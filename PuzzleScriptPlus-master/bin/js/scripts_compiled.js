/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */
if("function"!=typeof Blob||void 0===URL)if("function"==typeof Blob&&"undefined"!=typeof webkitURL)var URL=webkitURL;else var Blob=function(e){"use strict";var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},r=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},o=n.prototype,i=r.prototype,a=e.FileReaderSync,l=function(e){this.code=this[this.name=e]},s="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=s.length,u=e.URL||e.webkitURL||e,d=u.createObjectURL,h=u.revokeObjectURL,f=u,p=e.btoa,g=e.atob,m=!1,v=e.ArrayBuffer,y=e.Uint8Array;for(r.fake=i.fake=!0;c--;)l.prototype[s[c]]=c+1;try{y&&function(e){m=!e}.apply(0,new y(1))}catch(e){}return u.createObjectURL||(f=e.URL={}),f.createObjectURL=function(e){var t,n=e.type;return null===n&&(n="application/octet-stream"),e instanceof r?(t="data:"+n,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):p?t+";base64,"+p(e.data):t+","+encodeURIComponent(e.data)):d?d.call(u,e):void 0},f.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&h&&h.call(u,e)},o.append=function(e){var n=this.data;if(y&&(e instanceof v||e instanceof y))if(m)n.push(String.fromCharCode.apply(String,new y(e)));else for(var o=new y(e),i=0,s=o.length;i<s;i++)String.fromCharCode(o[i]);else if("Blob"===t(e)||"File"===t(e)){if(!a)throw new l("NOT_READABLE_ERR");var c=new a;n.push(c.readAsBinaryString(e))}else e instanceof r?"base64"===e.encoding&&g?n.push(g(e.data)):"URI"===e.encoding?n.push(decodeURIComponent(e.data)):"raw"===e.encoding&&n.push(e.data):("string"!=typeof e&&(e+=""),n.push(unescape(encodeURIComponent(e))))},o.getBlob=function(e){return arguments.length||(e=null),new r(this.data.join(""),e,"raw")},o.toString=function(){return"[object BlobBuilder]"},i.slice=function(e,t,n){var o=arguments.length;return o<3&&(n=null),new r(this.data.slice(e,o>1?t:this.data.length),n,this.encoding)},i.toString=function(){return"[object Blob]"},n}(e);return function(e,n){var r=n&&n.type||"",o=new t;if(e)for(var i=0,a=e.length;i<a;i++)o.append(e[i]);return o.getBlob(r)}}(self);
/*! @source http://purl.eligrey.com/github/canvas-toBlob.js/blob/master/canvas-toBlob.js */!function(e){"use strict";var t,n=e.Uint8Array,r=e.HTMLCanvasElement,o=/\s*;\s*base64\s*(?:;|$)/i,i=function(e){for(var r,o,i=e.length,a=new n(i/4*3|0),l=0,s=0,c=[0,0],u=0,d=0;i--;)o=e.charCodeAt(l++),255!==(r=t[o-43])&&undefined!==r&&(c[1]=c[0],c[0]=o,d=d<<6|r,4===++u&&(a[s++]=d>>>16,61!==c[1]&&(a[s++]=d>>>8),61!==c[0]&&(a[s++]=d),u=0));return a.buffer};n&&(t=new n([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),r&&!r.prototype.toBlob&&(r.prototype.toBlob=function(e,t){if(t||(t="image/png"),this.mozGetAsFile)e(this.mozGetAsFile("canvas",t));else{var r,a=Array.prototype.slice.call(arguments,1),l=this.toDataURL.apply(this,a),s=l.indexOf(","),c=l.substring(s+1),u=o.test(l.substring(0,s));Blob.fake?((r=new Blob).encoding=u?"base64":"URI",r.data=c,r.size=c.length):n&&(r=new Blob(u?[i(c)]:[decodeURIComponent(c)],{type:t})),e(r)}})}(self);
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){"use strict";var t=e.document,n=e.URL||e.webkitURL||e,r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,i=e.webkitRequestFileSystem,a=e.requestFileSystem||i||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},s="application/octet-stream",c=0,u=[],d=function(e,t,n){for(var r=(t=[].concat(t)).length;r--;){var o=e["on"+t[r]];if("function"==typeof o)try{o.call(e,n||e)}catch(e){l(e)}}},h=function(n,l){var h,f,p,g,m,v=this,y=n.type,_=!1,b=function(){var t=(e.URL||e.webkitURL||e).createObjectURL(n);return u.push(t),t},w=function(){d(v,"writestart progress write writeend".split(" "))},x=function(){!_&&h||(h=b()),f&&(f.location.href=h),v.readyState=v.DONE,w()},S=function(e){return function(){if(v.readyState!==v.DONE)return e.apply(this,arguments)}},k={create:!0,exclusive:!1};if(v.readyState=v.INIT,l||(l="download"),o)return h=b(),r.href=h,r.download=l,g=r,(m=t.createEvent("MouseEvents")).initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),g.dispatchEvent(m),v.readyState=v.DONE,void w();e.chrome&&y&&y!==s&&(p=n.slice||n.webkitSlice,n=p.call(n,0,n.size,s),_=!0),i&&"download"!==l&&(l+=".download"),f=y===s||i?e:e.open(),a?(c+=n.size,a(e.TEMPORARY,c,S((function(e){e.root.getDirectory("saved",k,S((function(e){var t=function(){e.getFile(l,k,S((function(e){e.createWriter(S((function(t){t.onwriteend=function(t){f.location.href=e.toURL(),u.push(e),v.readyState=v.DONE,d(v,"writeend",t)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&x()},"writestart progress write abort".split(" ").forEach((function(e){t["on"+e]=v["on"+e]})),t.write(n),v.abort=function(){t.abort(),v.readyState=v.DONE},v.readyState=v.WRITING})),x)})),x)};e.getFile(l,{create:!1},S((function(e){e.remove(),t()})),S((function(e){e.code===e.NOT_FOUND_ERR?t():x()})))})),x)})),x)):x()},f=h.prototype;return f.abort=function(){var e=this;e.readyState=e.DONE,d(e,"abort")},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,e.addEventListener("unload",(function(){for(var e=u.length;e--;){var t=u[e];"string"==typeof t?n.revokeObjectURL(t):t.remove()}u.length=0}),!1),function(e,t){return new h(e,t)}}(self);function storage_has(e){return null!==localStorage.getItem(e)}function storage_get(e){return localStorage.getItem(e)}function storage_set(e,t){return localStorage.setItem(e,t)}function storage_remove(e){localStorage.removeItem(e)}LZWEncoder=function(){var e,t,n,r,o,i,a,l,s,c,u,d,h={},f=-1,p=12,g=5003,m=p,v=1<<p,y=new Array,_=new Array,b=g,w=0,x=!1,S=0,k=0,C=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],M=[],T=h.LZWEncoder=function(o,i,a,l){e=o,t=i,n=a,r=Math.max(2,l)},E=function(e,t){M[d++]=e,d>=254&&R(t)},I=function(e){L(b),w=c+2,x=!0,D(c,e)},L=function(e){for(var t=0;t<e;++t)y[t]=-1},A=h.compress=function(e,t){var n,r,o,i,h,p,g;for(x=!1,l=O(a=s=e),u=(c=1<<e-1)+1,w=c+2,d=0,i=F(),g=0,n=b;n<65536;n*=2)++g;g=8-g,L(p=b),D(c,t);e:for(;(o=F())!=f;)if(n=(o<<m)+i,y[r=o<<g^i]!=n){if(y[r]>=0){h=p-r,0==r&&(h=1);do{if((r-=h)<0&&(r+=p),y[r]==n){i=_[r];continue e}}while(y[r]>=0)}D(i,t),i=o,w<v?(_[r]=w++,y[r]=n):I(t)}else i=_[r];D(i,t),D(u,t)},R=(h.encode=function(n){n.writeByte(r),o=e*t,i=0,A(r+1,n),n.writeByte(0)},function(e){d>0&&(e.writeByte(d),e.writeBytes(M,0,d),d=0)}),O=function(e){return(1<<e)-1},F=function(){return 0==o?f:(--o,255&n[i++])},D=function(e,t){for(S&=C[k],k>0?S|=e<<k:S=e,k+=a;k>=8;)E(255&S,t),S>>=8,k-=8;if((w>l||x)&&(x?(l=O(a=s),x=!1):(++a,l=a==m?v:O(a))),e==u){for(;k>0;)E(255&S,t),S>>=8,k-=8;R(t)}};return T.apply(this,arguments),h},NeuQuant=function(){var e,t,n,r,o,i={},a=256,l=499,s=491,c=487,u=503,d=3*u,h=a-1,f=4,p=100,g=16,m=1<<g,v=10,y=10,_=m>>y,b=m<<v-y,w=a>>3,x=6,S=1<<x,k=w*S,C=30,M=10,T=1<<M,E=8,I=1<<E,L=M+E,A=1<<L,R=new Array,O=new Array,F=new Array,D=new Array,P=i.NeuQuant=function(e,i,l){var s,c;for(t=e,n=i,r=l,o=new Array(a),s=0;s<a;s++)o[s]=new Array(4),(c=o[s])[0]=c[1]=c[2]=(s<<f+8)/a,F[s]=m/a,O[s]=0},N=function(){for(var e=[],t=new Array(a),n=0;n<a;n++)t[o[n][3]]=n;for(var r=0,i=0;i<a;i++){var l=t[i];e[r++]=o[l][0],e[r++]=o[l][1],e[r++]=o[l][2]}return e},B=function(){var e,t,n,r,i,l,s,c;for(s=0,c=0,e=0;e<a;e++){for(n=e,r=(i=o[e])[1],t=e+1;t<a;t++)(l=o[t])[1]<r&&(n=t,r=l[1]);if(l=o[n],e!=n&&(t=l[0],l[0]=i[0],i[0]=t,t=l[1],l[1]=i[1],i[1]=t,t=l[2],l[2]=i[2],i[2]=t,t=l[3],l[3]=i[3],i[3]=t),r!=s){for(R[s]=c+e>>1,t=s+1;t<r;t++)R[t]=e;s=r,c=e}}for(R[s]=c+h>>1,t=s+1;t<256;t++)R[t]=h},H=function(){var o,i,a,h,g,m,v,y,_,b,w,S,M,E;for(n<d&&(r=1),e=30+(r-1)/3,S=t,M=0,E=n,b=(w=n/(3*r))/p|0,y=T,(v=(m=k)>>x)<=1&&(v=0),o=0;o<v;o++)D[o]=y*((v*v-o*o)*I/(v*v));for(_=n<d?3:n%l!=0?3*l:n%s!=0?3*s:n%c!=0?3*c:3*u,o=0;o<w;)if(a=(255&S[M+0])<<f,h=(255&S[M+1])<<f,g=(255&S[M+2])<<f,i=V(a,h,g),W(y,i,a,h,g),0!=v&&j(v,i,a,h,g),(M+=_)>=E&&(M-=n),0==b&&(b=1),++o%b==0)for(y-=y/e,(v=(m-=m/C)>>x)<=1&&(v=0),i=0;i<v;i++)D[i]=y*((v*v-i*i)*I/(v*v))},z=(i.map=function(e,t,n){var r,i,l,s,c,u,d;for(c=1e3,d=-1,i=(r=R[t])-1;r<a||i>=0;)r<a&&((l=(u=o[r])[1]-t)>=c?r=a:(r++,l<0&&(l=-l),(s=u[0]-e)<0&&(s=-s),(l+=s)<c&&((s=u[2]-n)<0&&(s=-s),(l+=s)<c&&(c=l,d=u[3])))),i>=0&&((l=t-(u=o[i])[1])>=c?i=-1:(i--,l<0&&(l=-l),(s=u[0]-e)<0&&(s=-s),(l+=s)<c&&((s=u[2]-n)<0&&(s=-s),(l+=s)<c&&(c=l,d=u[3]))));return d},i.process=function(){return H(),z(),B(),N()},function(){var e;for(e=0;e<a;e++)o[e][0]>>=f,o[e][1]>>=f,o[e][2]>>=f,o[e][3]=e}),j=function(e,t,n,r,i){var l,s,c,u,d,h,f;for((c=t-e)<-1&&(c=-1),(u=t+e)>a&&(u=a),l=t+1,s=t-1,h=1;l<u||s>c;){if(d=D[h++],l<u){f=o[l++];try{f[0]-=d*(f[0]-n)/A,f[1]-=d*(f[1]-r)/A,f[2]-=d*(f[2]-i)/A}catch(e){}}if(s>c){f=o[s--];try{f[0]-=d*(f[0]-n)/A,f[1]-=d*(f[1]-r)/A,f[2]-=d*(f[2]-i)/A}catch(e){}}}},W=function(e,t,n,r,i){var a=o[t];a[0]-=e*(a[0]-n)/T,a[1]-=e*(a[1]-r)/T,a[2]-=e*(a[2]-i)/T},V=function(e,t,n){var r,i,l,s,c,u,d,h,p,m;for(p=h=~(1<<31),d=u=-1,r=0;r<a;r++)(i=(m=o[r])[0]-e)<0&&(i=-i),(l=m[1]-t)<0&&(l=-l),i+=l,(l=m[2]-n)<0&&(l=-l),(i+=l)<h&&(h=i,u=r),(s=i-(O[r]>>g-f))<p&&(p=s,d=r),c=F[r]>>y,F[r]-=c,O[r]+=c<<v;return F[u]+=_,O[u]-=b,d};return P.apply(this,arguments),i},GIFEncoder=function(){for(var e=0,t={};e<256;e++)t[e]=String.fromCharCode(e);function n(){this.bin=[]}n.prototype.getData=function(){for(var e="",n=this.bin.length,r=0;r<n;r++)e+=t[this.bin[r]];return e},n.prototype.writeByte=function(e){this.bin.push(e)},n.prototype.writeUTFBytes=function(e){for(var t=e.length,n=0;n<t;n++)this.writeByte(e.charCodeAt(n))},n.prototype.writeBytes=function(e,t,n){for(var r=n||e.length,o=t||0;o<r;o++)this.writeByte(e[o])};var r,o,i,a,l,s,c,u,d,h={},f=null,p=-1,g=0,m=!1,v=new Array,y=7,_=-1,b=!0,w=!1,x=10,S=(h.setDelay=function(e){g=Math.round(e/10)},h.setDispose=function(e){e>=0&&(_=e)},h.setRepeat=function(e){e>=0&&(p=e)},h.setTransparent=function(e){f=e},h.addFrame=function(e,t){if(null==e||!m||null==a)throw new Error("Please call start method before calling addFrame");var n=!0;try{t?l=e:(l=e.getImageData(0,0,e.canvas.width,e.canvas.height).data,w||k(e.canvas.width,e.canvas.height)),T(),C(),b&&(L(),R(),p>=0&&A()),E(),I(),b||R(),F(),b=!1}catch(e){n=!1}return n},h.finish=function(){if(!m)return!1;var e=!0;m=!1;try{a.writeByte(59)}catch(t){e=!1}return e},function(){i=0,l=null,s=null,c=null,d=null,!1,b=!0}),k=(h.setFrameRate=function(e){15!=e&&(g=Math.round(100/e))},h.setQuality=function(e){e<1&&(e=1),x=e},h.setSize=function(e,t){m&&!b||((r=e)<1&&(r=320),(o=t)<1&&(o=240),w=!0)}),C=(h.start=function(){S();var e=!0;!1,a=new n;try{a.writeUTFBytes("GIF89a")}catch(t){e=!1}return m=e},h.cont=function(){S();return!1,a=new n,m=!0},function(){var e=s.length,t=e/3;c=[];for(var n=new Set,r=0,o=0;o<t&&(n.add(((255&s[r++])<<16)+((255&s[r++])<<8)+(255&s[r++])),!(n.length>256));o++);if(n.length>256){y=7;var a=new NeuQuant(s,e,x);d=a.process(),r=0;for(o=0;o<t;o++){var l=a.map(255&s[r++],255&s[r++],255&s[r++]);v[l]=!0,c[o]=l}}else{d=Array.from(n),r=0;for(o=0;o<t;o++){l=d.indexOf(((255&s[r++])<<16)+((255&s[r++])<<8)+(255&s[r++]));v[l]=!0,c[o]=l}d=d.reduce((function(e,t,n,r){return e.concat(t>>>16,t>>>8&255,255&t)}),[]),-1===(y=Math.ceil(Math.log2(d.length/3))-1)&&(y=0)}s=null,u=8,null!=f&&(i=M(f))}),M=function(e){if(null==d)return-1;for(var t=(16711680&e)>>16,n=(65280&e)>>8,r=255&e,o=0,i=16777216,a=d.length,l=0;l<a;){var s=t-(255&d[l++]),c=n-(255&d[l++]),u=r-(255&d[l]),h=s*s+c*c+u*u,f=l/3;v[f]&&h<i&&(i=h,o=f),l++}return o},T=function(){var e=r,t=o;s=[];for(var n=l,i=0,a=0;a<t;a++)for(var c=0;c<e;c++){var u=a*e*4+4*c;s[i++]=n[u],s[i++]=n[u+1],s[i++]=n[u+2]}},E=function(){var e,t;a.writeByte(33),a.writeByte(249),a.writeByte(4),null==f?(e=0,t=0):(e=1,t=2),_>=0&&(t=7&_),t<<=2,a.writeByte(0|t|e),O(g),a.writeByte(i),a.writeByte(0)},I=function(){a.writeByte(44),O(0),O(0),O(r),O(o),b?a.writeByte(0):a.writeByte(128|y)},L=function(){O(r),O(o),a.writeByte(240|y),a.writeByte(0),a.writeByte(0)},A=function(){a.writeByte(33),a.writeByte(255),a.writeByte(11),a.writeUTFBytes("NETSCAPE2.0"),a.writeByte(3),a.writeByte(1),O(p),a.writeByte(0)},R=function(){a.writeBytes(d);for(var e=3*Math.pow(2,y+1)-d.length,t=0;t<e;t++)a.writeByte(0)},O=function(e){a.writeByte(255&e),a.writeByte(e>>8&255)},F=function(){new LZWEncoder(r,o,c,u).encode(a)};h.stream=function(){return a},h.setProperties=function(e,t){m=e,b=t};return h};var compiledText,canSetHTMLColors=!1,canDump=!0,canYoutube=!1,recordingStartsFromLevel=0,inputHistory=[],canOpenEditor=!0,IDE=!0;solving=!1;var debugger_turnIndex=0,debug_visualisation_array=[],diffToVisualize=null;function convertLevelToString(){for(var e="",t={},n=0,r=0;r<level.height;r++){for(var o=0;o<level.width;o++){for(var i=level.getCell(o+r*level.width),a=[],l=0;l<32*STRIDE_OBJ;++l)i.get(l)&&a.push(state.idDict[l]);a.sort(),a=a.join(" "),t.hasOwnProperty(a)||(t[a]=n++,e+=a+":"),e+=t[a]+","}e+="\n"}return e}function stripHTMLTags(e){var t=document.createElement("div");return t.innerHTML=e,(t.textContent||t.innerText||"").trim()}function dumpTestCase(){var e=[compiledText,errorStrings.map(stripHTMLTags),errorCount],t=JSON.stringify(e);t=`<br>\n\t[<br>\n\t\t"${state.metadata.title||"untitled test"}",<br>\n\t\t${t}<br>\n\t],`,consolePrint('<br>Compilation error/warning data (for error message tests - errormessage_testdata.js):<br><br><br><span id="'+(n="selectable"+ ++selectableint)+'" onclick="selectText(\''+n+"',event)\">"+t+"</span><br><br><br>",!0);var n;e=[compiledText,inputHistory.concat([]),convertLevelToString(),recordingStartsFromLevel,loadedLevelSeed],t=JSON.stringify(e);t=`<br>\n\t[<br>\n\t\t"${state.metadata.title||"untitled test"}",<br>\n\t\t${t}<br>\n\t],`,consolePrint('<br>Recorded play session data (for play session tests - testdata.js):<br><br><br><span id="'+(n="selectable"+ ++selectableint)+'" onclick="selectText(\''+n+"',event)\">"+t+"</span><br><br><br>",!0)}function clearInputHistory(){!0===canDump&&(inputHistory=[],recordingStartsFromLevel=curlevel)}function pushInput(e){!0===canDump&&inputHistory.push(e)}var unitTesting=!1,curlevel=0,solvedSections=[],curlevelTarget=null,hasUsedCheckpoint=!1,levelEditorOpened=!1,muted=0,runrulesonlevelstart_phase=!1,ignoreNotJustPressedAction=!0;function doSetupTitleScreenLevelContinue(){try{if(storage_has(document.URL)){if(storage_has(document.URL+"_checkpoint")){var e=storage_get(document.URL+"_checkpoint");curlevelTarget=JSON.parse(e);var t=[];for(var n in Object.keys(curlevelTarget.dat))t[n]=curlevelTarget.dat[n];curlevelTarget.dat=new Int32Array(t)}curlevel=storage_get(document.URL),void 0!==localStorage[document.URL+"_sections"]&&(solvedSections=JSON.parse(localStorage.getItem(document.URL+"_sections")))}}catch(e){}}doSetupTitleScreenLevelContinue();for(var verbose_logging=!1,throttle_movement=!1,cache_console_messages=!1,quittingTitleScreen=!1,quittingMessageScreen=!1,deltatime=17,timer=0,repeatinterval=150,autotick=0,autotickinterval=0,winning=!1,againing=!1,againinterval=150,norepeat_action=!1,oldflickscreendat=[],keybuffer=[],tweeninterval=0,tweentimer=0,restarting=!1,messageselected=!1,textImages={},initLevel={width:5,height:5,layerCount:2,dat:[1,3,3,1,1,2,2,3,3,1,2,1,2,2,3,3,1,1,2,2,3,2,1,3,2,1,3,2,1,3,1,3,3,1,1,2,2,3,3,1,2,1,2,2,3,3,1,1,2,2],movementMask:[1,3,3,1,1,2,2,3,3,1,2,1,2,2,3,3,1,1,2,2,3,2,1,3,2,1,3,2,1,3,1,3,3,1,1,2,2,3,3,1,2,1,2,2,3,3,1,1,2,2],rigidGroupIndexMask:[],rigidMovementAppliedMask:[],bannedGroup:[],colCellContents:[],rowCellContents:[],colCellContents_Movements:[],rowCellContents_Movements:[]},level=initLevel,font={0:"\n00000\n00000\n00000\n01110\n10001\n10011\n10101\n11001\n10001\n01110\n00000\n00000",1:"\n00000\n00000\n00000\n11100\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000",2:"\n00000\n00000\n00000\n11110\n00001\n00001\n01110\n10000\n10000\n11111\n00000\n00000",3:"\n00000\n00000\n00000\n11110\n00001\n00110\n00001\n00001\n00001\n11110\n00000\n00000",4:"\n00000\n00000\n00000\n10000\n10000\n10000\n10010\n11111\n00010\n00010\n00000\n00000",5:"\n00000\n00000\n00000\n11111\n10000\n11110\n00001\n00001\n00001\n11110\n00000\n00000",6:"\n00000\n00000\n00000\n01110\n10000\n11110\n10001\n10001\n10001\n01110\n00000\n00000",7:"\n00000\n00000\n00000\n11111\n00001\n00010\n00100\n00100\n00100\n00100\n00000\n00000",8:"\n00000\n00000\n00000\n01110\n10001\n01110\n10001\n10001\n10001\n01110\n00000\n00000",9:"\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n01111\n00001\n01110\n00000\n00000",a:"\n00000\n00000\n00000\n00000\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000",b:"\n00000\n00000\n00000\n10000\n10000\n11110\n10001\n10001\n10001\n01110\n00000\n00000",c:"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n01111\n00000\n00000",d:"\n00000\n00000\n00000\n00001\n00001\n01111\n10001\n10001\n10001\n01111\n00000\n00000",e:"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000",f:"\n00000\n00000\n00000\n00011\n00100\n11111\n00100\n00100\n00100\n00100\n00000\n00000",g:"\n00000\n00000\n00000\n00000\n00000\n01111\n10001\n10001\n10001\n01111\n00001\n01110",h:"\n00000\n00000\n00000\n10000\n10000\n11110\n10001\n10001\n10001\n10001\n00000\n00000",i:"\n00000\n00000\n00000\n00100\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000",j:"\n00000\n00000\n00000\n00100\n00000\n01100\n00100\n00100\n00100\n00100\n10100\n01000",k:"\n00000\n00000\n00000\n10000\n10000\n10001\n10010\n11100\n10010\n10001\n00000\n00000",l:"\n00000\n00000\n00000\n01100\n00100\n00100\n00100\n00100\n00100\n01110\n00000\n00000",m:"\n00000\n00000\n00000\n00000\n00000\n01010\n10101\n10101\n10101\n10101\n00000\n00000",n:"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n10001\n00000\n00000",o:"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000",p:"\n00000\n00000\n00000\n00000\n00000\n11110\n10001\n10001\n10001\n11110\n10000\n10000",q:"\n00000\n00000\n00000\n00000\n00000\n01111\n10001\n10001\n10001\n01111\n00001\n00001",r:"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10000\n00000\n00000",s:"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n01110\n00001\n11110\n00000\n00000",t:"\n00000\n00000\n00000\n00100\n00100\n11111\n00100\n00100\n00100\n00011\n00000\n00000",u:"\n00000\n00000\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000",v:"\n00000\n00000\n00000\n00000\n00000\n10001\n10010\n10100\n11000\n10000\n00000\n00000",w:"\n00000\n00000\n00000\n00000\n00000\n10101\n10101\n10101\n10101\n01010\n00000\n00000",x:"\n00000\n00000\n00000\n00000\n00000\n10001\n01010\n00100\n01010\n10001\n00000\n00000","×":"\n00000\n00000\n00000\n00000\n00000\n10001\n01010\n00100\n01010\n10001\n00000\n00000",y:"\n00000\n00000\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n01111\n00001\n11110",z:"\n00000\n00000\n00000\n00000\n00000\n11111\n00010\n00100\n01000\n11111\n00000\n00000",A:"\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000",B:"\n00000\n00000\n00000\n11110\n10001\n11110\n10001\n10001\n10001\n11110\n00000\n00000",C:"\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10000\n10000\n01111\n00000\n00000",D:"\n00000\n00000\n00000\n11110\n10001\n10001\n10001\n10001\n10001\n11110\n00000\n00000",E:"\n00000\n00000\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000",F:"\n00000\n00000\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n10000\n00000\n00000",G:"\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10011\n10001\n01111\n00000\n00000",H:"\n00000\n00000\n00000\n10001\n10001\n11111\n10001\n10001\n10001\n10001\n00000\n00000",I:"\n00000\n00000\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000",J:"\n00000\n00000\n00000\n01111\n00001\n00001\n00001\n00001\n00001\n01110\n00000\n00000",K:"\n00000\n00000\n00000\n10001\n10010\n10100\n11000\n10100\n10010\n10001\n00000\n00000",L:"\n00000\n00000\n00000\n10000\n10000\n10000\n10000\n10000\n10000\n11111\n00000\n00000",M:"\n00000\n00000\n00000\n11111\n10101\n10101\n10101\n10101\n10101\n10101\n00000\n00000",N:"\n00000\n00000\n00000\n10001\n11001\n10101\n10011\n10001\n10001\n10001\n00000\n00000",O:"\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000",P:"\n00000\n00000\n00000\n11110\n10001\n10001\n10001\n11110\n10000\n10000\n00000\n00000",Q:"\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n10001\n10101\n01110\n00100\n00000",R:"\n00000\n00000\n00000\n11110\n10001\n10001\n11110\n10001\n10001\n10001\n00000\n00000",S:"\n00000\n00000\n00000\n01111\n10000\n01110\n00001\n00001\n00001\n11110\n00000\n00000",T:"\n00000\n00000\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n00100\n00000\n00000",U:"\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000",V:"\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n10001\n01010\n00100\n00000\n00000",W:"\n00000\n00000\n00000\n10101\n10101\n10101\n10101\n10101\n10101\n01010\n00000\n00000",X:"\n00000\n00000\n00000\n10001\n10001\n01010\n00100\n01010\n10001\n10001\n00000\n00000",Y:"\n00000\n00000\n00000\n10001\n10001\n01010\n00100\n00100\n00100\n00100\n00000\n00000",Z:"\n00000\n00000\n00000\n11111\n00001\n00010\n00100\n01000\n10000\n11111\n00000\n00000",".":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00100\n00000\n00000","·":"\n00000\n00000\n00000\n00000\n00000\n00000\n00100\n00000\n00000\n00000\n00000\n00000","•":"\n00000\n00000\n00000\n00000\n00000\n01110\n01110\n01110\n00000\n00000\n00000\n00000","…":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n10101\n00000\n00000","†":"\n00000\n00100\n00100\n01110\n00100\n00100\n00100\n00100\n00100\n00100\n00000\n00000","‡":"\n00000\n00100\n00100\n01110\n00100\n00100\n00100\n00100\n01110\n00100\n00000\n00000","ƒ":"\n00000\n00000\n00000\n00011\n00100\n11111\n00100\n00100\n00100\n00100\n01000\n00000","‚":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00100\n01100\n00000\n00000","„":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n01001\n11011\n00000\n00000",",":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00100\n01100\n00000\n00000",";":"\n00000\n00000\n00000\n00000\n00000\n00100\n00000\n00000\n00100\n01100\n00000\n00000",":":"\n00000\n00000\n00000\n00000\n00000\n00100\n00000\n00000\n00000\n00100\n00000\n00000","?":"\n00000\n00000\n00000\n01110\n10001\n00001\n00001\n00110\n00000\n00100\n00000\n00000","¿":"\n00000\n00000\n00000\n00100\n00000\n01100\n10000\n10000\n10001\n01110\n00000\n00000","!":"\n00000\n00000\n00000\n00100\n00100\n00100\n00100\n00100\n00000\n00100\n00000\n00000","¡":"\n00000\n00000\n00000\n00100\n00000\n00100\n00100\n00100\n00100\n00100\n00000\n00000","@":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10111\n10000\n01110\n00000\n00000","£":"\n00000\n00000\n00000\n00000\n00000\n01110\n01001\n11100\n01000\n11111\n00000\n00000",$:"\n00000\n00000\n00000\n00000\n00100\n01111\n10100\n01110\n00101\n11110\n00100\n00000","%":"\n00000\n00000\n00000\n00000\n00000\n11001\n11010\n00100\n01011\n10011\n00000\n00000","‰":"\n00000\n00000\n00000\n00000\n11001\n11010\n00100\n01011\n10011\n00000\n00011\n00011","^":"\n00000\n00000\n00000\n00100\n01010\n00000\n00000\n00000\n00000\n00000\n00000\n00000","&":"\n00000\n00000\n00000\n00000\n00000\n01100\n10000\n01011\n10010\n01100\n00000\n00000","*":"\n00000\n00000\n00000\n00000\n00000\n01010\n00100\n01010\n00000\n00000\n00000\n00000","(":"\n00000\n00000\n00000\n00010\n00100\n00100\n00100\n00100\n00100\n00010\n00000\n00000",")":"\n00000\n00000\n00000\n01000\n00100\n00100\n00100\n00100\n00100\n01000\n00000\n00000","+":"\n00000\n00000\n00000\n00000\n00000\n00100\n00100\n11111\n00100\n00100\n00000\n00000","÷":"\n00000\n00000\n00000\n00000\n00000\n00100\n00000\n11111\n00000\n00100\n00000\n00000","±":"\n00000\n00000\n00000\n00000\n00000\n00100\n00100\n11111\n00100\n11111\n00000\n00000","-":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n01110\n00000\n00000\n00000\n00000","–":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n11110\n00000\n00000\n00000\n00000","—":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n11111\n00000\n00000\n00000\n00000",_:"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n11111\n00000\n00000","=":"\n00000\n00000\n00000\n00000\n00000\n00000\n11111\n00000\n11111\n00000\n00000\n00000"," ":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000","{":"\n00000\n00000\n00000\n00110\n00100\n00100\n01100\n00100\n00100\n00110\n00000\n00000","}":"\n00000\n00000\n00000\n01100\n00100\n00100\n00110\n00100\n00100\n01100\n00000\n00000","[":"\n00000\n00000\n00000\n00110\n00100\n00100\n00100\n00100\n00100\n00110\n00000\n00000","]":"\n00000\n00000\n00000\n01100\n00100\n00100\n00100\n00100\n00100\n01100\n00000\n00000","'":"\n00000\n00000\n00000\n00100\n00100\n00100\n00000\n00000\n00000\n00000\n00000\n00000","‘":"\n00000\n00000\n00000\n00110\n00100\n00000\n00000\n00000\n00000\n00000\n00000\n00000","’":"\n00000\n00000\n00000\n00100\n01100\n00000\n00000\n00000\n00000\n00000\n00000\n00000","“":"\n00000\n00000\n00000\n11011\n10010\n00000\n00000\n00000\n00000\n00000\n00000\n00000","”":"\n00000\n00000\n00000\n01001\n11011\n00000\n00000\n00000\n00000\n00000\n00000\n00000",'"':"\n00000\n00000\n00000\n01010\n01010\n01010\n00000\n00000\n00000\n00000\n00000\n00000","/":"\n00000\n00000\n00000\n00000\n00000\n00001\n00010\n00100\n01000\n10000\n00000\n00000","\\":"\n00000\n00000\n00000\n00000\n00000\n10000\n01000\n00100\n00010\n00001\n00000\n00000","|":"\n00100\n00100\n00100\n00100\n00100\n00100\n00100\n00100\n00100\n00100\n00100\n00100","¦":"\n00000\n00000\n00000\n00000\n00100\n00100\n00000\n00100\n00100\n00100\n00000\n00000","<":"\n00000\n00000\n00000\n00000\n00000\n00010\n00100\n01000\n00100\n00010\n00000\n00000","‹":"\n00000\n00000\n00000\n00000\n00000\n00000\n00100\n01000\n00100\n00000\n00000\n00000","«":"\n00000\n00000\n00000\n00000\n00000\n00000\n01001\n10010\n01001\n00000\n00000\n00000",">":"\n00000\n00000\n00000\n00000\n00000\n01000\n00100\n00010\n00100\n01000\n00000\n00000","›":"\n00000\n00000\n00000\n00000\n00000\n00000\n00100\n00010\n00100\n00000\n00000\n00000","»":"\n00000\n00000\n00000\n00000\n00000\n00000\n10010\n01001\n10010\n00000\n00000\n00000","~":"\n00000\n00000\n00000\n00000\n00000\n00000\n01000\n10101\n00010\n00000\n00000\n00000","˜":"\n00000\n00000\n00000\n00000\n00000\n01010\n10100\n00000\n00000\n00000\n00000\n00000","`":"\n00000\n00000\n00000\n00000\n00000\n01000\n00100\n00000\n00000\n00000\n00000\n00000","#":"\n00000\n00000\n00000\n00000\n00000\n01010\n11111\n01010\n11111\n01010\n00000\n00000","À":"\n01000\n00100\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","Á":"\n00010\n00100\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","Â":"\n00100\n01010\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","Ã":"\n01000\n10101\n00010\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","Ä":"\n00000\n01010\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","Å":"\n00100\n01010\n00100\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","Æ":"\n00000\n00000\n00000\n01111\n10100\n10100\n10100\n11111\n10100\n10111\n00000\n00000","Ç":"\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10000\n10000\n01111\n00100\n01000","È":"\n01000\n00100\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","É":"\n00010\n00100\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","Ê":"\n00100\n01010\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","Ë":"\n00000\n01010\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","Ì":"\n01000\n00100\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","Í":"\n00010\n00100\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","Î":"\n00100\n01010\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","Ï":"\n00000\n01010\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","Ð":"\n00000\n00000\n00000\n01110\n01001\n01001\n11101\n01001\n01001\n01110\n00000\n00000","Ñ":"\n01001\n10110\n00000\n10001\n11001\n10101\n10011\n10001\n10001\n10001\n00000\n00000","Ò":"\n01000\n00100\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ó":"\n00010\n00100\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ô":"\n00100\n01010\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Õ":"\n01001\n10110\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ö":"\n00000\n01010\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ø":"\n00000\n00010\n00100\n01110\n10101\n10101\n10101\n10101\n10101\n01110\n00100\n01000","Ù":"\n00000\n01000\n00100\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ú":"\n00000\n00010\n00100\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Û":"\n00100\n01010\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ü":"\n00000\n01010\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ý":"\n\t00000\n\t00000\n\t00000\n\t00000\n\t00000\n\t10001\n\t10010\n\t10100\n\t11000\n\t10000\n\t00000\n\t00000","Þ":"\n00000\n00000\n10000\n11110\n10001\n10001\n10001\n10001\n10001\n11110\n10000\n00000","ß":"\n00000\n00000\n00000\n01110\n10001\n10110\n10001\n10001\n10001\n10110\n10000\n00000","ẞ":"\n00000\n00000\n00000\n01110\n10001\n10110\n10001\n10001\n10001\n10110\n00000\n00000","à":"\n00000\n00000\n01000\n00100\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","á":"\n00000\n00000\n00010\n00100\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","â":"\n00000\n00000\n00100\n01010\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","ã":"\n00000\n00000\n01001\n10110\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","ä":"\n00000\n00000\n00000\n01010\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","å":"\n00000\n00100\n01010\n00100\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","æ":"\n00000\n00000\n00000\n00000\n00000\n01110\n10101\n10110\n10100\n01111\n00000\n00000","ç":"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n01111\n00100\n01000","è":"\n00000\n00000\n01000\n00100\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","é":"\n00000\n00000\n00010\n00100\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","ê":"\n00000\n00000\n00100\n01010\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","ë":"\n00000\n00000\n00000\n01010\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","ì":"\n00000\n00000\n01000\n00100\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","í":"\n00000\n00000\n00010\n00100\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","î":"\n00000\n00000\n00100\n01010\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","ï":"\n00000\n00000\n00000\n01010\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","ð":"\n00000\n00000\n00010\n00111\n00010\n01110\n10010\n10010\n10010\n01110\n00000\n00000","ñ":"\n\t00000\n\t00000\n\t00000\n\t00000\n\t00000\n\t01010\n\t10101\n\t10101\n\t10101\n\t10101\n\t00000\n\t00000","ò":"\n00000\n00000\n01000\n00100\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","ó":"\n00000\n00000\n00010\n00100\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","ô":"\n00000\n00000\n00100\n01010\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","õ":"\n00000\n00000\n01001\n10110\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","ö":"\n00000\n00000\n00000\n01010\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","ø":"\n00000\n00000\n00000\n00010\n00100\n01110\n10101\n10101\n10101\n01110\n00100\n01000","ù":"\n00000\n00000\n00000\n01000\n00100\n10001\n10001\n10001\n10001\n01111\n00000\n00000","ú":"\n00000\n00000\n00000\n00010\n00100\n10001\n10001\n10001\n10001\n01111\n00000\n00000","û":"\n00000\n00000\n00100\n01010\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000","ü":"\n00000\n00000\n00000\n01010\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000","ý":"\n00000\n00000\n00000\n00010\n00100\n10001\n10001\n10001\n10001\n01111\n00001\n11110","þ":"\n00000\n00000\n00000\n10000\n10000\n11110\n10001\n10001\n10001\n11110\n10000\n10000","ÿ":"\n00000\n00000\n00000\n01010\n00000\n10001\n10001\n10001\n10001\n01111\n00001\n11110","Ā":"\n00000\n01110\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","ā":"\n00000\n00000\n00000\n00000\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","Ă":"\n01010\n00100\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","ă":"\n00000\n00000\n01010\n00100\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","Ą":"\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00010\n00001","ą":"\n00000\n00000\n00000\n00000\n00000\n01111\n10001\n10001\n10001\n01111\n00010\n00001","Ć":"\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10000\n10000\n01111\n00000\n00000","ć":"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n01111\n00000\n00000","Ĉ":"\n00100\n01010\n00000\n01111\n10000\n10000\n10000\n10000\n10000\n01111\n00000\n00000","ĉ":"\n00000\n00000\n00100\n01010\n00000\n01111\n10000\n10000\n10000\n01111\n00000\n00000","Ċ":"\n00000\n00100\n00000\n01111\n10000\n10000\n10000\n10000\n10000\n01111\n00000\n00000","ċ":"\n00000\n00000\n00000\n00100\n00000\n01111\n10000\n10000\n10000\n01111\n00000\n00000","Č":"\n01010\n00100\n00000\n01111\n10000\n10000\n10000\n10000\n10000\n01111\n00000\n00000","č":"\n00000\n00000\n01010\n00100\n00000\n01111\n10000\n10000\n10000\n01111\n00000\n00000","Ď":"\n01010\n00100\n00000\n11110\n10001\n10001\n10001\n10001\n10001\n11110\n00000\n00000","ď":"\n\t00000\n\t00000\n\t00000\n\t00001\n\t00001\n\t01111\n\t10001\n\t10001\n\t10001\n\t01111\n\t00000\n\t00000","Đ":"\n00000\n00000\n00000\n01110\n01001\n01001\n11101\n01001\n01001\n01110\n00000\n00000","đ":"\n00000\n00000\n00010\n00111\n00010\n01110\n10010\n10010\n10010\n01110\n00000\n00000","Ē":"\n00000\n01110\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","ē":"\n00000\n00000\n00000\n01110\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","Ĕ":"\n01010\n00100\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","ĕ":"\n00000\n00000\n01010\n00100\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","Ė":"\n00000\n00100\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","ė":"\n00000\n00000\n00000\n00100\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","Ę":"\n00000\n00000\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00010\n00001","ę":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n11111\n10000\n01110\n00010\n00001","Ě":"\n01010\n00100\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11110\n00000\n00000","ě":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","Ĝ":"\n00100\n01010\n00000\n01111\n10000\n10000\n10000\n10011\n10001\n01111\n00000\n00000","ĝ":"\n00000\n00000\n00100\n01010\n00000\n01111\n10001\n10001\n10001\n01111\n00001\n01110","Ğ":"\n01010\n00100\n00000\n01111\n10000\n10000\n10000\n10011\n10001\n01111\n00000\n00000","ğ":"\n00000\n00000\n01010\n00100\n00000\n01111\n10001\n10001\n10001\n01111\n00001\n01110","Ġ":"\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10011\n10001\n01111\n00000\n00000","ġ":"\n00000\n00000\n00000\n00100\n00000\n01111\n10001\n10001\n10001\n01111\n00001\n01110","Ģ":"\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10011\n10001\n01111\n00000\n01100","ģ":"\n00010\n00100\n00000\n01111\n10000\n10000\n10000\n10011\n10001\n01111\n00000\n00000","Ĥ":"\n00100\n01010\n00000\n10001\n10001\n11111\n10001\n10001\n10001\n10001\n00000\n00000","ĥ":"\n00100\n01010\n00000\n10000\n10000\n11110\n10001\n10001\n10001\n10001\n00000\n00000","Ħ":"\n00000\n00000\n01010\n11111\n01010\n01110\n01010\n01010\n01010\n01010\n00000\n00000","ħ":"\n00000\n00000\n01000\n11100\n01000\n01110\n01001\n01001\n01001\n01001\n00000\n00000","Ĩ":"\n01001\n10110\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","ĩ":"\n01010\n10100\n00000\n00100\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","Ī":"\n00000\n01110\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","ī":"\n00000\n00000\n00000\n01110\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","Ĭ":"\n01010\n00100\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","ĭ":"\n00000\n00000\n01010\n00100\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","Į":"\n00000\n00000\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00010\n00001","į":"\n00000\n00000\n00000\n00100\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","İ":"\n00000\n00100\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","ı":"\n00000\n00000\n00000\n00000\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","Ĳ":"\n00000\n00000\n00000\n10010\n10010\n10010\n10010\n10010\n10010\n10110\n00000\n00000","ĳ":"\n00000\n00000\n00000\n01001\n00000\n11001\n01001\n01001\n01001\n11101\n00001\n00010","Ĵ":"\n00010\n00101\n00000\n01111\n00001\n00001\n00001\n00001\n00001\n01110\n00000\n00000","ĵ":"\n00000\n00000\n00100\n01010\n00000\n01100\n00100\n00100\n00100\n00100\n10100\n01000","Ķ":"\n00000\n00000\n00000\n10001\n10010\n10100\n11000\n10100\n10010\n10001\n00100\n01000","ķ":"\n00000\n00000\n00000\n10000\n10000\n10001\n10010\n11100\n10010\n10001\n00000\n00000","ĸ":"\n00000\n00000\n00000\n00000\n00000\n10001\n10010\n11100\n10010\n10001\n00000\n00000","Ĺ":"\n00000\n00000\n00000\n10000\n10000\n10000\n10000\n10000\n10000\n11111\n00000\n00000","ĺ":"\n00010\n00100\n00000\n01100\n00100\n00100\n00100\n00100\n00100\n01110\n00000\n00000","Ļ":"\n00000\n00000\n00000\n10000\n10000\n10000\n10000\n10000\n10000\n11111\n00000\n00100","ļ":"\n00000\n00000\n00000\n01100\n00100\n00100\n00100\n00100\n00100\n01110\n00000\n00100","Ľ":"\n00000\n00000\n00000\n10010\n10010\n10000\n10000\n10000\n10000\n11111\n00000\n00000","ľ":"\n00000\n00000\n00000\n01100\n00100\n00100\n00100\n00100\n00100\n01110\n00000\n00000","Ŀ":"\n00000\n00000\n00000\n10000\n10000\n10100\n10000\n10000\n10000\n11111\n00000\n00000","ŀ":"\n00000\n00000\n00000\n01100\n00100\n00100\n00101\n00100\n00100\n01110\n00000\n00000","Ł":"\n00000\n00000\n00000\n01000\n01010\n01100\n11000\n01000\n01000\n01111\n00000\n00000","ł":"\n00000\n00000\n00000\n01100\n00100\n00100\n00110\n01100\n00100\n01110\n00000\n00000","Ń":"\n00000\n00000\n00000\n10001\n11001\n10101\n10011\n10001\n10001\n10001\n00000\n00000","ń":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n10001\n00000\n00000","Ņ":"\n00000\n00000\n00000\n10001\n11001\n10101\n10011\n10001\n10001\n10001\n00100\n01000","ņ":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n10001\n00100\n01000","Ň":"\n00000\n01010\n00100\n10001\n11001\n10101\n10011\n10001\n10001\n10001\n00000\n00000","ň":"\n00000\n00000\n01010\n00100\n00000\n01110\n10001\n10001\n10001\n10001\n00000\n00000","ŉ":"\n00000\n00000\n00000\n10000\n10000\n00110\n01001\n01001\n01001\n01001\n00000\n00000","Ŋ":"\n00000\n00000\n00000\n10001\n11001\n10101\n10011\n10001\n10001\n10001\n00001\n00010","ŋ":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n10001\n00001\n00010","Ō":"\n00000\n01110\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ō":"\n00000\n00000\n00000\n01110\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","Ŏ":"\n01010\n00100\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ŏ":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","Ő":"\n01001\n10010\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ő":"\n00000\n00000\n01001\n10010\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","Œ":"\n00000\n00000\n00000\n01111\n10100\n10100\n10111\n10100\n10100\n01111\n00000\n00000","œ":"\n00000\n00000\n00000\n00000\n00000\n01110\n10101\n10110\n10100\n01111\n00000\n00000","Ŕ":"\n00010\n00100\n00000\n11110\n10001\n10001\n11110\n10001\n10001\n10001\n00000\n00000","ŕ":"\n00000\n00000\n00010\n00100\n00000\n01111\n10000\n10000\n10000\n10000\n00000\n00000","Ŗ":"\n00000\n00000\n00000\n11110\n10001\n10001\n11110\n10001\n10001\n10001\n00100\n01000","ŗ":"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10000\n00100\n01000","Ř":"\n01010\n00100\n00000\n11110\n10001\n10001\n11110\n10001\n10001\n10001\n00000\n00000","ř":"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10000\n00000\n00000","Ś":"\n00000\n00000\n00000\n01111\n10000\n01110\n00001\n00001\n00001\n11110\n00000\n00000","ś":"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n01110\n00001\n11110\n00000\n00000","Ŝ":"\n00100\n01010\n00000\n01111\n10000\n01110\n00001\n00001\n00001\n11110\n00000\n00000","ŝ":"\n00000\n00000\n00100\n01010\n00000\n01111\n10000\n01110\n00001\n11110\n00000\n00000","Ş":"\n00000\n00000\n00000\n01111\n10000\n01110\n00001\n00001\n00001\n11110\n00100\n00000","ş":"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n01110\n00001\n11110\n00100\n01000","Š":"\n01010\n00100\n00000\n01111\n10000\n01110\n00001\n00001\n00001\n11110\n00000\n00000","š":"\n00000\n00000\n01010\n00100\n00000\n01111\n10000\n01110\n00001\n11110\n00000\n00000","Ţ":"\n00000\n00000\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n00100\n00010\n00100","ţ":"\n00000\n00000\n00000\n00100\n00100\n11111\n00100\n00100\n00100\n00011\n00000\n01100","Ť":"\n01010\n00100\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n00100\n00000\n00000","ť":"\n00000\n00000\n00000\n00100\n00100\n11111\n00100\n00100\n00100\n00011\n00000\n00000","Ŧ":"\n00000\n00000\n00000\n11111\n00100\n00100\n01110\n00100\n00100\n00100\n00000\n00000","ŧ":"\n00000\n00000\n00000\n00100\n00100\n11111\n00100\n01110\n00100\n00011\n00000\n00000","Ũ":"\n01001\n10110\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ũ":"\n00000\n00000\n01001\n10110\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000","Ū":"\n00000\n01110\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ū":"\n00000\n00000\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000","Ŭ":"\n01010\n00100\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ŭ":"\n00000\n00000\n01010\n00100\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000","Ů":"\n00100\n01010\n00100\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ů":"\n00000\n00000\n00100\n01010\n00100\n10001\n10001\n10001\n10001\n01111\n00000\n00000","Ű":"\n01001\n10010\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ű":"\n00000\n00000\n01001\n10010\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000","Ų":"\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00100\n00010","ų":"\n00000\n00000\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n01111\n00010\n00001","Ŵ":"\n00100\n01010\n00000\n10101\n10101\n10101\n10101\n10101\n10101\n01010\n00000\n00000","ŵ":"\n00000\n00000\n00000\n00000\n00000\n10101\n10101\n10101\n10101\n01010\n00000\n00000","Ŷ":"\n00100\n01010\n00000\n10001\n10001\n01010\n00100\n00100\n00100\n00100\n00000\n00000","ŷ":"\n00000\n00000\n00100\n01010\n00000\n10001\n10001\n10001\n10001\n01111\n00001\n11110","Ÿ":"\n00000\n01010\n00000\n10001\n10001\n01010\n00100\n00100\n00100\n00100\n00000\n00000","Ź":"\n00010\n00100\n00000\n11111\n00001\n00010\n00100\n01000\n10000\n11111\n00000\n00000","ź":"\n00000\n00000\n00010\n00100\n00000\n11111\n00010\n00100\n01000\n11111\n00000\n00000","Ż":"\n00000\n00100\n00000\n11111\n00001\n00010\n00100\n01000\n10000\n11111\n00000\n00000","ż":"\n00000\n00000\n00000\n00100\n00000\n11111\n00010\n00100\n01000\n11111\n00000\n00000","Ž":"\n01010\n00100\n00000\n11111\n00001\n00010\n00100\n01000\n10000\n11111\n00000\n00000","ž":"\n00000\n00000\n01010\n00100\n00000\n11111\n00010\n00100\n01000\n11111\n00000\n00000","€":"\n00000\n00000\n00000\n00111\n01000\n11110\n01000\n11110\n01000\n00111\n00000\n00000","™":"\n00000\n11111\n00100\n00100\n00100\n00000\n01010\n10101\n10101\n10101\n00000\n00000","¢":"\n00000\n00000\n00000\n00010\n00100\n01111\n10100\n10100\n10100\n01111\n00100\n01000","¤":"\n00000\n00000\n00000\n00000\n10001\n01110\n10001\n10001\n01110\n10001\n00000\n00000","¥":"\n00000\n00000\n10001\n01010\n00100\n01110\n00100\n01110\n00100\n00000\n00000","§":"\n00000\n00000\n00000\n01110\n10000\n01110\n10001\n01110\n00001\n01110\n00000\n00000","¨":"\n00000\n00000\n00000\n01010\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000","©":"\n00000\n00000\n00000\n01110\n10001\n10111\n10101\n10111\n10001\n01110\n00000\n00000","®":"\n00000\n00000\n00000\n01110\n10001\n10111\n10101\n10101\n10001\n01110\n00000\n00000","ª":"\n00000\n01110\n00010\n01110\n01010\n01110\n00000\n00000\n00000\n00000\n00000\n00000","º":"\n00000\n00100\n01010\n01010\n01010\n00100\n00000\n00000\n00000\n00000\n00000\n00000","¬":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n01110\n00010\n00000\n00000\n00000","¯":"\n00000\n00000\n00000\n01110\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000","°":"\n00000\n00000\n00100\n01010\n00100\n00000\n00000\n00000\n00000\n00000\n00000\n00000","✓":"\n00000\n00000\n00000\n00000\n00000\n00001\n00010\n10100\n01000\n00000\n00000\n00000"},fontKeys=Object.keys(font),fontIndex={},i=0;i<fontKeys.length;i++)fontIndex[fontKeys[i]]=i;function RC4(e){this.s=new Array(256),this.i=0,this.j=0;for(var t=0;t<256;t++)this.s[t]=t;e&&this.mix(e)}function print_call_stack(){var e=(new Error).stack;console.log(e)}function RNG(e){this.seed=e,null==e?e=(Math.random()+Date.now()).toString():"function"==typeof e?(this.uniform=e,this.nextByte=function(){return~~(256*this.uniform())},e=null):"[object String]"!==Object.prototype.toString.call(e)&&(e=JSON.stringify(e)),this._normal=null,this._state=e?new RC4(e):null}
/**
 * Seedable random number generator functions.
 * @version 1.0.0
 * @license Public Domain
 *
 * @example
 * var rng = new RNG('Example');
 * rng.random(40, 50);  // =>  42
 * rng.uniform();       // =>  0.7972798995050903
 * rng.normal();        // => -0.6698504543216376
 * rng.exponential();   // =>  1.0547367609131555
 * rng.poisson(4);      // =>  2
 * rng.gamma(4);        // =>  2.781724687386858
 */
String.prototype.getBytes=function(){for(var e=[],t=0;t<this.length;t++){var n=this.charCodeAt(t),r=[];do{r.push(255&n),n>>=8}while(n>0);e=e.concat(r.reverse())}return e},RC4.prototype._swap=function(e,t){var n=this.s[e];this.s[e]=this.s[t],this.s[t]=n},RC4.prototype.mix=function(e){for(var t=e.getBytes(),n=0,r=0;r<this.s.length;r++)n+=this.s[r]+t[r%t.length],n%=256,this._swap(r,n)},RC4.prototype.next=function(){return this.i=(this.i+1)%256,this.j=(this.j+this.s[this.i])%256,this._swap(this.i,this.j),this.s[(this.s[this.i]+this.s[this.j])%256]},RNG.prototype.nextByte=function(){return this._state.next()},RNG.prototype.uniform=function(){for(var e=0,t=0;t<7;t++)e*=256,e+=this.nextByte();return e/(Math.pow(2,56)-1)},RNG.prototype.random=function(e,t){return null==e?this.uniform():(null==t&&(t=e,e=0),e+Math.floor(this.uniform()*(t-e)))},RNG.prototype.normal=function(){if(null!==this._normal){var e=this._normal;return this._normal=null,e}var t=this.uniform()||Math.pow(2,-53),n=this.uniform();return this._normal=Math.sqrt(-2*Math.log(t))*Math.sin(2*Math.PI*n),Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*n)},RNG.prototype.exponential=function(){return-Math.log(this.uniform()||Math.pow(2,-53))},RNG.prototype.poisson=function(e){var t=Math.exp(-(e||1)),n=0,r=1;do{n++,r*=this.uniform()}while(r>t);return n-1},RNG.prototype.gamma=function(e){var t=(e<1?1+e:e)-1/3,n=1/Math.sqrt(9*t);do{do{var r=this.normal(),o=Math.pow(n*r+1,3)}while(o<=0);var i=this.uniform(),a=Math.pow(r,2)}while(i>=1-.0331*a*a&&Math.log(i)>=.5*a+t*(1-o+Math.log(o)));return e<1?t*o*Math.exp(this.exponential()/-e):t*o},RNG.roller=function(e,t){var n=e.split(/(\d+)?d(\d+)([+-]\d+)?/).slice(1),r=parseFloat(n[0])||1,o=parseFloat(n[1]),i=parseFloat(n[2])||0;return t=t||new RNG,function(){for(var e=r+i,n=0;n<r;n++)e+=t.random(o);return e}};var FastBase64_chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",FastBase64_encLookup=[];function FastBase64_Init(){for(var e=0;e<4096;e++)FastBase64_encLookup[e]=FastBase64_chars[e>>6]+FastBase64_chars[63&e]}function FastBase64_Encode(e){for(var t=e.length,r="",o=0;t>2;)n=e[o]<<16|e[o+1]<<8|e[o+2],r+=FastBase64_encLookup[n>>12]+FastBase64_encLookup[4095&n],t-=3,o+=3;if(t>0){var i=(252&e[o])>>2,a=(3&e[o])<<4;if(t>1&&(a|=(240&e[++o])>>4),r+=FastBase64_chars[i],r+=FastBase64_chars[a],2==t){var l=(15&e[o++])<<2;l|=(192&e[o])>>6,r+=FastBase64_chars[l]}1==t&&(r+="="),r+="="}return r}function u32ToArray(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function u16ToArray(e){return[255&e,e>>8&255]}function MakeRiff(e,t,n){var r,o={chunkId:[82,73,70,70],chunkSize:0,format:[87,65,86,69],subChunk1Id:[102,109,116,32],subChunk1Size:16,audioFormat:1,numChannels:1,sampleRate:e,byteRate:0,blockAlign:0,bitsPerSample:t,subChunk2Id:[100,97,116,97],subChunk2Size:0};return o.byteRate=o.sampleRate*o.numChannels*o.bitsPerSample>>3,o.blockAlign=o.numChannels*o.bitsPerSample>>3,o.subChunk2Size=n.length,o.chunkSize=36+o.subChunk2Size,{dat:[],wav:r=o.chunkId.concat(u32ToArray(o.chunkSize),o.format,o.subChunk1Id,u32ToArray(o.subChunk1Size),u16ToArray(o.audioFormat),u16ToArray(o.numChannels),u32ToArray(o.sampleRate),u32ToArray(o.byteRate),u16ToArray(o.blockAlign),u16ToArray(o.bitsPerSample),o.subChunk2Id,u32ToArray(o.subChunk2Size),n),header:o,dataURI:"data:audio/wav;base64,"+FastBase64_Encode(r)}}FastBase64_Init(),"undefined"!=typeof exports&&(exports.RIFFWAVE=RIFFWAVE);var AUDIO_CONTEXT,SOUND_VOL=.25,QUIET_SOUND_VOL=.1,SAMPLE_RATE=5512,BIT_DEPTH=8,SQUARE=0,SAWTOOTH=1,SINE=2,NOISE=3,TRIANGLE=4,BREAKER=5,SHAPES=["square","sawtooth","sine","noise","triangle","breaker"];function checkAudioContextExists(){try{null==AUDIO_CONTEXT&&("undefined"!=typeof AudioContext?AUDIO_CONTEXT=new AudioContext:"undefined"!=typeof webkitAudioContext&&(AUDIO_CONTEXT=new webkitAudioContext))}catch(e){window.console.log(e)}}checkAudioContextExists();var rng,masterVolume=1;function Params(){var e={};return e.wave_type=SQUARE,e.p_env_attack=0,e.p_env_sustain=.3,e.p_env_punch=0,e.p_env_decay=.4,e.p_base_freq=.3,e.p_freq_limit=0,e.p_freq_ramp=0,e.p_freq_dramp=0,e.p_vib_strength=0,e.p_vib_speed=0,e.p_arp_mod=0,e.p_arp_speed=0,e.p_duty=0,e.p_duty_ramp=0,e.p_repeat_speed=0,e.p_pha_offset=0,e.p_pha_ramp=0,e.p_lpf_freq=1,e.p_lpf_ramp=0,e.p_lpf_resonance=0,e.p_hpf_freq=0,e.p_hpf_ramp=0,e.sound_vol=.5,e.sample_rate=44100,e.bit_depth=8,e}var seeded=!1;function frnd(e){return seeded?rng.uniform()*e:Math.random()*e}function rnd(e){return seeded?Math.floor(rng.uniform()*(e+1)):Math.floor(Math.random()*(e+1))}pickupCoin=function(){var e=Params();if(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=0),e.p_base_freq=.4+frnd(.5),e.p_env_attack=0,e.p_env_sustain=frnd(.1),e.p_env_decay=.1+frnd(.4),e.p_env_punch=.3+frnd(.3),rnd(1)){e.p_arp_speed=.5+frnd(.2);var t=1+(1|frnd(7)),n=t+(1|frnd(7))+2;e.p_arp_mod=+t/+n}return e},laserShoot=function(){var e=Params();return e.wave_type=rnd(2),e.wave_type===SINE&&rnd(1)&&(e.wave_type=rnd(1)),e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),e.p_base_freq=.5+frnd(.5),e.p_freq_limit=e.p_base_freq-.2-frnd(.6),e.p_freq_limit<.2&&(e.p_freq_limit=.2),e.p_freq_ramp=-.15-frnd(.2),0===rnd(2)&&(e.p_base_freq=.3+frnd(.6),e.p_freq_limit=frnd(.1),e.p_freq_ramp=-.35-frnd(.3)),rnd(1)?(e.p_duty=frnd(.5),e.p_duty_ramp=frnd(.2)):(e.p_duty=.4+frnd(.5),e.p_duty_ramp=-frnd(.7)),e.p_env_attack=0,e.p_env_sustain=.1+frnd(.2),e.p_env_decay=frnd(.4),rnd(1)&&(e.p_env_punch=frnd(.3)),0===rnd(2)&&(e.p_pha_offset=frnd(.2),e.p_pha_ramp=-frnd(.2)),rnd(1)&&(e.p_hpf_freq=frnd(.3)),e},explosion=function(){var e=Params();return rnd(1)?(e.p_base_freq=.1+frnd(.4),e.p_freq_ramp=-.1+frnd(.4)):(e.p_base_freq=.2+frnd(.7),e.p_freq_ramp=-.2-frnd(.2)),e.p_base_freq*=e.p_base_freq,0===rnd(4)&&(e.p_freq_ramp=0),0===rnd(2)&&(e.p_repeat_speed=.3+frnd(.5)),e.p_env_attack=0,e.p_env_sustain=.1+frnd(.3),e.p_env_decay=frnd(.5),0===rnd(1)&&(e.p_pha_offset=-.3+frnd(.9),e.p_pha_ramp=-frnd(.3)),e.p_env_punch=.2+frnd(.6),rnd(1)&&(e.p_vib_strength=frnd(.7),e.p_vib_speed=frnd(.6)),0===rnd(2)&&(e.p_arp_speed=.6+frnd(.3),e.p_arp_mod=.8-frnd(1.6)),e},birdSound=function(){var e=Params();return frnd(10)<1?(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),e.p_env_attack=.4304400932967592+frnd(.2)-.1,e.p_env_sustain=.15739346034252394+frnd(.2)-.1,e.p_env_punch=.004488201744871758+frnd(.2)-.1,e.p_env_decay=.07478075528212291+frnd(.2)-.1,e.p_base_freq=.9865265720147687+frnd(.2)-.1,e.p_freq_limit=0+frnd(.2)-.1,e.p_freq_ramp=-.2995018224359539+frnd(.2)-.1,frnd(1)<.5&&(e.p_freq_ramp=.1+frnd(.15)),e.p_freq_dramp=.004598608156964473+frnd(.1)-.05,e.p_vib_strength=-.2202799497929496+frnd(.2)-.1,e.p_vib_speed=.8084998703158364+frnd(.2)-.1,e.p_arp_mod=0,e.p_arp_speed=0,e.p_duty=-.9031808754347107+frnd(.2)-.1,e.p_duty_ramp=-.8128699999808343+frnd(.2)-.1,e.p_repeat_speed=.601486018931999+frnd(.2)-.1,e.p_pha_offset=-.9424902314367765+frnd(.2)-.1,e.p_pha_ramp=-.1055482222272056+frnd(.2)-.1,e.p_lpf_freq=.9989765717851521+frnd(.2)-.1,e.p_lpf_ramp=-.25051720626043017+frnd(.2)-.1,e.p_lpf_resonance=.32777871505494693+frnd(.2)-.1,e.p_hpf_freq=.0023548750981756753+frnd(.2)-.1,e.p_hpf_ramp=-.002375673204842568+frnd(.2)-.1,e):frnd(10)<1?(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),e.p_env_attack=.5277795946672003+frnd(.2)-.1,e.p_env_sustain=.18243733568468432+frnd(.2)-.1,e.p_env_punch=-.020159754546840117+frnd(.2)-.1,e.p_env_decay=.1561353422051903+frnd(.2)-.1,e.p_base_freq=.9028855606533718+frnd(.2)-.1,e.p_freq_limit=-.008842787837148716,e.p_freq_ramp=-.1,e.p_freq_dramp=-.012891241489551925,e.p_vib_strength=-.17923136138403065+frnd(.2)-.1,e.p_vib_speed=.908263385610142+frnd(.2)-.1,e.p_arp_mod=.41690153355414894+frnd(.2)-.1,e.p_arp_speed=.0010766233195860704+frnd(.2)-.1,e.p_duty=-.8735363011184684+frnd(.2)-.1,e.p_duty_ramp=-.7397985366747507+frnd(.2)-.1,e.p_repeat_speed=.0591789344172107+frnd(.2)-.1,e.p_pha_offset=-.9961184222777699+frnd(.2)-.1,e.p_pha_ramp=-.08234769395850523+frnd(.2)-.1,e.p_lpf_freq=.9412475115697335+frnd(.2)-.1,e.p_lpf_ramp=-.18261358925834958+frnd(.2)-.1,e.p_lpf_resonance=.24541438107389477+frnd(.2)-.1,e.p_hpf_freq=-.01831940280978611+frnd(.2)-.1,e.p_hpf_ramp=-.03857383633171346+frnd(.2)-.1,e):frnd(10)<1?(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),e.p_env_attack=.4304400932967592+frnd(.2)-.1,e.p_env_sustain=.15739346034252394+frnd(.2)-.1,e.p_env_punch=.004488201744871758+frnd(.2)-.1,e.p_env_decay=.07478075528212291+frnd(.2)-.1,e.p_base_freq=.9865265720147687+frnd(.2)-.1,e.p_freq_limit=0+frnd(.2)-.1,e.p_freq_ramp=-.2995018224359539+frnd(.2)-.1,e.p_freq_dramp=.004598608156964473+frnd(.2)-.1,e.p_vib_strength=-.2202799497929496+frnd(.2)-.1,e.p_vib_speed=.8084998703158364+frnd(.2)-.1,e.p_arp_mod=-.46410459213693644+frnd(.2)-.1,e.p_arp_speed=-.10955361249587248+frnd(.2)-.1,e.p_duty=-.9031808754347107+frnd(.2)-.1,e.p_duty_ramp=-.8128699999808343+frnd(.2)-.1,e.p_repeat_speed=.7014860189319991+frnd(.2)-.1,e.p_pha_offset=-.9424902314367765+frnd(.2)-.1,e.p_pha_ramp=-.1055482222272056+frnd(.2)-.1,e.p_lpf_freq=.9989765717851521+frnd(.2)-.1,e.p_lpf_ramp=-.25051720626043017+frnd(.2)-.1,e.p_lpf_resonance=.32777871505494693+frnd(.2)-.1,e.p_hpf_freq=.0023548750981756753+frnd(.2)-.1,e.p_hpf_ramp=-.002375673204842568+frnd(.2)-.1,e):frnd(5)>1?(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),rnd(1)?(e.p_arp_mod=.2697849293151393+frnd(.2)-.1,e.p_arp_speed=-.3131172257760948+frnd(.2)-.1,e.p_base_freq=.8090588299313949+frnd(.2)-.1,e.p_duty=-.6210022920964955+frnd(.2)-.1,e.p_duty_ramp=-.00043441813553182567+frnd(.2)-.1,e.p_env_attack=.004321877246874195+frnd(.2)-.1,e.p_env_decay=.1+frnd(.2)-.1,e.p_env_punch=.061737781504416146+frnd(.2)-.1,e.p_env_sustain=.4987252564798832+frnd(.2)-.1,e.p_freq_dramp=.31700340314222614+frnd(.2)-.1,e.p_freq_limit=0+frnd(.2)-.1,e.p_freq_ramp=-.163380391341416+frnd(.2)-.1,e.p_hpf_freq=.4709005021145149+frnd(.2)-.1,e.p_hpf_ramp=.6924667290539194+frnd(.2)-.1,e.p_lpf_freq=.8351398631384511+frnd(.2)-.1,e.p_lpf_ramp=.36616557192873134+frnd(.2)-.1,e.p_lpf_resonance=-.08685777111664439+frnd(.2)-.1,e.p_pha_offset=-.036084571580025544+frnd(.2)-.1,e.p_pha_ramp=-.014806445085568108+frnd(.2)-.1,e.p_repeat_speed=-.8094368475518489+frnd(.2)-.1,e.p_vib_speed=.4496665457171294+frnd(.2)-.1,e.p_vib_strength=.23413762515532424+frnd(.2)-.1):(e.p_arp_mod=-.35697118026766184+frnd(.2)-.1,e.p_arp_speed=.3581140690559588+frnd(.2)-.1,e.p_base_freq=1.3260897696157528+frnd(.2)-.1,e.p_duty=-.30984900436710694+frnd(.2)-.1,e.p_duty_ramp=-.0014374759133411626+frnd(.2)-.1,e.p_env_attack=.3160357835682254+frnd(.2)-.1,e.p_env_decay=.1+frnd(.2)-.1,e.p_env_punch=.24323114016870148+frnd(.2)-.1,e.p_env_sustain=.4+frnd(.2)-.1,e.p_freq_dramp=.2866475886237244+frnd(.2)-.1,e.p_freq_limit=0+frnd(.2)-.1,e.p_freq_ramp=-.10956352368742976+frnd(.2)-.1,e.p_hpf_freq=.20772718017889846+frnd(.2)-.1,e.p_hpf_ramp=.1564090637378835+frnd(.2)-.1,e.p_lpf_freq=.6021372770637031+frnd(.2)-.1,e.p_lpf_ramp=.24016227139979027+frnd(.2)-.1,e.p_lpf_resonance=-.08787383821160144+frnd(.2)-.1,e.p_pha_offset=-.381597686151701+frnd(.2)-.1,e.p_pha_ramp=-.0002481687661373495+frnd(.2)-.1,e.p_repeat_speed=.07812112809425686+frnd(.2)-.1,e.p_vib_speed=-.13648848579133943+frnd(.2)-.1,e.p_vib_strength=.0018874158972302657+frnd(.2)-.1),e):(e.wave_type=Math.floor(frnd(SHAPES.length)),1!==e.wave_type&&3!==e.wave_type||(e.wave_type=2),e.p_base_freq=.85+frnd(.15),e.p_freq_ramp=.3+frnd(.15),e.p_env_attack=0+frnd(.09),e.p_env_sustain=.2+frnd(.3),e.p_env_decay=0+frnd(.1),e.p_duty=frnd(2)-1,e.p_duty_ramp=Math.pow(frnd(2)-1,3),e.p_repeat_speed=.5+frnd(.1),e.p_pha_offset=-.3+frnd(.9),e.p_pha_ramp=-frnd(.3),e.p_arp_speed=.4+frnd(.6),e.p_arp_mod=.8+frnd(.1),e.p_lpf_resonance=frnd(2)-1,e.p_lpf_freq=1-Math.pow(frnd(1),3),e.p_lpf_ramp=Math.pow(frnd(2)-1,3),e.p_lpf_freq<.1&&e.p_lpf_ramp<-.05&&(e.p_lpf_ramp=-e.p_lpf_ramp),e.p_hpf_freq=Math.pow(frnd(1),5),e.p_hpf_ramp=Math.pow(frnd(2)-1,5),e)},pushSound=function(){var e=Params();return e.wave_type=Math.floor(frnd(SHAPES.length)),2===e.wave_type&&e.wave_type++,0===e.wave_type&&(e.wave_type=NOISE),e.p_base_freq=.1+frnd(.4),e.p_freq_ramp=.05+frnd(.2),e.p_env_attack=.01+frnd(.09),e.p_env_sustain=.01+frnd(.09),e.p_env_decay=.01+frnd(.09),e.p_repeat_speed=.3+frnd(.5),e.p_pha_offset=-.3+frnd(.9),e.p_pha_ramp=-frnd(.3),e.p_arp_speed=.6+frnd(.3),e.p_arp_mod=.8-frnd(1.6),e},powerUp=function(){var e=Params();return rnd(1)?e.wave_type=SAWTOOTH:e.p_duty=frnd(.6),e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),rnd(1)?(e.p_base_freq=.2+frnd(.3),e.p_freq_ramp=.1+frnd(.4),e.p_repeat_speed=.4+frnd(.4)):(e.p_base_freq=.2+frnd(.3),e.p_freq_ramp=.05+frnd(.2),rnd(1)&&(e.p_vib_strength=frnd(.7),e.p_vib_speed=frnd(.6))),e.p_env_attack=0,e.p_env_sustain=frnd(.4),e.p_env_decay=.1+frnd(.4),e},hitHurt=function(){return result=Params(),result.wave_type=rnd(2),result.wave_type===SINE&&(result.wave_type=NOISE),result.wave_type===SQUARE&&(result.p_duty=frnd(.6)),result.wave_type=Math.floor(frnd(SHAPES.length)),result.p_base_freq=.2+frnd(.6),result.p_freq_ramp=-.3-frnd(.4),result.p_env_attack=0,result.p_env_sustain=frnd(.1),result.p_env_decay=.1+frnd(.2),rnd(1)&&(result.p_hpf_freq=frnd(.3)),result},jump=function(){return result=Params(),result.wave_type=SQUARE,result.wave_type=Math.floor(frnd(SHAPES.length)),3===result.wave_type&&(result.wave_type=SQUARE),result.p_duty=frnd(.6),result.p_base_freq=.3+frnd(.3),result.p_freq_ramp=.1+frnd(.2),result.p_env_attack=0,result.p_env_sustain=.1+frnd(.3),result.p_env_decay=.1+frnd(.2),rnd(1)&&(result.p_hpf_freq=frnd(.3)),rnd(1)&&(result.p_lpf_freq=1-frnd(.6)),result},blipSelect=function(){return result=Params(),result.wave_type=rnd(1),result.wave_type=Math.floor(frnd(SHAPES.length)),3===result.wave_type&&(result.wave_type=rnd(1)),result.wave_type===SQUARE&&(result.p_duty=frnd(.6)),result.p_base_freq=.2+frnd(.4),result.p_env_attack=0,result.p_env_sustain=.1+frnd(.1),result.p_env_decay=frnd(.2),result.p_hpf_freq=.1,result},random=function(){return result=Params(),result.wave_type=Math.floor(frnd(SHAPES.length)),result.p_base_freq=Math.pow(frnd(2)-1,2),rnd(1)&&(result.p_base_freq=Math.pow(frnd(2)-1,3)+.5),result.p_freq_limit=0,result.p_freq_ramp=Math.pow(frnd(2)-1,5),result.p_base_freq>.7&&result.p_freq_ramp>.2&&(result.p_freq_ramp=-result.p_freq_ramp),result.p_base_freq<.2&&result.p_freq_ramp<-.05&&(result.p_freq_ramp=-result.p_freq_ramp),result.p_freq_dramp=Math.pow(frnd(2)-1,3),result.p_duty=frnd(2)-1,result.p_duty_ramp=Math.pow(frnd(2)-1,3),result.p_vib_strength=Math.pow(frnd(2)-1,3),result.p_vib_speed=frnd(2)-1,result.p_env_attack=Math.pow(frnd(2)-1,3),result.p_env_sustain=Math.pow(frnd(2)-1,2),result.p_env_decay=frnd(2)-1,result.p_env_punch=Math.pow(frnd(.8),2),result.p_env_attack+result.p_env_sustain+result.p_env_decay<.2&&(result.p_env_sustain+=.2+frnd(.3),result.p_env_decay+=.2+frnd(.3)),result.p_lpf_resonance=frnd(2)-1,result.p_lpf_freq=1-Math.pow(frnd(1),3),result.p_lpf_ramp=Math.pow(frnd(2)-1,3),result.p_lpf_freq<.1&&result.p_lpf_ramp<-.05&&(result.p_lpf_ramp=-result.p_lpf_ramp),result.p_hpf_freq=Math.pow(frnd(1),5),result.p_hpf_ramp=Math.pow(frnd(2)-1,5),result.p_pha_offset=Math.pow(frnd(2)-1,3),result.p_pha_ramp=Math.pow(frnd(2)-1,3),result.p_repeat_speed=frnd(2)-1,result.p_arp_speed=frnd(2)-1,result.p_arp_mod=frnd(2)-1,result};var generators=[pickupCoin,laserShoot,explosion,powerUp,hitHurt,jump,blipSelect,pushSound,random,birdSound],generatorNames=["pickupCoin","laserShoot","explosion","powerUp","hitHurt","jump","blipSelect","pushSound","random","birdSound"];function SoundEffect(e,t){this._buffer=AUDIO_CONTEXT.createBuffer(1,e,t)}function ULBS(){if("suspended"===AUDIO_CONTEXT.state){var e=function(){AUDIO_CONTEXT.resume().then((function(){document.body.removeEventListener("touchstart",e),document.body.removeEventListener("touchend",e),document.body.removeEventListener("mousedown",e),document.body.removeEventListener("mouseup",e),document.body.removeEventListener("keydown",e),document.body.removeEventListener("keyup",e)}))};document.body.addEventListener("touchstart",e,!1),document.body.addEventListener("touchend",e,!1),document.body.addEventListener("mousedown",e,!1),document.body.addEventListener("mouseup",e,!1),document.body.addEventListener("keydown",e,!1),document.body.addEventListener("keyup",e,!1)}}if(generateFromSeed=function(e){rng=new RNG(e/100|0);var t=generators[e%100%generators.length];seeded=!0;var n=t();return n.seed=e,seeded=!1,n},SoundEffect.prototype.getBuffer=function(){return this._buffer.getChannelData(0)},SoundEffect.prototype.play=function(){ULBS();var e=AUDIO_CONTEXT.createBufferSource(),t=AUDIO_CONTEXT.createBiquadFilter(),n=AUDIO_CONTEXT.createBiquadFilter(),r=AUDIO_CONTEXT.createBiquadFilter();e.buffer=this._buffer,e.connect(t),t.frequency.value=1600,n.frequency.value=1600,r.frequency.value=1600,t.connect(n),n.connect(r),r.connect(AUDIO_CONTEXT.destination);var o=AUDIO_CONTEXT.currentTime;void 0!==e.start?e.start(o):e.noteOn(o),e.onended=function(){r.disconnect()}},SoundEffect.MIN_SAMPLE_RATE=22050,void 0===AUDIO_CONTEXT&&((SoundEffect=function(e,t){this._sample_rate=t,this._buffer=new Array(e),this._audioElement=null}).prototype.getBuffer=function(){return this._audioElement=null,this._buffer},SoundEffect.prototype.play=function(){if(this._audioElement)this._audioElement.cloneNode(!1).play();else{for(var e=0;e<this._buffer.length;e++)this._buffer[e]=255&Math.floor(128*Math.max(0,Math.min(this._buffer[e]+1,2)));var t=MakeRiff(this._sample_rate,BIT_DEPTH,this._buffer);this._audioElement=new Audio,this._audioElement.src=t.dataURI,this._audioElement.play()}},SoundEffect.MIN_SAMPLE_RATE=1),SoundEffect.generate=function(e){function t(){n=0,r=100/(e.p_base_freq*e.p_base_freq+.001),o=Math.floor(r),i=100/(e.p_freq_limit*e.p_freq_limit+.001),a=1-.01*Math.pow(e.p_freq_ramp,3),l=1e-6*-Math.pow(e.p_freq_dramp,3),s=.5-.5*e.p_duty,c=5e-5*-e.p_duty_ramp,u=e.p_arp_mod>=0?1-.9*Math.pow(e.p_arp_mod,2):1+10*Math.pow(e.p_arp_mod,2),0,d=Math.floor(2e4*Math.pow(1-e.p_arp_speed,2)+32),1==e.p_arp_speed&&(d=0)}var n,r,o,i,a,l,s,c,u,d;t();var h=0,f=0,p=.1*Math.pow(e.p_lpf_freq,3),g=1+1e-4*e.p_lpf_ramp,m=5/(1+20*Math.pow(e.p_lpf_resonance,2))*(.01+p);m>.8&&(m=.8);var v=0,y=.1*Math.pow(e.p_hpf_freq,2),_=1+3e-4*e.p_hpf_ramp,b=0,w=.01*Math.pow(e.p_vib_speed,2),x=.5*e.p_vib_strength,S=0,k=0,C=0,M=[Math.floor(e.p_env_attack*e.p_env_attack*1e5),Math.floor(e.p_env_sustain*e.p_env_sustain*1e5),Math.floor(e.p_env_decay*e.p_env_decay*1e5)],T=M[0]+M[1]+M[2],E=0,I=1020*Math.pow(e.p_pha_offset,2);e.p_pha_offset<0&&(I=-I);var L=1*Math.pow(e.p_pha_ramp,2);e.p_pha_ramp<0&&(L=-L);for(var A=Math.abs(Math.floor(I)),R=0,O=[],F=0;F<1024;++F)O[F]=0;var D=[];for(F=0;F<32;++F)D[F]=2*Math.random()-1;var P=Math.floor(2e4*Math.pow(1-e.p_repeat_speed,2)+32);0==e.p_repeat_speed&&(P=0);for(var N,B=e.sound_vol,H=(B=Math.exp(e.sound_vol)-1,0),z=0,j=Math.floor(44100/e.sample_rate),W=0,V=Math.ceil(T/j),U=(N=e.sample_rate<SoundEffect.MIN_SAMPLE_RATE?new SoundEffect(4*V,SoundEffect.MIN_SAMPLE_RATE):new SoundEffect(V,e.sample_rate)).getBuffer(),q=0;;++q){0!=P&&++n>=P&&t(),0!=d&&q>=d&&(d=0,r*=u),(r*=a+=l)>i&&(r=i,e.p_freq_limit>0&&!0);var G=r;if(x>0&&(b+=w,G=r*(1+Math.sin(b)*x)),(o=Math.floor(G))<8&&(o=8),(s+=c)<0&&(s=0),s>.5&&(s=.5),++C>M[k]){for(C=1,k++;k<3&&0===M[k];)k++;if(3===k)break}S=0===k?C/M[0]:1===k?1+2*Math.pow(1-C/M[1],1)*e.p_env_punch:1-C/M[2],I+=L,(A=Math.abs(Math.floor(I)))>1023&&(A=1023),0!=_&&((y*=_)<1e-5&&(y=1e-5),y>.1&&(y=.1));for(var X=0,Y=0;Y<8;++Y){var Q=0;if(++E>=o&&(E%=o,e.wave_type===NOISE))for(F=0;F<32;++F)D[F]=2*Math.random()-1;var K=E/o;if(e.wave_type===SQUARE)Q=K<s?.5:-.5;else if(e.wave_type===SAWTOOTH)Q=1-2*K;else if(e.wave_type===SINE)Q=Math.sin(2*K*Math.PI);else if(e.wave_type===NOISE)Q=D[Math.floor(32*E/o)];else if(e.wave_type===TRIANGLE)Q=Math.abs(1-2*K)-1;else{if(e.wave_type!==BREAKER)throw new Exception("bad wave type! "+e.wave_type);Q=Math.abs(1-K*K*2)-1}var J=h;(p*=g)<0&&(p=0),p>.1&&(p=.1),1!=e.p_lpf_freq?(f+=(Q-h)*p,f-=f*m):(h=Q,f=0),v+=(h+=f)-J,Q=v-=v*y,O[1023&R]=Q,Q+=O[R-A+1024&1023],R=R+1&1023,X+=Q*S}H+=X,++z>=j&&(z=0,X=H/j,H=0,X=X/8*masterVolume,X*=B,U[W++]=X,e.sample_rate<SoundEffect.MIN_SAMPLE_RATE&&(U[W++]=X,U[W++]=X,U[W++]=X))}return j>0&&(X=(X=H/j)/8*masterVolume,X*=B,U[W++]=X,e.sample_rate<SoundEffect.MIN_SAMPLE_RATE&&(U[W++]=X,U[W++]=X,U[W++]=X)),N},"undefined"!=typeof exports){var RIFFWAVE=require("./riffwave").RIFFWAVE;exports.Params=Params,exports.generate=generate}var sfxCache={},cachedSeeds=[],CACHE_MAX=50;function cacheSeed(e){if(e in sfxCache)return sfxCache[e];var t=generateFromSeed(e);t.sound_vol=SOUND_VOL,t.sample_rate=SAMPLE_RATE,t.bit_depth=BIT_DEPTH;var n=SoundEffect.generate(t);for(sfxCache[e]=n,cachedSeeds.push(e);cachedSeeds.length>CACHE_MAX;){var r=cachedSeeds[0];cachedSeeds=cachedSeeds.slice(1),delete sfxCache[r]}return n}function cacheQuietSeed(e){if(e in sfxCache)return sfxCache[e];var t=generateFromSeed(e);t.sound_vol=QUIET_SOUND_VOL,t.sample_rate=SAMPLE_RATE,t.bit_depth=BIT_DEPTH;var n=SoundEffect.generate(t);for(sfxCache[e]=n,cachedSeeds.push(e);cachedSeeds.length>CACHE_MAX;){var r=cachedSeeds[0];cachedSeeds=cachedSeeds.slice(1),delete sfxCache[r]}return n}function playSound(e){muted||(checkAudioContextExists(),unitTesting||cacheSeed(e).play())}function playQuietSound(e){muted||(checkAudioContextExists(),unitTesting||cacheQuietSeed(e).play())}function killAudioButton(){var e=document.getElementById("muteButton"),t=document.getElementById("unMuteButton");e&&(e.remove(),t.remove())}function showAudioButton(){var e=document.getElementById("muteButton"),t=document.getElementById("unMuteButton");e&&(e.style.display="block",t.style.display="none")}function toggleMute(){0===muted?muteAudio():unMuteAudio()}function muteAudio(){muted=1,tryDeactivateYoutube();var e=document.getElementById("muteButton"),t=document.getElementById("unMuteButton");e&&(e.style.display="none",t.style.display="block")}function unMuteAudio(){muted=0,tryActivateYoutube();var e=document.getElementById("muteButton"),t=document.getElementById("unMuteButton");e&&(e.style.display="block",t.style.display="none")}
/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
!function(){"use strict";var e=function(){this.init()};e.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var n=this||t;if(e=parseFloat(e),n.ctx||c(),void 0!==e&&e>=0&&e<=1){if(n._volume=e,n._muted)return n;n.usingWebAudio&&n.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var r=0;r<n._howls.length;r++)if(!n._howls[r]._webAudio)for(var o=n._howls[r]._getSoundIds(),i=0;i<o.length;i++){var a=n._howls[r]._soundById(o[i]);a&&a._node&&(a._node.volume=a._volume*e)}return n}return n._volume},mute:function(e){var n=this||t;n.ctx||c(),n._muted=e,n.usingWebAudio&&n.masterGain.gain.setValueAtTime(e?0:n._volume,t.ctx.currentTime);for(var r=0;r<n._howls.length;r++)if(!n._howls[r]._webAudio)for(var o=n._howls[r]._getSoundIds(),i=0;i<o.length;i++){var a=n._howls[r]._soundById(o[i]);a&&a._node&&(a._node.muted=!!e||a._muted)}return n},stop:function(){for(var e=this||t,n=0;n<e._howls.length;n++)e._howls[n].stop();return e},unload:function(){for(var e=this||t,n=e._howls.length-1;n>=0;n--)e._howls[n].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,c()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,n=null;try{n="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!n||"function"!=typeof n.canPlayType)return e;var r=n.canPlayType("audio/mpeg;").replace(/^no$/,""),o=e._navigator?e._navigator.userAgent:"",i=o.match(/OPR\/([0-6].)/g),a=i&&parseInt(i[0].split("/")[1],10)<33,l=-1!==o.indexOf("Safari")&&-1===o.indexOf("Chrome"),s=o.match(/Version\/(.*?) /),c=l&&s&&parseInt(s[1],10)<15;return e._codecs={mp3:!(a||!r&&!n.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!r,opus:!!n.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(n.canPlayType('audio/wav; codecs="1"')||n.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!n.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!n.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/m4a;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(n.canPlayType("audio/x-m4b;")||n.canPlayType("audio/m4b;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(n.canPlayType("audio/x-mp4;")||n.canPlayType("audio/mp4;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(c||!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(c||!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!n.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(n.canPlayType("audio/x-flac;")||n.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var n=function(t){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var r=new Audio;r._unlocked=!0,e._releaseHtml5Audio(r)}catch(t){e.noAudio=!0;break}for(var o=0;o<e._howls.length;o++)if(!e._howls[o]._webAudio)for(var i=e._howls[o]._getSoundIds(),a=0;a<i.length;a++){var l=e._howls[o]._soundById(i[a]);l&&l._node&&!l._node._unlocked&&(l._node._unlocked=!0,l._node.load())}e._autoResume();var s=e.ctx.createBufferSource();s.buffer=e._scratchBuffer,s.connect(e.ctx.destination),void 0===s.start?s.noteOn(0):s.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),s.onended=function(){s.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",n,!0),document.removeEventListener("touchend",n,!0),document.removeEventListener("click",n,!0),document.removeEventListener("keydown",n,!0);for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("unlock")}};return document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",n,!0),document.addEventListener("click",n,!0),document.addEventListener("keydown",n,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var n=(new Audio).play();return n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)&&n.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var n=this||t;return e._unlocked&&n._html5AudioPool.push(e),n},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&t.usingWebAudio){for(var n=0;n<e._howls.length;n++)if(e._howls[n]._webAudio)for(var r=0;r<e._howls[n]._sounds.length;r++)if(!e._howls[n]._sounds[r]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&t.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var t=new e,n=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};n.prototype={init:function(e){var n=this;return t.ctx||c(),n._autoplay=e.autoplay||!1,n._format="string"!=typeof e.format?e.format:[e.format],n._html5=e.html5||!1,n._muted=e.mute||!1,n._loop=e.loop||!1,n._pool=e.pool||5,n._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,n._rate=e.rate||1,n._sprite=e.sprite||{},n._src="string"!=typeof e.src?e.src:[e.src],n._volume=void 0!==e.volume?e.volume:1,n._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},n._duration=0,n._state="unloaded",n._sounds=[],n._endTimers={},n._queue=[],n._playLock=!1,n._onend=e.onend?[{fn:e.onend}]:[],n._onfade=e.onfade?[{fn:e.onfade}]:[],n._onload=e.onload?[{fn:e.onload}]:[],n._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],n._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],n._onpause=e.onpause?[{fn:e.onpause}]:[],n._onplay=e.onplay?[{fn:e.onplay}]:[],n._onstop=e.onstop?[{fn:e.onstop}]:[],n._onmute=e.onmute?[{fn:e.onmute}]:[],n._onvolume=e.onvolume?[{fn:e.onvolume}]:[],n._onrate=e.onrate?[{fn:e.onrate}]:[],n._onseek=e.onseek?[{fn:e.onseek}]:[],n._onunlock=e.onunlock?[{fn:e.onunlock}]:[],n._onresume=[],n._webAudio=t.usingWebAudio&&!n._html5,void 0!==t.ctx&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(n),n._autoplay&&n._queue.push({event:"play",action:function(){n.play()}}),n._preload&&"none"!==n._preload&&n.load(),n},load:function(){var e=this,n=null;if(t.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var o=0;o<e._src.length;o++){var a,l;if(e._format&&e._format[o])a=e._format[o];else{if("string"!=typeof(l=e._src[o])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(a=/^data:audio\/([^;,]+);/i.exec(l))||(a=/\.([^.]+)$/.exec(l.split("?",1)[0])),a&&(a=a[1].toLowerCase())}if(a||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),a&&t.codecs(a)){n=e._src[o];break}}if(n)return e._src=n,e._state="loading","https:"===window.location.protocol&&"http:"===n.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new r(e),e._webAudio&&i(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,n){var r=this,o=null;if("number"==typeof e)o=e,e=null;else{if("string"==typeof e&&"loaded"===r._state&&!r._sprite[e])return null;if(void 0===e&&(e="__default",!r._playLock)){for(var i=0,a=0;a<r._sounds.length;a++)r._sounds[a]._paused&&!r._sounds[a]._ended&&(i++,o=r._sounds[a]._id);1===i?e=null:o=null}}var l=o?r._soundById(o):r._inactiveSound();if(!l)return null;if(o&&!e&&(e=l._sprite||"__default"),"loaded"!==r._state){l._sprite=e,l._ended=!1;var s=l._id;return r._queue.push({event:"play",action:function(){r.play(s)}}),s}if(o&&!l._paused)return n||r._loadQueue("play"),l._id;r._webAudio&&t._autoResume();var c=Math.max(0,l._seek>0?l._seek:r._sprite[e][0]/1e3),u=Math.max(0,(r._sprite[e][0]+r._sprite[e][1])/1e3-c),d=1e3*u/Math.abs(l._rate),h=r._sprite[e][0]/1e3,f=(r._sprite[e][0]+r._sprite[e][1])/1e3;l._sprite=e,l._ended=!1;var p=function(){l._paused=!1,l._seek=c,l._start=h,l._stop=f,l._loop=!(!l._loop&&!r._sprite[e][2])};if(!(c>=f)){var g=l._node;if(r._webAudio){var m=function(){r._playLock=!1,p(),r._refreshBuffer(l);var e=l._muted||r._muted?0:l._volume;g.gain.setValueAtTime(e,t.ctx.currentTime),l._playStart=t.ctx.currentTime,void 0===g.bufferSource.start?l._loop?g.bufferSource.noteGrainOn(0,c,86400):g.bufferSource.noteGrainOn(0,c,u):l._loop?g.bufferSource.start(0,c,86400):g.bufferSource.start(0,c,u),d!==1/0&&(r._endTimers[l._id]=setTimeout(r._ended.bind(r,l),d)),n||setTimeout((function(){r._emit("play",l._id),r._loadQueue()}),0)};"running"===t.state&&"interrupted"!==t.ctx.state?m():(r._playLock=!0,r.once("resume",m),r._clearTimer(l._id))}else{var v=function(){g.currentTime=c,g.muted=l._muted||r._muted||t._muted||g.muted,g.volume=l._volume*t.volume(),g.playbackRate=l._rate;try{var o=g.play();if(o&&"undefined"!=typeof Promise&&(o instanceof Promise||"function"==typeof o.then)?(r._playLock=!0,p(),o.then((function(){r._playLock=!1,g._unlocked=!0,n?r._loadQueue():r._emit("play",l._id)})).catch((function(){r._playLock=!1,r._emit("playerror",l._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),l._ended=!0,l._paused=!0}))):n||(r._playLock=!1,p(),r._emit("play",l._id)),g.playbackRate=l._rate,g.paused)return void r._emit("playerror",l._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||l._loop?r._endTimers[l._id]=setTimeout(r._ended.bind(r,l),d):(r._endTimers[l._id]=function(){r._ended(l),g.removeEventListener("ended",r._endTimers[l._id],!1)},g.addEventListener("ended",r._endTimers[l._id],!1))}catch(e){r._emit("playerror",l._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===g.src&&(g.src=r._src,g.load());var y=window&&window.ejecta||!g.readyState&&t._navigator.isCocoonJS;if(g.readyState>=3||y)v();else{r._playLock=!0,r._state="loading";var _=function(){r._state="loaded",v(),g.removeEventListener(t._canPlayEvent,_,!1)};g.addEventListener(t._canPlayEvent,_,!1),r._clearTimer(l._id)}}return l._id}r._ended(l)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),r=0;r<n.length;r++){t._clearTimer(n[r]);var o=t._soundById(n[r]);if(o&&!o._paused&&(o._seek=t.seek(n[r]),o._rateSeek=0,o._paused=!0,t._stopFade(n[r]),o._node))if(t._webAudio){if(!o._node.bufferSource)continue;void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),t._cleanBuffer(o._node)}else isNaN(o._node.duration)&&o._node.duration!==1/0||o._node.pause();arguments[1]||t._emit("pause",o?o._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var r=n._getSoundIds(e),o=0;o<r.length;o++){n._clearTimer(r[o]);var i=n._soundById(r[o]);i&&(i._seek=i._start||0,i._rateSeek=0,i._paused=!0,i._ended=!0,n._stopFade(r[o]),i._node&&(n._webAudio?i._node.bufferSource&&(void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),n._cleanBuffer(i._node)):isNaN(i._node.duration)&&i._node.duration!==1/0||(i._node.currentTime=i._start||0,i._node.pause(),i._node.duration===1/0&&n._clearSound(i._node))),t||n._emit("stop",i._id))}return n},mute:function(e,n){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"mute",action:function(){r.mute(e,n)}}),r;if(void 0===n){if("boolean"!=typeof e)return r._muted;r._muted=e}for(var o=r._getSoundIds(n),i=0;i<o.length;i++){var a=r._soundById(o[i]);a&&(a._muted=e,a._interval&&r._stopFade(a._id),r._webAudio&&a._node?a._node.gain.setValueAtTime(e?0:a._volume,t.ctx.currentTime):a._node&&(a._node.muted=!!t._muted||e),r._emit("mute",a._id))}return r},volume:function(){var e,n,r,o=this,i=arguments;if(0===i.length)return o._volume;if(1===i.length||2===i.length&&void 0===i[1]){var a=o._getSoundIds(),l=a.indexOf(i[0]);l>=0?n=parseInt(i[0],10):e=parseFloat(i[0])}else i.length>=2&&(e=parseFloat(i[0]),n=parseInt(i[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(r=n?o._soundById(n):o._sounds[0])?r._volume:0;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"volume",action:function(){o.volume.apply(o,i)}}),o;void 0===n&&(o._volume=e),n=o._getSoundIds(n);for(var s=0;s<n.length;s++)(r=o._soundById(n[s]))&&(r._volume=e,i[2]||o._stopFade(n[s]),o._webAudio&&r._node&&!r._muted?r._node.gain.setValueAtTime(e,t.ctx.currentTime):r._node&&!r._muted&&(r._node.volume=e*t.volume()),o._emit("volume",r._id));return o},fade:function(e,n,r,o){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"fade",action:function(){i.fade(e,n,r,o)}}),i;e=Math.min(Math.max(0,parseFloat(e)),1),n=Math.min(Math.max(0,parseFloat(n)),1),r=parseFloat(r),i.volume(e,o);for(var a=i._getSoundIds(o),l=0;l<a.length;l++){var s=i._soundById(a[l]);if(s){if(o||i._stopFade(a[l]),i._webAudio&&!s._muted){var c=t.ctx.currentTime,u=c+r/1e3;s._volume=e,s._node.gain.setValueAtTime(e,c),s._node.gain.linearRampToValueAtTime(n,u)}i._startFadeInterval(s,e,n,r,a[l],void 0===o)}}return i},_startFadeInterval:function(e,t,n,r,o,i){var a=this,l=t,s=n-t,c=Math.abs(s/.01),u=Math.max(4,c>0?r/c:r),d=Date.now();e._fadeTo=n,e._interval=setInterval((function(){var o=(Date.now()-d)/r;d=Date.now(),l+=s*o,l=Math.round(100*l)/100,l=s<0?Math.max(n,l):Math.min(n,l),a._webAudio?e._volume=l:a.volume(l,e._id,!0),i&&(a._volume=l),(n<t&&l<=n||n>t&&l>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,a.volume(n,e._id),a._emit("fade",e._id))}),u)},_stopFade:function(e){var n=this,r=n._soundById(e);return r&&r._interval&&(n._webAudio&&r._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(r._interval),r._interval=null,n.volume(r._fadeTo,e),r._fadeTo=null,n._emit("fade",e)),n},loop:function(){var e,t,n,r=this,o=arguments;if(0===o.length)return r._loop;if(1===o.length){if("boolean"!=typeof o[0])return!!(n=r._soundById(parseInt(o[0],10)))&&n._loop;e=o[0],r._loop=e}else 2===o.length&&(e=o[0],t=parseInt(o[1],10));for(var i=r._getSoundIds(t),a=0;a<i.length;a++)(n=r._soundById(i[a]))&&(n._loop=e,r._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop,r.playing(i[a])&&(r.pause(i[a],!0),r.play(i[a],!0)))));return r},rate:function(){var e,n,r,o=this,i=arguments;if(0===i.length)n=o._sounds[0]._id;else if(1===i.length){var a=o._getSoundIds(),l=a.indexOf(i[0]);l>=0?n=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),n=parseInt(i[1],10));if("number"!=typeof e)return(r=o._soundById(n))?r._rate:o._rate;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"rate",action:function(){o.rate.apply(o,i)}}),o;void 0===n&&(o._rate=e),n=o._getSoundIds(n);for(var s=0;s<n.length;s++)if(r=o._soundById(n[s])){o.playing(n[s])&&(r._rateSeek=o.seek(n[s]),r._playStart=o._webAudio?t.ctx.currentTime:r._playStart),r._rate=e,o._webAudio&&r._node&&r._node.bufferSource?r._node.bufferSource.playbackRate.setValueAtTime(e,t.ctx.currentTime):r._node&&(r._node.playbackRate=e);var c=o.seek(n[s]),u=(o._sprite[r._sprite][0]+o._sprite[r._sprite][1])/1e3-c,d=1e3*u/Math.abs(r._rate);!o._endTimers[n[s]]&&r._paused||(o._clearTimer(n[s]),o._endTimers[n[s]]=setTimeout(o._ended.bind(o,r),d)),o._emit("rate",r._id)}return o},seek:function(){var e,n,r=this,o=arguments;if(0===o.length)r._sounds.length&&(n=r._sounds[0]._id);else if(1===o.length){var i=r._getSoundIds(),a=i.indexOf(o[0]);a>=0?n=parseInt(o[0],10):r._sounds.length&&(n=r._sounds[0]._id,e=parseFloat(o[0]))}else 2===o.length&&(e=parseFloat(o[0]),n=parseInt(o[1],10));if(void 0===n)return 0;if("number"==typeof e&&("loaded"!==r._state||r._playLock))return r._queue.push({event:"seek",action:function(){r.seek.apply(r,o)}}),r;var l=r._soundById(n);if(l){if(!("number"==typeof e&&e>=0)){if(r._webAudio){var s=r.playing(n)?t.ctx.currentTime-l._playStart:0,c=l._rateSeek?l._rateSeek-l._seek:0;return l._seek+(c+s*Math.abs(l._rate))}return l._node.currentTime}var u=r.playing(n);u&&r.pause(n,!0),l._seek=e,l._ended=!1,r._clearTimer(n),r._webAudio||!l._node||isNaN(l._node.duration)||(l._node.currentTime=e);var d=function(){u&&r.play(n,!0),r._emit("seek",n)};if(u&&!r._webAudio){var h=function(){r._playLock?setTimeout(h,0):d()};setTimeout(h,0)}else d()}return r},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var r=0;r<t._sounds.length;r++)if(!t._sounds[r]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,r=t._soundById(e);return r&&(n=t._sprite[r._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,n=e._sounds,r=0;r<n.length;r++)n[r]._paused||e.stop(n[r]._id),e._webAudio||(e._clearSound(n[r]._node),n[r]._node.removeEventListener("error",n[r]._errorFn,!1),n[r]._node.removeEventListener(t._canPlayEvent,n[r]._loadFn,!1),n[r]._node.removeEventListener("ended",n[r]._endFn,!1),t._releaseHtml5Audio(n[r]._node)),delete n[r]._node,e._clearTimer(n[r]._id);var i=t._howls.indexOf(e);i>=0&&t._howls.splice(i,1);var a=!0;for(r=0;r<t._howls.length;r++)if(t._howls[r]._src===e._src||e._src.indexOf(t._howls[r]._src)>=0){a=!1;break}return o&&a&&delete o[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,r){var o=this["_on"+e];return"function"==typeof t&&o.push(r?{id:n,fn:t,once:r}:{id:n,fn:t}),this},off:function(e,t,n){var r=this,o=r["_on"+e],i=0;if("number"==typeof t&&(n=t,t=null),t||n)for(i=0;i<o.length;i++){var a=n===o[i].id;if(t===o[i].fn&&a||!t&&a){o.splice(i,1);break}}else if(e)r["_on"+e]=[];else{var l=Object.keys(r);for(i=0;i<l.length;i++)0===l[i].indexOf("_on")&&Array.isArray(r[l[i]])&&(r[l[i]]=[])}return r},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var r=this,o=r["_on"+e],i=o.length-1;i>=0;i--)o[i].id&&o[i].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(r,o[i].fn),0),o[i].once&&r.off(e,o[i].fn,o[i].id));return r._loadQueue(e),r},_loadQueue:function(e){var t=this;if(t._queue.length>0){var n=t._queue[0];n.event===e&&(t._queue.shift(),t._loadQueue()),e||n.action()}return t},_ended:function(e){var n=this,r=e._sprite;if(!n._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(n._ended.bind(n,e),100),n;var o=!(!e._loop&&!n._sprite[r][2]);if(n._emit("end",e._id),!n._webAudio&&o&&n.stop(e._id,!0).play(e._id),n._webAudio&&o){n._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var i=1e3*(e._stop-e._start)/Math.abs(e._rate);n._endTimers[e._id]=setTimeout(n._ended.bind(n,e),i)}return n._webAudio&&!o&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,n._clearTimer(e._id),n._cleanBuffer(e._node),t._autoSuspend()),n._webAudio||o||n.stop(e._id,!0),n},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var n=t._soundById(e);n&&n._node&&n._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new r(e)},_drain:function(){var e=this,t=e._pool,n=0,r=0;if(!(e._sounds.length<t)){for(r=0;r<e._sounds.length;r++)e._sounds[r]._ended&&n++;for(r=e._sounds.length-1;r>=0;r--){if(n<=t)return;e._sounds[r]._ended&&(e._webAudio&&e._sounds[r]._node&&e._sounds[r]._node.disconnect(0),e._sounds.splice(r,1),n--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=o[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),this},_cleanBuffer:function(e){var n=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),n))try{e.bufferSource.buffer=t._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(e){this._parent=e,this.init()};r.prototype={init:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._rate=n._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,n._sounds.push(e),e.create(),e},create:function(){var e=this,n=e._parent,r=t._muted||e._muted||e._parent._muted?0:e._volume;return n._webAudio?(e._node=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(r,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):t.noAudio||(e._node=t._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=n._src,e._node.preload=!0===n._preload?"auto":n._preload,e._node.volume=r*t.volume(),e._node.load()),e},reset:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._rate=n._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,n=e._parent;n._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(n._sprite).length&&(n._sprite={__default:[0,1e3*n._duration]}),"loaded"!==n._state&&(n._state="loaded",n._emit("load"),n._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var o={},i=function(e){var t=e._src;if(o[t])return e._duration=o[t].duration,void s(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);l(r.buffer,e)}else{var c=new XMLHttpRequest;c.open(e._xhr.method,t,!0),c.withCredentials=e._xhr.withCredentials,c.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){c.setRequestHeader(t,e._xhr.headers[t])})),c.onload=function(){var t=(c.status+"")[0];"0"===t||"2"===t||"3"===t?l(c.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+c.status+".")},c.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete o[t],e.load())},a(c)}},a=function(e){try{e.send()}catch(t){e.onerror()}},l=function(e,n){var r=function(){n._emit("loaderror",null,"Decoding audio data failed.")},i=function(e){e&&n._sounds.length>0?(o[n._src]=e,s(n,e)):r()};"undefined"!=typeof Promise&&1===t.ctx.decodeAudioData.length?t.ctx.decodeAudioData(e).then(i).catch(r):t.ctx.decodeAudioData(e,i,r)},s=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},c=function(){if(t.usingWebAudio){try{"undefined"!=typeof AudioContext?t.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch(e){t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),n=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=n?parseInt(n[1],10):null;if(e&&r&&r<9){var o=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!o&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};"function"==typeof define&&define.amd&&define([],(function(){return{Howler:t,Howl:n}})),"undefined"!=typeof exports&&(exports.Howler=t,exports.Howl=n),"undefined"!=typeof global?(global.HowlerGlobal=e,global.Howler=t,global.Howl=n,global.Sound=r):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=r)}(),
/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var n=t._howls.length-1;n>=0;n--)t._howls[n].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,n){var r=this;return r.ctx&&r.ctx.listener?(t="number"!=typeof t?r._pos[1]:t,n="number"!=typeof n?r._pos[2]:n,"number"!=typeof e?r._pos:(r._pos=[e,t,n],void 0!==r.ctx.listener.positionX?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],Howler.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],Howler.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],Howler.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]),r)):r},HowlerGlobal.prototype.orientation=function(e,t,n,r,o,i){var a=this;if(!a.ctx||!a.ctx.listener)return a;var l=a._orientation;return t="number"!=typeof t?l[1]:t,n="number"!=typeof n?l[2]:n,r="number"!=typeof r?l[3]:r,o="number"!=typeof o?l[4]:o,i="number"!=typeof i?l[5]:i,"number"!=typeof e?l:(a._orientation=[e,t,n,r,o,i],void 0!==a.ctx.listener.forwardX?(a.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(r,Howler.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(o,Howler.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(i,Howler.ctx.currentTime,.1)):a.ctx.listener.setOrientation(e,t,n,r,o,i),a)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var n=this;return n._orientation=t.orientation||[1,0,0],n._stereo=t.stereo||null,n._pos=t.pos||null,n._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},n._onstereo=t.onstereo?[{fn:t.onstereo}]:[],n._onpos=t.onpos?[{fn:t.onpos}]:[],n._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,n){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"stereo",action:function(){r.stereo(e,n)}}),r;var o=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof e)return r._stereo;r._stereo=e,r._pos=[e,0,0]}for(var i=r._getSoundIds(n),a=0;a<i.length;a++){var l=r._soundById(i[a]);if(l){if("number"!=typeof e)return l._stereo;l._stereo=e,l._pos=[e,0,0],l._node&&(l._pannerAttr.panningModel="equalpower",l._panner&&l._panner.pan||t(l,o),"spatial"===o?void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):l._panner.setPosition(e,0,0):l._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),r._emit("stereo",l._id)}}return r},Howl.prototype.pos=function(e,n,r,o){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"pos",action:function(){i.pos(e,n,r,o)}}),i;if(n="number"!=typeof n?0:n,r="number"!=typeof r?-.5:r,void 0===o){if("number"!=typeof e)return i._pos;i._pos=[e,n,r]}for(var a=i._getSoundIds(o),l=0;l<a.length;l++){var s=i._soundById(a[l]);if(s){if("number"!=typeof e)return s._pos;s._pos=[e,n,r],s._node&&(s._panner&&!s._panner.pan||t(s,"spatial"),void 0!==s._panner.positionX?(s._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):s._panner.setPosition(e,n,r)),i._emit("pos",s._id)}}return i},Howl.prototype.orientation=function(e,n,r,o){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"orientation",action:function(){i.orientation(e,n,r,o)}}),i;if(n="number"!=typeof n?i._orientation[1]:n,r="number"!=typeof r?i._orientation[2]:r,void 0===o){if("number"!=typeof e)return i._orientation;i._orientation=[e,n,r]}for(var a=i._getSoundIds(o),l=0;l<a.length;l++){var s=i._soundById(a[l]);if(s){if("number"!=typeof e)return s._orientation;s._orientation=[e,n,r],s._node&&(s._panner||(s._pos||(s._pos=i._pos||[0,0,-.5]),t(s,"spatial")),void 0!==s._panner.orientationX?(s._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),s._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),s._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):s._panner.setOrientation(e,n,r)),i._emit("orientation",s._id)}}return i},Howl.prototype.pannerAttr=function(){var e,n,r,o=this,i=arguments;if(!o._webAudio)return o;if(0===i.length)return o._pannerAttr;if(1===i.length){if("object"!=typeof i[0])return(r=o._soundById(parseInt(i[0],10)))?r._pannerAttr:o._pannerAttr;e=i[0],void 0===n&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),o._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:o._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:o._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:o._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:o._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:o._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:o._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:o._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:o._panningModel})}else 2===i.length&&(e=i[0],n=parseInt(i[1],10));for(var a=o._getSoundIds(n),l=0;l<a.length;l++)if(r=o._soundById(a[l])){var s=r._pannerAttr;s={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:s.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:s.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:s.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:s.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:s.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:s.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:s.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:s.panningModel};var c=r._panner;c?(c.coneInnerAngle=s.coneInnerAngle,c.coneOuterAngle=s.coneOuterAngle,c.coneOuterGain=s.coneOuterGain,c.distanceModel=s.distanceModel,c.maxDistance=s.maxDistance,c.refDistance=s.refDistance,c.rolloffFactor=s.rolloffFactor,c.panningModel=s.panningModel):(r._pos||(r._pos=o._pos||[0,0,-.5]),t(r,"spatial"))}return o},Sound.prototype.init=function(e){return function(){var t=this,n=t._parent;t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this),t._stereo?n.stereo(t._stereo):t._pos&&n.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,n=t._parent;return t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,t._stereo?n.stereo(t._stereo):t._pos?n.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,n._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}(),function(e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else{if("function"==typeof define&&define.amd)return define([],e);this.CodeMirror=e()}}((function(){"use strict";var e=/gecko\/\d/i.test(navigator.userAgent),t=/MSIE \d/.test(navigator.userAgent),n=t&&(null==document.documentMode||document.documentMode<8),r=t&&(null==document.documentMode||document.documentMode<9),o=t&&(null==document.documentMode||document.documentMode<10),i=/Trident\/([7-9]|\d{2,})\./.test(navigator.userAgent),a=t||i,l=/WebKit\//.test(navigator.userAgent),s=l&&/Qt\/\d+\.\d+/.test(navigator.userAgent),c=/Chrome\//.test(navigator.userAgent),u=/Opera\//.test(navigator.userAgent),d=/Apple Computer/.test(navigator.vendor),h=/KHTML\//.test(navigator.userAgent),f=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),p=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),g=/PhantomJS/.test(navigator.userAgent),m=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),v=m||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),y=m||/Mac/.test(navigator.platform),_=/win/i.test(navigator.platform),b=u&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);b&&(b=Number(b[1])),b&&b>=15&&(u=!1,l=!0);var w=y&&(s||u&&(null==b||b<12.11)),x=e||a&&!r,S=!1,k=!1;function C(e,n){if(!(this instanceof C))return new C(e,n);for(var o in this.options=n=n||{},kn)n.hasOwnProperty(o)||(n[o]=kn[o]);N(n);var i=n.value;"string"==typeof i&&(i=new Dr(i,n.mode)),this.doc=i;var l=this.display=new M(e,i);l.wrapper.CodeMirror=this,F(this),R(this),n.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),n.autofocus&&!v&&It(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new To},t&&setTimeout(Bo(Et,this,!0),20),function(e){var n,o=e.display;fo(o.scroller,"mousedown",pt(e,Ft)),fo(o.scroller,"dblclick",t?pt(e,(function(t){if(!_o(e,t)){var n=Ot(e,t);if(n&&!Pt(e,t)&&!Rt(e.display,t)){io(t);var r=Sn(e.doc,n);be(e.doc,r.anchor,r.head)}}})):function(t){_o(e,t)||io(t)});fo(o.lineSpace,"selectstart",(function(e){Rt(o,e)||io(e)})),x||fo(o.scroller,"contextmenu",(function(t){tn(e,t)}));function i(){e.state.focused&&setTimeout(Bo(It,e),0)}function l(){null==n&&(n=setTimeout((function(){n=null,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=$o=null,e.setSize()}),100))}function s(){Ko(document.body,o.wrapper)?setTimeout(s,5e3):po(window,"resize",l)}function c(t){_o(e,t)||so(t)}fo(o.scroller,"scroll",(function(){o.scroller.clientHeight&&(Ht(e,o.scroller.scrollTop),zt(e,o.scroller.scrollLeft,!0),go(e,"scroll",e))})),fo(o.scrollbarV,"scroll",(function(){o.scroller.clientHeight&&Ht(e,o.scrollbarV.scrollTop)})),fo(o.scrollbarH,"scroll",(function(){o.scroller.clientHeight&&zt(e,o.scrollbarH.scrollLeft)})),fo(o.scroller,"mousewheel",(function(t){Ut(e,t)})),fo(o.scroller,"DOMMouseScroll",(function(t){Ut(e,t)})),fo(o.scrollbarH,"mousedown",i),fo(o.scrollbarV,"mousedown",i),fo(o.wrapper,"scroll",(function(){o.wrapper.scrollTop=o.wrapper.scrollLeft=0})),fo(window,"resize",l),setTimeout(s,5e3),fo(o.input,"keyup",pt(e,Jt)),fo(o.input,"input",(function(){a&&!r&&e.display.inputHasSelection&&(e.display.inputHasSelection=null),Mt(e)})),fo(o.input,"keydown",pt(e,Kt)),fo(o.input,"keypress",pt(e,$t)),fo(o.input,"focus",Bo(Zt,e)),fo(o.input,"blur",Bo(en,e)),e.options.dragDrop&&(fo(o.scroller,"dragstart",(function(n){!function(e,n){if(t&&(!e.state.draggingText||+new Date-Nt<100))return void so(n);if(_o(e,n)||Rt(e.display,n))return;if(n.dataTransfer.setData("Text",e.getSelection()),n.dataTransfer.setDragImage&&!d){var r=Xo("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",u&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),n.dataTransfer.setDragImage(r,0,0),u&&r.parentNode.removeChild(r)}}(e,n)})),fo(o.scroller,"dragenter",c),fo(o.scroller,"dragover",c),fo(o.scroller,"drop",pt(e,Bt)));function f(t){o.inaccurateSelection&&(o.prevInput="",o.inaccurateSelection=!1,o.input.value=e.getSelection(),Oo(o.input)),"cut"==t.type&&(e.state.cutIncoming=!0)}fo(o.scroller,"paste",(function(t){Rt(o,t)||(e.state.pasteIncoming=!0,It(e),Mt(e))})),fo(o.input,"paste",(function(){e.state.pasteIncoming=!0,Mt(e)})),fo(o.input,"cut",f),fo(o.input,"copy",f),h&&fo(o.sizer,"mouseup",(function(){Jo()==o.input&&o.input.blur(),It(e)}))}(this);var s=this;ft(this,(function(){for(var e in s.curOp.forceUpdate=!0,Hr(s,i),n.autofocus&&!v||Jo()==l.input?setTimeout(Bo(Zt,s),20):en(s),Cn)Cn.hasOwnProperty(e)&&Cn[e](s,n[e],Tn);for(var t=0;t<An.length;++t)An[t](s)}))}function M(e,t){var r=this,o=r.input=Xo("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none");l?o.style.width="1000px":o.setAttribute("wrap","off"),m&&(o.style.border="1px solid black"),o.setAttribute("autocorrect","off"),o.setAttribute("autocapitalize","off"),o.setAttribute("spellcheck","false"),r.inputDiv=Xo("div",[o],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),r.scrollbarH=Xo("div",[Xo("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar"),r.scrollbarV=Xo("div",[Xo("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),r.scrollbarFiller=Xo("div",null,"CodeMirror-scrollbar-filler"),r.gutterFiller=Xo("div",null,"CodeMirror-gutter-filler"),r.lineDiv=Xo("div",null,"CodeMirror-code"),r.selectionDiv=Xo("div",null,null,"position: relative; z-index: 1"),r.cursorDiv=Xo("div",null,"CodeMirror-cursors"),r.measure=Xo("div",null,"CodeMirror-measure"),r.lineMeasure=Xo("div",null,"CodeMirror-measure"),r.lineSpace=Xo("div",[r.measure,r.lineMeasure,r.selectionDiv,r.cursorDiv,r.lineDiv],null,"position: relative; outline: none"),r.mover=Xo("div",[Xo("div",[r.lineSpace],"CodeMirror-lines")],null,"position: relative"),r.sizer=Xo("div",[r.mover],"CodeMirror-sizer"),r.heightForcer=Xo("div",null,null,"position: absolute; height: "+xo+"px; width: 1px;"),r.gutters=Xo("div",null,"CodeMirror-gutters"),r.lineGutter=null,r.scroller=Xo("div",[r.sizer,r.heightForcer,r.gutters],"CodeMirror-scroll"),r.scroller.setAttribute("tabIndex","-1"),r.wrapper=Xo("div",[r.inputDiv,r.scrollbarH,r.scrollbarV,r.scrollbarFiller,r.gutterFiller,r.scroller],"CodeMirror"),n&&(r.gutters.style.zIndex=-1,r.scroller.style.paddingRight=0),m&&(o.style.width="0px"),l||(r.scroller.draggable=!0),h&&(r.inputDiv.style.height="1px",r.inputDiv.style.position="absolute"),n&&(r.scrollbarH.style.minHeight=r.scrollbarV.style.minWidth="18px"),e.appendChild?e.appendChild(r.wrapper):e(r.wrapper),r.viewFrom=r.viewTo=t.first,r.view=[],r.externalMeasured=null,r.viewOffset=0,r.lastSizeC=0,r.updateLineNumbers=null,r.lineNumWidth=r.lineNumInnerWidth=r.lineNumChars=null,r.prevInput="",r.alignWidgets=!1,r.pollingFast=!1,r.poll=new To,r.cachedCharWidth=r.cachedTextHeight=r.cachedPaddingH=null,r.inaccurateSelection=!1,r.maxLine=null,r.maxLineLength=0,r.maxLineChanged=!1,r.wheelDX=r.wheelDY=r.wheelStartX=r.wheelStartY=null,r.shift=!1}function T(e){e.doc.mode=C.getMode(e.options,e.doc.modeOption),E(e)}function E(e){e.doc.iter((function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)})),e.doc.frontier=e.doc.first,De(e,100),e.state.modeGen++,e.curOp&&_t(e)}function I(e){var t=at(e.display),n=e.options.lineWrapping,r=n&&Math.max(5,e.display.scroller.clientWidth/lt(e.display)-3);return function(o){if(ur(e.doc,o))return 0;var i=0;if(o.widgets)for(var a=0;a<o.widgets.length;a++)o.widgets[a].height&&(i+=o.widgets[a].height);return n?i+(Math.ceil(o.text.length/r)||1)*t:i+t}}function L(e){var t=e.doc,n=I(e);t.iter((function(e){var t=n(e);t!=e.height&&Vr(e,t)}))}function A(e){var t=Pn[e.options.keyMap].style;e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(t?" cm-keymap-"+t:"")}function R(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Qe(e)}function O(e){F(e),_t(e),setTimeout((function(){j(e)}),20)}function F(e){var t=e.display.gutters,n=e.options.gutters;Yo(t);for(var r=0;r<n.length;++r){var o=n[r],i=t.appendChild(Xo("div",null,"CodeMirror-gutter "+o));"CodeMirror-linenumbers"==o&&(e.display.lineGutter=i,i.style.width=(e.display.lineNumWidth||1)+"px")}t.style.display=r?"":"none";var a=t.offsetWidth;e.display.sizer.style.marginLeft=a+"px",r&&(e.display.scrollbarH.style.left=e.options.fixedGutter?a+"px":0)}function D(e){if(0==e.height)return 0;for(var t,n=e.text.length,r=e;t=or(r);){r=(o=t.find(0,!0)).from.line,n+=o.from.ch-o.to.ch}for(r=e;t=ir(r);){var o=t.find(0,!0);n-=r.text.length-o.from.ch,n+=(r=o.to.line).text.length-o.to.ch}return n}function P(e){var t=e.display,n=e.doc;t.maxLine=zr(n,n.first),t.maxLineLength=D(t.maxLine),t.maxLineChanged=!0,n.iter((function(e){var n=D(e);n>t.maxLineLength&&(t.maxLineLength=n,t.maxLine=e)}))}function N(e){var t=Fo(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}function B(e){var t=e.display.scroller;return{clientHeight:t.clientHeight,barHeight:e.display.scrollbarV.clientHeight,scrollWidth:t.scrollWidth,clientWidth:t.clientWidth,barWidth:e.display.scrollbarH.clientWidth,docHeight:Math.round(e.doc.height+He(e.display))}}function H(e,t){t||(t=B(e));var n=e.display,r=t.docHeight+xo,o=t.scrollWidth>t.clientWidth,i=r>t.clientHeight;if(i?(n.scrollbarV.style.display="block",n.scrollbarV.style.bottom=o?ni(n.measure)+"px":"0",n.scrollbarV.firstChild.style.height=Math.max(0,r-t.clientHeight+(t.barHeight||n.scrollbarV.clientHeight))+"px"):(n.scrollbarV.style.display="",n.scrollbarV.firstChild.style.height="0"),o?(n.scrollbarH.style.display="block",n.scrollbarH.style.right=i?ni(n.measure)+"px":"0",n.scrollbarH.firstChild.style.width=t.scrollWidth-t.clientWidth+(t.barWidth||n.scrollbarH.clientWidth)+"px"):(n.scrollbarH.style.display="",n.scrollbarH.firstChild.style.width="0"),o&&i?(n.scrollbarFiller.style.display="block",n.scrollbarFiller.style.height=n.scrollbarFiller.style.width=ni(n.measure)+"px"):n.scrollbarFiller.style.display="",o&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(n.gutterFiller.style.display="block",n.gutterFiller.style.height=ni(n.measure)+"px",n.gutterFiller.style.width=n.gutters.offsetWidth+"px"):n.gutterFiller.style.display="",f&&0===ni(n.measure)){n.scrollbarV.style.minWidth=n.scrollbarH.style.minHeight=p?"18px":"12px";var a=function(t){co(t)!=n.scrollbarV&&co(t)!=n.scrollbarH&&pt(e,Ft)(t)};fo(n.scrollbarV,"mousedown",a),fo(n.scrollbarH,"mousedown",a)}}function z(e,t,n){var r=n&&null!=n.top?n.top:e.scroller.scrollTop;r=Math.floor(r-Be(e));var o=n&&null!=n.bottom?n.bottom:r+e.wrapper.clientHeight,i=qr(t,r),a=qr(t,o);if(n&&n.ensure){var l=n.ensure.from.line,s=n.ensure.to.line;if(l<i)return{from:l,to:qr(t,Gr(zr(t,l))+e.wrapper.clientHeight)};if(Math.min(s,t.lastLine())>=a)return{from:qr(t,Gr(zr(t,s))-e.wrapper.clientHeight),to:s}}return{from:i,to:a}}function j(e){var t=e.display,n=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var r=V(t)-t.scroller.scrollLeft+e.doc.scrollLeft,o=t.gutters.offsetWidth,i=r+"px",a=0;a<n.length;a++)if(!n[a].hidden){e.options.fixedGutter&&n[a].gutter&&(n[a].gutter.style.left=i);var l=n[a].alignable;if(l)for(var s=0;s<l.length;s++)l[s].style.left=i}e.options.fixedGutter&&(t.gutters.style.left=r+o+"px")}}function W(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function V(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function U(e,t,n){for(var r,o=e.display.viewFrom,i=e.display.viewTo,a=z(e.display,e.doc,t),l=!0;;l=!1){var s=e.display.scroller.clientWidth;if(!q(e,a,n))break;r=!0,e.display.maxLineChanged&&!e.options.lineWrapping&&G(e);var c=B(e);if(Ae(e),X(e,c),H(e,c),l&&e.options.lineWrapping&&s!=e.display.scroller.clientWidth)n=!0;else if(n=!1,t&&null!=t.top&&(t={top:Math.min(c.docHeight-xo-c.clientHeight,t.top)}),(a=z(e.display,e.doc,t)).from>=e.display.viewFrom&&a.to<=e.display.viewTo)break}return e.display.updateLineNumbers=null,r&&(vo(e,"update",e),e.display.viewFrom==o&&e.display.viewTo==i||vo(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo)),r}function q(e,t,r){var o=e.display,i=e.doc;if(o.wrapper.offsetWidth){if(!(!r&&t.from>=o.viewFrom&&t.to<=o.viewTo&&0==kt(e))){(function(e){if(!e.options.lineNumbers)return!1;var t=e.doc,n=W(e.options,t.first+t.size-1),r=e.display;if(n.length!=r.lineNumChars){var o=r.measure.appendChild(Xo("div",[Xo("div",n)],"CodeMirror-linenumber CodeMirror-gutter-elt")),i=o.firstChild.offsetWidth,a=o.offsetWidth-i;r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(i,r.lineGutter.offsetWidth-a),r.lineNumWidth=r.lineNumInnerWidth+a,r.lineNumChars=r.lineNumInnerWidth?n.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px";var l=r.gutters.offsetWidth;return r.scrollbarH.style.left=e.options.fixedGutter?l+"px":0,r.sizer.style.marginLeft=l+"px",!0}return!1})(e)&&wt(e);var a=Q(e),s=i.first+i.size,c=Math.max(t.from-e.options.viewportMargin,i.first),u=Math.min(s,t.to+e.options.viewportMargin);o.viewFrom<c&&c-o.viewFrom<20&&(c=Math.max(i.first,o.viewFrom)),o.viewTo>u&&o.viewTo-u<20&&(u=Math.min(s,o.viewTo)),k&&(c=sr(e.doc,c),u=cr(e.doc,u));var d=c!=o.viewFrom||u!=o.viewTo||o.lastSizeC!=o.wrapper.clientHeight;!function(e,t,n){var r=e.display;0==r.view.length||t>=r.viewTo||n<=r.viewFrom?(r.view=yt(e,t,n),r.viewFrom=t):(r.viewFrom>t?r.view=yt(e,t,r.viewFrom).concat(r.view):r.viewFrom<t&&(r.view=r.view.slice(xt(e,t))),r.viewFrom=t,r.viewTo<n?r.view=r.view.concat(yt(e,r.viewTo,n)):r.viewTo>n&&(r.view=r.view.slice(0,xt(e,n))));r.viewTo=n}(e,c,u),o.viewOffset=Gr(zr(e.doc,o.viewFrom)),e.display.mover.style.top=o.viewOffset+"px";var h=kt(e);if(d||0!=h||r){var f=Jo();return h>4&&(o.lineDiv.style.display="none"),function(e,t,n){var r=e.display,o=e.options.lineNumbers,i=r.lineDiv,a=i.firstChild;function s(t){var n=t.nextSibling;return l&&y&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),n}for(var c=r.view,u=r.viewFrom,d=0;d<c.length;d++){var h=c[d];if(h.hidden);else if(h.node){for(;a!=h.node;)a=s(a);var f=o&&null!=t&&t<=u&&h.lineNumber;h.changes&&(Fo(h.changes,"gutter")>-1&&(f=!1),K(e,h,u,n)),f&&(Yo(h.lineNumber),h.lineNumber.appendChild(document.createTextNode(W(e.options,u)))),a=h.node.nextSibling}else{var p=re(e,h,u,n);i.insertBefore(p,a)}u+=h.size}for(;a;)a=s(a)}(e,o.updateLineNumbers,a),h>4&&(o.lineDiv.style.display=""),f&&Jo()!=f&&f.offsetHeight&&f.focus(),Yo(o.cursorDiv),Yo(o.selectionDiv),d&&(o.lastSizeC=o.wrapper.clientHeight,De(e,400)),function(e){for(var t=e.display,r=t.lineDiv.offsetTop,o=0;o<t.view.length;o++){var i,a=t.view[o];if(!a.hidden){if(n){var l=a.node.offsetTop+a.node.offsetHeight;i=l-r,r=l}else{var s=a.node.getBoundingClientRect();i=s.bottom-s.top}var c=a.line.height-i;if(i<2&&(i=at(t)),(c>.001||c<-.001)&&(Vr(a.line,i),Y(a.line),a.rest))for(var u=0;u<a.rest.length;u++)Y(a.rest[u])}}}(e),!0}}}else wt(e)}function G(e){var t=e.display,n=je(e,t.maxLine,t.maxLine.text.length).left;t.maxLineChanged=!1;var r=Math.max(0,n+3),o=Math.max(0,t.sizer.offsetLeft+r+xo-t.scroller.clientWidth);t.sizer.style.minWidth=r+"px",o<e.doc.scrollLeft&&zt(e,Math.min(t.scroller.scrollLeft,o),!0)}function X(e,t){e.display.sizer.style.minHeight=e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=Math.max(t.docHeight,t.clientHeight-xo)+"px"}function Y(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.offsetHeight}function Q(e){for(var t=e.display,n={},r={},o=t.gutters.firstChild,i=0;o;o=o.nextSibling,++i)n[e.options.gutters[i]]=o.offsetLeft,r[e.options.gutters[i]]=o.offsetWidth;return{fixedPos:V(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:n,gutterWidth:r,wrapperWidth:t.wrapper.clientWidth}}function K(e,t,n,r){for(var o=0;o<t.changes.length;o++){var i=t.changes[o];"text"==i?Z(e,t):"gutter"==i?te(e,t,n,r):"class"==i?ee(t):"widget"==i&&ne(t,r)}t.changes=null}function J(e){return e.node==e.text&&(e.node=Xo("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),n&&(e.node.style.zIndex=2)),e.node}function $(e,t){var n=e.display.externalMeasured;return n&&n.line==t.line?(e.display.externalMeasured=null,t.measure=n.measure,n.built):kr(e,t)}function Z(e,t){var n=t.text.className,r=$(e,t);t.text==t.node&&(t.node=r.pre),t.text.parentNode.replaceChild(r.pre,t.text),t.text=r.pre,r.bgClass!=t.bgClass||r.textClass!=t.textClass?(t.bgClass=r.bgClass,t.textClass=r.textClass,ee(t)):n&&(t.text.className=n)}function ee(e){!function(e){var t=e.bgClass?e.bgClass+" "+(e.line.bgClass||""):e.line.bgClass;if(t&&(t+=" CodeMirror-linebackground"),e.background)t?e.background.className=t:(e.background.parentNode.removeChild(e.background),e.background=null);else if(t){var n=J(e);e.background=n.insertBefore(Xo("div",null,t),n.firstChild)}}(e),e.line.wrapClass?J(e).className=e.line.wrapClass:e.node!=e.text&&(e.node.className="");var t=e.textClass?e.textClass+" "+(e.line.textClass||""):e.line.textClass;e.text.className=t||""}function te(e,t,n,r){t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null);var o=t.line.gutterMarkers;if(e.options.lineNumbers||o){var i=J(t),a=t.gutter=i.insertBefore(Xo("div",null,"CodeMirror-gutter-wrapper","position: absolute; left: "+(e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px"),t.text);if(!e.options.lineNumbers||o&&o["CodeMirror-linenumbers"]||(t.lineNumber=a.appendChild(Xo("div",W(e.options,n),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),o)for(var l=0;l<e.options.gutters.length;++l){var s=e.options.gutters[l],c=o.hasOwnProperty(s)&&o[s];c&&a.appendChild(Xo("div",[c],"CodeMirror-gutter-elt","left: "+r.gutterLeft[s]+"px; width: "+r.gutterWidth[s]+"px"))}}}function ne(e,t){e.alignable&&(e.alignable=null);for(var n=e.node.firstChild;n;n=r){var r=n.nextSibling;"CodeMirror-linewidget"==n.className&&e.node.removeChild(n)}oe(e,t)}function re(e,t,n,r){var o=$(e,t);return t.text=t.node=o.pre,o.bgClass&&(t.bgClass=o.bgClass),o.textClass&&(t.textClass=o.textClass),ee(t),te(e,t,n,r),oe(t,r),t.node}function oe(e,t){if(ie(e.line,e,t,!0),e.rest)for(var n=0;n<e.rest.length;n++)ie(e.rest[n],e,t,!1)}function ie(e,t,n,r){if(e.widgets)for(var o=J(t),i=0,a=e.widgets;i<a.length;++i){var l=a[i],s=Xo("div",[l.node],"CodeMirror-linewidget");l.handleMouseEvents||(s.ignoreEvents=!0),ae(l,s,t,n),r&&l.above?o.insertBefore(s,t.gutter||t.text):o.appendChild(s),vo(l,"redraw")}}function ae(e,t,n,r){if(e.noHScroll){(n.alignable||(n.alignable=[])).push(t);var o=r.wrapperWidth;t.style.left=r.fixedPos+"px",e.coverGutter||(o-=r.gutterTotalWidth,t.style.paddingLeft=r.gutterTotalWidth+"px"),t.style.width=o+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-r.gutterTotalWidth+"px"))}var le=C.Pos=function(e,t){if(!(this instanceof le))return new le(e,t);this.line=e,this.ch=t},se=C.cmpPos=function(e,t){return e.line-t.line||e.ch-t.ch};function ce(e){return le(e.line,e.ch)}function ue(e,t){return se(e,t)<0?t:e}function de(e,t){return se(e,t)<0?e:t}function he(e,t){this.ranges=e,this.primIndex=t}function fe(e,t){this.anchor=e,this.head=t}function pe(e,t){var n=e[t];e.sort((function(e,t){return se(e.from(),t.from())})),t=Fo(e,n);for(var r=1;r<e.length;r++){var o=e[r],i=e[r-1];if(se(i.to(),o.from())>=0){var a=de(i.from(),o.from()),l=ue(i.to(),o.to()),s=i.empty()?o.from()==o.head:i.from()==i.head;r<=t&&--t,e.splice(--r,2,new fe(s?l:a,s?a:l))}}return new he(e,t)}function ge(e,t){return new he([new fe(e,t||e)],0)}function me(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function ve(e,t){if(t.line<e.first)return le(e.first,0);var n=e.first+e.size-1;return t.line>n?le(n,zr(e,n).text.length):function(e,t){var n=e.ch;return null==n||n>t?le(e.line,t):n<0?le(e.line,0):e}(t,zr(e,t.line).text.length)}function ye(e,t){return t>=e.first&&t<e.first+e.size}function _e(e,t,n,r){if(e.cm&&e.cm.display.shift||e.extend){var o=t.anchor;if(r){var i=se(n,o)<0;i!=se(r,o)<0?(o=n,n=r):i!=se(n,r)<0&&(n=r)}return new fe(o,n)}return new fe(r||n,n)}function be(e,t,n,r){Ce(e,new he([_e(e,e.sel.primary(),t,n)],0),r)}function we(e,t,n){for(var r=[],o=0;o<e.sel.ranges.length;o++)r[o]=_e(e,e.sel.ranges[o],t[o],null);Ce(e,pe(r,e.sel.primIndex),n)}function xe(e,t,n,r){var o=e.sel.ranges.slice(0);o[t]=n,Ce(e,pe(o,e.sel.primIndex),r)}function Se(e,t,n,r){Ce(e,ge(t,n),r)}function ke(e,t,n){var r=e.history.done,o=Ro(r);o&&o.ranges?(r[r.length-1]=t,Me(e,t,n)):Ce(e,t,n)}function Ce(e,t,n){Me(e,t,n),function(e,t,n,r){var o=e.history,i=r&&r.origin;n==o.lastOp||i&&o.lastSelOrigin==i&&(o.lastModTime==o.lastSelTime&&o.lastOrigin==i||function(e,t,n,r){var o=t.charAt(0);return"*"==o||"+"==o&&n.ranges.length==r.ranges.length&&n.somethingSelected()==r.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}(e,i,Ro(o.done),t))?o.done[o.done.length-1]=t:$r(t,o.done);o.lastSelTime=+new Date,o.lastSelOrigin=i,o.lastOp=n,r&&!1!==r.clearRedo&&Kr(o.undone)}(e,e.sel,e.cm?e.cm.curOp.id:NaN,n)}function Me(e,t,n){(bo(e,"beforeSelectionChange")||e.cm&&bo(e.cm,"beforeSelectionChange"))&&(t=function(e,t){var n={ranges:t.ranges,update:function(t){this.ranges=[];for(var n=0;n<t.length;n++)this.ranges[n]=new fe(ve(e,t[n].anchor),ve(e,t[n].head))}};return go(e,"beforeSelectionChange",e,n),e.cm&&go(e.cm,"beforeSelectionChange",e.cm,n),n.ranges!=t.ranges?pe(n.ranges,n.ranges.length-1):t}(e,t));var r=se(t.primary().head,e.sel.primary().head)<0?-1:1;Te(e,Ie(e,t,r,!0)),n&&!1===n.scroll||!e.cm||mn(e.cm)}function Te(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=e.cm.curOp.cursorActivity=!0),vo(e,"cursorActivity",e))}function Ee(e){Te(e,Ie(e,e.sel,null,!1))}function Ie(e,t,n,r){for(var o,i=0;i<t.ranges.length;i++){var a=t.ranges[i],l=Le(e,a.anchor,n,r),s=Le(e,a.head,n,r);(o||l!=a.anchor||s!=a.head)&&(o||(o=t.ranges.slice(0,i)),o[i]=new fe(l,s))}return o?pe(o,t.primIndex):t}function Le(e,t,n,r){var o=!1,i=t,a=n||1;e.cantEdit=!1;e:for(;;){var l=zr(e,i.line);if(l.markedSpans)for(var s=0;s<l.markedSpans.length;++s){var c=l.markedSpans[s],u=c.marker;if((null==c.from||(u.inclusiveLeft?c.from<=i.ch:c.from<i.ch))&&(null==c.to||(u.inclusiveRight?c.to>=i.ch:c.to>i.ch))){if(r&&(go(u,"beforeCursorEnter"),u.explicitlyCleared)){if(l.markedSpans){--s;continue}break}if(!u.atomic)continue;var d=u.find(a<0?-1:1);if(0==se(d,i)&&(d.ch+=a,d.ch<0?d=d.line>e.first?ve(e,le(d.line-1)):null:d.ch>l.text.length&&(d=d.line<e.first+e.size-1?le(d.line+1,0):null),!d)){if(o)return r?(e.cantEdit=!0,le(e.first,0)):Le(e,t,n,!0);o=!0,d=t,a=-a}i=d;continue e}}return i}}function Ae(e){for(var t=e.display,n=e.doc,r=document.createDocumentFragment(),o=document.createDocumentFragment(),i=0;i<n.sel.ranges.length;i++){var a=n.sel.ranges[i],l=a.empty();(l||e.options.showCursorWhenSelecting)&&Re(e,a,r),l||Oe(e,a,o)}if(e.options.moveInputWithCursor){var s=tt(e,n.sel.primary().head,"div"),c=t.wrapper.getBoundingClientRect(),u=t.lineDiv.getBoundingClientRect(),d=Math.max(0,Math.min(t.wrapper.clientHeight-10,s.top+u.top-c.top)),h=Math.max(0,Math.min(t.wrapper.clientWidth-10,s.left+u.left-c.left));t.inputDiv.style.top=d+"px",t.inputDiv.style.left=h+"px"}Qo(t.cursorDiv,r),Qo(t.selectionDiv,o)}function Re(e,t,n){var r=tt(e,t.head,"div"),o=n.appendChild(Xo("div"," ","CodeMirror-cursor"));if(o.style.left=r.left+"px",o.style.top=r.top+"px",o.style.height=Math.max(0,r.bottom-r.top)*e.options.cursorHeight+"px",r.other){var i=n.appendChild(Xo("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));i.style.display="",i.style.left=r.other.left+"px",i.style.top=r.other.top+"px",i.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function Oe(e,t,n){var r=e.display,o=e.doc,i=document.createDocumentFragment(),a=ze(e.display),l=a.left,s=r.lineSpace.offsetWidth-a.right;function c(e,t,n,r){t<0&&(t=0),i.appendChild(Xo("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px; top: "+t+"px; width: "+(null==n?s-e:n)+"px; height: "+(r-t)+"px"))}function u(t,n,r){var i,a,u=zr(o,t),d=u.text.length;function h(n,r){return et(e,le(t,n),"div",u,r)}return function(e,t,n,r){if(!e)return r(t,n,"ltr");for(var o=!1,i=0;i<e.length;++i){var a=e[i];(a.from<n&&a.to>t||t==n&&a.to==t)&&(r(Math.max(a.from,t),Math.min(a.to,n),1==a.level?"rtl":"ltr"),o=!0)}o||r(t,n,"ltr")}(Xr(u),n||0,null==r?d:r,(function(e,t,o){var u,f,p,g=h(e,"left");if(e==t)u=g,f=p=g.left;else{if(u=h(t-1,"right"),"rtl"==o){var m=g;g=u,u=m}f=g.left,p=u.right}null==n&&0==e&&(f=l),u.top-g.top>3&&(c(f,g.top,null,g.bottom),f=l,g.bottom<u.top&&c(f,g.bottom,null,u.top)),null==r&&t==d&&(p=s),(!i||g.top<i.top||g.top==i.top&&g.left<i.left)&&(i=g),(!a||u.bottom>a.bottom||u.bottom==a.bottom&&u.right>a.right)&&(a=u),f<l+1&&(f=l),c(f,u.top,p-f,u.bottom)})),{start:i,end:a}}var d=t.from(),h=t.to();if(d.line==h.line)u(d.line,d.ch,h.ch);else{var f=zr(o,d.line),p=zr(o,h.line),g=lr(f)==lr(p),m=u(d.line,d.ch,g?f.text.length+1:null).end,v=u(h.line,g?0:null,h.ch).start;g&&(m.top<v.top-2?(c(m.right,m.top,null,m.bottom),c(l,v.top,v.left,v.bottom)):c(m.right,m.top,v.left-m.right,m.bottom)),m.bottom<v.top&&c(l,m.bottom,null,v.top)}n.appendChild(i)}function Fe(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var n=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0&&(t.blinker=setInterval((function(){t.cursorDiv.style.visibility=(n=!n)?"":"hidden"}),e.options.cursorBlinkRate))}}function De(e,t){e.doc.mode.startState&&e.doc.frontier<e.display.viewTo&&e.state.highlight.set(t,Bo(Pe,e))}function Pe(e){var t=e.doc;if(t.frontier<t.first&&(t.frontier=t.first),!(t.frontier>=e.display.viewTo)){var n=+new Date+e.options.workTime,r=On(t.mode,Ne(e,t.frontier));ft(e,(function(){t.iter(t.frontier,Math.min(t.first+t.size,e.display.viewTo+500),(function(o){if(t.frontier>=e.display.viewFrom){var i=o.styles;o.styles=yr(e,o,r,!0);for(var a=!i||i.length!=o.styles.length,l=0;!a&&l<i.length;++l)a=i[l]!=o.styles[l];a&&bt(e,t.frontier,"text"),o.stateAfter=On(t.mode,r)}else br(e,o.text,r),o.stateAfter=t.frontier%5==0?On(t.mode,r):null;if(++t.frontier,+new Date>n)return De(e,e.options.workDelay),!0}))}))}}function Ne(e,t,n){var r=e.doc,o=e.display;if(!r.mode.startState)return!0;var i=function(e,t,n){for(var r,o,i=e.doc,a=n?-1:t-(e.doc.mode.innerMode?1e3:100),l=t;l>a;--l){if(l<=i.first)return i.first;var s=zr(i,l-1);if(s.stateAfter&&(!n||l<=i.frontier))return l;var c=Eo(s.text,null,e.options.tabSize);(null==o||r>c)&&(o=l-1,r=c)}return o}(e,t,n),a=i>r.first&&zr(r,i-1).stateAfter;return a=a?On(r.mode,a):Fn(r.mode),r.iter(i,t,(function(n){br(e,n.text,a);var l=i==t-1||i%5==0||i>=o.viewFrom&&i<o.viewTo;n.stateAfter=l?On(r.mode,a):null,++i})),n&&(r.frontier=i),a}function Be(e){return e.lineSpace.offsetTop}function He(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function ze(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=Qo(e.measure,Xo("pre","x")),n=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle;return e.cachedPaddingH={left:parseInt(n.paddingLeft),right:parseInt(n.paddingRight)}}function je(e,t,n,r){return Ue(e,Ve(e,t),n,r)}function We(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[xt(e,t)];var n=e.display.externalMeasured;return n&&t>=n.lineN&&t<n.lineN+n.size?n:void 0}function Ve(e,t){var n=Ur(t),r=We(e,n);r&&!r.text?r=null:r&&r.changes&&K(e,r,n,Q(e)),r||(r=function(e,t){var n=Ur(t=lr(t)),r=e.display.externalMeasured=new vt(e.doc,t,n);r.lineN=n;var o=r.built=kr(e,r);return r.text=o.pre,Qo(e.display.lineMeasure,o.pre),r}(e,t));var o=function(e,t,n){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var r=0;r<e.rest.length;r++)if(e.rest[r]==t)return{map:e.measure.maps[r],cache:e.measure.caches[r]};for(r=0;r<e.rest.length;r++)if(Ur(e.rest[r])>n)return{map:e.measure.maps[r],cache:e.measure.caches[r],before:!0}}(r,t,n);return{line:t,view:r,rect:null,map:o.map,cache:o.cache,before:o.before,hasHeights:!1}}function Ue(e,t,n,o){t.before&&(n=-1);var i,l=n+(o||"");return t.cache.hasOwnProperty(l)?i=t.cache[l]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(!function(e,t,n){var r=e.options.lineWrapping,o=r&&e.display.scroller.clientWidth;if(!t.measure.heights||r&&t.measure.width!=o){var i=t.measure.heights=[];if(r){t.measure.width=o;for(var a=t.text.firstChild.getClientRects(),l=0;l<a.length-1;l++){var s=a[l],c=a[l+1];Math.abs(s.bottom-c.bottom)>2&&i.push((s.bottom+c.top)/2-n.top)}}i.push(n.bottom-n.top)}}(e,t.view,t.rect),t.hasHeights=!0),i=function(e,t,n,o){for(var i,l,s,c,u,d=t.map,h=0;h<d.length;h+=3){var f=d[h],p=d[h+1];if(n<f?(l=0,s=1,c="left"):n<p?s=(l=n-f)+1:(h==d.length-3||n==p&&d[h+3]>n)&&(l=(s=p-f)-1,n>=p&&(c="right")),null!=l){if(i=d[h+2],f==p&&o==(i.insertLeft?"left":"right")&&(c=o),"left"==o&&0==l)for(;h&&d[h-2]==d[h-3]&&d[h-1].insertLeft;)i=d[2+(h-=3)],c="left";if("right"==o&&l==p-f)for(;h<d.length-3&&d[h+3]==d[h+4]&&!d[h+5].insertLeft;)i=d[(h+=3)+2],c="right";break}}if(3==i.nodeType){for(;l&&Vo(t.line.text.charAt(f+l));)--l;for(;f+s<p&&Vo(t.line.text.charAt(f+s));)++s;if(r&&0==l&&s==p-f)u=i.parentNode.getBoundingClientRect();else if(a&&e.options.lineWrapping){u=(g=Uo(i,l,s).getClientRects()).length?g["right"==o?g.length-1:0]:Ge}else u=Uo(i,l,s).getBoundingClientRect()}else{var g;l>0&&(c=o="right"),u=e.options.lineWrapping&&(g=i.getClientRects()).length>1?g["right"==o?g.length-1:0]:i.getBoundingClientRect()}if(r&&!l&&(!u||!u.left&&!u.right)){var m=i.parentNode.getClientRects()[0];u=m?{left:m.left,right:m.left+lt(e.display),top:m.top,bottom:m.bottom}:Ge}var v,y=(u.bottom+u.top)/2-t.rect.top,_=t.view.measure.heights;for(h=0;h<_.length-1&&!(y<_[h]);h++);v=h?_[h-1]:0,y=_[h];var b={left:("right"==c?u.right:u.left)-t.rect.left,right:("left"==c?u.left:u.right)-t.rect.left,top:v,bottom:y};u.left||u.right||(b.bogus=!0);return b}(e,t,n,o),i.bogus||(t.cache[l]=i)),{left:i.left,right:i.right,top:i.top,bottom:i.bottom}}he.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var n=this.ranges[t],r=e.ranges[t];if(0!=se(n.anchor,r.anchor)||0!=se(n.head,r.head))return!1}return!0},deepCopy:function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new fe(ce(this.ranges[t].anchor),ce(this.ranges[t].head));return new he(e,this.primIndex)},somethingSelected:function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},contains:function(e,t){t||(t=e);for(var n=0;n<this.ranges.length;n++){var r=this.ranges[n];if(se(t,r.from())>=0&&se(e,r.to())<=0)return n}return-1}},fe.prototype={from:function(){return de(this.anchor,this.head)},to:function(){return ue(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var qe,Ge={left:0,right:0,top:0,bottom:0};function Xe(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function Ye(e){e.display.externalMeasure=null,Yo(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)Xe(e.display.view[t])}function Qe(e){Ye(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function Ke(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Je(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function $e(e,t,n,r){if(t.widgets)for(var o=0;o<t.widgets.length;++o)if(t.widgets[o].above){var i=pr(t.widgets[o]);n.top+=i,n.bottom+=i}if("line"==r)return n;r||(r="local");var a=Gr(t);if("local"==r?a+=Be(e.display):a-=e.display.viewOffset,"page"==r||"window"==r){var l=e.display.lineSpace.getBoundingClientRect();a+=l.top+("window"==r?0:Je());var s=l.left+("window"==r?0:Ke());n.left+=s,n.right+=s}return n.top+=a,n.bottom+=a,n}function Ze(e,t,n){if("div"==n)return t;var r=t.left,o=t.top;if("page"==n)r-=Ke(),o-=Je();else if("local"==n||!n){var i=e.display.sizer.getBoundingClientRect();r+=i.left,o+=i.top}var a=e.display.lineSpace.getBoundingClientRect();return{left:r-a.left,top:o-a.top}}function et(e,t,n,r,o){return r||(r=zr(e.doc,t.line)),$e(e,r,je(e,r,t.ch,o),n)}function tt(e,t,n,r,o){function i(t,i){var a=Ue(e,o,t,i?"right":"left");return i?a.left=a.right:a.right=a.left,$e(e,r,a,n)}function a(e,t){var n=l[t],r=n.level%2;return e==di(n)&&t&&n.level<l[t-1].level?(e=hi(n=l[--t])-(n.level%2?0:1),r=!0):e==hi(n)&&t<l.length-1&&n.level<l[t+1].level&&(e=di(n=l[++t])-n.level%2,r=!1),r&&e==n.to&&e>n.from?i(e-1):i(e,r)}r=r||zr(e.doc,t.line),o||(o=Ve(e,r));var l=Xr(r),s=t.ch;if(!l)return i(s);var c=a(s,vi(l,s));return null!=ai&&(c.other=a(s,ai)),c}function nt(e,t){var n=0;t=ve(e.doc,t);e.options.lineWrapping||(n=lt(e.display)*t.ch);var r=zr(e.doc,t.line),o=Gr(r)+Be(e.display);return{left:n,right:n,top:o,bottom:o+r.height}}function rt(e,t,n,r){var o=le(e,t);return o.xRel=r,n&&(o.outside=!0),o}function ot(e,t,n){var r=e.doc;if((n+=e.display.viewOffset)<0)return rt(r.first,0,!0,-1);var o=qr(r,n),i=r.first+r.size-1;if(o>i)return rt(r.first+r.size-1,zr(r,i).text.length,!0,1);t<0&&(t=0);for(var a=zr(r,o);;){var l=it(e,a,o,t,n),s=ir(a),c=s&&s.find(0,!0);if(!s||!(l.ch>c.from.ch||l.ch==c.from.ch&&l.xRel>0))return l;o=Ur(a=c.to.line)}}function it(e,t,n,r,o){var i=o-Gr(t),a=!1,l=2*e.display.wrapper.clientWidth,s=Ve(e,t);function c(r){var o=tt(e,le(n,r),"line",t,s);return a=!0,i>o.bottom?o.left-l:i<o.top?o.left+l:(a=!1,o.left)}var u=Xr(t),d=t.text.length,h=fi(t),f=pi(t),p=c(h),g=a,m=c(f),v=a;if(r>m)return rt(n,f,v,1);for(;;){if(u?f==h||f==_i(t,h,1):f-h<=1){for(var y=r<p||r-p<=m-r?h:f,_=r-(y==h?p:m);Vo(t.text.charAt(y));)++y;return rt(n,y,y==h?g:v,_<-1?-1:_>1?1:0)}var b=Math.ceil(d/2),w=h+b;if(u){w=h;for(var x=0;x<b;++x)w=_i(t,w,1)}var S=c(w);S>r?(f=w,m=S,(v=a)&&(m+=1e3),d=b):(h=w,p=S,g=a,d-=b)}}function at(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==qe){qe=Xo("pre");for(var t=0;t<49;++t)qe.appendChild(document.createTextNode("x")),qe.appendChild(Xo("br"));qe.appendChild(document.createTextNode("x"))}Qo(e.measure,qe);var n=qe.offsetHeight/50;return n>3&&(e.cachedTextHeight=n),Yo(e.measure),n||1}function lt(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=Xo("span","xxxxxxxxxx"),n=Xo("pre",[t]);Qo(e.measure,n);var r=t.getBoundingClientRect(),o=(r.right-r.left)/10;return o>2&&(e.cachedCharWidth=o),o||10}var st,ct,ut=0;function dt(e){e.curOp={viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivity:!1,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,id:++ut},mo++||(ho=[])}function ht(e){var t=e.curOp,n=e.doc,r=e.display;if(e.curOp=null,t.updateMaxLine&&P(e),t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<r.viewFrom||t.scrollToPos.to.line>=r.viewTo)||r.maxLineChanged&&e.options.lineWrapping){var o=U(e,{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate);e.display.scroller.offsetHeight&&(e.doc.scrollTop=e.display.scroller.scrollTop)}if(!o&&t.selectionChanged&&Ae(e),o||t.startHeight==e.doc.height||H(e),null!=t.scrollTop&&r.scroller.scrollTop!=t.scrollTop){var i=Math.max(0,Math.min(r.scroller.scrollHeight-r.scroller.clientHeight,t.scrollTop));r.scroller.scrollTop=r.scrollbarV.scrollTop=n.scrollTop=i}if(null!=t.scrollLeft&&r.scroller.scrollLeft!=t.scrollLeft){var a=Math.max(0,Math.min(r.scroller.scrollWidth-r.scroller.clientWidth,t.scrollLeft));r.scroller.scrollLeft=r.scrollbarH.scrollLeft=n.scrollLeft=a,j(e)}if(t.scrollToPos){var l=function(e,t,n,r){null==r&&(r=0);for(;;){var o=!1,i=tt(e,t),a=n&&n!=t?tt(e,n):i,l=pn(e,Math.min(i.left,a.left),Math.min(i.top,a.top)-r,Math.max(i.left,a.left),Math.max(i.bottom,a.bottom)+r),s=e.doc.scrollTop,c=e.doc.scrollLeft;if(null!=l.scrollTop&&(Ht(e,l.scrollTop),Math.abs(e.doc.scrollTop-s)>1&&(o=!0)),null!=l.scrollLeft&&(zt(e,l.scrollLeft),Math.abs(e.doc.scrollLeft-c)>1&&(o=!0)),!o)return i}}(e,ve(e.doc,t.scrollToPos.from),ve(e.doc,t.scrollToPos.to),t.scrollToPos.margin);t.scrollToPos.isCursor&&e.state.focused&&function(e,t){var n=e.display,r=n.sizer.getBoundingClientRect(),o=null;t.top+r.top<0?o=!0:t.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(o=!1);if(null!=o&&!g){var i=Xo("div","​",null,"position: absolute; top: "+(t.top-n.viewOffset-Be(e.display))+"px; height: "+(t.bottom-t.top+xo)+"px; left: "+t.left+"px; width: 2px;");e.display.lineSpace.appendChild(i),i.scrollIntoView(o),e.display.lineSpace.removeChild(i)}}(e,l)}t.selectionChanged&&Fe(e),e.state.focused&&t.updateInput&&Et(e,t.typing);var s,c=t.maybeHiddenMarkers,u=t.maybeUnhiddenMarkers;if(c)for(var d=0;d<c.length;++d)c[d].lines.length||go(c[d],"hide");if(u)for(d=0;d<u.length;++d)u[d].lines.length&&go(u[d],"unhide");if(--mo||(s=ho,ho=null),t.changeObjs){for(d=0;d<t.changeObjs.length;d++)go(e,"change",e,t.changeObjs[d]);go(e,"changes",e,t.changeObjs)}if(t.cursorActivity&&go(e,"cursorActivity",e),s)for(d=0;d<s.length;++d)s[d]()}function ft(e,t){if(e.curOp)return t();dt(e);try{return t()}finally{ht(e)}}function pt(e,t){return function(){if(e.curOp)return t.apply(e,arguments);dt(e);try{return t.apply(e,arguments)}finally{ht(e)}}}function gt(e){return function(){if(this.curOp)return e.apply(this,arguments);dt(this);try{return e.apply(this,arguments)}finally{ht(this)}}}function mt(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);dt(t);try{return e.apply(this,arguments)}finally{ht(t)}}}function vt(e,t,n){this.line=t,this.rest=function(e){var t,n;for(;t=ir(e);)e=t.find(1,!0).line,(n||(n=[])).push(e);return n}(t),this.size=this.rest?Ur(Ro(this.rest))-n+1:1,this.node=this.text=null,this.hidden=ur(e,t)}function yt(e,t,n){for(var r,o=[],i=t;i<n;i=r){var a=new vt(e.doc,zr(e.doc,i),i);r=i+a.size,o.push(a)}return o}function _t(e,t,n,r){null==t&&(t=e.doc.first),null==n&&(n=e.doc.first+e.doc.size),r||(r=0);var o=e.display;if(r&&n<o.viewTo&&(null==o.updateLineNumbers||o.updateLineNumbers>t)&&(o.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=o.viewTo)k&&sr(e.doc,t)<o.viewTo&&wt(e);else if(n<=o.viewFrom)k&&cr(e.doc,n+r)>o.viewFrom?wt(e):(o.viewFrom+=r,o.viewTo+=r);else if(t<=o.viewFrom&&n>=o.viewTo)wt(e);else if(t<=o.viewFrom){(i=St(e,n,n+r,1))?(o.view=o.view.slice(i.index),o.viewFrom=i.lineN,o.viewTo+=r):wt(e)}else if(n>=o.viewTo){var i;(i=St(e,t,t,-1))?(o.view=o.view.slice(0,i.index),o.viewTo=i.lineN):wt(e)}else{var a=St(e,t,t,-1),l=St(e,n,n+r,1);a&&l?(o.view=o.view.slice(0,a.index).concat(yt(e,a.lineN,l.lineN)).concat(o.view.slice(l.index)),o.viewTo+=r):wt(e)}var s=o.externalMeasured;s&&(n<s.lineN?s.lineN+=r:t<s.lineN+s.size&&(o.externalMeasured=null))}function bt(e,t,n){e.curOp.viewChanged=!0;var r=e.display,o=e.display.externalMeasured;if(o&&t>=o.lineN&&t<o.lineN+o.size&&(r.externalMeasured=null),!(t<r.viewFrom||t>=r.viewTo)){var i=r.view[xt(e,t)];if(null!=i.node){var a=i.changes||(i.changes=[]);-1==Fo(a,n)&&a.push(n)}}}function wt(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function xt(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var n=e.display.view,r=0;r<n.length;r++)if((t-=n[r].size)<0)return r}function St(e,t,n,r){var o,i=xt(e,t),a=e.display.view;if(!k)return{index:i,lineN:n};for(var l=0,s=e.display.viewFrom;l<i;l++)s+=a[l].size;if(s!=t){if(r>0){if(i==a.length-1)return null;o=s+a[i].size-t,i++}else o=s-t;t+=o,n+=o}for(;sr(e.doc,n)!=n;){if(i==(r<0?0:a.length-1))return null;n+=r*a[i-(r<0?1:0)].size,i+=r}return{index:i,lineN:n}}function kt(e){for(var t=e.display.view,n=0,r=0;r<t.length;r++){var o=t[r];o.hidden||o.node&&!o.changes||++n}return n}function Ct(e){e.display.pollingFast||e.display.poll.set(e.options.pollInterval,(function(){Tt(e),e.state.focused&&Ct(e)}))}function Mt(e){var t=!1;e.display.pollingFast=!0,e.display.poll.set(20,(function n(){Tt(e)||t?(e.display.pollingFast=!1,Ct(e)):(t=!0,e.display.poll.set(60,n))}))}function Tt(e){var t=e.display.input,n=e.display.prevInput,o=e.doc;if(!e.state.focused||si(t)||At(e)||e.options.disableInput)return!1;var i=t.value;if(i==n&&!e.somethingSelected())return!1;if(a&&!r&&e.display.inputHasSelection===i)return Et(e),!1;var l=!e.curOp;l&&dt(e),e.display.shift=!1;for(var s=0,c=Math.min(n.length,i.length);s<c&&n.charCodeAt(s)==i.charCodeAt(s);)++s;for(var u=i.slice(s),d=li(u),h=e.state.pasteIncoming&&d.length>1&&o.sel.ranges.length==d.length,f=o.sel.ranges.length-1;f>=0;f--){var p=o.sel.ranges[f],g=p.from(),m=p.to();s<n.length?g=le(g.line,g.ch-(n.length-s)):e.state.overwrite&&p.empty()&&!e.state.pasteIncoming&&(m=le(m.line,Math.min(zr(o,m.line).text.length,m.ch+Ro(d).length)));var v=e.curOp.updateInput,y={from:g,to:m,text:h?[d[f]]:d,origin:e.state.pasteIncoming?"paste":e.state.cutIncoming?"cut":"+input"};if(sn(e.doc,y),vo(e,"inputRead",e,y),u&&!e.state.pasteIncoming&&e.options.electricChars&&e.options.smartIndent&&p.head.ch<100&&(!f||o.sel.ranges[f-1].head.line!=p.head.line)){var _=e.getModeAt(p.head).electricChars;if(_)for(var b=0;b<_.length;b++)if(u.indexOf(_.charAt(b))>-1){yn(e,p.head.line,"smart");break}}}return mn(e),e.curOp.updateInput=v,e.curOp.typing=!0,i.length>1e3||i.indexOf("\n")>-1?t.value=e.display.prevInput="":e.display.prevInput=i,l&&ht(e),e.state.pasteIncoming=e.state.cutIncoming=!1,!0}function Et(e,t){var n,o,i=e.doc;if(e.somethingSelected()){e.display.prevInput="";var l=i.sel.primary(),s=(n=ci&&(l.to().line-l.from().line>100||(o=e.getSelection()).length>1e3))?"-":o||e.getSelection();e.display.input.value=s,e.state.focused&&Oo(e.display.input),a&&!r&&(e.display.inputHasSelection=s)}else t||(e.display.prevInput=e.display.input.value="",a&&!r&&(e.display.inputHasSelection=null));e.display.inaccurateSelection=n}function It(e){"nocursor"==e.options.readOnly||v&&Jo()==e.display.input||e.display.input.focus()}function Lt(e){e.state.focused||(It(e),Zt(e))}function At(e){return e.options.readOnly||e.doc.cantEdit}function Rt(e,t){for(var n=co(t);n!=e.wrapper;n=n.parentNode)if(!n||n.ignoreEvents||n.parentNode==e.sizer&&n!=e.mover)return!0}function Ot(e,t,n,r){var o=e.display;if(!n){var i=co(t);if(i==o.scrollbarH||i==o.scrollbarV||i==o.scrollbarFiller||i==o.gutterFiller)return null}var a,l,s=o.lineSpace.getBoundingClientRect();try{a=t.clientX-s.left,l=t.clientY-s.top}catch(t){return null}var c,u=ot(e,a,l);if(r&&1==u.xRel&&(c=zr(e.doc,u.line).text).length==u.ch){var d=Eo(c,c.length,e.options.tabSize)-c.length;u=le(u.line,Math.round((a-ze(e.display).left)/lt(e.display))-d)}return u}function Ft(e){if(!_o(this,e)){var n=this,i=n.display;if(i.shift=e.shiftKey,Rt(i,e))l||(i.scroller.draggable=!1,setTimeout((function(){i.scroller.draggable=!0}),100));else if(!Pt(n,e)){var s=Ot(n,e);switch(window.focus(),uo(e)){case 1:s?function(e,n,i){setTimeout(Bo(Lt,e),0);var s,c=+new Date;ct&&ct.time>c-400&&0==se(ct.pos,i)?s="triple":st&&st.time>c-400&&0==se(st.pos,i)?(s="double",ct={time:c,pos:i}):(s="single",st={time:c,pos:i});var u=e.doc.sel,d=!1;e.options.dragDrop&&ti&&!d&&!At(e)&&"single"==s&&u.contains(i)>-1&&u.somethingSelected()?function(e,n,o){var i=e.display,a=pt(e,(function(s){l&&(i.scroller.draggable=!1),e.state.draggingText=!1,po(document,"mouseup",a),po(i.scroller,"drop",a),Math.abs(n.clientX-s.clientX)+Math.abs(n.clientY-s.clientY)<10&&(io(s),be(e.doc,o),It(e),t&&!r&&setTimeout((function(){document.body.focus(),It(e)}),20))}));l&&(i.scroller.draggable=!0);e.state.draggingText=a,i.scroller.dragDrop&&i.scroller.dragDrop();fo(document,"mouseup",a),fo(i.scroller,"drop",a)}(e,n,i):function(e,t,n,r,i){var l=e.display,s=e.doc;io(t);var c,u,d=s.sel;i?(u=s.sel.contains(n),c=u>-1?s.sel.ranges[u]:new fe(n,n)):c=s.sel.primary();if(t.altKey)r="rect",i||(c=new fe(n,n)),n=Ot(e,t,!0,!0),u=-1;else if("double"==r){var h=Sn(s,n);c=e.display.shift||s.extend?_e(s,c,h.anchor,h.head):h}else if("triple"==r){var f=new fe(le(n.line,0),ve(s,le(n.line+1,0)));c=e.display.shift||s.extend?_e(s,c,f.anchor,f.head):f}else c=_e(s,c,n);i?u>-1?xe(s,u,c,Co):(u=s.sel.ranges.length,Ce(s,pe(s.sel.ranges.concat([c]),u),{scroll:!1,origin:"*mouse"})):(u=0,Ce(s,new he([c],0),Co));var p=n;function g(t){if(0!=se(p,t))if(p=t,"rect"==r){for(var o=[],i=e.options.tabSize,a=Eo(zr(s,n.line).text,n.ch,i),l=Eo(zr(s,t.line).text,t.ch,i),h=Math.min(a,l),f=Math.max(a,l),g=Math.min(n.line,t.line),m=Math.min(e.lastLine(),Math.max(n.line,t.line));g<=m;g++){var v=zr(s,g).text,y=Io(v,h,i);h==f?o.push(new fe(le(g,y),le(g,y))):v.length>y&&o.push(new fe(le(g,y),le(g,Io(v,f,i))))}o.length||o.push(new fe(n,n)),Ce(s,pe(d.ranges.slice(0,u).concat(o),u),Co)}else{var _=c,b=_.anchor,w=t;if("single"!=r){if("double"==r)var x=Sn(s,t);else x=new fe(le(t.line,0),ve(s,le(t.line+1,0)));se(x.anchor,b)>0?(w=x.head,b=de(_.from(),x.anchor)):(w=x.anchor,b=ue(_.to(),x.head))}(o=d.ranges.slice(0))[u]=new fe(ve(s,b),w),Ce(s,pe(o,u),Co)}}var m=l.wrapper.getBoundingClientRect(),v=0;function y(t){var n=++v,o=Ot(e,t,!0,"rect"==r);if(o)if(0!=se(o,p)){Lt(e),g(o);var i=z(l,s);(o.line>=i.to||o.line<i.from)&&setTimeout(pt(e,(function(){v==n&&y(t)})),150)}else{var a=t.clientY<m.top?-20:t.clientY>m.bottom?20:0;a&&setTimeout(pt(e,(function(){v==n&&(l.scroller.scrollTop+=a,y(t))})),50)}}function _(t){v=1/0,io(t),It(e),po(document,"mousemove",b),po(document,"mouseup",w),s.history.lastSelOrigin=null}var b=pt(e,(function(e){(a&&!o?e.buttons:uo(e))?y(e):_(e)})),w=pt(e,_);fo(document,"mousemove",b),fo(document,"mouseup",w)}(e,n,i,s,d)}(n,e,s):co(e)==i.scroller&&io(e);break;case 2:l&&(n.state.lastMiddleDown=+new Date),s&&be(n.doc,s),setTimeout(Bo(It,n),20),io(e);break;case 3:x&&tn(n,e)}}}}function Dt(e,t,n,r,o){try{var i=t.clientX,a=t.clientY}catch(t){return!1}if(i>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;r&&io(t);var l=e.display,s=l.lineDiv.getBoundingClientRect();if(a>s.bottom||!bo(e,n))return lo(t);a-=s.top-l.viewOffset;for(var c=0;c<e.options.gutters.length;++c){var u=l.gutters.childNodes[c];if(u&&u.getBoundingClientRect().right>=i)return o(e,n,e,qr(e.doc,a),e.options.gutters[c],t),lo(t)}}function Pt(e,t){return Dt(e,t,"gutterClick",!0,vo)}var Nt=0;function Bt(e){var n=this;if(!_o(n,e)&&!Rt(n.display,e)){io(e),t&&(Nt=+new Date);var r=Ot(n,e,!0),o=e.dataTransfer.files;if(r&&!At(n))if(o&&o.length&&window.FileReader&&window.File)for(var i=o.length,a=Array(i),l=0,s=function(e,t){var o=new FileReader;o.onload=function(){if(a[t]=o.result,++l==i){var e={from:r=ve(n.doc,r),to:r,text:li(a.join("\n")),origin:"paste"};sn(n.doc,e),ke(n.doc,ge(r,nn(e)))}},o.readAsText(e)},c=0;c<i;++c)s(o[c],c);else{if(n.state.draggingText&&n.doc.sel.contains(r)>-1)return n.state.draggingText(e),void setTimeout(Bo(It,n),20);try{if(a=e.dataTransfer.getData("Text")){var u=n.state.draggingText&&n.listSelections();if(Me(n.doc,ge(r,r)),u)for(c=0;c<u.length;++c)fn(n.doc,"",u[c].anchor,u[c].head,"drag");n.replaceSelection(a,"around","paste"),It(n)}}catch(e){}}}}function Ht(t,n){Math.abs(t.doc.scrollTop-n)<2||(t.doc.scrollTop=n,e||U(t,{top:n}),t.display.scroller.scrollTop!=n&&(t.display.scroller.scrollTop=n),t.display.scrollbarV.scrollTop!=n&&(t.display.scrollbarV.scrollTop=n),e&&U(t),De(t,100))}function zt(e,t,n){(n?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)||(t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),e.doc.scrollLeft=t,j(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbarH.scrollLeft!=t&&(e.display.scrollbarH.scrollLeft=t))}var jt,Wt=0,Vt=null;function Ut(t,n){var r=n.wheelDeltaX,o=n.wheelDeltaY;null==r&&n.detail&&n.axis==n.HORIZONTAL_AXIS&&(r=n.detail),null==o&&n.detail&&n.axis==n.VERTICAL_AXIS?o=n.detail:null==o&&(o=n.wheelDelta);var i=t.display,a=i.scroller;if(r&&a.scrollWidth>a.clientWidth||o&&a.scrollHeight>a.clientHeight){if(o&&y&&l)e:for(var s=n.target,c=i.view;s!=a;s=s.parentNode)for(var d=0;d<c.length;d++)if(c[d].node==s){t.display.currentWheelTarget=s;break e}if(r&&!e&&!u&&null!=Vt)return o&&Ht(t,Math.max(0,Math.min(a.scrollTop+o*Vt,a.scrollHeight-a.clientHeight))),zt(t,Math.max(0,Math.min(a.scrollLeft+r*Vt,a.scrollWidth-a.clientWidth))),io(n),void(i.wheelStartX=null);if(o&&null!=Vt){var h=o*Vt,f=t.doc.scrollTop,p=f+i.wrapper.clientHeight;h<0?f=Math.max(0,f+h-50):p=Math.min(t.doc.height,p+h+50),U(t,{top:f,bottom:p})}Wt<20&&(null==i.wheelStartX?(i.wheelStartX=a.scrollLeft,i.wheelStartY=a.scrollTop,i.wheelDX=r,i.wheelDY=o,setTimeout((function(){if(null!=i.wheelStartX){var e=a.scrollLeft-i.wheelStartX,t=a.scrollTop-i.wheelStartY,n=t&&i.wheelDY&&t/i.wheelDY||e&&i.wheelDX&&e/i.wheelDX;i.wheelStartX=i.wheelStartY=null,n&&(Vt=(Vt*Wt+n)/(Wt+1),++Wt)}}),200)):(i.wheelDX+=r,i.wheelDY+=o))}}function qt(e,t,n){if("string"==typeof t&&!(t=Dn[t]))return!1;e.display.pollingFast&&Tt(e)&&(e.display.pollingFast=!1);var r=e.display.shift,o=!1;try{At(e)&&(e.state.suppressEdits=!0),n&&(e.display.shift=!1),o=t(e)!=So}finally{e.display.shift=r,e.state.suppressEdits=!1}return o}function Gt(e){var t=e.state.keyMaps.slice(0);return e.options.extraKeys&&t.push(e.options.extraKeys),t.push(e.options.keyMap),t}function Xt(e,t){var n=Nn(e.options.keyMap),r=n.auto;clearTimeout(jt),r&&!Hn(t)&&(jt=setTimeout((function(){Nn(e.options.keyMap)==n&&(e.options.keyMap=r.call?r.call(null,e):r,A(e))}),50));var o=zn(t,!0),i=!1;if(!o)return!1;var a=Gt(e);return(i=t.shiftKey?Bn("Shift-"+o,a,(function(t){return qt(e,t,!0)}))||Bn(o,a,(function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return qt(e,t)})):Bn(o,a,(function(t){return qt(e,t)})))&&(io(t),Fe(e),vo(e,"keyHandled",e,o,t)),i}a?Vt=-.53:e?Vt=15:c?Vt=-.7:d&&(Vt=-1/3);var Yt,Qt=null;function Kt(e){var n=this;if(Lt(n),!_o(n,e)){t&&27==e.keyCode&&(e.returnValue=!1);var r=e.keyCode;n.display.shift=16==r||e.shiftKey;var o=Xt(n,e);u&&(Qt=o?r:null,o||88!=r||ci||!(y?e.metaKey:e.ctrlKey)||n.replaceSelection("",null,"cut"))}}function Jt(e){_o(this,e)||16==e.keyCode&&(this.doc.sel.shift=!1)}function $t(e){var t=this;if(!_o(t,e)){var n=e.keyCode,o=e.charCode;if(u&&n==Qt)return Qt=null,void io(e);if(!(u&&(!e.which||e.which<10)||h)||!Xt(t,e))(function(e,t,n){var r=Bn("'"+n+"'",Gt(e),(function(t){return qt(e,t,!0)}));return r&&(io(t),Fe(e),vo(e,"keyHandled",e,"'"+n+"'",t)),r})(t,e,String.fromCharCode(null==o?n:o))||(a&&!r&&(t.display.inputHasSelection=null),Mt(t))}}function Zt(e){"nocursor"!=e.options.readOnly&&(e.state.focused||(go(e,"focus",e),e.state.focused=!0,-1==e.display.wrapper.className.search(/\bCodeMirror-focused\b/)&&(e.display.wrapper.className+=" CodeMirror-focused"),e.curOp||(Et(e),l&&setTimeout(Bo(Et,e,!0),0))),Ct(e),Fe(e))}function en(e){e.state.focused&&(go(e,"blur",e),e.state.focused=!1,e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-focused","")),clearInterval(e.display.blinker),setTimeout((function(){e.state.focused||(e.display.shift=!1)}),150)}function tn(e,t){if(!_o(e,t,"contextmenu")){var n=e.display;if(!Rt(n,t)&&!function(e,t){return!!bo(e,"gutterContextMenu")&&Dt(e,t,"gutterContextMenu",!1,go)}(e,t)){var o=Ot(e,t),i=n.scroller.scrollTop;if(o&&!u){e.options.resetSelectionOnContextMenu&&-1==e.doc.sel.contains(o)&&pt(e,Ce)(e.doc,ge(o),ko);var l=n.input.style.cssText;if(n.inputDiv.style.position="absolute",n.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(t.clientY-5)+"px; left: "+(t.clientX-5)+"px; z-index: 1000; background: "+(a?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",It(e),Et(e),e.somethingSelected()||(n.input.value=n.prevInput=" "),a&&!r&&c(),x){so(t);var s=function(){po(window,"mouseup",s),setTimeout(d,20)};fo(window,"mouseup",s)}else setTimeout(d,50)}}}function c(){if(null!=n.input.selectionStart){var t=n.input.value="​"+(e.somethingSelected()?n.input.value:"");n.prevInput="​",n.input.selectionStart=1,n.input.selectionEnd=t.length}}function d(){if(n.inputDiv.style.position="relative",n.input.style.cssText=l,r&&(n.scrollbarV.scrollTop=n.scroller.scrollTop=i),Ct(e),null!=n.input.selectionStart){a&&!r||c(),clearTimeout(Yt);var t=0,o=function(){"​"==n.prevInput&&0==n.input.selectionStart?pt(e,Dn.selectAll)(e):t++<10?Yt=setTimeout(o,500):Et(e)};Yt=setTimeout(o,200)}}}var nn=C.changeEnd=function(e){return e.text?le(e.from.line+e.text.length-1,Ro(e.text).length+(1==e.text.length?e.from.ch:0)):e.to};function rn(e,t){if(se(e,t.from)<0)return e;if(se(e,t.to)<=0)return nn(t);var n=e.line+t.text.length-(t.to.line-t.from.line)-1,r=e.ch;return e.line==t.to.line&&(r+=nn(t).ch-t.to.ch),le(n,r)}function on(e,t){for(var n=[],r=0;r<e.sel.ranges.length;r++){var o=e.sel.ranges[r];n.push(new fe(rn(o.anchor,t),rn(o.head,t)))}return pe(n,e.sel.primIndex)}function an(e,t,n){return e.line==t.line?le(n.line,e.ch-t.ch+n.ch):le(n.line+(e.line-t.line),e.ch)}function ln(e,t,n){var r={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){this.canceled=!0}};return n&&(r.update=function(t,n,r,o){t&&(this.from=ve(e,t)),n&&(this.to=ve(e,n)),r&&(this.text=r),void 0!==o&&(this.origin=o)}),go(e,"beforeChange",e,r),e.cm&&go(e.cm,"beforeChange",e.cm,r),r.canceled?null:{from:r.from,to:r.to,text:r.text,origin:r.origin}}function sn(e,t,n){if(e.cm){if(!e.cm.curOp)return pt(e.cm,sn)(e,t,n);if(e.cm.state.suppressEdits)return}if(!(bo(e,"beforeChange")||e.cm&&bo(e.cm,"beforeChange"))||(t=ln(e,t,!0))){var r=S&&!n&&function(e,t,n){var r=null;if(e.iter(t.line,n.line+1,(function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var n=e.markedSpans[t].marker;!n.readOnly||r&&-1!=Fo(r,n)||(r||(r=[])).push(n)}})),!r)return null;for(var o=[{from:t,to:n}],i=0;i<r.length;++i)for(var a=r[i],l=a.find(0),s=0;s<o.length;++s){var c=o[s];if(!(se(c.to,l.from)<0||se(c.from,l.to)>0)){var u=[s,1],d=se(c.from,l.from),h=se(c.to,l.to);(d<0||!a.inclusiveLeft&&!d)&&u.push({from:c.from,to:l.from}),(h>0||!a.inclusiveRight&&!h)&&u.push({from:l.to,to:c.to}),o.splice.apply(o,u),s+=u.length-1}}return o}(e,t.from,t.to);if(r)for(var o=r.length-1;o>=0;--o)cn(e,{from:r[o].from,to:r[o].to,text:o?[""]:t.text});else cn(e,t)}}function cn(e,t){if(1!=t.text.length||""!=t.text[0]||0!=se(t.from,t.to)){var n=on(e,t);Jr(e,t,n,e.cm?e.cm.curOp.id:NaN),hn(e,t,n,Qn(e,t));var r=[];Br(e,(function(e,n){n||-1!=Fo(r,e.history)||(oo(e.history,t),r.push(e.history)),hn(e,t,null,Qn(e,t))}))}}function un(e,t,n){if(!e.cm||!e.cm.state.suppressEdits){for(var r,o=e.history,i=e.sel,a="undo"==t?o.done:o.undone,l="undo"==t?o.undone:o.done,s=0;s<a.length&&(r=a[s],n?!r.ranges||r.equals(e.sel):r.ranges);s++);if(s!=a.length){for(o.lastOrigin=o.lastSelOrigin=null;(r=a.pop()).ranges;){if($r(r,l),n&&!r.equals(e.sel))return void Ce(e,r,{clearRedo:!1});i=r}var c=[];$r(i,l),l.push({changes:c,generation:o.generation}),o.generation=r.generation||++o.maxGeneration;var u=bo(e,"beforeChange")||e.cm&&bo(e.cm,"beforeChange");for(s=r.changes.length-1;s>=0;--s){var d=r.changes[s];if(d.origin=t,u&&!ln(e,d,!1))return void(a.length=0);c.push(Qr(e,d));var h=s?on(e,d):Ro(a);hn(e,d,h,Jn(e,d)),e.cm&&mn(e.cm);var f=[];Br(e,(function(e,t){t||-1!=Fo(f,e.history)||(oo(e.history,d),f.push(e.history)),hn(e,d,null,Jn(e,d))}))}}}}function dn(e,t){e.first+=t,e.sel=new he(Do(e.sel.ranges,(function(e){return new fe(le(e.anchor.line+t,e.anchor.ch),le(e.head.line+t,e.head.ch))})),e.sel.primIndex),e.cm&&_t(e.cm,e.first,e.first-t,t)}function hn(e,t,n,r){if(e.cm&&!e.cm.curOp)return pt(e.cm,hn)(e,t,n,r);if(t.to.line<e.first)dn(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var o=t.text.length-1-(e.first-t.from.line);dn(e,o),t={from:le(e.first,0),to:le(t.to.line+o,t.to.ch),text:[Ro(t.text)],origin:t.origin}}var i=e.lastLine();t.to.line>i&&(t={from:t.from,to:le(i,zr(e,i).text.length),text:[t.text[0]],origin:t.origin}),t.removed=jr(e,t.from,t.to),n||(n=on(e,t)),e.cm?function(e,t,n){var r=e.doc,o=e.display,i=t.from,a=t.to,l=!1,s=i.line;e.options.lineWrapping||(s=Ur(lr(zr(r,i.line))),r.iter(s,a.line+1,(function(e){if(e==o.maxLine)return l=!0,!0})));r.sel.contains(t.from,t.to)>-1&&(e.curOp.cursorActivity=!0);Ar(r,t,n,I(e)),e.options.lineWrapping||(r.iter(s,i.line+t.text.length,(function(e){var t=D(e);t>o.maxLineLength&&(o.maxLine=e,o.maxLineLength=t,o.maxLineChanged=!0,l=!1)})),l&&(e.curOp.updateMaxLine=!0));r.frontier=Math.min(r.frontier,i.line),De(e,400);var c=t.text.length-(a.line-i.line)-1;i.line!=a.line||1!=t.text.length||Lr(e.doc,t)?_t(e,i.line,a.line+1,c):bt(e,i.line,"text");(bo(e,"change")||bo(e,"changes"))&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push({from:i,to:a,text:t.text,removed:t.removed,origin:t.origin})}(e.cm,t,r):Ar(e,t,r),Me(e,n,ko)}}function fn(e,t,n,r,o){if(r||(r=n),se(r,n)<0){var i=r;r=n,n=i}"string"==typeof t&&(t=li(t)),sn(e,{from:n,to:r,text:t,origin:o})}function pn(e,t,n,r,o){var i=e.display,a=at(e.display);n<0&&(n=0);var l=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:i.scroller.scrollTop,s=i.scroller.clientHeight-xo,c={},u=e.doc.height+He(i),d=n<a,h=o>u-a;if(n<l)c.scrollTop=d?0:n;else if(o>l+s){var f=Math.min(n,(h?u:o)-s);f!=l&&(c.scrollTop=f)}var p=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:i.scroller.scrollLeft,g=i.scroller.clientWidth-xo;t+=i.gutters.offsetWidth,r+=i.gutters.offsetWidth;var m=i.gutters.offsetWidth,v=t<m+10;return t<p+m||v?(v&&(t=0),c.scrollLeft=Math.max(0,t-10-m)):r>g+p-3&&(c.scrollLeft=r+10-g),c}function gn(e,t,n){null==t&&null==n||vn(e),null!=t&&(e.curOp.scrollLeft=(null==e.curOp.scrollLeft?e.doc.scrollLeft:e.curOp.scrollLeft)+t),null!=n&&(e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+n)}function mn(e){vn(e);var t=e.getCursor(),n=t,r=t;e.options.lineWrapping||(n=t.ch?le(t.line,t.ch-1):t,r=le(t.line,t.ch+1)),e.curOp.scrollToPos={from:n,to:r,margin:e.options.cursorScrollMargin,isCursor:!0}}function vn(e){var t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null;var n=nt(e,t.from),r=nt(e,t.to),o=pn(e,Math.min(n.left,r.left),Math.min(n.top,r.top)-t.margin,Math.max(n.right,r.right),Math.max(n.bottom,r.bottom)+t.margin);e.scrollTo(o.scrollLeft,o.scrollTop)}}function yn(e,t,n,r){var o,i=e.doc;null==n&&(n="add"),"smart"==n&&(e.doc.mode.indent?o=Ne(e,t):n="prev");var a=e.options.tabSize,l=zr(i,t),s=Eo(l.text,null,a);l.stateAfter&&(l.stateAfter=null);var c,u=l.text.match(/^\s*/)[0];if(r||/\S/.test(l.text)){if("smart"==n&&(c=e.doc.mode.indent(o,l.text.slice(u.length),l.text))==So){if(!r)return;n="prev"}}else c=0,n="not";"prev"==n?c=t>i.first?Eo(zr(i,t-1).text,null,a):0:"add"==n?c=s+e.options.indentUnit:"subtract"==n?c=s-e.options.indentUnit:"number"==typeof n&&(c=s+n),c=Math.max(0,c);var d="",h=0;if(e.options.indentWithTabs)for(var f=Math.floor(c/a);f;--f)h+=a,d+="\t";if(h<c&&(d+=Ao(c-h)),d!=u)fn(e.doc,d,le(t,0),le(t,u.length),"+input");else for(f=0;f<i.sel.ranges.length;f++){var p=i.sel.ranges[f];if(p.head.line==t&&p.head.ch<u.length){xe(i,f,new fe(h=le(t,u.length),h));break}}l.stateAfter=null}function _n(e,t,n,r){var o=t,i=t,a=e.doc;return"number"==typeof t?i=zr(a,me(a,t)):o=Ur(t),null==o?null:r(i,o)?(bt(e,o,n),i):null}function bn(e,t){for(var n=e.doc.sel.ranges,r=[],o=0;o<n.length;o++){for(var i=t(n[o]);r.length&&se(i.from,Ro(r).to)<=0;){var a=r.pop();if(se(a.from,i.from)<0){i.from=a.from;break}}r.push(i)}ft(e,(function(){for(var t=r.length-1;t>=0;t--)fn(e.doc,"",r[t].from,r[t].to,"+delete");mn(e)}))}function wn(e,t,n,r,o){var i=t.line,a=t.ch,l=n,s=zr(e,i),c=!0;function u(t){var r,l=(o?_i:bi)(s,a,n,!0);if(null==l){if(t||!((r=i+n)<e.first||r>=e.first+e.size?c=!1:(i=r,s=zr(e,r))))return c=!1;a=o?(n<0?pi:fi)(s):n<0?s.text.length:0}else a=l;return!0}if("char"==r)u();else if("column"==r)u(!0);else if("word"==r||"group"==r)for(var d=null,h="group"==r,f=!0;!(n<0)||u(!f);f=!1){var p=s.text.charAt(a)||"\n",g=zo(p)?"w":h&&"\n"==p?"n":!h||/\s/.test(p)?null:"p";if(!h||f||g||(g="s"),d&&d!=g){n<0&&(n=1,u());break}if(g&&(d=g),n>0&&!u(!f))break}var m=Le(e,le(i,a),l,!0);return c||(m.hitSide=!0),m}function xn(e,t,n,r){var o,i=e.doc,a=t.left;if("page"==r){var l=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);o=t.top+n*(l-(n<0?1.5:.5)*at(e.display))}else"line"==r&&(o=n>0?t.bottom+3:t.top-3);for(;;){var s=ot(e,a,o);if(!s.outside)break;if(n<0?o<=0:o>=i.height){s.hitSide=!0;break}o+=5*n}return s}function Sn(e,t){var n=zr(e,t.line).text,r=t.ch,o=t.ch;if(n){(t.xRel<0||o==n.length)&&r?--r:++o;for(var i=n.charAt(r),a=zo(i)?zo:/\s/.test(i)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!zo(e)};r>0&&a(n.charAt(r-1));)--r;for(;o<n.length&&a(n.charAt(o));)++o}return new fe(le(t.line,r),le(t.line,o))}C.prototype={constructor:C,posFromMouse:function(e){return Ot(this,e,!0)},focus:function(){window.focus(),It(this),Mt(this)},setOption:function(e,t){var n=this.options,r=n[e];n[e]==t&&"mode"!=e||(n[e]=t,Cn.hasOwnProperty(e)&&pt(this,Cn[e])(this,t,r))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](e)},removeKeyMap:function(e){for(var t=this.state.keyMaps,n=0;n<t.length;++n)if(t[n]==e||"string"!=typeof t[n]&&t[n].name==e)return t.splice(n,1),!0},addOverlay:gt((function(e,t){var n=e.token?e:C.getMode(this.options,e);if(n.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:n,modeSpec:e,opaque:t&&t.opaque}),this.state.modeGen++,_t(this)})),removeOverlay:gt((function(e){for(var t=this.state.overlays,n=0;n<t.length;++n){var r=t[n].modeSpec;if(r==e||"string"==typeof e&&r.name==e)return t.splice(n,1),this.state.modeGen++,void _t(this)}})),indentLine:gt((function(e,t,n){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),ye(this.doc,e)&&yn(this,e,t,n)})),indentSelection:gt((function(e){for(var t=this.doc.sel.ranges,n=-1,r=0;r<t.length;r++){var o=t[r];if(o.empty())o.head.line>n&&(yn(this,o.head.line,e,!0),n=o.head.line,r==this.doc.sel.primIndex&&mn(this));else{var i=Math.max(n,o.from().line),a=o.to();n=Math.min(this.lastLine(),a.line-(a.ch?0:1))+1;for(var l=i;l<n;++l)yn(this,l,e)}}})),getTokenAt:function(e,t){for(var n=this.doc,r=Ne(this,(e=ve(n,e)).line,t),o=this.doc.mode,i=zr(n,e.line),a=new jn(i.text,this.options.tabSize);a.pos<e.ch&&!a.eol();){a.start=a.pos;var l=o.token(a,r)}return{start:a.start,end:a.pos,string:a.current(),type:l||null,state:r}},getTokenTypeAt:function(e){e=ve(this.doc,e);var t=_r(this,zr(this.doc,e.line)),n=0,r=(t.length-1)/2,o=e.ch;if(0==o)return t[2];for(;;){var i=n+r>>1;if((i?t[2*i-1]:0)>=o)r=i;else{if(!(t[2*i+1]<o))return t[2*i+2];n=i+1}}},getModeAt:function(e){var t=this.doc.mode;return t.innerMode?C.innerMode(t,this.getTokenAt(e).state).mode:t},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var n=[];if(!Rn.hasOwnProperty(t))return Rn;var r=Rn[t],o=this.getModeAt(e);if("string"==typeof o[t])r[o[t]]&&n.push(r[o[t]]);else if(o[t])for(var i=0;i<o[t].length;i++){var a=r[o[t][i]];a&&n.push(a)}else o.helperType&&r[o.helperType]?n.push(r[o.helperType]):r[o.name]&&n.push(r[o.name]);for(i=0;i<r._global.length;i++){var l=r._global[i];l.pred(o,this)&&-1==Fo(n,l.val)&&n.push(l.val)}return n},getStateAfter:function(e,t){var n=this.doc;return Ne(this,(e=me(n,null==e?n.first+n.size-1:e))+1,t)},cursorCoords:function(e,t){var n=this.doc.sel.primary();return tt(this,null==e?n.head:"object"==typeof e?ve(this.doc,e):e?n.from():n.to(),t||"page")},charCoords:function(e,t){return et(this,ve(this.doc,e),t||"page")},coordsChar:function(e,t){return ot(this,(e=Ze(this,e,t||"page")).left,e.top)},lineAtHeight:function(e,t){return e=Ze(this,{top:e,left:0},t||"page").top,qr(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t){var n=!1,r=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>r&&(e=r,n=!0);var o=zr(this.doc,e);return $e(this,o,{top:0,left:0},t||"page").top+(n?this.doc.height-Gr(o):0)},defaultTextHeight:function(){return at(this.display)},defaultCharWidth:function(){return lt(this.display)},setGutterMarker:gt((function(e,t,n){return _n(this,e,"gutter",(function(e){var r=e.gutterMarkers||(e.gutterMarkers={});return r[t]=n,!n&&jo(r)&&(e.gutterMarkers=null),!0}))})),clearGutter:gt((function(e){var t=this,n=t.doc,r=n.first;n.iter((function(n){n.gutterMarkers&&n.gutterMarkers[e]&&(n.gutterMarkers[e]=null,bt(t,r,"gutter"),jo(n.gutterMarkers)&&(n.gutterMarkers=null)),++r}))})),addLineClass:gt((function(e,t,n){return _n(this,e,"class",(function(e){var r="text"==t?"textClass":"background"==t?"bgClass":"wrapClass";if(e[r]){if(new RegExp("(?:^|\\s)"+n+"(?:$|\\s)").test(e[r]))return!1;e[r]+=" "+n}else e[r]=n;return!0}))})),removeLineClass:gt((function(e,t,n){return _n(this,e,"class",(function(e){var r="text"==t?"textClass":"background"==t?"bgClass":"wrapClass",o=e[r];if(!o)return!1;if(null==n)e[r]=null;else{var i=o.match(new RegExp("(?:^|\\s+)"+n+"(?:$|\\s+)"));if(!i)return!1;var a=i.index+i[0].length;e[r]=o.slice(0,i.index)+(i.index&&a!=o.length?" ":"")+o.slice(a)||null}return!0}))})),addLineWidget:gt((function(e,t,n){return function(e,t,n,r){var o=new hr(e,n,r);o.noHScroll&&(e.display.alignWidgets=!0);return _n(e,t,"widget",(function(t){var n=t.widgets||(t.widgets=[]);if(null==o.insertAt?n.push(o):n.splice(Math.min(n.length-1,Math.max(0,o.insertAt)),0,o),o.line=t,!ur(e.doc,t)){var r=Gr(t)<e.doc.scrollTop;Vr(t,t.height+pr(o)),r&&gn(e,null,o.height),e.curOp.forceUpdate=!0}return!0})),o}(this,e,t,n)})),removeLineWidget:function(e){e.clear()},lineInfo:function(e){if("number"==typeof e){if(!ye(this.doc,e))return null;var t=e;if(!(e=zr(this.doc,e)))return null}else{if(null==(t=Ur(e)))return null}return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,n,r,o){var i=this.display,a=(e=tt(this,ve(this.doc,e))).bottom,l=e.left;if(t.style.position="absolute",i.sizer.appendChild(t),"over"==r)a=e.top;else if("above"==r||"near"==r){var s=Math.max(i.wrapper.clientHeight,this.doc.height),c=Math.max(i.sizer.clientWidth,i.lineSpace.clientWidth);("above"==r||e.bottom+t.offsetHeight>s)&&e.top>t.offsetHeight?a=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=s&&(a=e.bottom),l+t.offsetWidth>c&&(l=c-t.offsetWidth)}t.style.top=a+"px",t.style.left=t.style.right="","right"==o?(l=i.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==o?l=0:"middle"==o&&(l=(i.sizer.clientWidth-t.offsetWidth)/2),t.style.left=l+"px"),n&&function(e,t,n,r,o){var i=pn(e,t,n,r,o);null!=i.scrollTop&&Ht(e,i.scrollTop),null!=i.scrollLeft&&zt(e,i.scrollLeft)}(this,l,a,l+t.offsetWidth,a+t.offsetHeight)},triggerOnKeyDown:gt(Kt),triggerOnKeyPress:gt($t),triggerOnKeyUp:gt(Jt),execCommand:function(e){if(Dn.hasOwnProperty(e))return Dn[e](this)},findPosH:function(e,t,n,r){var o=1;t<0&&(o=-1,t=-t);for(var i=0,a=ve(this.doc,e);i<t&&!(a=wn(this.doc,a,o,n,r)).hitSide;++i);return a},moveH:gt((function(e,t){var n=this;n.extendSelectionsBy((function(r){return n.display.shift||n.doc.extend||r.empty()?wn(n.doc,r.head,e,t,n.options.rtlMoveVisually):e<0?r.from():r.to()}),Mo)})),deleteH:gt((function(e,t){var n=this.doc.sel,r=this.doc;n.somethingSelected()?r.replaceSelection("",null,"+delete"):bn(this,(function(n){var o=wn(r,n.head,e,t,!1);return e<0?{from:o,to:n.head}:{from:n.head,to:o}}))})),findPosV:function(e,t,n,r){var o=1,i=r;t<0&&(o=-1,t=-t);for(var a=0,l=ve(this.doc,e);a<t;++a){var s=tt(this,l,"div");if(null==i?i=s.left:s.left=i,(l=xn(this,s,o,n)).hitSide)break}return l},moveV:gt((function(e,t){var n=this,r=this.doc,o=[],i=!n.display.shift&&!r.extend&&r.sel.somethingSelected();if(r.extendSelectionsBy((function(a){if(i)return e<0?a.from():a.to();var l=tt(n,a.head,"div");null!=a.goalColumn&&(l.left=a.goalColumn),o.push(l.left);var s=xn(n,l,e,t);return"page"==t&&a==r.sel.primary()&&gn(n,null,et(n,s,"div").top-l.top),s}),Mo),o.length)for(var a=0;a<r.sel.ranges.length;a++)r.sel.ranges[a].goalColumn=o[a]})),toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?this.display.cursorDiv.className+=" CodeMirror-overwrite":this.display.cursorDiv.className=this.display.cursorDiv.className.replace(" CodeMirror-overwrite",""),go(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return Jo()==this.display.input},scrollTo:gt((function(e,t){null==e&&null==t||vn(this),null!=e&&(this.curOp.scrollLeft=e),null!=t&&(this.curOp.scrollTop=t)})),getScrollInfo:function(){var e=this.display.scroller,t=xo;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-t,width:e.scrollWidth-t,clientHeight:e.clientHeight-t,clientWidth:e.clientWidth-t}},scrollIntoView:gt((function(e,t){if(null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:le(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line)vn(this),this.curOp.scrollToPos=e;else{var n=pn(this,Math.min(e.from.left,e.to.left),Math.min(e.from.top,e.to.top)-e.margin,Math.max(e.from.right,e.to.right),Math.max(e.from.bottom,e.to.bottom)+e.margin);this.scrollTo(n.scrollLeft,n.scrollTop)}})),setSize:gt((function(e,t){function n(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e}null!=e&&(this.display.wrapper.style.width=n(e)),null!=t&&(this.display.wrapper.style.height=n(t)),this.options.lineWrapping&&Ye(this),this.curOp.forceUpdate=!0,go(this,"refresh",this)})),operation:function(e){return ft(this,e)},refresh:gt((function(){var e=this.display.cachedTextHeight;_t(this),Qe(this),this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop),(null==e||Math.abs(e-at(this.display))>.5)&&L(this),go(this,"refresh",this)})),swapDoc:gt((function(e){var t=this.doc;return t.cm=null,Hr(this,e),Qe(this),Et(this),this.scrollTo(e.scrollLeft,e.scrollTop),vo(this,"swapDoc",this,t),t})),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},wo(C);var kn=C.defaults={},Cn=C.optionHandlers={};function Mn(e,t,n,r){C.defaults[e]=t,n&&(Cn[e]=r?function(e,t,r){r!=Tn&&n(e,t,r)}:n)}var Tn=C.Init={toString:function(){return"CodeMirror.Init"}};Mn("value","",(function(e,t){e.setValue(t)}),!0),Mn("mode",null,(function(e,t){e.doc.modeOption=t,T(e)}),!0),Mn("indentUnit",2,T,!0),Mn("indentWithTabs",!1),Mn("smartIndent",!0),Mn("tabSize",4,(function(e){E(e),Qe(e),_t(e)}),!0),Mn("specialChars",/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\ufeff]/g,(function(e,t){e.options.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),e.refresh()}),!0),Mn("specialCharPlaceholder",(function(e){var t=Xo("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t}),(function(e){e.refresh()}),!0),Mn("electricChars",!0),Mn("rtlMoveVisually",!_),Mn("wholeLineUpdateBefore",!0),Mn("theme","default",(function(e){R(e),O(e)}),!0),Mn("keyMap","default",A),Mn("extraKeys",null),Mn("lineWrapping",!1,(function(e){e.options.lineWrapping?(e.display.wrapper.className+=" CodeMirror-wrap",e.display.sizer.style.minWidth=""):(e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-wrap",""),P(e)),L(e),_t(e),Qe(e),setTimeout((function(){H(e)}),100)}),!0),Mn("gutters",[],(function(e){N(e.options),O(e)}),!0),Mn("fixedGutter",!0,(function(e,t){e.display.gutters.style.left=t?V(e.display)+"px":"0",e.refresh()}),!0),Mn("coverGutterNextToScrollbar",!1,H,!0),Mn("lineNumbers",!1,(function(e){N(e.options),O(e)}),!0),Mn("firstLineNumber",1,O,!0),Mn("lineNumberFormatter",(function(e){return e}),O,!0),Mn("showCursorWhenSelecting",!1,Ae,!0),Mn("resetSelectionOnContextMenu",!0),Mn("readOnly",!1,(function(e,t){"nocursor"==t?(en(e),e.display.input.blur(),e.display.disabled=!0):(e.display.disabled=!1,t||Et(e))})),Mn("disableInput",!1,(function(e,t){t||Et(e)}),!0),Mn("dragDrop",!0),Mn("cursorBlinkRate",530),Mn("cursorScrollMargin",0),Mn("cursorHeight",1),Mn("workTime",100),Mn("workDelay",100),Mn("flattenSpans",!0,E,!0),Mn("addModeClass",!1,E,!0),Mn("pollInterval",100),Mn("undoDepth",200,(function(e,t){e.doc.history.undoDepth=t})),Mn("historyEventDelay",1250),Mn("viewportMargin",10,(function(e){e.refresh()}),!0),Mn("maxHighlightLength",1e4,E,!0),Mn("moveInputWithCursor",!0,(function(e,t){t||(e.display.inputDiv.style.top=e.display.inputDiv.style.left=0)})),Mn("tabindex",null,(function(e,t){e.display.input.tabIndex=t||""})),Mn("autofocus",null);var En=C.modes={},In=C.mimeModes={};C.defineMode=function(e,t){if(C.defaults.mode||"null"==e||(C.defaults.mode=e),arguments.length>2){t.dependencies=[];for(var n=2;n<arguments.length;++n)t.dependencies.push(arguments[n])}En[e]=t},C.defineMIME=function(e,t){In[e]=t},C.resolveMode=function(e){if("string"==typeof e&&In.hasOwnProperty(e))e=In[e];else if(e&&"string"==typeof e.name&&In.hasOwnProperty(e.name)){var t=In[e.name];"string"==typeof t&&(t={name:t}),(e=Po(t,e)).name=t.name}else if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return C.resolveMode("application/xml");return"string"==typeof e?{name:e}:e||{name:"null"}},C.getMode=function(e,t){t=C.resolveMode(t);var n=En[t.name];if(!n)return C.getMode(e,"text/plain");var r=n(e,t);if(Ln.hasOwnProperty(t.name)){var o=Ln[t.name];for(var i in o)o.hasOwnProperty(i)&&(r.hasOwnProperty(i)&&(r["_"+i]=r[i]),r[i]=o[i])}if(r.name=t.name,t.helperType&&(r.helperType=t.helperType),t.modeProps)for(var i in t.modeProps)r[i]=t.modeProps[i];return r},C.defineMode("null",(function(){return{token:function(e){e.skipToEnd()}}})),C.defineMIME("text/plain","null");var Ln=C.modeExtensions={};C.extendMode=function(e,t){No(t,Ln.hasOwnProperty(e)?Ln[e]:Ln[e]={})},C.defineExtension=function(e,t){C.prototype[e]=t},C.defineDocExtension=function(e,t){Dr.prototype[e]=t},C.defineOption=Mn;var An=[];C.defineInitHook=function(e){An.push(e)};var Rn=C.helpers={};C.registerHelper=function(e,t,n){Rn.hasOwnProperty(e)||(Rn[e]=C[e]={_global:[]}),Rn[e][t]=n},C.registerGlobalHelper=function(e,t,n,r){C.registerHelper(e,t,r),Rn[e]._global.push({pred:n,val:r})};var On=C.copyState=function(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var n={};for(var r in t){var o=t[r];o instanceof Array&&(o=o.concat([])),n[r]=o}return n},Fn=C.startState=function(e,t,n){return!e.startState||e.startState(t,n)};C.innerMode=function(e,t){for(;e.innerMode;){var n=e.innerMode(t);if(!n||n.mode==e)break;t=n.state,e=n.mode}return n||{mode:e,state:t}};var Dn=C.commands={selectAll:function(e){e.setSelection(le(e.firstLine(),0),le(e.lastLine()),ko)},singleSelection:function(e){e.setSelection(e.getCursor("anchor"),e.getCursor("head"),ko)},killLine:function(e){bn(e,(function(t){if(t.empty()){var n=zr(e.doc,t.head.line).text.length;return t.head.ch==n&&t.head.line<e.lastLine()?{from:t.head,to:le(t.head.line+1,0)}:{from:t.head,to:le(t.head.line,n)}}return{from:t.from(),to:t.to()}}))},deleteLine:function(e){bn(e,(function(t){return{from:le(t.from().line,0),to:ve(e.doc,le(t.to().line+1,0))}}))},delLineLeft:function(e){bn(e,(function(e){return{from:le(e.from().line,0),to:e.from()}}))},undo:function(e){e.undo()},redo:function(e){e.redo()},undoSelection:function(e){e.undoSelection()},redoSelection:function(e){e.redoSelection()},goDocStart:function(e){e.extendSelection(le(e.firstLine(),0))},goDocEnd:function(e){e.extendSelection(le(e.lastLine()))},goLineStart:function(e){e.extendSelectionsBy((function(t){return gi(e,t.head.line)}),Mo)},goLineStartSmart:function(e){e.extendSelectionsBy((function(t){var n=gi(e,t.head.line),r=e.getLineHandle(n.line),o=Xr(r);if(!o||0==o[0].level){var i=Math.max(0,r.text.search(/\S/)),a=t.head.line==n.line&&t.head.ch<=i&&t.head.ch;return le(n.line,a?0:i)}return n}),Mo)},goLineEnd:function(e){e.extendSelectionsBy((function(t){return function(e,t){var n,r=zr(e.doc,t);for(;n=ir(r);)r=n.find(1,!0).line,t=null;var o=Xr(r),i=o?o[0].level%2?fi(r):pi(r):r.text.length;return le(null==t?Ur(r):t,i)}(e,t.head.line)}),Mo)},goLineRight:function(e){e.extendSelectionsBy((function(t){var n=e.charCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:n},"div")}),Mo)},goLineLeft:function(e){e.extendSelectionsBy((function(t){var n=e.charCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:n},"div")}),Mo)},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goGroupRight:function(e){e.moveH(1,"group")},goGroupLeft:function(e){e.moveH(-1,"group")},goWordRight:function(e){e.moveH(1,"word")},delCharBefore:function(e){e.deleteH(-1,"char")},delCharAfter:function(e){e.deleteH(1,"char")},delWordBefore:function(e){e.deleteH(-1,"word")},delWordAfter:function(e){e.deleteH(1,"word")},delGroupBefore:function(e){e.deleteH(-1,"group")},delGroupAfter:function(e){e.deleteH(1,"group")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("\t")},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){ft(e,(function(){for(var t=e.listSelections(),n=0;n<t.length;n++){var r=t[n].head,o=zr(e.doc,r.line).text;r.ch>0&&r.ch<o.length-1&&e.replaceRange(o.charAt(r.ch)+o.charAt(r.ch-1),le(r.line,r.ch-1),le(r.line,r.ch+1))}}))},newlineAndIndent:function(e){ft(e,(function(){for(var t=e.listSelections().length,n=0;n<t;n++){var r=e.listSelections()[n];e.replaceRange("\n",r.anchor,r.head,"+input"),e.indentLine(r.from().line+1,null,!0),mn(e)}}))},toggleOverwrite:function(e){e.toggleOverwrite()}},Pn=C.keyMap={};function Nn(e){return"string"==typeof e?Pn[e]:e}Pn.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Pn.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Pn.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delLineLeft","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection",fallthrough:["basic","emacsy"]},Pn.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},Pn.default=y?Pn.macDefault:Pn.pcDefault;var Bn=C.lookupKey=function(e,t,n){function r(t){var o=(t=Nn(t))[e];if(!1===o)return"stop";if(null!=o&&n(o))return!0;if(t.nofallthrough)return"stop";var i=t.fallthrough;if(null==i)return!1;if("[object Array]"!=Object.prototype.toString.call(i))return r(i);for(var a=0;a<i.length;++a){var l=r(i[a]);if(l)return l}return!1}for(var o=0;o<t.length;++o){var i=r(t[o]);if(i)return"stop"!=i}},Hn=C.isModifierKey=function(e){var t=ui[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t},zn=C.keyName=function(e,t){if(u&&34==e.keyCode&&e.char)return!1;var n=ui[e.keyCode];return null!=n&&!e.altGraphKey&&(e.altKey&&(n="Alt-"+n),(w?e.metaKey:e.ctrlKey)&&(n="Ctrl-"+n),(w?e.ctrlKey:e.metaKey)&&(n="Cmd-"+n),!t&&e.shiftKey&&(n="Shift-"+n),n)};C.fromTextArea=function(e,t){if(t||(t={}),t.value=e.value,!t.tabindex&&e.tabindex&&(t.tabindex=e.tabindex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var n=Jo();t.autofocus=n==e||null!=e.getAttribute("autofocus")&&n==document.body}function r(){e.value=l.getValue()}if(e.form&&(fo(e.form,"submit",r),!t.leaveSubmitMethodAlone)){var o=e.form,i=o.submit;try{var a=o.submit=function(){r(),o.submit=i,o.submit(),o.submit=a}}catch(e){}}e.style.display="none";var l=C((function(t){e.parentNode.insertBefore(t,e.nextSibling)}),t);return l.save=r,l.getTextArea=function(){return e},l.toTextArea=function(){r(),e.parentNode.removeChild(l.getWrapperElement()),e.style.display="",e.form&&(po(e.form,"submit",r),"function"==typeof e.form.submit&&(e.form.submit=i))},l};var jn=C.StringStream=function(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};jn.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(e){var t=this.string.charAt(this.pos);if("string"==typeof e)var n=t==e;else n=t&&(e.test?e.test(t):e(t));if(n)return++this.pos,t},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},backUp:function(e){this.pos-=e},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Eo(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?Eo(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return Eo(this.string,null,this.tabSize)-(this.lineStart?Eo(this.string,this.lineStart,this.tabSize):0)},match:function(e,t,n){if("string"!=typeof e){var r=this.string.slice(this.pos).match(e);return r&&r.index>0?null:(r&&!1!==t&&(this.pos+=r[0].length),r)}var o=function(e){return n?e.toLowerCase():e};if(o(this.string.substr(this.pos,e.length))==o(e))return!1!==t&&(this.pos+=e.length),!0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}}};var Wn=C.TextMarker=function(e,t){this.lines=[],this.type=t,this.doc=e};wo(Wn),Wn.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&dt(e),bo(this,"clear")){var n=this.find();n&&vo(this,"clear",n.from,n.to)}for(var r=null,o=null,i=0;i<this.lines.length;++i){var a=this.lines[i],l=Xn(a.markedSpans,this);e&&!this.collapsed?bt(e,Ur(a),"text"):e&&(null!=l.to&&(o=Ur(a)),null!=l.from&&(r=Ur(a))),a.markedSpans=Yn(a.markedSpans,l),null==l.from&&this.collapsed&&!ur(this.doc,a)&&e&&Vr(a,at(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(i=0;i<this.lines.length;++i){var s=lr(this.lines[i]),c=D(s);c>e.display.maxLineLength&&(e.display.maxLine=s,e.display.maxLineLength=c,e.display.maxLineChanged=!0)}null!=r&&e&&this.collapsed&&_t(e,r,o+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&Ee(e.doc)),e&&vo(e,"markerCleared",e,this),t&&ht(e)}},Wn.prototype.find=function(e,t){var n,r;null==e&&"bookmark"==this.type&&(e=1);for(var o=0;o<this.lines.length;++o){var i=this.lines[o],a=Xn(i.markedSpans,this);if(null!=a.from&&(n=le(t?i:Ur(i),a.from),-1==e))return n;if(null!=a.to&&(r=le(t?i:Ur(i),a.to),1==e))return r}return n&&{from:n,to:r}},Wn.prototype.changed=function(){var e=this.find(-1,!0),t=this,n=this.doc.cm;e&&n&&ft(n,(function(){var r=e.line,o=Ur(e.line),i=We(n,o);if(i&&(Xe(i),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!ur(t.doc,r)&&null!=t.height){var a=t.height;t.height=null;var l=pr(t)-a;l&&Vr(r,r.height+l)}}))},Wn.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=Fo(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},Wn.prototype.detachLine=function(e){if(this.lines.splice(Fo(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}};var Vn=0;function Un(e,t,n,r,o){if(r&&r.shared)return function(e,t,n,r,o){(r=No(r)).shared=!1;var i=[Un(e,t,n,r,o)],a=i[0],l=r.widgetNode;return Br(e,(function(e){l&&(r.widgetNode=l.cloneNode(!0)),i.push(Un(e,ve(e,t),ve(e,n),r,o));for(var s=0;s<e.linked.length;++s)if(e.linked[s].isParent)return;a=Ro(i)})),new qn(i,a)}(e,t,n,r,o);if(e.cm&&!e.cm.curOp)return pt(e.cm,Un)(e,t,n,r,o);var i=new Wn(e,o),a=se(t,n);if(r&&No(r,i),a>0||0==a&&!1!==i.clearWhenEmpty)return i;if(i.replacedWith&&(i.collapsed=!0,i.widgetNode=Xo("span",[i.replacedWith],"CodeMirror-widget"),r.handleMouseEvents||(i.widgetNode.ignoreEvents=!0),r.insertLeft&&(i.widgetNode.insertLeft=!0)),i.collapsed){if(ar(e,t.line,t,n,i)||t.line!=n.line&&ar(e,n.line,t,n,i))throw new Error("Inserting collapsed marker partially overlapping an existing one");k=!0}i.addToHistory&&Jr(e,{from:t,to:n,origin:"markText"},e.sel,NaN);var l,s=t.line,c=e.cm;if(e.iter(s,n.line+1,(function(e){c&&i.collapsed&&!c.options.lineWrapping&&lr(e)==c.display.maxLine&&(l=!0),i.collapsed&&s!=t.line&&Vr(e,0),function(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}(e,new Gn(i,s==t.line?t.ch:null,s==n.line?n.ch:null)),++s})),i.collapsed&&e.iter(t.line,n.line+1,(function(t){ur(e,t)&&Vr(t,0)})),i.clearOnEnter&&fo(i,"beforeCursorEnter",(function(){i.clear()})),i.readOnly&&(S=!0,(e.history.done.length||e.history.undone.length)&&e.clearHistory()),i.collapsed&&(i.id=++Vn,i.atomic=!0),c){if(l&&(c.curOp.updateMaxLine=!0),i.collapsed)_t(c,t.line,n.line+1);else if(i.className||i.title||i.startStyle||i.endStyle)for(var u=t.line;u<=n.line;u++)bt(c,u,"text");i.atomic&&Ee(c.doc),vo(c,"markerAdded",c,i)}return i}var qn=C.SharedTextMarker=function(e,t){this.markers=e,this.primary=t;for(var n=0,r=this;n<e.length;++n)e[n].parent=this,fo(e[n],"clear",(function(){r.clear()}))};function Gn(e,t,n){this.marker=e,this.from=t,this.to=n}function Xn(e,t){if(e)for(var n=0;n<e.length;++n){var r=e[n];if(r.marker==t)return r}}function Yn(e,t){for(var n,r=0;r<e.length;++r)e[r]!=t&&(n||(n=[])).push(e[r]);return n}function Qn(e,t){var n=ye(e,t.from.line)&&zr(e,t.from.line).markedSpans,r=ye(e,t.to.line)&&zr(e,t.to.line).markedSpans;if(!n&&!r)return null;var o=t.from.ch,i=t.to.ch,a=0==se(t.from,t.to),l=function(e,t,n){if(e)for(var r,o=0;o<e.length;++o){var i=e[o],a=i.marker;if(null==i.from||(a.inclusiveLeft?i.from<=t:i.from<t)||i.from==t&&"bookmark"==a.type&&(!n||!i.marker.insertLeft)){var l=null==i.to||(a.inclusiveRight?i.to>=t:i.to>t);(r||(r=[])).push(new Gn(a,i.from,l?null:i.to))}}return r}(n,o,a),s=function(e,t,n){if(e)for(var r,o=0;o<e.length;++o){var i=e[o],a=i.marker;if(null==i.to||(a.inclusiveRight?i.to>=t:i.to>t)||i.from==t&&"bookmark"==a.type&&(!n||i.marker.insertLeft)){var l=null==i.from||(a.inclusiveLeft?i.from<=t:i.from<t);(r||(r=[])).push(new Gn(a,l?null:i.from-t,null==i.to?null:i.to-t))}}return r}(r,i,a),c=1==t.text.length,u=Ro(t.text).length+(c?o:0);if(l)for(var d=0;d<l.length;++d){if(null==(h=l[d]).to)(f=Xn(s,h.marker))?c&&(h.to=null==f.to?null:f.to+u):h.to=o}if(s)for(d=0;d<s.length;++d){var h,f;if(null!=(h=s[d]).to&&(h.to+=u),null==h.from)(f=Xn(l,h.marker))||(h.from=u,c&&(l||(l=[])).push(h));else h.from+=u,c&&(l||(l=[])).push(h)}l&&(l=Kn(l)),s&&s!=l&&(s=Kn(s));var p=[l];if(!c){var g,m=t.text.length-2;if(m>0&&l)for(d=0;d<l.length;++d)null==l[d].to&&(g||(g=[])).push(new Gn(l[d].marker,null,null));for(d=0;d<m;++d)p.push(g);p.push(s)}return p}function Kn(e){for(var t=0;t<e.length;++t){var n=e[t];null!=n.from&&n.from==n.to&&!1!==n.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function Jn(e,t){var n=function(e,t){var n=t["spans_"+e.id];if(!n)return null;for(var r=0,o=[];r<t.text.length;++r)o.push(eo(n[r]));return o}(e,t),r=Qn(e,t);if(!n)return r;if(!r)return n;for(var o=0;o<n.length;++o){var i=n[o],a=r[o];if(i&&a)e:for(var l=0;l<a.length;++l){for(var s=a[l],c=0;c<i.length;++c)if(i[c].marker==s.marker)continue e;i.push(s)}else a&&(n[o]=a)}return n}function $n(e){var t=e.markedSpans;if(t){for(var n=0;n<t.length;++n)t[n].marker.detachLine(e);e.markedSpans=null}}function Zn(e,t){if(t){for(var n=0;n<t.length;++n)t[n].marker.attachLine(e);e.markedSpans=t}}function er(e){return e.inclusiveLeft?-1:0}function tr(e){return e.inclusiveRight?1:0}function nr(e,t){var n=e.lines.length-t.lines.length;if(0!=n)return n;var r=e.find(),o=t.find(),i=se(r.from,o.from)||er(e)-er(t);if(i)return-i;var a=se(r.to,o.to)||tr(e)-tr(t);return a||t.id-e.id}function rr(e,t){var n,r=k&&e.markedSpans;if(r)for(var o,i=0;i<r.length;++i)(o=r[i]).marker.collapsed&&null==(t?o.from:o.to)&&(!n||nr(n,o.marker)<0)&&(n=o.marker);return n}function or(e){return rr(e,!0)}function ir(e){return rr(e,!1)}function ar(e,t,n,r,o){var i=zr(e,t),a=k&&i.markedSpans;if(a)for(var l=0;l<a.length;++l){var s=a[l];if(s.marker.collapsed){var c=s.marker.find(0),u=se(c.from,n)||er(s.marker)-er(o),d=se(c.to,r)||tr(s.marker)-tr(o);if(!(u>=0&&d<=0||u<=0&&d>=0)&&(u<=0&&(se(c.to,n)||tr(s.marker)-er(o))>0||u>=0&&(se(c.from,r)||er(s.marker)-tr(o))<0))return!0}}}function lr(e){for(var t;t=or(e);)e=t.find(-1,!0).line;return e}function sr(e,t){var n=zr(e,t),r=lr(n);return n==r?t:Ur(r)}function cr(e,t){if(t>e.lastLine())return t;var n,r=zr(e,t);if(!ur(e,r))return t;for(;n=ir(r);)r=n.find(1,!0).line;return Ur(r)+1}function ur(e,t){var n=k&&t.markedSpans;if(n)for(var r,o=0;o<n.length;++o)if((r=n[o]).marker.collapsed){if(null==r.from)return!0;if(!r.marker.widgetNode&&0==r.from&&r.marker.inclusiveLeft&&dr(e,t,r))return!0}}function dr(e,t,n){if(null==n.to){var r=n.marker.find(1,!0);return dr(e,r.line,Xn(r.line.markedSpans,n.marker))}if(n.marker.inclusiveRight&&n.to==t.text.length)return!0;for(var o,i=0;i<t.markedSpans.length;++i)if((o=t.markedSpans[i]).marker.collapsed&&!o.marker.widgetNode&&o.from==n.to&&(null==o.to||o.to!=n.from)&&(o.marker.inclusiveLeft||n.marker.inclusiveRight)&&dr(e,t,o))return!0}wo(qn),qn.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();vo(this,"clear")}},qn.prototype.find=function(e,t){return this.primary.find(e,t)};var hr=C.LineWidget=function(e,t,n){if(n)for(var r in n)n.hasOwnProperty(r)&&(this[r]=n[r]);this.cm=e,this.node=t};function fr(e,t,n){Gr(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&gn(e,null,n)}function pr(e){return null!=e.height?e.height:(Ko(document.body,e.node)||Qo(e.cm.display.measure,Xo("div",[e.node],null,"position: relative")),e.height=e.node.offsetHeight)}wo(hr),hr.prototype.clear=function(){var e=this.cm,t=this.line.widgets,n=this.line,r=Ur(n);if(null!=r&&t){for(var o=0;o<t.length;++o)t[o]==this&&t.splice(o--,1);t.length||(n.widgets=null);var i=pr(this);ft(e,(function(){fr(e,n,-i),bt(e,r,"widget"),Vr(n,Math.max(0,n.height-i))}))}},hr.prototype.changed=function(){var e=this.height,t=this.cm,n=this.line;this.height=null;var r=pr(this)-e;r&&ft(t,(function(){t.curOp.forceUpdate=!0,fr(t,n,r),Vr(n,n.height+r)}))};var gr=C.Line=function(e,t,n){this.text=e,Zn(this,t),this.height=n?n(this):1};function mr(e){e.parent=null,$n(e)}function vr(e,t,n,r,o,i){var a=n.flattenSpans;null==a&&(a=e.options.flattenSpans);var l,s=0,c=null,u=new jn(t,e.options.tabSize);for(""==t&&n.blankLine&&n.blankLine(r);!u.eol();){if(u.pos>e.options.maxHighlightLength?(a=!1,i&&br(e,t,r,u.pos),u.pos=t.length,l=null):l=n.token(u,r),e.options.addModeClass){var d=C.innerMode(n,r).mode.name;d&&(l="m-"+(l?d+" "+l:d))}a&&c==l||(s<u.start&&o(u.start,c),s=u.start,c=l),u.start=u.pos}for(;s<u.pos;){var h=Math.min(u.pos,s+5e4);o(h,c),s=h}}function yr(e,t,n,r){var o=[e.state.modeGen];vr(e,t.text,e.doc.mode,n,(function(e,t){o.push(e,t)}),r);for(var i=0;i<e.state.overlays.length;++i){var a=e.state.overlays[i],l=1,s=0;vr(e,t.text,a.mode,!0,(function(e,t){for(var n=l;s<e;){var r=o[l];r>e&&o.splice(l,1,e,o[l+1],r),l+=2,s=Math.min(e,r)}if(t)if(a.opaque)o.splice(n,l-n,e,t),l=n+2;else for(;n<l;n+=2){var i=o[n+1];o[n+1]=i?i+" "+t:t}}))}return o}function _r(e,t){return t.styles&&t.styles[0]==e.state.modeGen||(t.styles=yr(e,t,t.stateAfter=Ne(e,Ur(t)))),t.styles}function br(e,t,n,r){var o=e.doc.mode,i=new jn(t,e.options.tabSize);for(i.start=i.pos=r||0,""==t&&o.blankLine&&o.blankLine(n);!i.eol()&&i.pos<=e.options.maxHighlightLength;)o.token(i,n),i.start=i.pos}wo(gr),gr.prototype.lineNo=function(){return Ur(this)};var wr={},xr={};function Sr(e,t){if(!e)return null;for(;;){var n=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!n)break;e=e.slice(0,n.index)+e.slice(n.index+n[0].length);var r=n[1]?"bgClass":"textClass";null==t[r]?t[r]=n[2]:new RegExp("(?:^|s)"+n[2]+"(?:$|s)").test(t[r])||(t[r]+=" "+n[2])}if(/^\s*$/.test(e))return null;var o=t.cm.options.addModeClass?xr:wr;return o[e]||(o[e]=e.replace(/\S+/g,"cm-$&"))}function kr(e,t){var n=Xo("span",null,null,l?"padding-right: .1px":null),r={pre:Xo("pre",[n]),content:n,col:0,pos:0,cm:e};t.measure={};for(var o=0;o<=(t.rest?t.rest.length:0);o++){var i,s=o?t.rest[o-1]:t.line;r.pos=0,r.addToken=Cr,(a||l)&&e.getOption("lineWrapping")&&(r.addToken=Mr(r.addToken)),oi(e.display.measure)&&(i=Xr(s))&&(r.addToken=Tr(r.addToken,i)),r.map=[],Ir(s,r,_r(e,s)),0==r.map.length&&r.map.push(0,0,r.content.appendChild(ri(e.display.measure))),0==o?(t.measure.map=r.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(r.map),(t.measure.caches||(t.measure.caches=[])).push({}))}return go(e,"renderLine",e,t.line,r.pre),r}function Cr(e,t,n,o,i,a){if(t){var l=e.cm.options.specialChars,s=!1;if(l.test(t)){g=document.createDocumentFragment();for(var c=0;;){l.lastIndex=c;var u=l.exec(t),d=u?u.index-c:t.length-c;if(d){var h=document.createTextNode(t.slice(c,c+d));r?g.appendChild(Xo("span",[h])):g.appendChild(h),e.map.push(e.pos,e.pos+d,h),e.col+=d,e.pos+=d}if(!u)break;if(c+=d+1,"\t"==u[0]){var f=e.cm.options.tabSize,p=f-e.col%f;h=g.appendChild(Xo("span",Ao(p),"cm-tab"));e.col+=p}else{h=e.cm.options.specialCharPlaceholder(u[0]);r?g.appendChild(Xo("span",[h])):g.appendChild(h),e.col+=1}e.map.push(e.pos,e.pos+1,h),e.pos++}}else{e.col+=t.length;var g=document.createTextNode(t);e.map.push(e.pos,e.pos+t.length,g),r&&(s=!0),e.pos+=t.length}if(n||o||i||s){var m=n||"";o&&(m+=o),i&&(m+=i);var v=Xo("span",[g],m);return a&&(v.title=a),e.content.appendChild(v)}e.content.appendChild(g)}}function Mr(e){function t(e){for(var t=" ",n=0;n<e.length-2;++n)t+=n%2?" ":" ";return t+=" "}return function(n,r,o,i,a,l){e(n,r.replace(/ {3,}/g,t),o,i,a,l)}}function Tr(e,t){return function(n,r,o,i,a,l){o=o?o+" cm-force-border":"cm-force-border";for(var s=n.pos,c=s+r.length;;){for(var u=0;u<t.length;u++){var d=t[u];if(d.to>s&&d.from<=s)break}if(d.to>=c)return e(n,r,o,i,a,l);e(n,r.slice(0,d.to-s),o,i,null,l),i=null,r=r.slice(d.to-s),s=d.to}}}function Er(e,t,n,r){var o=!r&&n.widgetNode;o&&(e.map.push(e.pos,e.pos+t,o),e.content.appendChild(o)),e.pos+=t}function Ir(e,t,n){var r=e.markedSpans,o=e.text,i=0;if(r)for(var a,l,s,c,u,d,h=o.length,f=0,p=(S=1,""),g=0;;){if(g==f){l=s=c=u="",d=null,g=1/0;for(var m=[],v=0;v<r.length;++v){var y=r[v],_=y.marker;y.from<=f&&(null==y.to||y.to>f)?(null!=y.to&&g>y.to&&(g=y.to,s=""),_.className&&(l+=" "+_.className),_.startStyle&&y.from==f&&(c+=" "+_.startStyle),_.endStyle&&y.to==g&&(s+=" "+_.endStyle),_.title&&!u&&(u=_.title),_.collapsed&&(!d||nr(d.marker,_)<0)&&(d=y)):y.from>f&&g>y.from&&(g=y.from),"bookmark"==_.type&&y.from==f&&_.widgetNode&&m.push(_)}if(d&&(d.from||0)==f&&(Er(t,(null==d.to?h+1:d.to)-f,d.marker,null==d.from),null==d.to))return;if(!d&&m.length)for(v=0;v<m.length;++v)Er(t,0,m[v])}if(f>=h)break;for(var b=Math.min(h,g);;){if(p){var w=f+p.length;if(!d){var x=w>b?p.slice(0,b-f):p;t.addToken(t,x,a?a+l:l,c,f+x.length==g?s:"",u)}if(w>=b){p=p.slice(b-f),f=b;break}f=w,c=""}p=o.slice(i,i=n[S++]),a=Sr(n[S++],t)}}else for(var S=1;S<n.length;S+=2)t.addToken(t,o.slice(i,i=n[S]),Sr(n[S+1],t))}function Lr(e,t){return 0==t.from.ch&&0==t.to.ch&&""==Ro(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function Ar(e,t,n,r){function o(e){return n?n[e]:null}function i(e,n,o){!function(e,t,n,r){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),$n(e),Zn(e,n);var o=r?r(e):1;o!=e.height&&Vr(e,o)}(e,n,o,r),vo(e,"change",e,t)}var a=t.from,l=t.to,s=t.text,c=zr(e,a.line),u=zr(e,l.line),d=Ro(s),h=o(s.length-1),f=l.line-a.line;if(Lr(e,t)){for(var p=0,g=[];p<s.length-1;++p)g.push(new gr(s[p],o(p),r));i(u,u.text,h),f&&e.remove(a.line,f),g.length&&e.insert(a.line,g)}else if(c==u)if(1==s.length)i(c,c.text.slice(0,a.ch)+d+c.text.slice(l.ch),h);else{for(g=[],p=1;p<s.length-1;++p)g.push(new gr(s[p],o(p),r));g.push(new gr(d+c.text.slice(l.ch),h,r)),i(c,c.text.slice(0,a.ch)+s[0],o(0)),e.insert(a.line+1,g)}else if(1==s.length)i(c,c.text.slice(0,a.ch)+s[0]+u.text.slice(l.ch),o(0)),e.remove(a.line+1,f);else{i(c,c.text.slice(0,a.ch)+s[0],o(0)),i(u,d+u.text.slice(l.ch),h);for(p=1,g=[];p<s.length-1;++p)g.push(new gr(s[p],o(p),r));f>1&&e.remove(a.line+1,f-1),e.insert(a.line+1,g)}vo(e,"change",e,t)}function Rr(e){this.lines=e,this.parent=null;for(var t=0,n=0;t<e.length;++t)e[t].parent=this,n+=e[t].height;this.height=n}function Or(e){this.children=e;for(var t=0,n=0,r=0;r<e.length;++r){var o=e[r];t+=o.chunkSize(),n+=o.height,o.parent=this}this.size=t,this.height=n,this.parent=null}Rr.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var n=e,r=e+t;n<r;++n){var o=this.lines[n];this.height-=o.height,mr(o),vo(o,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,n){this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var r=0;r<t.length;++r)t[r].parent=this},iterN:function(e,t,n){for(var r=e+t;e<r;++e)if(n(this.lines[e]))return!0}},Or.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var n=0;n<this.children.length;++n){var r=this.children[n],o=r.chunkSize();if(e<o){var i=Math.min(t,o-e),a=r.height;if(r.removeInner(e,i),this.height-=a-r.height,o==i&&(this.children.splice(n--,1),r.parent=null),0==(t-=i))break;e=0}else e-=o}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof Rr))){var l=[];this.collapse(l),this.children=[new Rr(l)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,n){this.size+=t.length,this.height+=n;for(var r=0;r<this.children.length;++r){var o=this.children[r],i=o.chunkSize();if(e<=i){if(o.insertInner(e,t,n),o.lines&&o.lines.length>50){for(;o.lines.length>50;){var a=new Rr(o.lines.splice(o.lines.length-25,25));o.height-=a.height,this.children.splice(r+1,0,a),a.parent=this}this.maybeSpill()}break}e-=i}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=new Or(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var n=Fo(e.parent.children,e);e.parent.children.splice(n+1,0,t)}else{var r=new Or(e.children);r.parent=e,e.children=[r,t],e=r}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,n){for(var r=0;r<this.children.length;++r){var o=this.children[r],i=o.chunkSize();if(e<i){var a=Math.min(t,i-e);if(o.iterN(e,a,n))return!0;if(0==(t-=a))break;e=0}else e-=i}}};var Fr=0,Dr=C.Doc=function(e,t,n){if(!(this instanceof Dr))return new Dr(e,t,n);null==n&&(n=0),Or.call(this,[new Rr([new gr("",null)])]),this.first=n,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.frontier=n;var r=le(n,0);this.sel=ge(r),this.history=new Yr(null),this.id=++Fr,this.modeOption=t,"string"==typeof e&&(e=li(e)),Ar(this,{from:r,to:r,text:e}),Ce(this,ge(r),ko)};Dr.prototype=Po(Or.prototype,{constructor:Dr,iter:function(e,t,n){n?this.iterN(e-this.first,t-e,n):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var n=0,r=0;r<t.length;++r)n+=t[r].height;this.insertInner(e-this.first,t,n)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=Wr(this,this.first,this.first+this.size);return!1===e?t:t.join(e||"\n")},setValue:mt((function(e){var t=le(this.first,0),n=this.first+this.size-1;sn(this,{from:t,to:le(n,zr(this,n).text.length),text:li(e),origin:"setValue"},!0),Ce(this,ge(t))})),replaceRange:function(e,t,n,r){fn(this,e,t=ve(this,t),n=n?ve(this,n):t,r)},getRange:function(e,t,n){var r=jr(this,ve(this,e),ve(this,t));return!1===n?r:r.join(n||"\n")},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(ye(this,e))return zr(this,e)},getLineNumber:function(e){return Ur(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=zr(this,e)),lr(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return ve(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:mt((function(e,t,n){Se(this,ve(this,"number"==typeof e?le(e,t||0):e),null,n)})),setSelection:mt((function(e,t,n){Se(this,ve(this,e),ve(this,t||e),n)})),extendSelection:mt((function(e,t,n){be(this,ve(this,e),t&&ve(this,t),n)})),extendSelections:mt((function(e,t){we(this,function(e,t){for(var n=[],r=0;r<t.length;r++)n[r]=ve(e,t[r]);return n}(this,e))})),extendSelectionsBy:mt((function(e,t){we(this,Do(this.sel.ranges,e),t)})),setSelections:mt((function(e,t,n){if(e.length){for(var r=0,o=[];r<e.length;r++)o[r]=new fe(ve(this,e[r].anchor),ve(this,e[r].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),Ce(this,pe(o,t),n)}})),addSelection:mt((function(e,t,n){var r=this.sel.ranges.slice(0);r.push(new fe(ve(this,e),ve(this,t||e))),Ce(this,pe(r,r.length-1),n)})),getSelection:function(e){for(var t,n=this.sel.ranges,r=0;r<n.length;r++){var o=jr(this,n[r].from(),n[r].to());t=t?t.concat(o):o}return!1===e?t:t.join(e||"\n")},getSelections:function(e){for(var t=[],n=this.sel.ranges,r=0;r<n.length;r++){var o=jr(this,n[r].from(),n[r].to());!1!==e&&(o=o.join(e||"\n")),t[r]=o}return t},replaceSelection:mt((function(e,t,n){for(var r=[],o=0;o<this.sel.ranges.length;o++)r[o]=e;this.replaceSelections(r,t,n||"+input")})),replaceSelections:function(e,t,n){for(var r=[],o=this.sel,i=0;i<o.ranges.length;i++){var a=o.ranges[i];r[i]={from:a.from(),to:a.to(),text:li(e[i]),origin:n}}var l=t&&"end"!=t&&function(e,t,n){for(var r=[],o=le(e.first,0),i=o,a=0;a<t.length;a++){var l=t[a],s=an(l.from,o,i),c=an(nn(l),o,i);if(o=l.to,i=c,"around"==n){var u=e.sel.ranges[a],d=se(u.head,u.anchor)<0;r[a]=new fe(d?c:s,d?s:c)}else r[a]=new fe(s,s)}return new he(r,e.sel.primIndex)}(this,r,t);for(i=r.length-1;i>=0;i--)sn(this,r[i]);l?ke(this,l):this.cm&&mn(this.cm)},undo:mt((function(){un(this,"undo")})),redo:mt((function(){un(this,"redo")})),undoSelection:mt((function(){un(this,"undo",!0)})),redoSelection:mt((function(){un(this,"redo",!0)})),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,n=0,r=0;r<e.done.length;r++)e.done[r].ranges||++t;for(r=0;r<e.undone.length;r++)e.undone[r].ranges||++n;return{undo:t,redo:n}},clearHistory:function(){this.history=new Yr(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:to(this.history.done),undone:to(this.history.undone)}},setHistory:function(e){var t=this.history=new Yr(this.history.maxGeneration);t.done=to(e.done.slice(0),null,!0),t.undone=to(e.undone.slice(0),null,!0)},markText:function(e,t,n){return Un(this,ve(this,e),ve(this,t),n,"range")},setBookmark:function(e,t){var n={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared};return Un(this,e=ve(this,e),e,n,"bookmark")},findMarksAt:function(e){var t=[],n=zr(this,(e=ve(this,e)).line).markedSpans;if(n)for(var r=0;r<n.length;++r){var o=n[r];(null==o.from||o.from<=e.ch)&&(null==o.to||o.to>=e.ch)&&t.push(o.marker.parent||o.marker)}return t},findMarks:function(e,t){e=ve(this,e),t=ve(this,t);var n=[],r=e.line;return this.iter(e.line,t.line+1,(function(o){var i=o.markedSpans;if(i)for(var a=0;a<i.length;a++){var l=i[a];r==e.line&&e.ch>l.to||null==l.from&&r!=e.line||r==t.line&&l.from>t.ch||n.push(l.marker.parent||l.marker)}++r})),n},getAllMarks:function(){var e=[];return this.iter((function(t){var n=t.markedSpans;if(n)for(var r=0;r<n.length;++r)null!=n[r].from&&e.push(n[r].marker)})),e},posFromIndex:function(e){var t,n=this.first;return this.iter((function(r){var o=r.text.length+1;if(o>e)return t=e,!0;e-=o,++n})),ve(this,le(n,t))},indexFromPos:function(e){var t=(e=ve(this,e)).ch;return e.line<this.first||e.ch<0?0:(this.iter(this.first,e.line,(function(e){t+=e.text.length+1})),t)},copy:function(e){var t=new Dr(Wr(this,this.first,this.first+this.size),this.modeOption,this.first);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,n=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<n&&(n=e.to);var r=new Dr(Wr(this,t,n),e.mode||this.modeOption,t);return e.sharedHist&&(r.history=this.history),(this.linked||(this.linked=[])).push({doc:r,sharedHist:e.sharedHist}),r.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],r},unlinkDoc:function(e){if(e instanceof C&&(e=e.doc),this.linked)for(var t=0;t<this.linked.length;++t){if(this.linked[t].doc==e){this.linked.splice(t,1),e.unlinkDoc(this);break}}if(e.history==this.history){var n=[e.id];Br(e,(function(e){n.push(e.id)}),!0),e.history=new Yr(null),e.history.done=to(this.history.done,n),e.history.undone=to(this.history.undone,n)}},iterLinkedDocs:function(e){Br(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),Dr.prototype.eachLine=Dr.prototype.iter;var Pr="iter insert remove copy getEditor".split(" ");for(var Nr in Dr.prototype)Dr.prototype.hasOwnProperty(Nr)&&Fo(Pr,Nr)<0&&(C.prototype[Nr]=function(e){return function(){return e.apply(this.doc,arguments)}}(Dr.prototype[Nr]));function Br(e,t,n){!function e(r,o,i){if(r.linked)for(var a=0;a<r.linked.length;++a){var l=r.linked[a];if(l.doc!=o){var s=i&&l.sharedHist;n&&!s||(t(l.doc,s),e(l.doc,r,s))}}}(e,null,!0)}function Hr(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,L(e),T(e),e.options.lineWrapping||P(e),e.options.mode=t.modeOption,_t(e)}function zr(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var n=e;!n.lines;)for(var r=0;;++r){var o=n.children[r],i=o.chunkSize();if(t<i){n=o;break}t-=i}return n.lines[t]}function jr(e,t,n){var r=[],o=t.line;return e.iter(t.line,n.line+1,(function(e){var i=e.text;o==n.line&&(i=i.slice(0,n.ch)),o==t.line&&(i=i.slice(t.ch)),r.push(i),++o})),r}function Wr(e,t,n){var r=[];return e.iter(t,n,(function(e){r.push(e.text)})),r}function Vr(e,t){var n=t-e.height;if(n)for(var r=e;r;r=r.parent)r.height+=n}function Ur(e){if(null==e.parent)return null;for(var t=e.parent,n=Fo(t.lines,e),r=t.parent;r;t=r,r=r.parent)for(var o=0;r.children[o]!=t;++o)n+=r.children[o].chunkSize();return n+t.first}function qr(e,t){var n=e.first;e:do{for(var r=0;r<e.children.length;++r){var o=e.children[r],i=o.height;if(t<i){e=o;continue e}t-=i,n+=o.chunkSize()}return n}while(!e.lines);for(r=0;r<e.lines.length;++r){var a=e.lines[r].height;if(t<a)break;t-=a}return n+r}function Gr(e){for(var t=0,n=(e=lr(e)).parent,r=0;r<n.lines.length;++r){var o=n.lines[r];if(o==e)break;t+=o.height}for(var i=n.parent;i;i=(n=i).parent)for(r=0;r<i.children.length;++r){var a=i.children[r];if(a==n)break;t+=a.height}return t}function Xr(e){var t=e.order;return null==t&&(t=e.order=wi(e.text)),t}function Yr(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function Qr(e,t){var n={from:ce(t.from),to:nn(t),text:jr(e,t.from,t.to)};return Zr(e,n,t.from.line,t.to.line+1),Br(e,(function(e){Zr(e,n,t.from.line,t.to.line+1)}),!0),n}function Kr(e){for(;e.length;){if(!Ro(e).ranges)break;e.pop()}}function Jr(e,t,n,r){var o=e.history;o.undone.length=0;var i,a=+new Date;if((o.lastOp==r||o.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&o.lastModTime>a-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))&&(i=function(e,t){return t?(Kr(e.done),Ro(e.done)):e.done.length&&!Ro(e.done).ranges?Ro(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),Ro(e.done)):void 0}(o,o.lastOp==r))){var l=Ro(i.changes);0==se(t.from,t.to)&&0==se(t.from,l.to)?l.to=nn(t):i.changes.push(Qr(e,t))}else{var s=Ro(o.done);for(s&&s.ranges||$r(e.sel,o.done),i={changes:[Qr(e,t)],generation:o.generation},o.done.push(i);o.done.length>o.undoDepth;)o.done.shift(),o.done[0].ranges||o.done.shift()}o.done.push(n),o.generation=++o.maxGeneration,o.lastModTime=o.lastSelTime=a,o.lastOp=r,o.lastOrigin=o.lastSelOrigin=t.origin,l||go(e,"historyAdded")}function $r(e,t){var n=Ro(t);n&&n.ranges&&n.equals(e)||t.push(e)}function Zr(e,t,n,r){var o=t["spans_"+e.id],i=0;e.iter(Math.max(e.first,n),Math.min(e.first+e.size,r),(function(n){n.markedSpans&&((o||(o=t["spans_"+e.id]={}))[i]=n.markedSpans),++i}))}function eo(e){if(!e)return null;for(var t,n=0;n<e.length;++n)e[n].marker.explicitlyCleared?t||(t=e.slice(0,n)):t&&t.push(e[n]);return t?t.length?t:null:e}function to(e,t,n){for(var r=0,o=[];r<e.length;++r){var i=e[r];if(i.ranges)o.push(n?he.prototype.deepCopy.call(i):i);else{var a=i.changes,l=[];o.push({changes:l});for(var s=0;s<a.length;++s){var c,u=a[s];if(l.push({from:u.from,to:u.to,text:u.text}),t)for(var d in u)(c=d.match(/^spans_(\d+)$/))&&Fo(t,Number(c[1]))>-1&&(Ro(l)[d]=u[d],delete u[d])}}}return o}function no(e,t,n,r){n<e.line?e.line+=r:t<e.line&&(e.line=t,e.ch=0)}function ro(e,t,n,r){for(var o=0;o<e.length;++o){var i=e[o],a=!0;if(i.ranges){i.copied||((i=e[o]=i.deepCopy()).copied=!0);for(var l=0;l<i.ranges.length;l++)no(i.ranges[l].anchor,t,n,r),no(i.ranges[l].head,t,n,r)}else{for(l=0;l<i.changes.length;++l){var s=i.changes[l];if(n<s.from.line)s.from=le(s.from.line+r,s.from.ch),s.to=le(s.to.line+r,s.to.ch);else if(t<=s.to.line){a=!1;break}}a||(e.splice(0,o+1),o=0)}}}function oo(e,t){var n=t.from.line,r=t.to.line,o=t.text.length-(r-n)-1;ro(e.done,n,r,o),ro(e.undone,n,r,o)}wo(Dr);var io=C.e_preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},ao=C.e_stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0};function lo(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}var so=C.e_stop=function(e){io(e),ao(e)};function co(e){return e.target||e.srcElement}function uo(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),y&&e.ctrlKey&&1==t&&(t=3),t}var ho,fo=C.on=function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else if(e.attachEvent)e.attachEvent("on"+t,n);else{var r=e._handlers||(e._handlers={});(r[t]||(r[t]=[])).push(n)}},po=C.off=function(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else if(e.detachEvent)e.detachEvent("on"+t,n);else{var r=e._handlers&&e._handlers[t];if(!r)return;for(var o=0;o<r.length;++o)if(r[o]==n){r.splice(o,1);break}}},go=C.signal=function(e,t){var n=e._handlers&&e._handlers[t];if(n)for(var r=Array.prototype.slice.call(arguments,2),o=0;o<n.length;++o)n[o].apply(null,r)},mo=0;function vo(e,t){var n=e._handlers&&e._handlers[t];if(n){var r=Array.prototype.slice.call(arguments,2);ho||(++mo,ho=[],setTimeout(yo,0));for(var o=0;o<n.length;++o)ho.push(i(n[o]))}function i(e){return function(){e.apply(null,r)}}}function yo(){--mo;var e=ho;ho=null;for(var t=0;t<e.length;++t)e[t]()}function _o(e,t,n){return go(e,n||t.type,e,t),lo(t)||t.codemirrorIgnore}function bo(e,t){var n=e._handlers&&e._handlers[t];return n&&n.length>0}function wo(e){e.prototype.on=function(e,t){fo(this,e,t)},e.prototype.off=function(e,t){po(this,e,t)}}var xo=30,So=C.Pass={toString:function(){return"CodeMirror.Pass"}},ko={scroll:!1},Co={origin:"*mouse"},Mo={origin:"+move"};function To(){this.id=null}To.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var Eo=C.countColumn=function(e,t,n,r,o){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var i=r||0,a=o||0;;){var l=e.indexOf("\t",i);if(l<0||l>=t)return a+(t-i);a+=l-i,a+=n-a%n,i=l+1}};function Io(e,t,n){for(var r=0,o=0;;){var i=e.indexOf("\t",r);-1==i&&(i=e.length);var a=i-r;if(i==e.length||o+a>=t)return r+Math.min(a,t-o);if(o+=i-r,r=i+1,(o+=n-o%n)>=t)return r}}var Lo=[""];function Ao(e){for(;Lo.length<=e;)Lo.push(Ro(Lo)+" ");return Lo[e]}function Ro(e){return e[e.length-1]}var Oo=function(e){e.select()};function Fo(e,t){for(var n=0;n<e.length;++n)if(e[n]==t)return n;return-1}function Do(e,t){for(var n=[],r=0;r<e.length;r++)n[r]=t(e[r],r);return n}function Po(e,t){var n;if(Object.create)n=Object.create(e);else{var r=function(){};r.prototype=e,n=new r}return t&&No(t,n),n}function No(e,t){for(var n in t||(t={}),e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function Bo(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}m?Oo=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:a&&(Oo=function(e){try{e.select()}catch(e){}}),[].indexOf&&(Fo=function(e,t){return e.indexOf(t)}),[].map&&(Do=function(e,t){return e.map(t)});var Ho=/[\u00df\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,zo=C.isWordChar=function(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Ho.test(e))};function jo(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}var Wo=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function Vo(e){return e.charCodeAt(0)>=768&&Wo.test(e)}var Uo,qo={};function Go(e){function t(e){return(e=e.trim()).length<4?null:e.length<7?[17*parseInt(e.charAt(1),16),17*parseInt(e.charAt(2),16),17*parseInt(e.charAt(3),16)]:[parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16)]}function n(e){var t=[e[0],e[1],e[2]].map((function(e){return(e/=255)<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}));return.2126*t[0]+.7152*t[1]+.0722*t[2]}var r=n(t("#0F192A"));function o(e){return(n(e)+.05)/(r+.05)}function i(e){var t,n,r,o=e[0],i=e[1],a=e[2];if(0==i)t=n=r=a;else{function c(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var l=a<.5?a*(1+i):a+i-a*i,s=2*a-l;t=c(s,l,o+1/3),n=c(s,l,o),r=c(s,l,o-1/3)}return[255*t,255*n,255*r]}var a,l=e;if(qo[l])a=qo[l];else{var s=t(l);if(s){var c=o(s);if(c<2.361){var u=function(e){var t=e[0],n=e[1],r=e[2];t/=255,n/=255,r/=255;var o,i,a=Math.max(t,n,r),l=Math.min(t,n,r),s=(a+l)/2;if(a==l)o=i=0;else{var c=a-l;switch(i=s>.5?c/(2-a-l):c/(a+l),a){case t:o=(n-r)/c+(n<r?6:0);break;case n:o=(r-t)/c+2;break;case r:o=(t-n)/c+4}o/=6}return[o,i,s]}(s);do{u[2]+=.01,c=o(i(u))}while(c<2.361);a="color: hsl("+~~(360*u[0])+","+~~(100*u[1])+"%,"+~~(100*u[2])+"%)"}else a="color:"+l}qo[l]=a}return a}function Xo(e,t,n,r){var o=document.createElement(e);if(n){if(0===n.indexOf("cm-MULTICOLOR"))r=Go(n.substr(13)),n="cm-COLOR";else if(-1!==n.indexOf("cm-COLOR-#")){r=Go(n.match(/cm-COLOR-(#[0-9a-fA-F]+)/)[1])}o.className=n}if(r&&(o.style.cssText=r),"string"==typeof t)o.appendChild(document.createTextNode(t));else if(t)for(var i=0;i<t.length;++i)o.appendChild(t[i]);return o}function Yo(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function Qo(e,t){return Yo(e).appendChild(t)}function Ko(e,t){if(e.contains)return e.contains(t);for(;t=t.parentNode;)if(t==e)return!0}function Jo(){return document.activeElement}Uo=document.createRange?function(e,t,n){var r=document.createRange();return r.setEnd(e,n),r.setStart(e,t),r}:function(e,t,n){var r=document.body.createTextRange();return r.moveToElementText(e.parentNode),r.collapse(!0),r.moveEnd("character",n),r.moveStart("character",t),r},t&&(Jo=function(){try{return document.activeElement}catch(e){return document.body}});var $o,Zo,ei,ti=function(){if(r)return!1;var e=Xo("div");return"draggable"in e||"dragDrop"in e}();function ni(e){if(null!=$o)return $o;var t=Xo("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return Qo(e,t),t.offsetWidth&&($o=t.offsetHeight-t.clientHeight),$o||0}function ri(e){if(null==Zo){var t=Xo("span","​");Qo(e,Xo("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Zo=t.offsetWidth<=1&&t.offsetHeight>2&&!n)}return Zo?Xo("span","​"):Xo("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px")}function oi(e){if(null!=ei)return ei;var t=Qo(e,document.createTextNode("AخA")),n=Uo(t,0,1).getBoundingClientRect();if(n.left==n.right)return!1;var r=Uo(t,1,2).getBoundingClientRect();return ei=r.right-n.right<3}var ii,ai,li=C.splitLines=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,n=[],r=e.length;t<=r;){var o=e.indexOf("\n",t);-1==o&&(o=e.length);var i=e.slice(t,"\r"==e.charAt(o-1)?o-1:o),a=i.indexOf("\r");-1!=a?(n.push(i.slice(0,a)),t+=a+1):(n.push(i),t=o+1)}return n}:function(e){return e.split(/\r\n?|\n/)},si=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},ci="oncopy"in(ii=Xo("div"))||(ii.setAttribute("oncopy","return;"),"function"==typeof ii.oncopy),ui={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};function di(e){return e.level%2?e.to:e.from}function hi(e){return e.level%2?e.from:e.to}function fi(e){var t=Xr(e);return t?di(t[0]):0}function pi(e){var t=Xr(e);return t?hi(Ro(t)):e.text.length}function gi(e,t){var n=zr(e.doc,t),r=lr(n);r!=n&&(t=Ur(r));var o=Xr(r),i=o?o[0].level%2?pi(r):fi(r):0;return le(t,i)}function mi(e,t,n){var r=e[0].level;return t==r||n!=r&&t<n}function vi(e,t){ai=null;for(var n,r=0;r<e.length;++r){var o=e[r];if(o.from<t&&o.to>t)return r;if(o.from==t||o.to==t){if(null!=n)return mi(e,o.level,e[n].level)?(o.from!=o.to&&(ai=n),r):(o.from!=o.to&&(ai=r),n);n=r}}return n}function yi(e,t,n,r){if(!r)return t+n;do{t+=n}while(t>0&&Vo(e.text.charAt(t)));return t}function _i(e,t,n,r){var o=Xr(e);if(!o)return bi(e,t,n,r);for(var i=vi(o,t),a=o[i],l=yi(e,t,a.level%2?-n:n,r);;){if(l>a.from&&l<a.to)return l;if(l==a.from||l==a.to)return vi(o,l)==i?l:n>0==(a=o[i+=n]).level%2?a.to:a.from;if(!(a=o[i+=n]))return null;l=n>0==a.level%2?yi(e,a.to,-1,r):yi(e,a.from,1,r)}}function bi(e,t,n,r){var o=t+n;if(r)for(;o>0&&Vo(e.text.charAt(o));)o+=n;return o<0||o>e.text.length?null:o}C.keyNames=ui,function(){for(var e=0;e<10;e++)ui[e+48]=ui[e+96]=String(e);for(e=65;e<=90;e++)ui[e]=String.fromCharCode(e);for(e=1;e<=12;e++)ui[e+111]=ui[e+63235]="F"+e}();var wi=function(){function e(e){return e<=247?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(e):1424<=e&&e<=1524?"R":1536<=e&&e<=1773?"rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm".charAt(e-1536):1774<=e&&e<=2220?"r":8192<=e&&e<=8203?"w":8204==e?"b":"L"}var t=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,n=/[stwN]/,r=/[LRr]/,o=/[Lb1n]/,i=/[1n]/,a="L";function l(e,t,n){this.level=e,this.from=t,this.to=n}return function(s){if(!t.test(s))return!1;for(var c=s.length,u=[],d=0;d<c;++d)u.push(v=e(s.charCodeAt(d)));d=0;for(var h=a;d<c;++d){"m"==(v=u[d])?u[d]=h:h=v}d=0;for(var f=a;d<c;++d){"1"==(v=u[d])&&"r"==f?u[d]="n":r.test(v)&&(f=v,"r"==v&&(u[d]="R"))}for(d=1,h=u[0];d<c-1;++d){"+"==(v=u[d])&&"1"==h&&"1"==u[d+1]?u[d]="1":","!=v||h!=u[d+1]||"1"!=h&&"n"!=h||(u[d]=h),h=v}for(d=0;d<c;++d){if(","==(v=u[d]))u[d]="N";else if("%"==v){for(var p=d+1;p<c&&"%"==u[p];++p);for(var g=d&&"!"==u[d-1]||p<c&&"1"==u[p]?"1":"N",m=d;m<p;++m)u[m]=g;d=p-1}}for(d=0,f=a;d<c;++d){var v=u[d];"L"==f&&"1"==v?u[d]="L":r.test(v)&&(f=v)}for(d=0;d<c;++d)if(n.test(u[d])){for(p=d+1;p<c&&n.test(u[p]);++p);var y="L"==(d?u[d-1]:a),_="L"==(p<c?u[p]:a);for(g=y||_?"L":"R",m=d;m<p;++m)u[m]=g;d=p-1}var b,w=[];for(d=0;d<c;)if(o.test(u[d])){var x=d;for(++d;d<c&&o.test(u[d]);++d);w.push(new l(0,x,d))}else{var S=d,k=w.length;for(++d;d<c&&"L"!=u[d];++d);for(m=S;m<d;)if(i.test(u[m])){S<m&&w.splice(k,0,new l(1,S,m));var C=m;for(++m;m<d&&i.test(u[m]);++m);w.splice(k,0,new l(2,C,m)),S=m}else++m;S<d&&w.splice(k,0,new l(1,S,d))}return 1==w[0].level&&(b=s.match(/^\s+/))&&(w[0].from=b[0].length,w.unshift(new l(0,0,b[0].length))),1==Ro(w).level&&(b=s.match(/\s+$/))&&(Ro(w).to-=b[0].length,w.push(new l(0,c-b[0].length,c))),w[0].level!=Ro(w).level&&w.push(new l(w[0].level,c,c)),w}}();return C.version="4.0.3",C})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";var t="CodeMirror-activeline",n="CodeMirror-activeline-background";function r(e){for(var r=0;r<e.state.activeLines.length;r++)e.removeLineClass(e.state.activeLines[r],"wrap",t),e.removeLineClass(e.state.activeLines[r],"background",n)}function o(e,o){for(var i=[],a=0;a<o.length;a++){var l=e.getLineHandleVisualStart(o[a].head.line);i[i.length-1]!=l&&i.push(l)}(function(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0})(e.state.activeLines,i)||e.operation((function(){r(e);for(var o=0;o<i.length;o++)e.addLineClass(i[o],"wrap",t),e.addLineClass(i[o],"background",n);e.state.activeLines=i}))}function i(e,t){o(e,t.ranges)}e.defineOption("styleActiveLine",!1,(function(t,n,a){var l=a&&a!=e.Init;n&&!l?(t.state.activeLines=[],o(t,t.listSelections()),t.on("beforeSelectionChange",i)):!n&&l&&(t.off("beforeSelectionChange",i),r(t),delete t.state.activeLines)}))})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){function t(e,t,n){var r;return(r=e.getWrapperElement().appendChild(document.createElement("div"))).className=n?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof t?r.innerHTML=t:r.appendChild(t),r}function n(e,t){e.state.currentNotificationClose&&e.state.currentNotificationClose(),e.state.currentNotificationClose=t}e.defineExtension("openDialog",(function(r,o,i){n(this,null);var a=t(this,r,i&&i.bottom),l=!1,s=this;function c(){l||(l=!0,a.parentNode.removeChild(a))}var u,d=a.getElementsByTagName("input")[0];return d?(i&&i.value&&(d.value=i.value),e.on(d,"keydown",(function(t){i&&i.onKeyDown&&i.onKeyDown(t,d.value,c)||13!=t.keyCode&&27!=t.keyCode||(d.blur(),e.e_stop(t),c(),s.focus(),13==t.keyCode&&o(d.value))})),i&&i.onKeyUp&&e.on(d,"keyup",(function(e){i.onKeyUp(e,d.value,c)})),i&&i.value&&(d.value=i.value),d.focus(),e.on(d,"blur",c)):(u=a.getElementsByTagName("button")[0])&&(e.on(u,"click",(function(){c(),s.focus()})),u.focus(),e.on(u,"blur",c)),c})),e.defineExtension("openConfirm",(function(r,o,i){n(this,null);var a=t(this,r,i&&i.bottom),l=a.getElementsByTagName("button"),s=!1,c=this,u=1;function d(){s||(s=!0,a.parentNode.removeChild(a),c.focus())}l[0].focus();for(var h=0;h<l.length;++h){var f=l[h];!function(t){e.on(f,"click",(function(n){e.e_preventDefault(n),d(),t&&t(c)}))}(o[h]),e.on(f,"blur",(function(){--u,setTimeout((function(){u<=0&&d()}),200)})),e.on(f,"focus",(function(){++u}))}})),e.defineExtension("openNotification",(function(r,o){n(this,c);var i,a=t(this,r,o&&o.bottom),l=o&&(void 0===o.duration?5e3:o.duration),s=!1;function c(){s||(s=!0,clearTimeout(i),a.parentNode.removeChild(a))}e.on(a,"click",(function(t){e.e_preventDefault(t),c()})),l&&(i=setTimeout(c,o.duration))}))})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],e):e(CodeMirror)}((function(e){"use strict";function t(){this.posFrom=this.posTo=this.query=null,this.overlay=null}function n(e){return e.state.search||(e.state.search=new t)}function r(e){return"string"==typeof e&&e==e.toLowerCase()}function o(e,t,n){return e.getSearchCursor(t,n,r(t))}function i(e,t,n,r,o){e.openDialog?e.openDialog(t,o,{value:r}):o(prompt(n,r))}function a(e){var t=e.match(/^\/(.*)\/([a-z]*)$/);return t?(e=new RegExp(t[1],-1==t[2].indexOf("i")?"":"i")).test("")&&(e=/x^/):""==e&&(e=/x^/),e}function l(e,t){var o=n(e);if(o.query)return s(e,t);i(e,'Search: <input type="text" style="width: 10em"/>',"Search for:",e.getSelection(),(function(n){e.operation((function(){n&&!o.query&&(o.query=a(n),e.removeOverlay(o.overlay,r(o.query)),o.overlay=function(e,t){var n;return"string"==typeof e?(n=e.charAt(0),e=new RegExp("^"+e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),t?"i":"")):e=new RegExp("^(?:"+e.source+")",e.ignoreCase?"i":""),{token:function(r){if(r.match(e))return"searching";for(;!r.eol()&&(r.next(),n&&!t&&(r.skipTo(n)||r.skipToEnd()),!r.match(e,!1)););}}}(o.query,r(o.query)),e.addOverlay(o.overlay),o.posFrom=o.posTo=e.getCursor(),s(e,t))}))}))}function s(t,r){t.operation((function(){var i=n(t),a=o(t,i.query,r?i.posFrom:i.posTo);(a.find(r)||(a=o(t,i.query,r?e.Pos(t.lastLine()):e.Pos(t.firstLine(),0))).find(r))&&(t.setSelection(a.from(),a.to()),t.scrollIntoView({from:a.from(),to:a.to()}),i.posFrom=a.from(),i.posTo=a.to())}))}function c(e){e.operation((function(){var t=n(e);t.query&&(t.query=null,e.removeOverlay(t.overlay))}))}function u(e,t){i(e,'Replace: <input type="text" style="width: 10em"/> ',"Replace:",e.getSelection(),(function(n){n&&(n=a(n),i(e,'With: <input type="text" style="width: 10em"/>',"Replace with:","",(function(r){if(t)e.operation((function(){for(var t=o(e,n);t.findNext();)if("string"!=typeof n){var i=e.getRange(t.from(),t.to()).match(n);t.replace(r.replace(/\$(\d)/g,(function(e,t){return i[t]})))}else t.replace(r)}));else{c(e);var i=o(e,n,e.getCursor()),a=function(){var t,r=i.from();!(t=i.findNext())&&(i=o(e,n),!(t=i.findNext())||r&&i.from().line==r.line&&i.from().ch==r.ch)||(e.setSelection(i.from(),i.to()),e.scrollIntoView({from:i.from(),to:i.to()}),function(e,t,n,r){e.openConfirm?e.openConfirm(t,r):confirm(n)&&r[0]()}(e,"Replace? <button>Yes</button> <button>No</button> <button>Stop</button>","Replace?",[function(){l(t)},a]))},l=function(e){i.replace("string"==typeof n?r:r.replace(/\$(\d)/g,(function(t,n){return e[n]}))),a()};a()}})))}))}e.commands.find=function(e){c(e),l(e)},e.commands.findNext=l,e.commands.findPrev=function(e){l(e,!0)},e.commands.clearSearch=c,e.commands.replace=u,e.commands.replaceAll=function(e){u(e,!0)}})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";var t=e.Pos;function n(e,n,o,i){if(i=!0,this.atOccurrence=!1,this.doc=e,null==i&&"string"==typeof n&&(i=!1),o=o?e.clipPos(o):t(0,0),this.pos={from:o,to:o},"string"!=typeof n)n.global||(n=new RegExp(n.source,n.ignoreCase?"ig":"g")),this.matches=function(r,o){if(r){n.lastIndex=0;for(var i=e.getLine(o.line).slice(0,o.ch),a=0;;){n.lastIndex=a;var l=n.exec(i);if(!l)break;if(c=(s=l).index,(a=s.index+(s[0].length||1))==i.length)break}(u=s&&s[0].length||0)||(0==c&&0==i.length?s=void 0:c!=e.getLine(o.line).length&&u++)}else{n.lastIndex=o.ch;i=e.getLine(o.line);var s,c,u=(s=n.exec(i))&&s[0].length||0;(c=s&&s.index)+u==i.length||u||(u=1)}if(s&&u)return{from:t(o.line,c),to:t(o.line,c+u),match:s}};else{var a=n;i&&(n=n.toLowerCase());var l=i?function(e){return e.toLowerCase()}:function(e){return e},s=n.split("\n");if(1==s.length)n.length?this.matches=function(o,i){if(o){var s=e.getLine(i.line).slice(0,i.ch);if((u=(c=l(s)).lastIndexOf(n))>-1)return u=r(s,c,u),{from:t(i.line,u),to:t(i.line,u+a.length)}}else{var c,u;s=e.getLine(i.line).slice(i.ch);if((u=(c=l(s)).indexOf(n))>-1)return u=r(s,c,u)+i.ch,{from:t(i.line,u),to:t(i.line,u+a.length)}}}:this.matches=function(){};else{var c=a.split("\n");this.matches=function(n,r){var o=s.length-1;if(n){if(r.line-(s.length-1)<e.firstLine())return;if(l(e.getLine(r.line).slice(0,c[o].length))!=s[s.length-1])return;for(var i=t(r.line,c[o].length),a=r.line-1,u=o-1;u>=1;--u,--a)if(s[u]!=l(e.getLine(a)))return;var d=(h=e.getLine(a)).length-c[0].length;if(l(h.slice(d))!=s[0])return;return{from:t(a,d),to:i}}if(!(r.line+(s.length-1)>e.lastLine())){var h;d=(h=e.getLine(r.line)).length-c[0].length;if(l(h.slice(d))==s[0]){var f=t(r.line,d);for(a=r.line+1,u=1;u<o;++u,++a)if(s[u]!=l(e.getLine(a)))return;if(e.getLine(a).slice(0,c[o].length)==s[o])return{from:f,to:t(a,c[o].length)}}}}}}}function r(e,t,n){if(e.length==t.length)return n;for(var r=Math.min(n,e.length);;){var o=e.slice(0,r).toLowerCase().length;if(o<n)++r;else{if(!(o>n))return r;--r}}}n.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){var n=this,r=this.doc.clipPos(e?this.pos.from:this.pos.to);function o(e){var r=t(e,0);return n.pos={from:r,to:r},n.atOccurrence=!1,!1}for(;;){if(this.pos=this.matches(e,r))return this.atOccurrence=!0,this.pos.match||!0;if(e){if(!r.line)return o(0);r=t(r.line-1,this.doc.getLine(r.line-1).length)}else{var i=this.doc.lineCount();if(r.line==i-1)return o(i);r=t(r.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(n){if(this.atOccurrence){var r=e.splitLines(n);this.doc.replaceRange(r,this.pos.from,this.pos.to),this.pos.to=t(this.pos.from.line+r.length-1,r[r.length-1].length+(1==r.length?this.pos.from.ch:0))}}},e.defineExtension("getSearchCursor",(function(e,t,r){return!0,new n(this.doc,e,t,true)})),e.defineDocExtension("getSearchCursor",(function(e,t,r){return!0,new n(this,e,t,true)})),e.defineExtension("selectMatches",(function(t,n){for(var r=[],o=this.getSearchCursor(t,this.getCursor("from"),true);o.findNext()&&!(e.cmpPos(o.to(),this.getCursor("to"))>0);)r.push({anchor:o.from(),head:o.to()});r.length&&this.setSelections(r,0)}))})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";function t(e){"object"==typeof e&&(this.minChars=e.minChars,this.style=e.style,this.showToken=e.showToken,this.delay=e.delay),null==this.style&&(this.style="matchhighlight"),null==this.minChars&&(this.minChars=2),null==this.delay&&(this.delay=100),this.overlay=this.timeout=null}function n(e){var t=e.state.matchHighlighter;clearTimeout(t.timeout),t.timeout=setTimeout((function(){r(e)}),t.delay)}function r(e){e.operation((function(){var t=e.state.matchHighlighter;if(t.overlay&&(e.removeOverlay(t.overlay),t.overlay=null),e.somethingSelected()||!t.showToken){if(e.getCursor("head").line==e.getCursor("anchor").line){var n=e.getSelections()[0].replace(/^\s+|\s+$/g,"");n.length>=t.minChars&&e.addOverlay(t.overlay=o(n,!1,t.style))}}else{for(var r=!0===t.showToken?/[\w$]/:t.showToken,i=e.getCursor(),a=e.getLine(i.line),l=i.ch,s=l;l&&r.test(a.charAt(l-1));)--l;for(;s<a.length&&r.test(a.charAt(s));)++s;l<s&&e.addOverlay(t.overlay=o(a.slice(l,s),r,t.style))}}))}function o(e,t,n){return{token:function(r){if(r.match(e)&&(!t||function(e,t){return!(e.start&&t.test(e.string.charAt(e.start-1))||e.pos!=e.string.length&&t.test(e.string.charAt(e.pos)))}(r,t)))return n;r.next(),r.skipTo(e.charAt(0))||r.skipToEnd()}}}e.defineOption("highlightSelectionMatches",!1,(function(o,i,a){if(a&&a!=e.Init){var l=o.state.matchHighlighter.overlay;l&&o.removeOverlay(l),clearTimeout(o.state.matchHighlighter.timeout),o.state.matchHighlighter=null,o.off("cursorActivity",n)}i&&(o.state.matchHighlighter=new t(i),r(o),o.on("cursorActivity",n))}))})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";function t(e,t){this.cm=e,this.options=t,this.widget=null,this.debounce=0,this.tick=0,this.startPos=this.cm.getCursor("start"),this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var n=this;e.on("cursorActivity",this.activityFunc=function(){n.cursorActivity()})}e.showHint=function(e,t,n){if(!t)return e.showHint(n);n&&n.async&&(t.async=!0);var r={hint:t};if(n)for(var o in n)r[o]=n[o];return e.showHint(r)},e.defineExtension("showHint",(function(n){n=function(e,t,n){var r=e.options.hintOptions,o={};for(var i in s)o[i]=s[i];if(r)for(var i in r)void 0!==r[i]&&(o[i]=r[i]);if(n)for(var i in n)void 0!==n[i]&&(o[i]=n[i]);o.hint.resolve&&(o.hint=o.hint.resolve(e,t));return o}(this,this.getCursor("start"),n);var r=this.listSelections();if(!(r.length>1)){if(this.somethingSelected()){if(!n.hint.supportsSelection)return;for(var o=0;o<r.length;o++)if(r[o].head.line!=r[o].anchor.line)return}this.state.completionActive&&this.state.completionActive.close();var i=this.state.completionActive=new t(this,n);i.options.hint&&(e.signal(this,"startCompletion",this),i.update(!0))}}));var n=window.requestAnimationFrame||function(e){return setTimeout(e,1e3/60)},r=window.cancelAnimationFrame||clearTimeout;function o(e){return"string"==typeof e?e:e.text}function i(e,t){for(;t&&t!=e;){if("LI"===t.nodeName.toUpperCase()&&t.parentNode==e)return t;t=t.parentNode}}function a(t,n){this.completion=t,this.data=n,this.picked=!1;var r=this,a=t.cm,l=this.hints=document.createElement("ul");l.className="CodeMirror-hints",this.selectedHint=n.selectedHint||0;for(var s=n.list,c=0;c<s.length;++c){var u=l.appendChild(document.createElement("li")),d=s[c],h="CodeMirror-hint"+(c!=this.selectedHint?"":" CodeMirror-hint-active");null!=d.className&&(h=d.className+" "+h),u.className=h,d.render?d.render(u,n,d):u.appendChild(document.createTextNode(d.displayText||o(d))),u.hintId=c}var f=a.cursorCoords(t.options.alignWithWord?n.from:null),p=f.left,g=f.bottom,m=!0;l.style.left=p+"px",l.style.top=g+"px";var v=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),y=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(t.options.container||document.body).appendChild(l);var _=l.getBoundingClientRect(),b=_.bottom-y,w=l.scrollHeight>l.clientHeight+1,x=a.getScrollInfo();if(b>0){var S=_.bottom-_.top;if(f.top-(f.bottom-_.top)-S>0)l.style.top=(g=f.top-S)+"px",m=!1;else if(S>y){l.style.height=y-5+"px",l.style.top=(g=f.bottom-_.top)+"px";var k=a.getCursor();n.from.ch!=k.ch&&(f=a.cursorCoords(k),l.style.left=(p=f.left)+"px",_=l.getBoundingClientRect())}}var C,M=_.right-v;if(M>0&&(_.right-_.left>v&&(l.style.width=v-5+"px",M-=_.right-_.left-v),l.style.left=(p=f.left-M)+"px"),w)for(var T=l.firstChild;T;T=T.nextSibling)T.style.paddingRight=a.display.nativeBarWidth+"px";(a.addKeyMap(this.keyMap=function(e,t){var n={Up:function(){t.moveFocus(-1)},Down:function(){t.moveFocus(1)},PageUp:function(){t.moveFocus(1-t.menuSize(),!0)},PageDown:function(){t.moveFocus(t.menuSize()-1,!0)},Enter:t.pick,Tab:t.pick,Esc:t.close},r=e.options.customKeys,o=r?{}:n;function i(e,r){var i;i="string"!=typeof r?function(e){return r(e,t)}:n.hasOwnProperty(r)?n[r]:r,o[e]=i}if(r)for(var a in r)r.hasOwnProperty(a)&&i(a,r[a]);var l=e.options.extraKeys;if(l)for(var a in l)l.hasOwnProperty(a)&&i(a,l[a]);return o}(t,{moveFocus:function(e,t){r.changeActive(r.selectedHint+e,t)},setFocus:function(e){r.changeActive(e)},menuSize:function(){return r.screenAmount()},length:s.length,close:function(){t.close()},pick:function(){r.pick()},data:n})),t.options.closeOnUnfocus)&&(a.on("blur",this.onBlur=function(){C=setTimeout((function(){t.close()}),100)}),a.on("focus",this.onFocus=function(){clearTimeout(C)}));return a.on("scroll",this.onScroll=function(){var e=a.getScrollInfo(),n=a.getWrapperElement().getBoundingClientRect(),r=g+x.top-e.top,o=r-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(m||(o+=l.offsetHeight),o<=n.top||o>=n.bottom)return t.close();l.style.top=r+"px",l.style.left=p+x.left-e.left+"px"}),e.on(l,"dblclick",(function(e){var t=i(l,e.target||e.srcElement);t&&null!=t.hintId&&(r.changeActive(t.hintId),r.pick())})),e.on(l,"click",(function(e){var n=i(l,e.target||e.srcElement);n&&null!=n.hintId&&(r.changeActive(n.hintId),t.options.completeOnSingleClick&&r.pick())})),e.on(l,"mousedown",(function(){setTimeout((function(){a.focus()}),20)})),e.signal(n,"select",s[this.selectedHint],l.childNodes[this.selectedHint]),!0}function l(e,t,n,r){if(e.async)e(t,r,n);else{var o=e(t,n);o&&o.then?o.then(r):r(o)}}t.prototype={close:function(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&e.signal(this.data,"close"),this.widget&&this.widget.close(),e.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(t,n){var r=t.list[n];r.hint?r.hint(this.cm,t,r):this.cm.replaceRange(o(r),r.from||t.from,r.to||t.to,"complete"),e.signal(t,"pick",r),this.close()},cursorActivity:function(){this.debounce&&(r(this.debounce),this.debounce=0);var e=this.cm.getCursor(),t=this.cm.getLine(e.line);if(e.line!=this.startPos.line||t.length-e.ch!=this.startLen-this.startPos.ch||e.ch<this.startPos.ch||this.cm.somethingSelected()||e.ch&&this.options.closeCharacters.test(t.charAt(e.ch-1)))this.close();else{var o=this;this.debounce=n((function(){o.update()})),this.widget&&this.widget.disable()}},update:function(e){if(null!=this.tick){var t=this,n=++this.tick;l(this.options.hint,this.cm,this.options,(function(r){t.tick==n&&t.finishUpdate(r,e)}))}},finishUpdate:function(t,n){this.data&&e.signal(this.data,"update");var r=this.widget&&this.widget.picked||n&&this.options.completeSingle;this.widget&&this.widget.close(),this.data=t,t&&t.list.length&&(r&&1==t.list.length?this.pick(t,0):(this.widget=new a(this,t),e.signal(t,"shown")))}},a.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null,this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var e=this.completion.cm;this.completion.options.closeOnUnfocus&&(e.off("blur",this.onBlur),e.off("focus",this.onFocus)),e.off("scroll",this.onScroll)}},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var e=this;this.keyMap={Enter:function(){e.picked=!0}},this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(t,n){if(t>=this.data.list.length?t=n?this.data.list.length-1:0:t<0&&(t=n?0:this.data.list.length-1),this.selectedHint!=t){var r=this.hints.childNodes[this.selectedHint];r&&(r.className=r.className.replace(" CodeMirror-hint-active","")),(r=this.hints.childNodes[this.selectedHint=t]).className+=" CodeMirror-hint-active",r.offsetTop<this.hints.scrollTop?this.hints.scrollTop=r.offsetTop-3:r.offsetTop+r.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=r.offsetTop+r.offsetHeight-this.hints.clientHeight+3),e.signal(this.data,"select",this.data.list[this.selectedHint],r)}},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},e.registerHelper("hint","auto",{resolve:function(t,n){var r,o=t.getHelpers(n,"hint");if(o.length){var i=function(e,t,n){var r=function(e,t){if(!e.somethingSelected())return t;for(var n=[],r=0;r<t.length;r++)t[r].supportsSelection&&n.push(t[r]);return n}(e,o);!function o(i){if(i==r.length)return t(null);l(r[i],e,n,(function(e){e&&e.list.length>0?t(e):o(i+1)}))}(0)};return i.async=!0,i.supportsSelection=!0,i}return(r=t.getHelper(t.getCursor(),"hintWords"))?function(t){return e.hint.fromList(t,{words:r})}:e.hint.anyword?function(t,n){return e.hint.anyword(t,n)}:function(){}}}),e.registerHelper("hint","fromList",(function(t,n){var r,o=t.getCursor(),i=t.getTokenAt(o),a=e.Pos(o.line,i.start),l=o;i.start<o.ch&&/\w/.test(i.string.charAt(o.ch-i.start-1))?r=i.string.substr(0,o.ch-i.start):(r="",a=o);for(var s=[],c=0;c<n.words.length;c++){var u=n.words[c];u.slice(0,r.length)==r&&s.push(u)}if(s.length)return{list:s,from:a,to:l}})),e.commands.autocomplete=e.showHint;var s={hint:e.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null};e.defineOption("hintOptions",null)})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";var t=/[\w$#]+/,n=["METADATA",["author","Gill Bloggs","Your name goes here. This will appear in the title screen of the game."],["color_palette","arne","By default, when you use colour names, they are pulled from a variation of <a href='http://androidarts.com/palette/16pal.htm'>Arne</a>'s 16-Colour palette. However, there are other palettes to choose from: <p> <ul> <li>1 - mastersystem </li> <li>2 - gameboycolour </li> <li>3 - amiga </li> <li>4 - arnecolors </li> <li>5 - famicom </li> <li>6 - atari </li> <li>7 - pastel </li> <li>8 - ega </li> <li>9 - amstrad </li> <li>10 - proteus_mellow </li> <li>11 - proteus_rich </li> <li>12 - proteus_night </li> <li>13 - c64 </li> <li>14 - whitingjp </li> </ul> <p> (you can also refer to them by their numerical index)"],["again_interval","0.1","The amount of time it takes an 'again' event to trigger."],["background_color","blue","Can accept a color name or hex code (in the form #412bbc). Controls the background color of title/message screens, as well as the background color of the website. Text_color is its sibling."],["debug","","This outputs the compiled instructions whenever you build your file."],["flickscreen","8x5","Setting flickscreen divides each level into WxH grids, and zooms the camera in so that the player can only see one at a time"],["homepage","www.puzzlescript.net","A link to your homepage!"],["key_repeat_interval","0.1","When you hold down a key, how long is the delay between repeated presses getting sent to the game (in seconds)?"],["noaction","","Hides the action key (X) instruction from the title screen, and does not respond when the player pressed it (outside of menus and cutscenes and the like)."],["norepeat_action","","The action button will only respond to individual presses, and not auto-trigger when held down."],["noundo","","Disables the undo key (Z)"],["norestart","","Disables the restart key (R)"],["realtime_interval","","The number indicates how long each realtime frame should be."],["require_player_movement","","If the player doesn't move, cancel the whole move."],["run_rules_on_level_start","","Applies the rules once on level-load, before the player has moved"],["scanline","","Applies a scanline visual effect"],["text_color","orange","Can accept a color name or hex code (in the form #412bbc). Controls the font color of title/message screens, as well as the font color in the website. Background_color is its sibling."],["title","My Amazing Puzzle Game","The name of your game. Appears on the title screen."],["throttle_movement","","For use in conjunction with realtime_interval - this stops you from moving crazy fast - repeated keypresses of the same movement direction will not increase your speed. This doesn't apply to the action button."],["verbose_logging","","As you play the game, spits out information about all rules applied as you play, and also allows visual inspection of what exactly the rules do by hovering over them with your mouse (or tapping them on touchscreen)."],["zoomscreen","WxH","Zooms the camera in to a WxH section of the map around the player, centered on the player."],["mouse_left","lmb","Sets the object to place when pressing left mouse button."],["mouse_drag","drag","Sets the object to place when moving the mouse while left mouse button is held."],["mouse_up","lmbup","Sets the object to place when left mouse button is released."],["mouse_right","rmb","Sets the object to place when pressing right mouse button."],["mouse_rdrag","rdrag","Sets the object to place when moving the mouse while right mouse button is held."],["mouse_rup","rmbup","Sets the object to place when right mouse button is released."],["nokeyboard","","Allows the game to run without a Player object and movement."],["smoothscreen","[flick] WxH [IxJ] [S]","Zooms the camera in to a WxH section of the map around the player and smoothly scrolls to follow the player. The optional argument IxJ (default: 1x1) specifies a boundary in which the player can move without moving the camera. The optional speed argument (default: 0.125) specifies how far the camera will move towards the player each frame as a fraction of the distance to the player. The optional flick keyword makes the camera move like flickscreen."],["smoothscreen_debug","","Draw smoothscreen debug information."],["sprite_size","5","Size of sprites."],["case_sensitive","","Makes object names and legend case sensitive."],["level_select","","Show level selection option on main screen (use with sections in levels)."],["credits","","Show credits option on main screen"],["continue_is_level_select","","Don't show separate option on main menu for level selection."],["level_select_lock","","Level selection will have unsolved levels locked."],["level_select_unlocked_ahead","1","Level selection will have N number of unsolved levels unlocked after last solved level."],["level_select_solve_symbol","x","Symbol that will be used for solved levels in level select menu"],["custom_font","","Custom font to use for text rendering."],["font_size","","Controls the size of the custom_font"],["local_radius","X","Radius around the player to execute rules in"],["runtime_metadata_twiddling","","Allows you to change some prelude flags during runtime using rules"],["runtime_metadata_twiddling_debug","","Prints in the console each time the metadata is twiddled"],["skip_title_screen","","Will skip the title screen when the game initializes, booting straight into the level or level select"],["tween_length","0.05","Will animate objects that are moving using LEFT, RIGHT, UP, and DOWN. Duration in seconds."],["tween_easing","linear","How movement animations should lerp when using TWEEN_LENGTH, e.g. 'easeInQuad', 'easeOutCubic', etc."],["tween_snap","5","With how much granularity to snap to the underlying sprite grid. Uses the SPRITE_SIZE by default."],["message_text_align","center","Towards which side message text should align. left, center (default), or right."],["text_controls","arrow keys to move /nX to action","Overwrite keyboard/mouse control description on the title screen."],["text_message_continue","[x] or [space] to continue!","Overwrite the text below messages that normally says 'X to continue'."],["level_select_unlocked_rollover","3","An alternative to LEVEL_SELECT_UNLOCKED_AHEAD, which applies a strict maximum number of unsolved levels."],["sitelock_origin_whitelist","https://auroriax.github.io:1234","Exported versions of the game will only run on sites with this origin."],["sitelock_hostname_whitelist","auroriax.github.io","Exported versions of the game will only run on sites with this hostname."]],r=["COLOR","black","white","darkgray","lightgray","gray","red","darkred","lightred","brown","darkbrown","lightbrown","orange","yellow","green","darkgreen","lightgreen","blue","lightblue","darkblue","purple","pink","transparent"],o=["COMMAND","sfx0","sfx1","sfx2","sfx3","sfx4","sfx5","sfx6","sfx7","sfx8","sfx9","sfx10","sfx11","sfx12","sfx13","cancel","checkpoint","restart","win","message","again","nosave","quit","global","zoomscreen","flickscreen","smoothscreen","key_repeat_interval","again_interval","realtime_interval","background_color","text_color","noundo","norestart","goto","undo","message_text_align"],i=["DIRECTION","up","down","left","right","horizontal","vertical"],a=["DIRECTION","up","down","left","right","random","horizontal","vertical","late","rigid"],l=["BRACKET","startloop","endloop"],s=["DIRECTION","up","down","left","right","moving","stationary","no","randomdir","random","horizontal","vertical","orthogonal","perpendicular","parallel","action"],c=["SOUNDVERB","titlescreen","startgame","cancel","endgame","startlevel","undo","restart","endlevel","enterlevelselect","showmessage","closemessage","sfx0","sfx1","sfx2","sfx3","sfx4","sfx5","sfx6","sfx7","sfx8","sfx9","sfx10","sfx11","sfx12","sfx13","create","destroy","move","cantmove","action"],u=["LOGICWORD","some","on","no","all"],d=["LOGICWORD","and","or"],h=["mastersystem","gameboycolour","amiga","arnecolors","famicom","atari","pastel","ega","amstrad","proteus_mellow","proteus_rich","proteus_night","c64","whitingjp"];function f(e,t,n){var r=n.text,o=n.extra,i=n.tag;0==r.length&&(r=n.extra,o=n.text);var a=document.createElement("span");a.className+=" cm-s-midnight ";var l=document.createElement("span"),s=document.createTextNode(r);if(l.appendChild(s),a.appendChild(l),null!=i&&(l.className+="cm-"+i),e.appendChild(a),o.length>0){var c=document.createElement("span");c.style.color="orange";o=document.createTextNode(" "+o);c.appendChild(o),c.style.color="orange",e.appendChild(o)}}e.registerHelper("hint","anyword",(function(p,g){for(var m=g&&g.word||t,v=(g&&g.range,p.getCursor()),y=p.getLine(v.line),_=v.ch,b=_,w=y.substr(0,_);b&&m.test(y.charAt(b-1));)--b;var x=b!=_&&y.slice(b,_),S=p.getTokenAt(v),k=S.state;if(!x||k.commentLevel>0)return{list:[]};var C=!1,M=!1,T=[],E=[];switch(k.section){case"objects":2==k.objects_section&&T.push(r);break;case"legend":E=I=w.toLowerCase().split(/[\p{Z}\s]/u).filter((function(e){return""!==e})),w.indexOf("=")>=0&&(w.trim().split(/\s+/).length%2==1?C=!0:T.push(d));break;case"sounds":T.push(i),T.push(c),C=!0,M=!0;break;case"collisionlayers":var I;E=I=w.toLowerCase().split(/[,\p{Z}\s]/u).filter((function(e){return""!==e})),C=!0,M=!0;break;case"rules":-1==w.indexOf("[")?(T.push(a),T.push(l)):T.push(s),w.indexOf("->")>=0&&T.push(o),C=!0;break;case"winconditions":w.trim().split(/\s+/).length%2==0&&(C=!0),T.push(u);break;case"levels":0==="message".indexOf(w.trim())&&(T.push(["MESSAGE_VERB","message"]),T.push(["SECTION_VERB","section"]),T.push(["GOTO_VERB","goto"]));break;default:if((X=w.toLowerCase()).indexOf("background_color")>=0||X.indexOf("text_color")>=0)T.push(r);else{var L=w.trim().split(/\s+/);L.length<2?T.push(n):2==L.length&&"color_palette"==L[0].toLowerCase()&&T.push(h)}}x=x.toLowerCase();var A=g&&g.list||[],R={};if(C){var O=k.objects;for(var F in O)if(O.hasOwnProperty(F)){var D=(j=F).toLowerCase();if(!(x&&0!=D.lastIndexOf(x,0)||Object.prototype.hasOwnProperty.call(R,D))){R[D]=!0;var P=k.original_case_names[j];A.push({text:P,extra:"",tag:"NAME",render:f})}}var N=[k.legend_synonyms];N.push(k.legend_properties),M||N.push(k.legend_aggregates);for(var B=0;B<N.length;B++)for(var H=N[B],z=0;z<H.length;z++){var j;D=(j=H[z][0]).toLowerCase();if(!(x&&0!=D.lastIndexOf(x,0)||Object.prototype.hasOwnProperty.call(R,D))){R[D]=!0;P=k.original_case_names[j];A.push({text:P,extra:"",tag:"NAME",render:f})}}}for(B=0;B<T.length;B++){var W=T[B],V=W[0];for(z=1;z<W.length;z++){var U=W[z],q="";"string"!=typeof U&&(U.length>1&&(q=U[1]),U=U[0]);D=(D=U).toLowerCase();if(!(x&&0!=D.lastIndexOf(x,0)||Object.prototype.hasOwnProperty.call(R,D))){R[D]=!0;var G=V;"COLOR"===G&&(G="COLOR-"+U.toUpperCase()),A.push({text:U,extra:q,tag:G,render:f})}}}if(E.length>0){E[E.length-1]===x&&I.pop();for(B=0;B<A.length;B++){var X=A[B].text.toLowerCase();E.indexOf(X)>=0&&(A.splice(B,1),B--)}}1===A.length&&A[0].text.toLowerCase()===x&&(A=[]);for(B=1;B<A.length;B++)if(A[B].text.toLowerCase()===x){var Y=A[B];A.splice(B,1),A.unshift(Y);break}return S.string.trim().length>x.length&&(A=[]),{list:A,from:e.Pos(v.line,b),to:e.Pos(v.line,_)}})),e.ExcludedIntelliSenseTriggerKeys={9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",91:"left window key",92:"right window key",93:"select",107:"add",109:"subtract",110:"decimal point",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equalsign",188:"comma",190:"period",191:"slash",192:"graveaccent",220:"backslash",222:"quote"}})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";var t={lineComment:"//"},n=/[^\s\u00a0]/,r=e.Pos;e.cmpPos;function o(e,t){var n=e.getMode();return!1!==n.useInnerComments&&n.innerMode?e.getModeAt(t):n}e.commands.toggleComment=function(e){e.toggleComment()},e.defineExtension("toggleComment",(function(e){e||(e=t);for(var n=this,o=1/0,i=this.listSelections(),a=null,l=i.length-1;l>=0;l--){var s=i[l].from(),c=i[l].to();s.line>=o||(c.line>=o&&(c=r(o,0)),o=s.line,null==a?n.uncomment(s,c,e)?a="un":(n.lineComment(s,c,e),a="line"):"un"==a?n.uncomment(s,c,e):n.lineComment(s,c,e))}})),e.defineExtension("lineComment",(function(e,i,a){a||(a=t);var l=this,s=(o(l,e),l.getLine(e.line));if(null!=s&&(c=e,u=s,!/\bstring\b/.test(l.getTokenTypeAt(r(c.line,0)))||/^[\'\"\`]/.test(u))){var c,u,d=Math.min(0!=i.ch||i.line==e.line?i.line+1:i.line,l.lastLine()+1),h=null==a.padding?" ":a.padding,f=a.commentBlankLines||e.line==i.line;l.operation((function(){for(var t=e.line;t<d;++t){var o=l.getLine(t);(f||n.test(o))&&(l.replaceRange("("+h,r(t,0)),o=l.getLine(t),l.replaceRange(h+")",r(t,o.length)))}}))}})),e.defineExtension("uncomment",(function(e,i,a){a||(a=t);var l,s=this,c=(o(s,e),Math.min(0!=i.ch||i.line==e.line?i.line:i.line-1,s.lastLine())),u=Math.min(e.line,c),d=[],h=null==a.padding?" ":a.padding;e:{for(var f=u;f<=c;++f){var p=s.getLine(f),g=p.indexOf("("),m=p.lastIndexOf(")");if(g>-1&&!/comment/.test(s.getTokenTypeAt(r(f,g+1)))&&(g=-1),-1==g&&n.test(p))break e;if(g>-1&&n.test(p.slice(0,g)))break e;if(m>-1&&!/comment/.test(s.getTokenTypeAt(r(f,m)))&&(m=-1),-1==m&&n.test(p))break e;if(m>-1&&n.test(p.slice(m+1)))break e;d.push(p)}if(s.operation((function(){for(var e=u;e<=c;++e){var t=d[e-u],n=t.indexOf("("),o=n+"(".length,i=t.indexOf(")"),a=i+")".length;n<0||i<0||(t.slice(a-1-h.length,a-1)==h&&(i-=h.length),t.slice(o,o+h.length)==h&&(o+=h.length),l=!0,s.replaceRange("",r(e,i),r(e,a)),s.replaceRange("",r(e,n),r(e,o)))}})),l)return!0}return!1}))})),colorPalettesAliases={1:"mastersystem",2:"gameboycolour",3:"amiga",4:"arnecolors",5:"famicom",6:"atari",7:"pastel",8:"ega",9:"amstrad",10:"proteus_mellow",11:"proteus_rich",12:"proteus_night",13:"c64",14:"whitingjp"},colorPalettes={mastersystem:{black:"#000000",white:"#FFFFFF",grey:"#555555",darkgrey:"#555500",lightgrey:"#AAAAAA",gray:"#555555",darkgray:"#555500",lightgray:"#AAAAAA",red:"#FF0000",darkred:"#AA0000",lightred:"#FF5555",brown:"#AA5500",darkbrown:"#550000",lightbrown:"#FFAA00",orange:"#FF5500",yellow:"#FFFF55",green:"#55AA00",darkgreen:"#005500",lightgreen:"#AAFF00",blue:"#5555AA",lightblue:"#AAFFFF",darkblue:"#000055",purple:"#550055",pink:"#FFAAFF"},gameboycolour:{black:"#000000",white:"#FFFFFF",grey:"#7F7F7C",darkgrey:"#3E3E44",lightgrey:"#BAA7A7",gray:"#7F7F7C",darkgray:"#3E3E44",lightgray:"#BAA7A7",red:"#A7120C",darkred:"#880606",lightred:"#BA381F",brown:"#57381F",darkbrown:"#3E2519",lightbrown:"#8E634B",orange:"#BA4B32",yellow:"#C0BA6F",green:"#517525",darkgreen:"#385D12",lightgreen:"#6F8E44",blue:"#5D6FA7",lightblue:"#8EA7A7",darkblue:"#4B575D",purple:"#3E3E44",pink:"#BA381F"},amiga:{black:"#000000",white:"#FFFFFF",grey:"#BBBBBB",darkgrey:"#333333",lightgrey:"#FFEEDD",gray:"#BBBBBB",darkgray:"#333333",lightgray:"#FFEEDD",red:"#DD1111",darkred:"#990000",lightred:"#FF4422",brown:"#663311",darkbrown:"#331100",lightbrown:"#AA6644",orange:"#FF6644",yellow:"#FFDD66",green:"#448811",darkgreen:"#335500",lightgreen:"#88BB77",blue:"#8899DD",lightblue:"#BBDDEE",darkblue:"#666688",purple:"#665555",pink:"#997788"},arnecolors:{black:"#000000",white:"#FFFFFF",grey:"#9d9d9d",darkgrey:"#697175",lightgrey:"#cccccc",gray:"#9d9d9d",darkgray:"#697175",lightgray:"#cccccc",red:"#be2633",darkred:"#732930",lightred:"#e06f8b",brown:"#a46422",darkbrown:"#493c2b",lightbrown:"#eeb62f",orange:"#eb8931",yellow:"#f7e26b",green:"#44891a",darkgreen:"#2f484e",lightgreen:"#a3ce27",blue:"#1d57f7",lightblue:"#B2DCEF",darkblue:"#1B2632",purple:"#342a97",pink:"#de65e2"},famicom:{black:"#000000",white:"#ffffff",grey:"#7c7c7c",darkgrey:"#080808",lightgrey:"#bcbcbc",gray:"#7c7c7c",darkgray:"#080808",lightgray:"#bcbcbc",red:"#f83800",darkred:"#881400",lightred:"#f87858",brown:"#AC7C00",darkbrown:"#503000",lightbrown:"#FCE0A8",orange:"#FCA044",yellow:"#F8B800",green:"#00B800",darkgreen:"#005800",lightgreen:"#B8F8B8",blue:"#0058F8",lightblue:"#3CBCFC",darkblue:"#0000BC",purple:"#6644FC",pink:"#F878F8"},atari:{black:"#000000",white:"#FFFFFF",grey:"#909090",darkgrey:"#404040",lightgrey:"#b0b0b0",gray:"#909090",darkgray:"#404040",lightgray:"#b0b0b0",red:"#A03C50",darkred:"#700014",lightred:"#DC849C",brown:"#805020",darkbrown:"#703400",lightbrown:"#CB9870",orange:"#CCAC70",yellow:"#ECD09C",green:"#58B06C",darkgreen:"#006414",lightgreen:"#70C484",blue:"#1C3C88",lightblue:"#6888C8",darkblue:"#000088",purple:"#3C0080",pink:"#B484DC"},pastel:{black:"#000000",white:"#FFFFFF",grey:"#3e3e3e",darkgrey:"#313131",lightgrey:"#9cbcbc",gray:"#3e3e3e",darkgray:"#313131",lightgray:"#9cbcbc",red:"#f56ca2",darkred:"#a63577",lightred:"#ffa9cf",brown:"#b58c53",darkbrown:"#787562",lightbrown:"#B58C53",orange:"#EB792D",yellow:"#FFe15F",green:"#00FF4F",darkgreen:"#2b732c",lightgreen:"#97c04f",blue:"#0f88d3",lightblue:"#00fffe",darkblue:"#293a7b",purple:"#ff6554",pink:"#eb792d"},ega:{black:"#000000",white:"#ffffff",grey:"#555555",darkgrey:"#555555",lightgrey:"#aaaaaa",gray:"#555555",darkgray:"#555555",lightgray:"#aaaaaa",red:"#ff5555",darkred:"#aa0000",lightred:"#ff55ff",brown:"#aa5500",darkbrown:"#aa5500",lightbrown:"#ffff55",orange:"#ff5555",yellow:"#ffff55",green:"#00aa00",darkgreen:"#00aaaa",lightgreen:"#55ff55",blue:"#5555ff",lightblue:"#55ffff",darkblue:"#0000aa",purple:"#aa00aa",pink:"#ff55ff"},proteus_mellow:{black:"#3d2d2e",white:"#ddf1fc",grey:"#9fb2d4",darkgrey:"#7b8272",lightgrey:"#a4bfda",gray:"#9fb2d4",darkgray:"#7b8272",lightgray:"#a4bfda",red:"#9d5443",darkred:"#8c5b4a",lightred:"#94614c",brown:"#89a78d",darkbrown:"#829e88",lightbrown:"#aaae97",orange:"#d1ba86",yellow:"#d6cda2",green:"#75ac8d",darkgreen:"#8fa67f",lightgreen:"#8eb682",blue:"#88a3ce",lightblue:"#a5adb0",darkblue:"#5c6b8c",purple:"#d39fac",pink:"#c8ac9e"},proteus_night:{black:"#010912",white:"#fdeeec",grey:"#051d40",darkgrey:"#091842",lightgrey:"#062151",gray:"#051d40",darkgray:"#091842",lightgray:"#062151",red:"#ad4576",darkred:"#934765",lightred:"#ab6290",brown:"#61646b",darkbrown:"#3d2d2d",lightbrown:"#8393a0",orange:"#0a2227",yellow:"#0a2541",green:"#75ac8d",darkgreen:"#0a2434",lightgreen:"#061f2e",blue:"#0b2c79",lightblue:"#809ccb",darkblue:"#08153b",purple:"#666a87",pink:"#754b4d"},proteus_rich:{black:"#6f686f",white:"#d1b1e2",grey:"#b9aac1",darkgrey:"#8e8b84",lightgrey:"#c7b5cd",gray:"#b9aac1",darkgray:"#8e8b84",lightgray:"#c7b5cd",red:"#a11f4f",darkred:"#934765",lightred:"#c998ad",brown:"#89867d",darkbrown:"#797f75",lightbrown:"#ab9997",orange:"#ce8c5c",yellow:"#f0d959",green:"#75bc54",darkgreen:"#599d79",lightgreen:"#90cf5c",blue:"#8fd0ec",lightblue:"#bcdce7",darkblue:"#0b2c70",purple:"#9b377f",pink:"#cd88e5"},amstrad:{black:"#000000",white:"#ffffff",grey:"#7f7f7f",darkgrey:"#636363",lightgrey:"#afafaf",gray:"#7f7f7f",darkgray:"#636363",lightgray:"#afafaf",red:"#ff0000",darkred:"#7f0000",lightred:"#ff7f7f",brown:"#ff7f00",darkbrown:"#7f7f00",lightbrown:"#ffff00",orange:"#ff007f",yellow:"#ffff7f",green:"#01ff00",darkgreen:"#007f00",lightgreen:"#7fff7f",blue:"#0000ff",lightblue:"#7f7fff",darkblue:"#00007f",purple:"#7f007f",pink:"#ff7fff"},c64:{black:"#000000",white:"#ffffff",grey:"#6C6C6C",darkgrey:"#444444",lightgrey:"#959595",gray:"#6C6C6C",darkgray:"#444444",lightgray:"#959595",red:"#68372B",darkred:"#3f1e17",lightred:"#9A6759",brown:"#433900",darkbrown:"#221c02",lightbrown:"#6d5c0d",orange:"#6F4F25",yellow:"#B8C76F",green:"#588D43",darkgreen:"#345129",lightgreen:"#9AD284",blue:"#6C5EB5",lightblue:"#70A4B2",darkblue:"#352879",purple:"#6F3D86",pink:"#b044ac"},whitingjp:{black:"#202527",white:"#eff8fd",grey:"#7b7680",darkgrey:"#3c3b44",lightgrey:"#bed0d7",gray:"#7b7680",darkgray:"#3c3b44",lightgray:"#bed0d7",red:"#bd194b",darkred:"#6b1334",lightred:"#ef2358",brown:"#b52e1c",darkbrown:"#681c12",lightbrown:"#e87b45",orange:"#ff8c10",yellow:"#fbd524",green:"#36bc3c",darkgreen:"#317610",lightgreen:"#8ce062",blue:"#3f62c6",lightblue:"#57bbe0",darkblue:"#2c2fa0",purple:"#7037d9",pink:"#ec2b8f"}};var reg_color_names=/(black|white|darkgray|lightgray|gray|grey|darkgrey|lightgrey|red|darkred|lightred|brown|darkbrown|lightbrown|orange|yellow|green|darkgreen|lightgreen|blue|lightblue|darkblue|purple|pink|transparent)\s*/,reg_color=/(black|white|gray|darkgray|lightgray|grey|darkgrey|lightgrey|red|darkred|lightred|brown|darkbrown|lightbrown|orange|yellow|green|darkgreen|lightgreen|blue|lightblue|darkblue|purple|pink|transparent|#(?:[0-9a-f]{2}){3,4}|#(?:[0-9a-f]{3}))\s*/;function createSprite(e,t,n,r){void 0===n&&(n=[state.bgcolor,state.fgcolor]);var o=makeSpriteCanvas(e);return renderSprite(o.getContext("2d"),t,n,r,0,0),o}function renderSprite(e,t,n,r,o,i){void 0===n&&(n=["#00000000",state.fgcolor]);var a=o*cellwidth,l=i*cellheight;e.clearRect(a,l,cellwidth,cellheight);var s=t[0].length,c=t.length,u=~~(cellwidth/(s+(0|r))),d=~~(cellheight/(c+(0|r))),h=d;"scanline"in state.metadata&&(h=Math.ceil(d/2)),e.fillStyle=state.fgcolor;for(var f=0;f<c;f++)for(var p=0;p<s;p++){var g=t[f][p];if(g>=0){var m=f*d|0,v=p*u|0;e.fillStyle=n[g],e.fillRect(a+v,l+m,u,h)}}}function drawTextWithCustomFont(e,t,n,r){t.fillStyle=state.fgcolor,t.textBaseline="middle",t.textAlign="center";var o=1;void 0!==state.metadata.font_size&&(o=Math.max(parseFloat(state.metadata.font_size),0)),t.font=cellheight*o+"px PuzzleCustomFont",t.fillText(e,n,r)}var textsheetCanvas=null;function regenText(e,t){null==textsheetCanvas&&(textsheetCanvas=document.createElement("canvas"));var n=Math.ceil(Math.sqrt(fontKeys.length));textsheetCanvas.width=n*cellwidth,textsheetCanvas.height=n*cellheight*2;for(var r=textsheetCanvas.getContext("2d"),o=0;o<fontKeys.length;o++){var i=fontKeys[o];if("†"==i){console.log("making custom red character"),fontstr="11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();var a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#FF0000","#FF0000"],1,a,l),renderSprite(r,fontstr,["#FF0000","#FF0000"],1,a,l+n)}else if("ŋ"==i){console.log("making blue siren character"),fontstr="00000\n            00000\n            00000\n            00000\n            00000\n            00000\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#0000FF"],1,a,l),renderSprite(r,fontstr,["#000000","#0000FF"],1,a,l+n)}else if("ŉ"==i){console.log("making red siren character"),fontstr="00000\n            00000\n            00000\n            00000\n            00000\n            00000\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FF0000"],1,a,l),renderSprite(r,fontstr,["#000000","#FF0000"],1,a,l+n)}else if("Æ"==i){console.log("making custom white character"),fontstr="11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#FFFFFF","#FFFFFF"],1,a,l+n)}else if("Ĳ"==i){console.log("making custom half-white character"),fontstr="00000\n            00000\n            00000\n            00000\n            00000\n            00000\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("ĳ"==i){console.log("making custom blue character"),fontstr="11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#0000FF","#0000FF"],1,a,l),renderSprite(r,fontstr,["#0000FF","#0000FF"],1,a,l+n)}else if("æ"==i){console.log("making custom left wheel character"),fontstr="11111\n            11111\n            11111\n            11100\n            11100\n            11100\n            11100\n            11100\n            11100\n            11100\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#3A3B3C"],1,a,l),renderSprite(r,fontstr,["#FFFFFF","#3A3B3C"],1,a,l+n)}else if("ł"==i){console.log("making custom right wheel character"),fontstr="11111\n            11111\n            11111\n            00111\n            00111\n            00111\n            00111\n            00111\n            00111\n            00111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#3A3B3C"],1,a,l),renderSprite(r,fontstr,["#FFFFFF","#3A3B3C"],1,a,l+n)}else if("®"==i){console.log("making custom light gray character"),fontstr="11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#D3D3D3","#D3D3D3"],1,a,l),renderSprite(r,fontstr,["#D3D3D3","#D3D3D3"],1,a,l+n)}else if("€"==i){console.log("making custom light blue character"),fontstr="11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#ADD8E6","#ADD8E6"],1,a,l),renderSprite(r,fontstr,["#ADD8E6","#ADD8E6"],1,a,l+n)}else if("ĸ"==i){console.log("making custom black character"),fontstr="11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#000000"],1,a,l),renderSprite(r,fontstr,["#000000","#000000"],1,a,l+n)}else if("Ł"==i){console.log("making custom noise line character"),fontstr="11111\n            11111\n            11111\n            11111\n            01111\n            10111\n            11011\n            00001\n            01111\n            10111\n            11011\n            11101",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#000000"],1,a,l),renderSprite(r,fontstr,["#FFFFFF","#000000"],1,a,l+n)}else if("ŀ"==i){console.log("making custom noise line 2 character"),fontstr="11111\n            11111\n            11101\n            11101\n            11101\n            11101\n            10101\n            10001\n            10101\n            10111\n            10111\n            10111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#000000"],1,a,l),renderSprite(r,fontstr,["#FFFFFF","#000000"],1,a,l+n)}else if("Ŀ"==i){console.log("making custom noise line 3 character"),fontstr="11111\n            11111\n            11111\n            11111\n            00111\n            01111\n            11111\n            00000\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#000000"],1,a,l),renderSprite(r,fontstr,["#FFFFFF","#000000"],1,a,l+n)}else if("ļ"==i){console.log("making custom noise line 4 character"),fontstr="11111\n            11111\n            11111\n            11111\n            10000\n            11111\n            11110\n            11100\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#000000"],1,a,l),renderSprite(r,fontstr,["#FFFFFF","#000000"],1,a,l+n)}else if("¥"==i){console.log("making custom title 1 character"),fontstr="11111\n            11111\n            11111\n            11100\n            11110\n            11110\n            11110\n            11110\n            11110\n            11110\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("§"==i){console.log("making custom title 2 character"),fontstr="11111\n            11111\n            11111\n            01010\n            11010\n            11010\n            11000\n            11010\n            11010\n            11010\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("¤"==i){console.log("making custom title 3 character"),fontstr="11111\n            11111\n            11111\n            10001\n            10111\n            10111\n            10001\n            10111\n            10111\n            10001\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("¢"==i){console.log("making custom title 4 character"),fontstr="11111\n            11111\n            11111\n            10001\n            10111\n            10111\n            10001\n            11101\n            11101\n            10001\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("Ÿ"==i){console.log("making custom title 5 character"),fontstr="11111\n            11111\n            11111\n            00010\n            01010\n            01010\n            01010\n            01010\n            01010\n            00010\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("ŷ"==i){console.log("making custom title 6 character"),fontstr="11111\n            11111\n            11111\n            10101\n            10100\n            10100\n            10100\n            10101\n            10101\n            00101\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("ų"==i){console.log("making custom title 7 character"),fontstr="11111\n            11111\n            11111\n            10100\n            10101\n            10101\n            00101\n            00101\n            00101\n            10100\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("ø"==i){console.log("making custom title 7.1 character"),fontstr="11111\n            11111\n            11111\n            11111\n            01111\n            01111\n            01111\n            01111\n            01111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("Ų"==i){console.log("making custom title 8 character"),fontstr="11111\n            11111\n            11111\n            11000\n            11010\n            11010\n            11010\n            11010\n            11010\n            11000\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("ű"==i){console.log("making custom title 9 character"),fontstr="11111\n            11111\n            11111\n            10001\n            10111\n            10001\n            10111\n            10111\n            10111\n            10111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("ŧ"==i){console.log("making custom title 10 character"),fontstr="11111\n            11111\n            11111\n            10001\n            10111\n            10111\n            10001\n            11101\n            11101\n            10001\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("Ŧ"==i){console.log("making custom title 11 character"),fontstr="11111\n            11111\n            11111\n            00010\n            10110\n            10110\n            10110\n            10110\n            10110\n            00010\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("Ţ"==i){console.log("making custom title 12 character"),fontstr="11111\n            11111\n            11111\n            00100\n            10101\n            10101\n            01100\n            10101\n            10101\n            10100\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("Œ"==i){console.log("making custom title 13 character"),fontstr="11111\n            11111\n            11111\n            01011\n            11001\n            11001\n            01000\n            11010\n            11010\n            01011\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if("œ"==i){console.log("making custom title 14 character"),fontstr="11111\n            11111\n            11111\n            01000\n            01011\n            01011\n            01000\n            01110\n            01110\n            01000\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,a,l+n)}else if(font.hasOwnProperty(i)){fontstr=font[i].split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();a=o%n|0,l=o/n|0;"✓"==i?(renderSprite(r,fontstr,["#000000","#00FF00"],1,a,l),renderSprite(r,fontstr,["#000000","#00FF00"],0,a,l+n)):">"==i||"<"==i||"#"==i||"["==i||"]"==i||"Ć"==i||"ć"==i||"ľ"==i||"į"==i||"ķ"==i||"ť"==i||"ŏ"==i||"ń"==i||"ū"==i||"ě"==i||"Ĺ"==i||"Ġ"==i||"Ń"==i||"Ý"==i||"Ś"==i||"ś"==i||"ā"==i||"ď"==i||"ř"==i||"ñ"==i||"ŵ"==i?(renderSprite(r,fontstr,["#000000","#FFFF00"],1,a,l),renderSprite(r,fontstr,["#000000","#FFFF00"],0,a,l+n)):"*"==i||"+"==i?(renderSprite(r,fontstr,["#000000","#FF0000"],1,a,l),renderSprite(r,fontstr,["#000000","#FF0000"],0,a,l+n)):(renderSprite(r,fontstr,void 0,1,a,l),renderSprite(r,fontstr,["#00000000","#000000"],0,a,l+n))}}}var spriteimages,glyphImagesCorrespondance,glyphImages,glyphHighlight,glyphHighlightDiff,glyphHighlightResize,glyphPrintButton,glyphMouseOver,editor_s_grille=[[0,1,1,1,0],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,1],[0,1,1,1,0]],spritesheetCanvas=null;function regenSpriteImages(){if(console.log("sprites length: "+sprites.length),textMode)return spriteimages=[],void regenText();if(!0===IDE&&(textImages.editor_s=createSprite("chars",editor_s_grille,void 0)),0!==state.levels.length){spriteimages=[];var e=Math.ceil(Math.sqrt(sprites.length));null==spritesheetCanvas&&(spritesheetCanvas=document.createElement("canvas")),spritesheetCanvas.width=e*cellwidth,spritesheetCanvas.height=e*cellheight;for(var t=spritesheetCanvas.getContext("2d"),n=0;n<sprites.length;n++)if(null!=sprites[n]){canOpenEditor&&(spriteimages[n]=createSprite(n.toString(),sprites[n].dat,sprites[n].colors));var r=n%e|0,o=n/e|0;renderSprite(t,sprites[n].dat,sprites[n].colors,0,r,o)}canOpenEditor&&generateGlyphImages()}}var canvas,ctx,x,y,cellwidth,cellheight,xoffset,yoffset,lastDownTarget,glyphSelectedIndex=0,editorRowCount=1,editorGlyphMovements=[],canvasdict={};function makeSpriteCanvas(e){var t;return e in canvasdict?t=canvasdict[e]:(t=document.createElement("canvas"),canvasdict[e]=t),t.width=cellwidth,t.height=cellheight,t}function generateGlyphImages(){if(0!==cellwidth&&0!==cellheight){for(var e in glyphImagesCorrespondance=[],glyphImages=[],seenobjects={},state.glyphDict)if(1==e.length&&state.glyphDict.hasOwnProperty(e)){var t=state.glyphDict[e],n=t.join(",");if(seenobjects.hasOwnProperty(n))continue;var r=makeSpriteCanvas("C"+e),o=r.getContext("2d");glyphImagesCorrespondance.push(e),seenobjects[n]=!0;for(var i=0;i<t.length;i++){var a=t[i];-1!==a&&o.drawImage(spriteimages[a],0,0)}glyphImages.push(r)}if(IDE){(o=(glyphHighlight=makeSpriteCanvas("highlight")).getContext("2d")).fillStyle="#FFFFFF",o.fillRect(0,0,cellwidth,1),o.fillRect(0,0,1,cellheight),o.fillRect(0,cellheight-1,cellwidth,1),o.fillRect(cellwidth-1,0,1,cellheight),glyphPrintButton=textImages.editor_s,(o=(glyphHighlightDiff=makeSpriteCanvas("glyphHighlightDiff")).getContext("2d")).fillStyle=state.bgcolor,o.fillRect(0,0,cellwidth,2),o.fillRect(0,0,2,cellheight),o.fillRect(0,cellheight-2,cellwidth,2),o.fillRect(cellwidth-2,0,2,cellheight),o.fillStyle=state.fgcolor,o.fillRect(0,0,cellwidth,1),o.fillRect(0,0,1,cellheight),o.fillRect(0,cellheight-1,cellwidth,1),o.fillRect(cellwidth-1,0,1,cellheight),glyphPrintButton=textImages.editor_s,(o=(glyphHighlightResize=makeSpriteCanvas("highlightresize")).getContext("2d")).fillStyle="#FFFFFF";var l=cellwidth/2-1|0,s=cellwidth-l-1-l,c=cellheight/2-1|0,u=cellheight-c-1-l;o.fillRect(l,0,s,cellheight),o.fillRect(0,c,cellwidth,u),(o=(glyphMouseOver=makeSpriteCanvas("glyphMouseOver")).getContext("2d")).fillStyle="yellow",o.fillRect(0,0,cellwidth,2),o.fillRect(0,0,2,cellheight),o.fillRect(0,cellheight-2,cellwidth,2),o.fillRect(cellwidth-2,0,2,cellheight);const e=[[[3,2],[5,0],[7,2]],[[3,8],[5,10],[7,8]],[[2,3],[0,5],[2,7]],[[7,3],[10,5],[7,7]],[[3,5],[5,7],[7,5],[5,3]]];for(i=0;i<e.length;i++){editorGlyphMovements[i]=makeSpriteCanvas("editorGlyphMovements"+i);var d=e[i];(o=editorGlyphMovements[i].getContext("2d")).lineWidth=1,o.fillStyle=state.bgcolor,o.strokeStyle=state.fgcolor,o.beginPath(),o.moveTo(d[0][0]*cellwidth/10,d[0][1]*cellheight/10);for(var h=1;h<d.length;h++)o.lineTo(d[h][0]*cellwidth/10,d[h][1]*cellheight/10);o.closePath(),o.fill(),o.stroke()}}}}function glyphCount(){var e=0;for(var t in state.glyphDict)1==t.length&&state.glyphDict.hasOwnProperty(t)&&e++;return e}function redraw(){if(0!==cellwidth&&0!==cellheight){var e=Math.ceil(Math.sqrt(fontKeys.length));if(textMode)if(console.log("redrawing in text mode"),ctx.fillStyle=state.bgcolor,ctx.fillRect(0,0,canvas.width,canvas.height),void 0!==state.metadata.custom_font&&loadedCustomFont){null===spritesheetCanvas&&regenSpriteImages();for(t=0;t<titleHeight;t++){drawTextWithCustomFont(titleImage[t],ctx,xoffset+titleWidth*cellwidth/2,yoffset+t*cellheight+cellheight/2)}}else for(var t=0;t<titleWidth;t++)for(var n=0;n<titleHeight;n++){var r=titleImage[n].charAt(t);if(r in font){var o=fontIndex[r],i=o%e|0,a=o/e|0;ctx.imageSmoothingEnabled=!1,"†"==r||"Æ"==r||"æ"==r||"®"==r||"€"==r||"¥"==r||"§"==r||"¤"==r||"¢"==r||"Ÿ"==r||"ŷ"==r||"ų"==r||"Ų"==r||"ű"==r||"ŧ"==r||"Ŧ"==r||"Ţ"==r||"Œ"==r||"œ"==r||"ŋ"==r||"ŉ"==r||"ł"==r||"Ł"==r||"ŀ"==r||"Ŀ"==r||"ļ"==r||"ĸ"==r||"ĳ"==r||"Ĳ"==r||"ø"==r?ctx.drawImage(textsheetCanvas,i*textcellwidth,a*textcellheight,textcellwidth,textcellheight,xoffset+t*cellwidth,yoffset+n*cellheight,1.25*cellwidth,1.2*cellheight):ctx.drawImage(textsheetCanvas,i*textcellwidth,a*textcellheight,textcellwidth,textcellheight,xoffset+t*cellwidth,yoffset+n*cellheight,cellwidth,cellheight)}}else{console.log("redrawing in normal mode");var l=level;null!==diffToVisualize&&((l=new Level(-1,diffToVisualize.width,diffToVisualize.height,diffToVisualize.layerCount,diffToVisualize.objects)).movements=diffToVisualize.movements),ctx.fillStyle=state.bgcolor,ctx.fillRect(0,0,canvas.width,canvas.height);var s=0,c=screenwidth,u=0,d=screenheight,h={x:0,y:0};if(levelEditorOpened){var f=glyphCount();c-=2,d-=2+(editorRowCount=Math.ceil(f/(screenwidth-1)))}else if(flickscreen){if((m=getPlayerPositions()).length>0){var p=(v=m[0])/l.height|0,g=v%l.height|0;s=(p/screenwidth|0)*screenwidth,u=(g/screenheight|0)*screenheight,c=Math.min(s+screenwidth,l.width),d=Math.min(u+screenheight,l.height),oldflickscreendat=[s,u,c,d]}else oldflickscreendat.length>0&&(s=oldflickscreendat[0],u=oldflickscreendat[1],c=oldflickscreendat[2],d=oldflickscreendat[3])}else if(zoomscreen){var m;if((m=getPlayerPositions()).length>0){var v;p=(v=m[0])/l.height|0,g=v%l.height|0;s=Math.max(Math.min(p-(screenwidth/2|0),l.width-screenwidth),0),u=Math.max(Math.min(g-(screenheight/2|0),l.height-screenheight),0),c=Math.min(s+screenwidth,l.width),d=Math.min(u+screenheight,l.height),oldflickscreendat=[s,u,c,d]}else oldflickscreendat.length>0&&(s=oldflickscreendat[0],u=oldflickscreendat[1],c=oldflickscreendat[2],d=oldflickscreendat[3])}else smoothscreen&&(null!==cameraPositionTarget?(["x","y"].forEach((function(e){var t=cameraPositionTarget[e]-cameraPosition[e];0!==t&&(Math.abs(t)<.5/cellwidth?cameraPosition[e]=cameraPositionTarget[e]:(cameraPosition[e]+=t*state.metadata.smoothscreen.cameraSpeed,h[e]=cameraPosition[e]%1))})),s=Math.max(Math.min(Math.floor(cameraPosition.x)-Math.floor(screenwidth/2),level.width-screenwidth),0),u=Math.max(Math.min(Math.floor(cameraPosition.y)-Math.floor(screenheight/2),level.height-screenheight),0),c=Math.min(s+screenwidth,level.width),d=Math.min(u+screenheight,level.height),oldflickscreendat=[s,u,c,d]):oldflickscreendat.length>0&&(s=oldflickscreendat[0],u=oldflickscreendat[1],c=oldflickscreendat[2],d=oldflickscreendat[3]),ctx.save(),ctx.beginPath(),ctx.moveTo(xoffset,yoffset),ctx.lineTo(xoffset+(c-s)*cellwidth,yoffset),ctx.lineTo(xoffset+(c-s)*cellwidth,yoffset+(d-u)*cellwidth),ctx.lineTo(xoffset,yoffset+(d-u)*cellwidth),ctx.clip());screenOffsetX=s,screenOffsetY=u;var y=smoothscreen?1:0,_=Math.ceil(Math.sqrt(sprites.length));if(state.metadata.tween_length&&currentMovedEntities){var b=1-clamp(tweentimer/tweeninterval,0,1),w="linear",x=state.sprite_size;void 0!==state.metadata.tween_easing&&(w=state.metadata.tween_easing,NaN!=parseInt(w)&&easingAliases[parseInt(w)]&&(w=easingAliases[parseInt(w)]),w=w.toLowerCase()),void 0!==state.metadata.tween_snap&&(x=Math.max(parseInt(state.metadata.tween_snap),1)),null!=EasingFunctions[w]&&(b=EasingFunctions[w](b)),b=Math.floor(b*x)/x;for(E=0;E<state.idDict.length;E++){var S=state.objects[state.idDict[E]].layer;for(t=Math.max(s-y,0);t<Math.min(c+y,l.width);t++)for(n=Math.max(u-y,0);n<Math.min(d+y,l.height);n++){M=n+t*l.height;if(0!=(T=l.getCellInto(M,_o12)).get(E)){I=E%_|0,L=E/_|0,A=xoffset+(t-s-h.x)*cellwidth,R=yoffset+(n-u-h.y)*cellheight;if(currentMovedEntities&&currentMovedEntities["p"+M+"-l"+S]){var k=currentMovedEntities["p"+M+"-l"+S];if(16!=k){var C=dirMasksDelta[k];A-=cellwidth*C[0]*b,R-=cellheight*C[1]*b}else 16==k&&(ctx.globalAlpha=1-b)}ctx.drawImage(spritesheetCanvas,I*cellwidth,L*cellheight,cellwidth,cellheight,Math.floor(A),Math.floor(R),cellwidth,cellheight),ctx.globalAlpha=1}}}}else for(var t=Math.max(s-y,0);t<Math.min(c+y,l.width);t++)for(var n=Math.max(u-y,0);n<Math.min(d+y,l.height);n++)for(var M=n+t*l.height,T=l.getCellInto(M,_o12),E=0;E<state.objectCount;E++)if(0!=T.get(E)){var I=E%_|0,L=E/_|0,A=xoffset+(t-s-h.x)*cellwidth,R=yoffset+(n-u-h.y)*cellheight;ctx.drawImage(spritesheetCanvas,I*cellwidth,L*cellheight,cellwidth,cellheight,Math.floor(A),Math.floor(R),cellwidth,cellheight)}if(null!==diffToVisualize){for(var O=diffToVisualize.lineNumber-1;O>=-1&&!debug_visualisation_array[diffToVisualize.turnIndex].hasOwnProperty(O);O--);var F=debug_visualisation_array[diffToVisualize.turnIndex][O],D=new Level(-1,F.width,F.height,F.layerCount,F.objects);D.movements=F.movements;for(t=s;t<c;t++)for(n=u;n<d;n++){M=n+t*l.height;var P=D.getMovements(M),N=l.getMovements(M),B=D.getCellInto(M,_o11);T=l.getCellInto(M,_o12);N.equals(P)&&T.equals(B)||ctx.drawImage(glyphHighlightDiff,xoffset+(t-s)*cellwidth,yoffset+(n-u)*cellheight)}for(t=s;t<c;t++)for(n=u;n<d;n++){M=n+t*l.height,N=l.getMovements(M);for(var H=0;H<l.layerCount;H++){var z=N.getshiftor(31,5*H);for(E=0;E<5;E++)0!=(z&Math.pow(2,E))&&ctx.drawImage(editorGlyphMovements[E],xoffset+(t-s)*cellwidth,yoffset+(n-u)*cellheight)}}}smoothscreen&&(state.metadata.smoothscreen.debug&&drawSmoothScreenDebug(ctx),ctx.restore()),levelEditorOpened&&drawEditorIcons(s,u)}}}function drawSmoothScreenDebug(e){e.save();var t=state.metadata.smoothscreen.boundarySize,n=getPlayerPositions();if(n.length>0){var r={x:n[0]/level.height|0,y:n[0]%level.height|0},o=r.x-cameraPosition.x,i=r.y-cameraPosition.y;e.fillStyle="#00ff00",e.beginPath(),e.arc(xoffset+(Math.floor(screenwidth/2)+o+.5)*cellwidth,yoffset+(Math.floor(screenheight/2)+i+.5)*cellheight,cellwidth/4,0,2*Math.PI),e.fill()}var a=cameraPositionTarget.x-cameraPosition.x,l=cameraPositionTarget.y-cameraPosition.y;e.fillStyle="#0000ff",e.beginPath(),e.arc(xoffset+(Math.floor(screenwidth/2)+a)*cellwidth,yoffset+(Math.floor(screenheight/2)+l)*cellheight,cellwidth/8,0,2*Math.PI),e.fill(),e.strokeStyle="#0000ff",e.lineWidth=cellwidth/16,e.strokeRect(xoffset+(Math.floor(screenwidth/2)+a-Math.floor(t.width/2))*cellwidth,yoffset+(Math.floor(screenheight/2)+l-Math.floor(t.height/2))*cellheight,t.width*cellwidth,t.height*cellheight),e.fillStyle="#ff0000",e.beginPath(),e.arc(xoffset+Math.floor(screenwidth/2)*cellwidth,yoffset+Math.floor(screenheight/2)*cellheight,cellwidth/4,0,2*Math.PI),e.fill(),e.strokeStyle="#ff0000",e.lineWidth=cellwidth/8,e.strokeRect(xoffset+(Math.floor(screenwidth/2)-Math.floor(t.width/2))*cellwidth,yoffset+(Math.floor(screenheight/2)-Math.floor(t.height/2))*cellheight,t.width*cellwidth,t.height*cellheight),e.restore()}function drawEditorIcons(e,t){glyphImages.length;var n=glyphImages.length-0;ctx.drawImage(glyphPrintButton,xoffset-cellwidth,yoffset-cellheight*(1+editorRowCount)),mouseCoordY===-1-editorRowCount&&-1===mouseCoordX&&ctx.drawImage(glyphMouseOver,xoffset-cellwidth,yoffset-cellheight*(1+editorRowCount));for(var r=mouseCoordX+(screenwidth-1)*(l=editorRowCount-(-mouseCoordY-2)-1),o=0;o<n;o++){var i=glyphImages[0+o],a=o%(screenwidth-1),l=o/(screenwidth-1)|0;ctx.drawImage(i,xoffset+a*cellwidth,yoffset+l*cellheight-cellheight*(1+editorRowCount)),mouseCoordX>=0&&mouseCoordX<screenwidth-1&&r===o&&ctx.drawImage(glyphMouseOver,xoffset+a*cellwidth,yoffset+l*cellheight-cellheight*(1+editorRowCount)),o===glyphSelectedIndex&&ctx.drawImage(glyphHighlight,xoffset+a*cellwidth,yoffset+l*cellheight-cellheight*(1+editorRowCount))}var s="",c=null;if(mouseCoordX>=0&&mouseCoordX<screenwidth&&r>=0&&r<n){const e=glyphImagesCorrespondance[0+r];s=e,e in state.synonymsDict?s+=" = "+state.synonymsDict[e]:e in state.aggregatesDict&&(s+=" = "+state.aggregatesDict[e].join(" and "))}else if(mouseCoordX>=0&&mouseCoordY>=0&&mouseCoordX<screenwidth&&mouseCoordY<screenheight-editorRowCount){const n=level.getCellInto(mouseCoordY+t+(mouseCoordX+e)*level.height,_o12);null!==(c=state.idDict.filter(((e,t)=>0!=n.get(t))))&&(s=c.join(", "))}s.length>0&&(ctx.fillStyle=state.fgcolor,ctx.font='16px "Source Sans Pro", Helvetica, Arial, sans-serif',ctx.fillText(s,xoffset,yoffset-.4*cellheight)),mouseCoordX>=-1&&mouseCoordY>=-1&&mouseCoordX<screenwidth-1&&mouseCoordY<screenheight-1-editorRowCount&&(-1==mouseCoordX||-1==mouseCoordY||mouseCoordX==screenwidth-2||mouseCoordY===screenheight-2-editorRowCount?ctx.drawImage(glyphHighlightResize,xoffset+mouseCoordX*cellwidth,yoffset+mouseCoordY*cellheight):ctx.drawImage(glyphHighlight,xoffset+mouseCoordX*cellwidth,yoffset+mouseCoordY*cellheight))}window.addEventListener("resize",canvasResize,!1),canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d"),x=0,y=0;var oldcellwidth=0,oldcellheight=0,oldtextmode=-1,oldfgcolor=-1,forceRegenImages=!1,textcellwidth=0,textcellheight=0;function canvasResize(){if(parentWidth=canvas.parentNode.clientWidth,parentHeight=canvas.parentNode.clientHeight,screenwidth=level.width,screenheight=level.height,void 0!==state)if(flickscreen=void 0!==state.metadata.flickscreen,zoomscreen=void 0!==state.metadata.zoomscreen,smoothscreen=void 0!==state.metadata.smoothscreen,levelEditorOpened){screenwidth+=2;var e=glyphCount();editorRowCount=Math.ceil(e/(screenwidth-1)),screenheight+=2+editorRowCount}else flickscreen?(screenwidth=state.metadata.flickscreen[0],screenheight=state.metadata.flickscreen[1]):zoomscreen?(screenwidth=state.metadata.zoomscreen[0],screenheight=state.metadata.zoomscreen[1]):smoothscreen&&(screenwidth=state.metadata.smoothscreen.screenSize.width,screenheight=state.metadata.smoothscreen.screenSize.height);textMode&&(screenwidth=titleWidth,screenheight=titleHeight),cellwidth=parentWidth/screenwidth,cellheight=parentHeight/screenheight;var t=5,n=5;if(sprites.length>=2)t=sprites[1].dat.length,n=sprites[1].dat.length;textMode&&(t=6,n=font.X.length/t+1),cellwidth=t*Math.max(~~(cellwidth/t),1),cellheight=n*Math.max(~~(cellheight/n),1),0!=cellwidth&&0!=cellheight||textMode||(cellwidth=t,cellheight=n,console.log("Resized below 1")),xoffset=0,yoffset=0,cellwidth/t>cellheight/n||textMode&&void 0!==state.metadata.custom_font&&loadedCustomFont?(cellwidth=cellheight*t/n,xoffset=(parentWidth-cellwidth*screenwidth)/2,yoffset=(parentHeight-cellheight*screenheight)/2):(cellheight=cellwidth*n/t,yoffset=(parentHeight-cellheight*screenheight)/2,xoffset=(parentWidth-cellwidth*screenwidth)/2),yoffset<0&&(yoffset=0),xoffset<0&&(xoffset=0),levelEditorOpened&&!textMode&&(xoffset+=cellwidth,yoffset+=cellheight*(1+editorRowCount)),cellwidth|=0,cellheight|=0,xoffset|=0,yoffset|=0,textMode&&(textcellwidth=cellwidth,textcellheight=cellheight),(oldcellwidth!=cellwidth||oldcellheight!=cellheight||oldtextmode!=textMode||textMode||oldfgcolor!=state.fgcolor||forceRegenImages)&&(forceRegenImages=!1,regenSpriteImages()),oldcellheight=cellheight,oldcellwidth=cellwidth,oldtextmode=textMode,oldfgcolor=state.fgcolor,canvas.width=xoffset+cellwidth*screenwidth,canvas.height=yoffset+cellheight*screenheight,redraw()}EasingFunctions={linear:e=>e,easeinquad:e=>e*e,easeoutquad:e=>e*(2-e),easeinoutquad:e=>e<.5?2*e*e:(4-2*e)*e-1,easeincubic:e=>e*e*e,easeoutcubic:e=>--e*e*e+1,easeinoutcubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeinquart:e=>e*e*e*e,easeoutquart:e=>1- --e*e*e*e,easeinoutquart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,easeinquint:e=>e*e*e*e*e,easeoutquint:e=>1+--e*e*e*e*e,easeinoutquint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},easingAliases={1:"linear",2:"easeInQuad",3:"easeOutQuad",4:"easeInOutQuad",5:"easeInCubic",6:"easeOutCubic",7:"easeInOutCubic",8:"easeInQuart",9:"easeOutQuart",10:"easeInOutQuart",11:"easeInQuint",12:"easeOutQuint",13:"easeInOutQuint"};var keyRepeatTimer=0,keyRepeatIndex=0,input_throttle_timer=0,lastinput=-100,dragging=!1,rightdragging=!1,columnAdded=!1;function selectText(e,t){t=t||window.event;var n=document.getElementById(e);if(t&&(t.ctrlKey||t.metaKey)){if(solving)return;var r=["console"].concat(n.innerHTML.split("<br>")),o=levelFromString(state,r);loadLevelFromLevelDat(state,o,null),canvasResize()}else{if(document.selection)(i=document.body.createTextRange()).moveToElementText(n),i.select();else if(window.getSelection){var i;(i=document.createRange()).selectNode(n);var a=window.getSelection();a.removeAllRanges(),a.addRange(i)}}}function recalcLevelBounds(){}function arrCopy(e,t,n,r,o){for(;o--;)n[r++]=e[t]++}function adjustLevel(e,t,n){backups.push(backupLevel());var r=e.clone();e.width+=t,e.height+=n,e.n_tiles=e.width*e.height,e.objects=new Int32Array(e.n_tiles*STRIDE_OBJ);var o=new BitVec(STRIDE_OBJ);o.ibitset(state.backgroundid);for(var i=0;i<e.n_tiles;++i)e.setCell(i,o);return e.movements=new Int32Array(e.objects.length),columnAdded=!0,RebuildLevelArrays(),r}function addLeftColumn(){for(var e=adjustLevel(level,1,0),t=1;t<level.width;++t)for(var n=0;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r-level.height))}}function addRightColumn(){for(var e=adjustLevel(level,1,0),t=0;t<level.width-1;++t)for(var n=0;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r))}}function addTopRow(){for(var e=adjustLevel(level,0,1),t=0;t<level.width;++t)for(var n=1;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r-t-1))}}function addBottomRow(){for(var e=adjustLevel(level,0,1),t=0;t<level.width;++t)for(var n=0;n<level.height-1;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r-t))}}function removeLeftColumn(){if(!(level.width<=1))for(var e=adjustLevel(level,-1,0),t=0;t<level.width;++t)for(var n=0;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r+level.height))}}function removeRightColumn(){if(!(level.width<=1))for(var e=adjustLevel(level,-1,0),t=0;t<level.width;++t)for(var n=0;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r))}}function removeTopRow(){if(!(level.height<=1))for(var e=adjustLevel(level,0,-1),t=0;t<level.width;++t)for(var n=0;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r+t+1))}}function removeBottomRow(){if(!(level.height<=1))for(var e=adjustLevel(level,0,-1),t=0;t<level.width;++t)for(var n=0;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r+t))}}function matchGlyph(e,t){for(var n,r=-1,o=0;o<t.length;++o){var i=t[o][0],a=t[o][1],l=t[o][2];if(a.bitsSetInArray(e.data)){for(var s=0,c=0;c<32*STRIDE_OBJ;++c)l.get(c)&&e.get(c)&&s++,a.get(c)&&e.get(c)&&s++;s>r&&(r=s,n=i)}}return r>0?n:(logErrorNoLine("Wasn't able to approximate a glyph value for some tiles, using '.' as a placeholder.",!0),".")}var lastCoord,htmlEntityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},selectableint=0;function printLevel(){var e=[];for(var t in state.glyphDict)if(state.glyphDict.hasOwnProperty(t)&&1===t.length){for(var n=state.glyphDict[t],r=new BitVec(STRIDE_OBJ),o=0;o<n.length;o++){var i=n[o];i>=0&&r.ibitset(i)}var a=r.clone(),l=state.layerMasks[state.backgroundlayer];r.iclear(l),e.push([t,r,a])}var s="selectable"+ ++selectableint,c='Printing level contents:<br><br><span id="'+s+'" onclick="selectText(\''+s+"',event)\"><br>";cache_console_messages=!1;for(var u=0;u<level.height;u++){for(o=0;o<level.width;o++){var d=u+o*level.height;(n=matchGlyph(level.getCell(d),e))in htmlEntityMap&&(n=htmlEntityMap[n]),c+=n}u<level.height-1&&(c+="<br>")}consolePrint(c+="</span><br><br>",!0)}function levelEditorClick(e,t){if(mouseCoordY<=-2){var n=mouseCoordX+(screenwidth-1)*(editorRowCount-(-mouseCoordY-2)-1);-1===mouseCoordX?printLevel():mouseCoordX>=0&&n<glyphImages.length&&(glyphSelectedIndex=n,redraw())}else if(mouseCoordX>-1&&mouseCoordY>-1&&mouseCoordX<screenwidth-2&&mouseCoordY<screenheight-2-editorRowCount){for(var r=glyphImagesCorrespondance[glyphSelectedIndex],o=state.glyphDict[r],i=new BitVec(STRIDE_OBJ),a=0;a<o.length;a++){var l=o[a];l>=0&&i.ibitset(l)}var s=state.layerMasks[state.backgroundlayer];i.bitsClearInArray(s.data)&&i.ibitset(state.backgroundid);var c=mouseCoordY+mouseCoordX*level.height;if(level.getCell(c).equals(i))return;!1===anyEditsSinceMouseDown&&(anyEditsSinceMouseDown=!0,backups.push(backupLevel())),level.setCell(c,i),redraw()}else t&&(-1===mouseCoordX?(addLeftColumn(),canvasResize()):mouseCoordX===screenwidth-2&&(addRightColumn(),canvasResize()),-1===mouseCoordY?(addTopRow(),canvasResize()):mouseCoordY===screenheight-2-editorRowCount&&(addBottomRow(),canvasResize()))}function levelEditorRightClick(e,t){if(-2===mouseCoordY)mouseCoordX<=glyphImages.length&&(glyphSelectedIndex=mouseCoordX,redraw());else if(mouseCoordX>-1&&mouseCoordY>-1&&mouseCoordX<screenwidth-2&&mouseCoordY<screenheight-2-editorRowCount){var n=mouseCoordY+mouseCoordX*level.height,r=new BitVec(STRIDE_OBJ);r.ibitset(state.backgroundid),level.setCell(n,r),redraw()}else t&&(-1===mouseCoordX?(removeLeftColumn(),canvasResize()):mouseCoordX===screenwidth-2&&(removeRightColumn(),canvasResize()),-1===mouseCoordY?(removeTopRow(),canvasResize()):mouseCoordY===screenheight-2-editorRowCount&&(removeBottomRow(),canvasResize()))}function getTilesTraversingPoints(e,t,n,r){if(cellwidth!==cellheight)throw"Error: Cell is not square.";var o=n-e,i=r-t,a=e*i-t*o,l=cellwidth*(Math.abs(o)+Math.abs(i)),s=2*a-l,c=2*a+l;for(var u=Math.floor(e/cellwidth),d=Math.floor(t/cellheight),h=Math.floor(n/cellwidth),f=Math.floor(r/cellheight),p=cellwidth-1,g=h-u>=0?1:-1,m=f-d>=0?1:-1,v=d,y=[],_=[],b=u;b!=h+g;b+=g)for(var w=!1,x=v;x!=f+m;x+=m){if(x>=level.height||x<0||b>=level.width||b<0)throw error="Mouse input loop failed; it:"+b+" "+x+" cell1:"+u+" "+d+" cell2:"+h+" "+f,console.log(error),error;if(fOfPointTimesTwo=i*(2*b*cellwidth+p)-o*(2*x*cellwidth+p),s<fOfPointTimesTwo==fOfPointTimesTwo<=c)y.push(b),_.push(x),w=!0,v=x;else if(w)break}for(var S=("mouse_obstacle"in state.metadata),k=[u],C=[d];u!==h||d!==f;){if(d>=level.height||d<0||u>=level.width||u<0)throw error="Mouse input loop failed; cell1:"+u+" "+d+" cell2:"+h+" "+f,console.log(error),error;if(hitObstacle=function(){var e=screenOffsetY+d+(screenOffsetX+u)*level.height,t=level.getCell(e);return!!state.obstacleMask.anyBitsInCommon(t)},cellCornerXTimesTwo=2*u*cellwidth+p+g*cellwidth,cellCornerYTimesTwo=2*d*cellwidth+p+m*cellwidth,fOfPointTimesTwo=i*cellCornerXTimesTwo-o*cellCornerYTimesTwo,fOfPointTimesTwo>2*a==m>0!=g>0?(u+=g,S&&hitObstacle()&&(u-=g,d+=m)):(d+=m,S&&hitObstacle()&&(d-=m,u+=g)),S&&hitObstacle())break;k.push(u),C.push(d)}if(S)y=k,_=C;else for(b=0;b<y.length;b++)if(y[b]!==k[b]||_[b]!==C[b]){try{displayError("line tile placement algorithm discrepancies detected")}catch(e){}throw consolePrint("line tile placement algorithm discrepancies detected",!0),"line tile placement algorithm discrepancies detected"}return{tileListX:y,tileListY:_}}var x1=5,y1=5,x2=5,y2=5;function mouseAction(e,t,n){if(textMode){if(!t){if(quittingTitleScreen)return;return void(hoverSelection=!mouseInCanvas||mouseCoordY<0||mouseCoordY>15?-1:mouseCoordY)}if(titleScreen){if(quittingTitleScreen||titleSelected)return;if(0===titleMode)titleButtonSelected();else if(1===titleMode)8===mouseCoordY&&titleSelectOptions>=1?(titleSelection=0,titleButtonSelected()):9===mouseCoordY&&titleSelectOptions>=3?(titleSelection=1,titleButtonSelected()):10===mouseCoordY&&titleSelectOptions>=2?(titleSelection=2===titleSelectOptions?1:2,titleButtonSelected()):11===mouseCoordY&&titleSelectOptions>=4&&(titleSelection=3,titleButtonSelected());else if(2===titleMode){if(quittingTitleScreen||titleSelected)return;if(0===mouseCoordY)titleSelection=0,goToTitleScreen(),tryPlayTitleSound(),canvasResize();else if(2===mouseCoordY)0!=levelSelectScrollPos&&levelSelectScroll(-3);else if(12===mouseCoordY)titleSelectOptions-amountOfLevelsOnScreen>levelSelectScrollPos&&levelSelectScroll(3);else{var r=-1;switch(mouseCoordY){case 3:r=0;break;case 4:r=1;break;case 5:r=2;break;case 6:r=3;break;case 7:r=4;break;case 8:r=5;break;case 9:r=6;break;case 10:r=7;break;case 11:r=8}-1!=r&&(r+=levelSelectScrollPos)<titleSelectOptions&&(titleSelection=r,titleSelected=!0,messageselected=!1,timer=0,quittingTitleScreen=!0,generateLevelSelectScreen())}}else if(3===titleMode){if(quittingTitleScreen||titleSelected)return;0===mouseCoordY&&(titleSelection=0,goToTitleScreen(),tryPlayTitleSound(),canvasResize())}else 4===titleMode&&generateTitleScreen()}else!1===messageselected&&state.levels[curlevel].message&&(messageselected=!0,timer=0,quittingMessageScreen=!0,tryPlayCloseMessageSound(),titleScreen=!1,drawMessageScreen())}else{if(winning)return;if(x1=x2,y1=y2,x2=mousePixelX,y2=mousePixelY,x2=Math.max(0,Math.min(cellwidth*screenwidth-1,mousePixelX)),y2=Math.max(0,Math.min(cellheight*screenheight-1,mousePixelY)),t){if(mouseCoordX>=0&&mouseCoordY>=0&&mouseCoordX<screenwidth&&mouseCoordY<screenheight){s=screenOffsetY+mouseCoordY+(screenOffsetX+mouseCoordX)*level.height;if(lastCoord=s,againing);else try{d=backupLevel();(c=level.getCell(s)).ibitset(n),level.setCell(s,c),pushInput(u=5),processInput(u,!1,!1,d)&&redraw()}catch(e){console.log(e),consolePrint(e,!0)}}}else for(var o=getTilesTraversingPoints(x1,y1,x2,y2),i=o.tileListX,a=o.tileListY,l=0;l<i.length;l++){var s=screenOffsetY+a[l]+(screenOffsetX+i[l])*level.height;if(lastCoord!==s)if(lastCoord=s,againing);else try{var c,u,d=backupLevel();(c=level.getCell(s)).ibitset(n),level.setCell(s,c),pushInput(u=5),processInput(u,!1,!1,d)&&redraw()}catch(e){console.log(e),consolePrint(e,!0)}}}}var anyEditsSinceMouseDown=!1;function onMouseDown(e,t=!1){if(!e.handled){ULBS();var n=0===e.button;e.button;if("touchstart"==e.type&&(n=!0),n&&(e.ctrlKey||e.metaKey)&&(n=!1,!0),n){if(lastDownTarget=e.target,keybuffer=[],e.target===canvas||"tapFocusIndicator"===e.target.className){if(setMouseCoord(e),dragging=!0,rightdragging=!1,anyEditsSinceMouseDown=!1,levelEditorOpened&&!textMode)return levelEditorClick(e,!0);if("mouse_left"in state.metadata)return t&&prevent(e),mouseAction(e,!0,state.lmbID)}dragging=!1,rightdragging=!1}else if(2===e.button||0===e.button&&(e.ctrlKey||e.metaKey))if("gameCanvas"===e.target.id){if(setMouseCoord(e),dragging=!1,rightdragging=!0,levelEditorOpened)return levelEditorRightClick(e,!0);if("mouse_right"in state.metadata)return mouseAction(e,!0,state.rmbID)}else dragging=!1,rightdragging=!1;else 1===e.button&&!1===textMode&&levelEditorOpened&&(pushInput("undo"),DoUndo(!1,!0),canvasResize());e.handled=!0}}function rightClickCanvas(e){return"mouse_right"in state.metadata||levelEditorOpened?prevent(e):void 0}function onMouseUp(e,t=!1){if(!e.handled){if(dragging=!1,rightdragging=!1,0===e.button){if(e.target===canvas&&(setMouseCoord(e),"mouse_up"in state.metadata))return t&&prevent(e),mouseAction(e,!0,state.lmbupID)}else if(2===e.button&&"gameCanvas"===e.target.id&&(setMouseCoord(e),"mouse_rup"in state.metadata))return mouseAction(e,!0,state.rmbupID);e.handled=!0}}function onKeyDown(e){ULBS(),e=e||window.event,!IDE&&[32,37,38,39,40].indexOf(e.keyCode)>-1&&(e&&(e.ctrlKey||e.metaKey)||prevent(e)),IDE||77!==e.keyCode||toggleMute(),keybuffer.indexOf(e.keyCode)>=0||((lastDownTarget===canvas||window.Mobile&&lastDownTarget===window.Mobile.focusIndicator)&&-1===keybuffer.indexOf(e.keyCode)&&(e&&(e.ctrlKey||e.metaKey)||(keybuffer.splice(keyRepeatIndex,0,e.keyCode),keyRepeatTimer=0,checkKey(e,!e.repeat))),!0===canDump&&(74===e.keyCode&&(e.ctrlKey||e.metaKey)?(dumpTestCase(),prevent(e)):75===e.keyCode&&(e.ctrlKey||e.metaKey)?(makeGIF(),prevent(e)):83===e.keyCode&&(e.ctrlKey||e.metaKey)?(saveClick(),prevent(e)):66===e.keyCode&&(e.ctrlKey||e.metaKey)?(rebuildClick(),prevent(e),e.target.blur(),canvas.focus()):82===e.keyCode&&(e.ctrlKey||e.metaKey)?(runClick(),prevent(e),e.target.blur(),canvas.focus()):120===e.keyCode?(prevent(e),solve()):119===e.keyCode?(prevent(e),stopSolving()):13===e.keyCode&&(e.ctrlKey||e.metaKey)&&(canvas.focus(),editor.display.input.blur(),e.shiftKey?runClick():rebuildClick(),prevent(e))))}function relMouseCoords(e){var t=0,n=0,r=0,o=0,i=this;do{t+=i.offsetLeft-i.scrollLeft,n+=i.offsetTop-i.scrollTop}while(i=i.offsetParent);return null==e.touches?(r=e.pageX-t,o=e.pageY-n):(r=e.touches[0].pageX-t,o=e.touches[0].pageY-n),{x:r,y:o}}function onKeyUp(e){e=e||window.event;var t=keybuffer.indexOf(e.keyCode);t>=0&&(keybuffer.splice(t,1),keyRepeatIndex>=t&&keyRepeatIndex--)}function onMyFocus(e){keybuffer=[],keyRepeatIndex=0,keyRepeatTimer=0}function onMyBlur(e){keybuffer=[],keyRepeatIndex=0,keyRepeatTimer=0}HTMLCanvasElement.prototype.relMouseCoords=relMouseCoords;var mouseCoordX=0,mouseCoordY=0,mousePixelX=0,mousePixelY=0;function setMouseCoord(e){var t=canvas.relMouseCoords(e);(isNaN(t.x)||isNaN(t.y))&&console.warn("[SetMouseCoord] Did not recieve valid mouse coords from event. Ignoring it (since I'm assuming this is a faked keypress that was generated on mobile)."),mousePixelX=t.x-xoffset,mousePixelY=t.y-yoffset,mouseCoordX=Math.floor(mousePixelX/cellwidth),mouseCoordY=Math.floor(mousePixelY/cellheight)}function mouseMove(e){if(!e.handled){if(levelEditorOpened)setMouseCoord(e),dragging?levelEditorClick(e,!1):rightdragging&&levelEditorRightClick(e,!1),redraw();else if(titleScreen&&IsMouseGameInputEnabled()){var t=hoverSelection;setMouseCoord(e),mouseAction(e,!1,null),t!=hoverSelection&&(1==titleMode?(generateTitleScreen(),redraw()):2==titleMode?(generateLevelSelectScreen(),redraw()):3==titleMode&&(generateCreditsScreen(),redraw()))}else dragging&&"mouse_drag"in state.metadata?(setMouseCoord(e),mouseAction(e,!1,state.dragID),redraw()):rightdragging&&"mouse_rdrag"in state.metadata&&(setMouseCoord(e),mouseAction(e,!1,state.rdragID),redraw());e.handled=!0}}function onMouseIn(){mouseInCanvas=!0}function onMouseOut(){mouseInCanvas=!1}function onTouchDown(e){onMouseDown(e,!0)}function onTouchUp(e){onMouseUp(e,!0)}function onMouseWheel(e){mouseInCanvas&&!e.ctrlKey&&(normalizedDelta=Math.sign(e.deltaY),titleScreen&&2==titleMode&&IsMouseGameInputEnabled()&&(levelSelectScroll(normalizedDelta),redraw(),prevent(e)),levelEditorOpened&&(glyphSelectedIndex=clamp(glyphSelectedIndex+normalizedDelta,0,glyphCount()-1),redraw(),prevent(e)))}function levelSelectScroll(e){levelSelectScrollPos=clamp(levelSelectScrollPos+e,0,Math.max(state.sections.length-amountOfLevelsOnScreen,0)),titleSelection=clamp(titleSelection+e,0,state.sections.length-1),generateLevelSelectScreen()}function clamp(e,t,n){return Math.min(Math.max(e,t),n)}function prevent(e){return e.preventDefault&&e.preventDefault(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.stopPropagation&&e.stopPropagation(),e.returnValue=!1,!1}function titleButtonSelected(){!1===titleSelected&&(tryPlayStartGameSound(),titleSelected=!0,messageselected=!1,timer=0,quittingTitleScreen=!0,generateTitleScreen(),canvasResize(),document.dispatchEvent(new Event("psplusGameStarted")))}mouseInCanvas=!1,document.addEventListener("touchstart",onTouchDown,{passive:!1}),document.addEventListener("touchmove",mouseMove,!1),document.addEventListener("touchend",onTouchUp,{passive:!1}),document.addEventListener("mousedown",onMouseDown,!1),document.addEventListener("mouseup",onMouseUp,!1),document.addEventListener("mousemove",mouseMove,!1),document.addEventListener("contextmenu",rightClickCanvas,!1),document.addEventListener("keydown",onKeyDown,!1),document.addEventListener("keyup",onKeyUp,!1),document.addEventListener("wheel",onMouseWheel,{passive:!1}),window.addEventListener("focus",onMyFocus,!1),window.addEventListener("blur",onMyBlur,!1),canvas.addEventListener("mouseenter",onMouseIn,!1),canvas.addEventListener("mouseleave",onMouseOut,!1);var gamepadKeys=[];function pollGamepads(){function e(e,t){return!(e.length<t)&&("object"==typeof e[t]?e[t].pressed:1==e[t])}function t(e,t,n){return!(e.length<t)&&e[t]*n>.5}var n=[];function r(e){-1===keybuffer.indexOf(e)&&(keybuffer.splice(keyRepeatIndex,0,e),keyRepeatTimer=0,checkKey({keyCode:e},!0)),n.splice(0,0,e)}function o(){for(var e=0;e<gamepadKeys.length;e++)if(!(n.indexOf(gamepadKeys[e])>=0)){var t=keybuffer.indexOf(gamepadKeys[e]);t>=0&&(keybuffer.splice(t,1),keyRepeatIndex>=t&&keyRepeatIndex--)}gamepadKeys=n}var i=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];if(null!=i&&0!=i.length){for(var a=0;a<i.length;a++){var l=i[a];null!=l&&l.connected&&((e(l.buttons,3)||e(l.buttons,4))&&r(82),(e(l.buttons,1)||t(l.axes,2,1))&&r(90),(e(l.buttons,2)||e(l.buttons,0)||e(l.buttons,5)||t(l.axes,1,1))&&r(88),e(l.buttons,7)&&r(27),e(l.buttons,6)&&r(69),(t(l.axes,0,1)||t(l.axes,6,1))&&r(39),(t(l.axes,0,-1)||t(l.axes,6,-1))&&r(37),(t(l.axes,1,-1)||t(l.axes,7,-1))&&r(38),(t(l.axes,1,1)||t(l.axes,7,1))&&r(40))}o()}else o()}function checkKey(e,t){if(ULBS(),!(winning||e&&(e.ctrlKey||e.metaKey||e.altKey))){var n=-1;switch(e.keyCode){case 65:case 37:n=1;break;case 38:case 87:n=0;break;case 68:case 39:n=3;break;case 83:case 40:n=2;break;case 80:printLevel();break;case 13:case 32:case 67:case 88:if(t&&ignoreNotJustPressedAction&&(ignoreNotJustPressedAction=!1),!1===t&&ignoreNotJustPressedAction)return;if(!1!==norepeat_action&&!t)return;n=4;break;case 85:case 90:if(!1===textMode)return pushInput("undo"),DoUndo(!1,!0),canvasResize(),prevent(e);break;case 82:if(!1===textMode&&t)return pushInput("restart"),DoRestart(),canvasResize(),prevent(e);break;case 27:if(solving){stopSolving();break}if(!1===titleScreen||titleMode>1)return(timer/1e3>.5||titleMode>1)&&!quittingTitleScreen&&(titleSelection=0,timer=0,!1===titleScreen&&void 0!==state.metadata.level_select?gotoLevelSelectScreen():goToTitleScreen(),tryPlayTitleSound(),canvasResize()),prevent(e);break;case 69:if(!solving&&canOpenEditor)return t&&(titleScreen&&("EMPTY GAME"===state.title?compile(["loadFirstNonMessageLevel"]):nextLevel()),!1===(levelEditorOpened=!levelEditorOpened)&&printLevel(),restartTarget=backupLevel(),canvasResize()),prevent(e);break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:if(levelEditorOpened&&t){var r=9;return e.keyCode>=49&&(r=e.keyCode-49),r<glyphImages.length?glyphSelectedIndex=r:consolePrint("Trying to select tile outside of range in level editor.",!0),canvasResize(),prevent(e)}break;case 189:if(levelEditorOpened&&t&&glyphSelectedIndex>0)return glyphSelectedIndex--,canvasResize(),prevent(e);break;case 187:if(levelEditorOpened&&t&&glyphSelectedIndex+1<glyphImages.length)return glyphSelectedIndex++,canvasResize(),prevent(e)}if(throttle_movement&&n>=0&&n<=3){if(lastinput==n&&input_throttle_timer<repeatinterval)return;lastinput=n,input_throttle_timer=0}if(textMode);else if(!againing&&n>=0)return 4===n&&"noaction"in state.metadata||(pushInput(n),processInput(n)&&redraw()),prevent(e)}}function update(){var e=!1;if(timer+=deltatime,tweentimer+=deltatime,input_throttle_timer+=deltatime,quittingTitleScreen&&(2==titleMode?(quittingTitleScreen=!1,gotoLevel(titleSelection)):timer/1e3>.3&&(quittingTitleScreen=!1,titleMode<=1&&nextLevel())),againing&&timer>againinterval&&0==messagetext.length&&processInput(-1)&&(e=!0,keyRepeatTimer=0,autotick=0),quittingMessageScreen&&timer/1e3>.15&&(quittingMessageScreen=!1,""===messagetext?nextLevel():(messagetext="",textMode=!1,titleScreen=!1,titleMode=curlevel>0||null!==curlevelTarget?1:0,titleSelected=!1,ignoreNotJustPressedAction=!0,titleSelection=0,canvasResize(),checkWin())),winning&&timer/1e3>.5&&(winning=!1,nextLevel()),pollGamepads(),keybuffer.length>0){keyRepeatTimer+=deltatime;var t=throttle_movement?repeatinterval:repeatinterval/Math.sqrt(keybuffer.length);if(keyRepeatTimer>t)keyRepeatTimer=0,keyRepeatIndex=(keyRepeatIndex+1)%keybuffer.length,checkKey({keyCode:keybuffer[keyRepeatIndex]},!1)}!(autotickinterval>0)||textMode||levelEditorOpened||againing||winning||(autotick+=deltatime)>autotickinterval&&(autotick=0,pushInput("tick"),processInput(-1)&&(e=!0)),(e||void 0!==state&&(void 0!==state.metadata.smoothscreen||void 0!==state.metadata.tween_length))&&redraw()}var looping=!1,loop=function(){looping=!0;try{update()}catch(e){console.error(e)}"hidden"!==document.visibilityState?setTimeout(loop,deltatime):looping=!1};function Animatable(e,t,n){var r;function o(){var e;return(r+=t)>=1&&(e=!0,r=1),n(r),e}function i(){var e;return(r-=t)<=0&&(e=!0,r=0),n(r),e}return r=0,{animateUp:function(){Animator.getInstance().animate(e,o)},animateDown:function(){Animator.getInstance().animate(e,i)}}}document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&!1===looping&&loop()})),loop(),window.Mobile={},Mobile.hasTouch=function(){var e;return("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)&&(e=!0),e},Mobile.enable=function(e){return(e||Mobile.hasTouch()&&!Mobile._instance)&&(Mobile._instance=new Mobile.GestureHandler,Mobile._instance.bindEvents(),Mobile._instance.bootstrap()),Mobile._instance},window.Mobile.GestureHandler=function(){this.initialize.apply(this,arguments)},Mobile.log=function(e){document.getElementsByTagName("h1")[0].innerHTML=Math.random().toString().substring(4,1)+"-"+e},Mobile.debugDot=function(e){var t,n;n="border-radius: 50px;width: 5px;height: 5px;background: red;position: absolute;left: "+e.touches[0].clientX+"px;top: "+e.touches[0].clientY+"px;",(t=document.createElement("div")).setAttribute("style",n),document.getElementsByTagName("body")[0].appendChild(t)},function(e){"use strict";var t={action:88,left:37,right:39,up:38,down:40,undo:85,restart:82,quit:27},n=['<div class="tab">','  <div class="tab-affordance"></div>','  <div class="tab-icon">','    <div class="slice"></div>','    <div class="slice"></div>',"  </div>","</div>"].join("\n");e.initialize=function(){this.firstPos={x:0,y:0},this.setTabAnimationRatio=this.setTabAnimationRatio.bind(this),this.setMenuAnimationRatio=this.setMenuAnimationRatio.bind(this),this.repeatTick=this.repeatTick.bind(this),this.isFocused=!0},e.setFocusElement=function(e){this.focusElement=e,this.isFocused=!1,this.buildFocusIndicator()},e.bindEvents=function(){window.addEventListener("touchstart",this.onTouchStart.bind(this)),window.addEventListener("touchend",this.onTouchEnd.bind(this)),window.addEventListener("touchmove",this.onTouchMove.bind(this))},e.bootstrap=function(){this.showTab(),this.disableScrolling(),this.isAudioSupported()||this.disableAudio(),this.disableSelection()},e.onTouchStart=function(e){this.isTouching||(this.handleFocusChange(e),this.isFocused&&"A"!==e.target.tagName.toUpperCase()&&(this.isTouching=!0,this.mayBeSwiping=!0,this.gestured=!1,this.swipeDirection=void 0,this.swipeDistance=0,this.startTime=(new Date).getTime(),this.firstPos.x=e.touches[0].clientX,this.firstPos.y=e.touches[0].clientY))},e.onTouchEnd=function(e){this.isFocused&&this.isTouching&&(this.gestured||0===e.touches.length&&"unMuteButton"!==e.target.id&&"muteButton"!==e.target.id&&this.handleTap(),0===e.touches.length&&(this.isTouching=!1,this.endRepeatWatcher()))},e.onTouchMove=function(e){if(this.isFocused&&!levelEditorOpened)return this.isSuccessfulSwipe()?(this.handleSwipe(this.swipeDirection,this.touchCount),this.gestured=!0,this.mayBeSwiping=!1,this.beginRepeatWatcher(e)):this.mayBeSwiping?this.swipeStep(e):this.isRepeating&&this.repeatStep(e),prevent(e),!1},e.handleFocusChange=function(e){this.focusElement&&(this.isFocused=this.isTouchInsideFocusElement(e),this.setFocusIndicatorVisibility(this.isFocused),canvas.focus(),editor.display.input.blur())},e.isTouchInsideFocusElement=function(e){var t;return!(!e.touches||!e.touches[0])&&(t=this.absoluteElementPosition(this.focusElement),!(e.touches[0].clientX<t.left||e.touches[0].clientY<t.top)&&!(e.touches[0].clientX>t.left+this.focusElement.clientWidth||e.touches[0].clientY>t.top+this.focusElement.clientHeight))},e.setFocusIndicatorVisibility=function(e){},e.absoluteElementPosition=function(e){var t,n;for(t={top:e.offsetTop||0,left:e.offsetLeft||0},n=document.getElementsByTagName("body")[0],t.top-=n.scrollTop||0;e=e.offsetParent;)t.top+=e.offsetTop||0,t.left+=e.offsetLeft||0;return t},e.beginRepeatWatcher=function(e){var t;this.repeatInterval||(this.isRepeating=!0,t=1e3*state.metadata.key_repeat_interval,!isNaN(t)&&t||(t=150),this.repeatInterval=setInterval(this.repeatTick,t),this.recenter(e))},e.endRepeatWatcher=function(){this.repeatInterval&&(clearInterval(this.repeatInterval),delete this.repeatInterval,this.isRepeating=!1)},e.repeatTick=function(){this.isTouching&&this.handleSwipe(this.direction,this.touchCount)},e.recenter=function(e){this.firstPos.x=e.touches[0].clientX,this.firstPos.y=e.touches[0].clientY},e.isSuccessfulSwipe=function(){var e;return this.mayBeSwiping&&void 0!==this.swipeDirection&&this.swipeDistance>=50&&(e=!0),e},e.swipeStep=function(e){var t,n,r;this.mayBeSwiping&&(t={x:e.touches[0].clientX,y:e.touches[0].clientY},n=(new Date).getTime(),r=e.touches.length,this.swipeDistance=this.cardinalDistance(this.firstPos,t),this.swipeDirection?n-this.startTime>1e3&&(this.mayBeSwiping=!1):this.swipeDistance>10&&(this.swipeDirection=this.dominantDirection(this.firstPos,t),this.touchCount=r))},e.repeatStep=function(e){var t;t={x:e.touches[0].clientX,y:e.touches[0].clientY},this.cardinalDistance(this.firstPos,t)>=50&&(this.swipeDirection=this.dominantDirection(this.firstPos,t),this.recenter(e))},e.cardinalDistance=function(e,t){var n,r;return n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y),Math.max(n,r)},e.dominantDirection=function(e,t){var n,r,o;return n=t.x-e.x,r=t.y-e.y,o="x",Math.abs(r)>Math.abs(n)&&(o="y"),"x"===o?n>0?"right":"left":r>0?"down":"up"},e.handleSwipe=function(e,t){IsMouseGameInputEnabled()||(1===t?this.emitKeydown(this.swipeDirection):t>1&&this.toggleMenu())},e.handleTap=function(){IsMouseGameInputEnabled()||this.emitKeydown("action")},e.emitKeydown=function(e){var n;(this.isMenuVisible||"undo"!=e&&"restart"!=e&&"quit"!=e)&&(n={keyCode:t[e]},this.fakeCanvasFocus(),onKeyDown(n),onKeyUp(n))},e.fakeCanvasFocus=function(){onMouseDown({button:0,target:document.getElementById("gameCanvas")})},e.toggleMenu=function(){this.isMenuVisible?this.hideMenu():this.showMenu()},e.showMenu=function(){this.menuElem||this.buildMenu(),this.getAnimatables().menu.animateUp(),this.isMenuVisible=!0,this.hideTab()},e.hideMenu=function(){this.menuElem&&this.getAnimatables().menu.animateDown(),this.isMenuVisible=!1,this.showTab()},e.getAnimatables=function(){return this._animatables||(this._animatables={tab:Animatable("tab",.1,this.setTabAnimationRatio),menu:Animatable("menu",.1,this.setMenuAnimationRatio)}),this._animatables},e.showTab=function(){this.tabElem||this.buildTab(),this.getAnimatables().tab.animateDown()},e.hideTab=function(){this.tabElem&&this.tabElem.setAttribute("style","display: none;"),this.getAnimatables().tab.animateUp()},e.buildTab=function(){var e,t,r,o=this;(e=document.createElement("div")).innerHTML=n,r=e.children[0],t=function(e){e.stopPropagation(),o.showMenu()},this.tabAffordance=r.getElementsByClassName("tab-affordance")[0],this.tabElem=r.getElementsByClassName("tab-icon")[0],this.tabAffordance.addEventListener("touchstart",t),this.tabAffordance.addEventListener("click",(e=>{})),this.tabElem.addEventListener("touchstart",t),this.tabElem.addEventListener("click",(e=>{})),document.getElementsByTagName("body")[0].appendChild(r)},e.buildMenu=function(){var e,t,n,r,o,i,a=this;(e=document.createElement("div")).innerHTML=this.buildMenuString(state),this.menuElem=e.children[0],this.closeElem=this.menuElem.getElementsByClassName("close")[0],i=function(e){e.stopPropagation(),a.hideMenu()},this.closeAffordance=this.menuElem.getElementsByClassName("close-affordance")[0],o=this.menuElem.getElementsByClassName("close")[0],this.closeAffordance.addEventListener("touchstart",i),this.closeAffordance.addEventListener("click",(e=>{})),o.addEventListener("touchstart",i),o.addEventListener("click",(e=>{})),(t=this.menuElem.getElementsByClassName("undo")[0])&&(t.addEventListener("touchstart",(function(e){e.stopPropagation(),a.emitKeydown("undo")})),t.addEventListener("click",(e=>{}))),(n=this.menuElem.getElementsByClassName("restart")[0])&&(n.addEventListener("touchstart",(function(e){e.stopPropagation(),a.emitKeydown("restart")})),n.addEventListener("click",(e=>{}))),(r=this.menuElem.getElementsByClassName("quit")[0]).addEventListener("touchstart",(function(e){e.stopPropagation(),a.emitKeydown("quit")})),r.addEventListener("click",(e=>{})),document.getElementsByTagName("body")[0].appendChild(this.menuElem)},e.buildMenuString=function(e){var t,n,r,o;return t=3,(r=e.metadata.noundo)&&(t-=1),(o=e.metadata.norestart)&&(t-=1),n=['<div class="mobile-menu item-count-'+t+'">','  <div class="close-affordance"></div>','  <div class="close">','    <div class="slice"></div>','    <div class="slice"></div>',"  </div>"],r||n.push('  <div class="undo button">Undo</div>'),o||n.push('  <div class="restart button">Restart</div>'),(n=n.concat(['  <div class="quit button">Quit to Menu</div>','  <div class="clear"></div>',"</div>"])).join("\n")},e.buildFocusIndicator=function(){this.focusIndicator=document.createElement("DIV"),this.focusIndicator.setAttribute("class","tapFocusIndicator"),this.focusIndicator.setAttribute("style","visibility: hidden;"),this.focusElement.parentNode.appendChild(this.focusIndicator)},e.setTabAnimationRatio=function(e){var t;(e=Math.round(1e3*e)/1e3)>=.999?this.tabAffordance.setAttribute("style","display: none;"):this.tabAffordance.setAttribute("style","display: block;"),t="opacity: "+(1-e)+";"+" width: "+(66*e+18*(1-e))+"px;",this.tabElem.setAttribute("style",t)},e.setMenuAnimationRatio=function(e){var t,n,r;r="left: "+((t=-18*(e=Math.round(1e3*e)/1e3)+-66*(1-e))-4)+"px; "+(n="opacity: "+e+";")+" width: "+-t+"px;",(e=Math.round(1e3*e)/1e3)<=.001?(this.closeAffordance.setAttribute("style","display: none;"),n="display:none;"):this.closeAffordance.setAttribute("style","display: block;"),this.closeElem.setAttribute("style",r),this.menuElem.setAttribute("style",n)},e.disableScrolling=function(){var e={height:"100%",overflow:"hidden",position:"fixed",width:"100%"},t="";for(var n in e)t+=n+": "+e[n]+"; ";document.body.setAttribute("style",t)},e.disableAudio=function(){window.playSeed=function(){}},e.isAudioSupported=function(){var e=!0;return"undefined"!=typeof webkitAudioContext&&(e=!1),e},e.disableSelection=function(){var e;(e=document.getElementsByTagName("body")[0]).setAttribute("class",e.getAttribute("class")+" disable-select")}}(window.Mobile.GestureHandler.prototype),window.Animator=function(){this.initialize.apply(this,arguments)},function(e){e.initialize=function(){this._animations={},this.tick=this.tick.bind(this)},e.animate=function(e,t){this._animations[e]=t,this.wakeup()},e.wakeup=function(){this._isAnimating||(this._isAnimating=!0,this.tick())},e.tick=function(){var e,t,n;for(e in n=[],t=!0,this._animations){if(!this._animations.hasOwnProperty(e))return;this._animations[e]()?n.push(e):t=!1}if(t){for(0;0<n.length;n++)delete this._isAnimating[n[0]];this._isAnimating=!1}else requestAnimationFrame(this.tick)}}(window.Animator.prototype),window.Animator.getInstance=function(){return window.Animator._instance||(window.Animator._instance=new window.Animator),window.Animator._instance},function(){"use strict";var e,t,n=["ms","moz","webkit","o"];for(e=0;e<n.length&&!window.requestAnimationFrame;e++)window.requestAnimationFrame=window[n[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[e]+"CancelAnimationFrame"],window.cancelAnimationFrame||(window.cancelAnimationFrame=window[n[e]+"CancelRequestAnimationFrame"]);window.requestAnimationFrame||(t=0,window.requestAnimationFrame=function(e,n){var r,o,i;return r=(new Date).getTime(),o=Math.max(0,16-(r-t)),i=window.setTimeout((function(){e(r+o)}),o),t=r+o,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),Mobile.enable()}();var get_blob=function(){return self.Blob},standalone_HTML_String="",clientStandaloneRequest=new XMLHttpRequest;function buildStandalone(e){if(0!==standalone_HTML_String.length){var t=standalone_HTML_String.concat(""),n="PuzzleScript Game";void 0!==state.metadata.title&&(n=state.metadata.title);var r="auroriax.github.io/PuzzleScript";void 0!==state.metadata.homepage&&(r=state.metadata.homepage),"background_color"in state.metadata&&(t=t.replace(/black;\/\*Don\'t/g,state.bgcolor+";/*Don't")),"text_color"in state.metadata&&(t=t.replace(/lightblue;\/\*Don\'t/g,state.fgcolor+";/*Don't")),t=(t=t.replace(/__GAMETITLE__/g,n)).replace(/__HOMEPAGE__/g,r),e=e.replace(/\$/g,"$$$$"),t=t.replace(/__GAMEDAT__/g,e);var o=new(get_blob())([t],{type:"text/plain;charset=utf-8"});saveAs(o,n+".html")}else consolePrint("Can't export yet - still downloading html template.",!0,null,null)}clientStandaloneRequest.open("GET","standalone_inlined.txt"),clientStandaloneRequest.onreadystatechange=function(){4==clientStandaloneRequest.readyState&&(""===clientStandaloneRequest.responseText&&consolePrint("Couldn't find standalone template. Is there a connection problem to the internet?",!0,null,null),standalone_HTML_String=clientStandaloneRequest.responseText)},clientStandaloneRequest.send();var onLevelRestarted=new Event("levelRestarted"),RandomGen=new RNG,intro_template=["..................................","..................................","..................................","......Puzzle Script Terminal......","..............v 1.7+..............","..................................","..................................","..................................",".........insert cartridge.........","..................................","..................................","..................................",".................................."],sitelock_template=["..................................","..................................","..................................","......Puzzle Script Terminal......","..............v 1.7+..............","..................................","..................................","..................................",".....This game is sitelocked!.....","................................. ","................................  ","...............................   ","..............................    "],messagecontainer_template=["..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..........X to continue...........","..................................",".................................."],messagecontainer_template_mouse=["..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","........Ćľįćķ ťŏ ćŏńťįńūě.........","..................................",".................................."],titletemplate_firstgo=["..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..........>.start game.<..........","..................................",".................................."],titletemplate_firstgo_selected=["..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","+++++++++++.start game.++++++++++++","..................................",".................................."],titletemplate_empty=["..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................",".................................."],titletemplate_intro1=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆÆÆÆĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆ¥§¤Æ¢ŸŷųÆĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆŲűÆŧŦŢŒœÆĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆÆÆ†ÆÆÆÆĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆÆÆÆĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸĸæłĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro2=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆÆÆÆĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆ¥§¤Æ¢ŸŷųÆĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆŲűÆŧŦŢŒœÆĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆÆÆ†ÆÆÆÆĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆÆÆÆĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸĸæłĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro3=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆ¥§¤Æ¢Ÿ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆŲűÆŧŦŢ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆÆÆ†Æ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro4=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆ¥§","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆŲű","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæł","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro5=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro10=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro9=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸÆĸĸÆĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸĸĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸÆĸĸÆĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸÆÆĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro8=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸÆĸĸÆĸĳĸĸĸĸĸĸĸĸĸĸĸŁĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸĸĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸÆÆÆÆĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro7=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸĲĸĸĲĸĳĸĸĸĸĸĸĸĸĸĸĸŁĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸĸĸĸĸĸĳĸĸĸĸĸĸĸĸĸļĿĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸÆÆÆÆĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro6=["ĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĳĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĳĸĲĸĸĲĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀ","ĸĸĸĸĸĸĸĸĸĳĸĸĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸĸ","ĸĸĸĸĸĸĸĸĸĳĸÆÆÆÆĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĳĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],title_options=(titletemplate_intro5=["ĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĳĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĳĸĲĸĸĲĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸ","ĸĸĸĸĸĳĸĸĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋ","ĸĸĸĸĸĳĸÆÆÆÆĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®","ĸĸĸĸĸĸĳĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®","ĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro4=["ĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĳĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆ","ĸĳĸĲĸĸĲĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆÆ¥","ĸĳĸĸĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆÆÆ","ĸĳĸÆÆÆÆĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆ","ĸĸĳĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆ","ĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæł","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro3=["ĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆ","ĸĸĲĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆÆ¥§¤†¢","ĸĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆÆÆÆ†††","ÆÆÆĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆŲű†ŧ","ĸĸĸĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆ","ĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro2=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆÆÆÆÆ","ĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆÆ¥§¤†¢Ÿŷųø","ĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆÆÆÆ†††ÆÆÆÆ","ĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆŲű†ŧŦŢŒœ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆÆÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸĸĸæł","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro1=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆÆ¥§¤†¢ŸŷųøÆĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆÆÆÆ†††ÆÆÆÆÆĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆŲű†ŧŦŢŒœÆĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸĸĸæłĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],[[".............Continue.............",".............Continue.............",".............Ćŏńťįńūě.............","...........>.Continue.<..........."],["...........Level Select...........","...........Level Select...........","...........ĹěÝěľ Śěľěćť...........",".........>.Level Select.<.........."],[".............Settings.............",".............Settings.............",".............Settings.............","...........>.Settings.<..........."],[".............New Game.............",".............New Game.............",".............Ńěŵ Ġāñě.............","...........>.New Game.<..........."],[".............Credits..............",".............Credits..............",".............Ćřěďįťś..............","...........>.Credits.<............"]]),titleImage=[],titleWidth=titletemplate_empty[0].length,titleHeight=titletemplate_empty.length,textMode=!0,titleScreen=!0,titleMode=0,titleSelection=0,titleSelectOptions=3,titleSelected=!1,hoverSelection=-1;function showContinueOptionOnTitleScreen(){return(curlevel>0||null!==curlevelTarget)&&curlevel in state.levels}function unloadGame(){state=introstate,(level=new Level(0,5,5,2,null,null)).objects=new Int32Array(0),generateTitleScreen(),canvasResize(),redraw(),titleSelected=!0}function isContinueOptionSelected(){return void 0===state.metadata.continue_is_level_select&&0==titleSelection}function isNewGameOptionSelected(){return titleSelection==titleSelectOptions-2}function isLevelSelectOptionSelected(){return void 0!==state.metadata.level_select&&(void 0!==state.metadata.continue_is_level_select?0==titleSelection:1==titleSelection)}function delay(e){return new Promise((t=>setTimeout(t,e)))}function isCreditsOptionSelected(){return void 0!==state.metadata.credits&&titleSelection==titleSelectOptions-1}function playIntro9(){4===titleMode&&(titleImage=deepClone(titletemplate_intro9),delay(2e3).then((()=>playIntro8())))}function playIntro8(){4===titleMode&&(titleImage=deepClone(titletemplate_intro8),delay(1200).then((()=>playIntro7())))}function playIntro7(){4===titleMode&&(titleImage=deepClone(titletemplate_intro7),delay(1200).then((()=>playIntro6())))}function playIntro6(){4===titleMode&&(titleImage=deepClone(titletemplate_intro6),delay(250).then((()=>playIntro5())))}function playIntro5(){4===titleMode&&(titleImage=deepClone(titletemplate_intro5),delay(250).then((()=>playIntro4())))}function playIntro4(){4===titleMode&&(titleImage=deepClone(titletemplate_intro4),delay(250).then((()=>playIntro3())))}function playIntro3(){4===titleMode&&(titleImage=deepClone(titletemplate_intro3),delay(250).then((()=>playIntro2())))}function playIntro2(){4===titleMode&&(titleImage=deepClone(titletemplate_intro2),delay(250).then((()=>playIntro1())))}function playIntro1(){4===titleMode&&(titleImage=deepClone(titletemplate_intro1),delay(250).then((()=>generateTitleScreen())))}function generateTitleScreen(){if(new Howl({src:["resources/sampleMusic.mp3"]}).play(),tryLoadCustomFont(),titleMode=showContinueOptionOnTitleScreen()?1:0,0!==state.levels.length)if(isSitelocked())titleImage=sitelock_template;else{var e="\n\tĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆÆÆÆÆÆ\n\tĸĸĸĸĸŁŀĸÆÆ¥§¤†¢ŸŷųøÆ\n    ļĿĸŉŋÆÆÆÆ†††ÆÆÆÆÆ\n\tĸĸĸĸĸ€®®ÆÆÆŲű†ŧŦŢŒœÆ\n\tĸĸĸĸĸ®®®ÆÆÆÆÆÆÆÆÆÆÆÆ\n\tĸĸĸĸĸĸĸĸĸæłĸĸĸĸĸæłĸ";if(void 0!==state.metadata.title&&(e=state.metadata.title),0===titleMode)titleSelectOptions=2,titleImage=deepClone(titleSelected?titletemplate_firstgo_selected:titletemplate_firstgo);else{var t=[0];titleSelectOptions=2,void 0!==state.metadata.level_select&&void 0===state.metadata.continue_is_level_select&&(titleSelectOptions++,t.push(1)),void 0!==state.metadata.settings&&(titleSelectOptions++,t.push(2)),t.push(3),void 0!==state.metadata.credits&&(titleSelectOptions++,t.push(4)),titleImage=deepClone(titletemplate_empty);for(var n=0;n<titleSelectOptions;n++){var r=0,o=0;3==titleSelectOptions&&1==n&&(o=1);var i=8+n+o;titleSelection==n&&titleSelected&&(r=2),hoverSelection==i&&!titleSelected&&hoverSelection>=0&&(r=3),titleImage[i]=deepClone(title_options[t[n]][r])}}if(state.metadata.text_controls){for(n=0;n<titleImage.length;n++)titleImage[n]=titleImage[n].replace(/\./g," ");var a=wordwrap(state.metadata.text_controls,35,!0);a[0]&&(titleImage[10]=a[0]),a[1]&&(titleImage[11]=a[1]),a[2]&&(titleImage[12]=a[2])}else for(n=0;n<titleImage.length;n++)titleImage[n]=titleImage[n].replace(/\./g," ");var l=titleImage[0].length,s=wordwrap(e,titleImage[0].length);void 0!==state.metadata.author?s.length>3&&(s.splice(3),logWarning("Game title is too long to fit on screen, truncating to three lines.",void 0,!0)):s.length>6&&(s.splice(6),logWarning("Game title is too long to fit on screen, truncating to six lines.",void 0,!0));for(n=0;n<s.length;n++){var c=s[n],u=c.length,d=(l-u)/2|0,h=titleImage[1+n];titleImage[1+n]=h.slice(0,d)+c+h.slice(d+c.length)}if(void 0!==state.metadata.author){var f=wordwrap("by "+state.metadata.author,titleImage[0].length);f[0].length<titleImage[0].length&&(f[0]=" "+f[0]),f.length>3&&(f.splice(3),logWarning("Author list too long to fit on screen, truncating to three lines.",void 0,!0));for(n=0;n<f.length;n++){var p=f[n]+" ";p.length>l&&(p=p.slice(0,l));h=titleImage[3+n];titleImage[3+n]=h.slice(0,l-p.length)+p}}}else titleImage=intro_template}var levelSelectScrollPos=0;function gotoLevelSelectScreen(){if(void 0!==state.metadata.level_select){if(levelSelectScrollPos=0,titleSelected=!1,timer=0,quittingTitleScreen=!1,quittingMessageScreen=!1,messageselected=!1,titleMode=2,titleScreen=!0,textMode=!0,againing=!1,messagetext="",0==titleSelection)for(var e=0;e<state.sections.length;e++)if(state.sections[e].firstLevel>curlevel){titleSelection=Math.max(0,e-1);break}state.metadata=deepClone(state.default_metadata),twiddleMetadataExtras(),generateLevelSelectScreen(),redraw()}else goToTitleScreen()}function gotoCreditsScreen(){void 0!==state.metadata.credits?(levelSelectScrollPos=0,titleSelected=!1,timer=0,quittingTitleScreen=!1,quittingMessageScreen=!1,messageselected=!1,titleMode=3,titleScreen=!0,textMode=!0,againing=!1,messagetext="",twiddleMetadataExtras(),generateCreditsScreen(),redraw()):goToTitleScreen()}function generateCreditsScreen(){titleImage=[" [ ESC: Back ]                    ","              Credits             ","                                  ","           Developed by:          ","                Joey Meffen       ","                Nick Birtch       ","                                  ","     A PuzzleScript Plus Game     "],0==hoverSelection&&(titleImage[0]="[  ESC: Back  ]                   ");for(var e=titleImage.length;e<13;e++)titleImage.push("                                  ");redraw()}function generateLevelSelectScreen(){titleImage=[" [ ESC: Back ]                    ","           Level Select           "],0==hoverSelection&&(titleImage[0]="[  ESC: Back  ]                   "),amountOfLevelsOnScreen=9,titleSelectOptions=state.sections.length,titleSelection<levelSelectScrollPos?levelSelectScrollPos=titleSelection:titleSelection>=levelSelectScrollPos+amountOfLevelsOnScreen&&(levelSelectScrollPos=titleSelection-amountOfLevelsOnScreen+1);var e=titleSelection-levelSelectScrollPos;0==e&&(levelSelectScrollPos=Math.max(0,levelSelectScrollPos-1)),e==amountOfLevelsOnScreen-1&&(levelSelectScrollPos=Math.min(state.sections.length-amountOfLevelsOnScreen,levelSelectScrollPos+1)),0!=levelSelectScrollPos?2==hoverSelection?titleImage.push("                        [  PREV  ]"):titleImage.push("                         [ PREV ] "):titleImage.push("                                  ");var t=-1;if(void 0!==state.metadata.level_select_lock){for(var n=0;n<state.sections.length;n++)solvedSections.indexOf(state.sections[n].name)>=0?t=n:0;void 0===state.metadata.level_select_unlocked_ahead?t+=1:void 0!==state.metadata.level_select_unlocked_rollover?t=solvedSections.length+Number(state.metadata.level_select_unlocked_rollover)-1:t+=Number(state.metadata.level_select_unlocked_ahead)}for(n=levelSelectScrollPos;n<levelSelectScrollPos+amountOfLevelsOnScreen&&!(n<0||n>=state.sections.length);n++){var r=state.sections[n],o=solvedSections.indexOf(r.name)>=0,i=n==titleSelection,a=t>=0&&n>t,l=r.name.substring(0,31);if(a){i&&titleSelected&&(titleSelected=!1,quittingTitleScreen=!1);var s=l.length;l="";for(var c=0;c<s;c++)l+="*"}var u="✓";void 0!==state.metadata.level_select_solve_symbol&&(u=state.metadata.level_select_solve_symbol);var d=(o?u:" ")+" ",h=" ";hoverSelection-3+levelSelectScrollPos==n&&(h=">"),i&&titleSelected&&(h=" "),d+=h+" "+l;for(c=l.length;c<32;c++)d+=" ";titleImage.push(d)}levelSelectScrollPos!=titleSelectOptions-amountOfLevelsOnScreen&&titleSelectOptions-amountOfLevelsOnScreen>0?12==hoverSelection?titleImage.push("                        [  NEXT  ]"):titleImage.push("                         [ NEXT ] "):titleImage.push("                                  ");for(n=titleImage.length;n<13;n++)titleImage.push("                                  ");redraw()}function gotoLevel(e){solving||e<0||(againing=!1,messagetext="",curlevel=state.sections[e].firstLevel,loadLevelFromStateOrTarget(),updateLocalStorage(),resetFlickDat(),canvasResize(),clearInputHistory())}var introstate={title:"EMPTY GAME",attribution:"increpare",objectCount:2,metadata:[],levels:[],bgcolor:"#000000",fgcolor:"#FFFFFF"},state=introstate;function deepClone(e){if(!e)return e;if([Number,String,Boolean].forEach((function(n){e instanceof n&&(t=n(e))})),void 0===t)if("[object Array]"===Object.prototype.toString.call(e))t=[],e.forEach((function(e,n,r){t[n]=deepClone(e)}));else if("object"==typeof e)if(e.nodeType&&"function"==typeof e.cloneNode)var t=e.cloneNode(!0);else if(e.prototype)t=e;else if(e instanceof Date)t=new Date(e);else for(var n in t={},e)t[n]=deepClone(e[n]);else t=e;return t}function wordwrap(e,t,n=!1){if(!e)return e;var r=".{1,"+(t=t||75)+"}(\\s|$)|.{"+t+"}|.+$";if(n){splitNewlines=e.split("\\n");var o=[];return splitNewlines.forEach((e=>{o=o.concat(e.match(RegExp(r,"g")))})),o}return e.match(RegExp(r,"g"))}var splitMessage=[];function drawMessageScreen(){if(tryLoadCustomFont(),titleMode=0,textMode=!0,"text_message_continue"in state.metadata){titleImage=deepClone(messagecontainer_template);for(var e=0;e<titleImage.length;e++)titleImage[e]=titleImage[e].replace(/\./g," ");titleImage[10]=state.metadata.text_message_continue}else{titleImage=IsMouseGameInputEnabled()?deepClone(messagecontainer_template_mouse):deepClone(messagecontainer_template);for(e=0;e<titleImage.length;e++)titleImage[e]=titleImage[e].replace(/\./g," ")}var t=titleImage[9],n=titleImage[10];titleImage[10]=t;var r,o=titleImage[0].length;""===messagetext?r=state.levels[curlevel].message.trim():r=messagetext;var i=5-((splitMessage=wordwrap(r,titleImage[0].length,!0)).length/2|0);i<0&&(i=0);var a=Math.min(splitMessage.length,12);for(e=0;e<a;e++)if(splitMessage[e]){var l=splitMessage[e].trimRight(),s=i+e,c=l.length,u=(o-c)/2|0;if(state.metadata.message_text_align){var d=state.metadata.message_text_align.toLowerCase();"left"==d?u=0:"right"==d&&(u=o-c)}var h=titleImage[s];titleImage[s]=h.slice(0,u)+l+h.slice(u+l.length)}var f=10;a>=10&&(f=a<12?a+1:12),titleImage[f]=quittingMessageScreen?t:n,canvasResize()}var loadedLevelSeed=0;function loadLevelFromLevelDat(e,t,n,r){if(null==n&&(n=(Math.random()+Date.now()).toString()),RandomGen=new RNG(loadedLevelSeed=n),forceRegenImages=!0,ignoreNotJustPressedAction=!0,titleScreen=!1,titleMode=showContinueOptionOnTitleScreen()?1:0,titleSelection=0,titleSelected=!1,dragging=!1,rightdragging=!1,e.metadata=deepClone(e.default_metadata),againing=!1,void 0===t)return consolePrint("Trying to access a level that doesn't exist.",!0),void goToTitleScreen();void 0!==t.message?(ignoreNotJustPressedAction=!0,tryPlayShowMessageSound(),twiddleMetadataExtras(),drawMessageScreen(),canvasResize(),clearInputHistory()):void 0!==t.target?(setSectionSolved(e.levels[Number(curlevel)].section),gotoLevel(t.target)):(consolePrint("level loading"),titleMode=0,textMode=!1,level=t.clone(),RebuildLevelArrays(),void 0!==e&&(void 0!==e.metadata.flickscreen?oldflickscreendat=[0,0,Math.min(e.metadata.flickscreen[0],level.width),Math.min(e.metadata.flickscreen[1],level.height)]:void 0!==e.metadata.zoomscreen?oldflickscreendat=[0,0,Math.min(e.metadata.zoomscreen[0],level.width),Math.min(e.metadata.zoomscreen[1],level.height)]:void 0!==e.metadata.smoothscreen&&(oldflickscreendat=[0,0,Math.min(e.metadata.smoothscreen.screenSize.width,level.width),Math.min(e.metadata.smoothscreen.screenSize.height,level.height)])),initSmoothCamera(),twiddleMetadataExtras(),backups=[],restartTarget=backupLevel(),keybuffer=[],"run_rules_on_level_start"in e.metadata&&(runrulesonlevelstart_phase=!0,processInput(-1,!0),runrulesonlevelstart_phase=!1)),!0===r&&clearInputHistory()}function loadLevelFromStateTarget(e,t,n,r){curlevel=t,curlevelTarget=n,void 0===n.message&&tryPlayStartLevelSound(),consolePrint("level index = "+t+", target = "+n),loadLevelFromLevelDat(e,e.levels[t],r),restoreLevel(n,!0),restartTarget=n}function loadLevelFromState(e,t,n){var r=e.levels[t];curlevel=t,curlevelTarget=null,void 0!==r&&void 0===r.message&&(document.dispatchEvent(new CustomEvent("psplusLevelLoaded",{detail:t})),tryPlayStartLevelSound()),loadLevelFromLevelDat(e,r,n)}var sprites=[{color:"#423563",dat:[[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]]},{color:"#252342",dat:[[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,1,1,1,0],[0,1,0,1,0]]}];function tryLoadCustomFont(){null==state||null==state.metadata||null==state.metadata.custom_font||loadedCustomFont||new FontFace("PuzzleCustomFont","url("+state.metadata.custom_font+")").load().then((function(e){document.fonts.add(e),loadedCustomFont=!0,canvasResize(),redraw()})).catch((function(e){alert("Unable to load font!")}))}function tryPlaySimpleSound(e){if(void 0!==state.sfx_Events[e]){var t=state.sfx_Events[e];"sfx10"==e||"sfx11"==e||"sfx12"==e||"sfx13"==e?playQuietSound(t):playSound(t)}}function tryPlayTitleSound(){tryPlaySimpleSound("titlescreen")}function tryPlayStartGameSound(){tryPlaySimpleSound("startgame")}function tryPlayEndGameSound(){tryPlaySimpleSound("endgame")}function tryPlayCancelSound(){tryPlaySimpleSound("cancel")}function tryPlayStartLevelSound(){tryPlaySimpleSound("startlevel")}function tryPlayEndLevelSound(){tryPlaySimpleSound("endlevel")}function tryPlayEnterLevelSelectSound(){tryPlaySimpleSound("enterlevelselect")}function tryPlayUndoSound(){tryPlaySimpleSound("undo")}function tryPlayRestartSound(){tryPlaySimpleSound("restart")}function tryPlayShowMessageSound(){tryPlaySimpleSound("showmessage")}function tryPlayCloseMessageSound(){tryPlaySimpleSound("closemessage")}loadedCustomFont=!1,tryLoadCustomFont(),generateTitleScreen(),titleMode>0&&(titleSelection=0),canvasResize();var restartTarget,backups=[];function backupLevel(){var e={dat:new Int32Array(level.objects),width:level.width,height:level.height,oldflickscreendat:oldflickscreendat.concat([]),cameraPositionTarget:Object.assign({},cameraPositionTarget)};if(void 0!==state.metadata.runtime_metadata_twiddling){var t=deepClone(state.metadata);delete t.custom_font,e.metadata=t}return e}function level4Serialization(){return{dat:Array.from(level.objects),width:level.width,height:level.height,oldflickscreendat:oldflickscreendat.concat([]),cameraPositionTarget:Object.assign({},cameraPositionTarget)}}function tryDeactivateYoutube(){var e=document.getElementById("youtubeFrame");e&&document.body.removeChild(e)}function tryActivateYoutube(){if(!document.getElementById("youtubeFrame")&&canYoutube&&"youtube"in state.metadata){var e=state.metadata.youtube,t="https://www.youtube.com/embed/"+e+"?autoplay=1&loop=1&playlist="+e;(ifrm=document.createElement("IFRAME")).setAttribute("src",t),ifrm.setAttribute("id","youtubeFrame"),ifrm.style.visibility="hidden",ifrm.style.width="500px",ifrm.style.height="500px",ifrm.style.position="absolute",ifrm.style.top="-1000px",ifrm.style.left="-1000px",document.body.appendChild(ifrm)}}function setGameState(e,t,n){for(var r in oldflickscreendat=[],timer=0,autotick=0,winning=!1,againing=!1,messageselected=!1,STRIDE_MOV=e.STRIDE_MOV,STRIDE_OBJ=e.STRIDE_OBJ,sfxCreateMask=new BitVec(STRIDE_OBJ),sfxDestroyMask=new BitVec(STRIDE_OBJ),void 0===t&&(t=["restart"]),(0===state.levels.length||0===e.levels.length)&&t.length>0&&"rebuild"===t[0]&&(t=["restart"]),void 0===n&&(n=null),RandomGen=new RNG(n),state=e,"rebuild"!==t[0]&&(backups=[]),sprites=[],state.objects)if(state.objects.hasOwnProperty(r)){var o=state.objects[r],i={colors:o.colors,dat:o.spritematrix};sprites[o.id]=i}switch(void 0!==state.metadata.realtime_interval?(autotick=0,autotickinterval=1e3*state.metadata.realtime_interval):(autotick=0,autotickinterval=0),repeatinterval=void 0!==state.metadata.key_repeat_interval?1e3*state.metadata.key_repeat_interval:150,tweeninterval=void 0!==state.metadata.tween_length?1e3*state.metadata.tween_length:0,againinterval=void 0!==state.metadata.again_interval?1e3*state.metadata.again_interval:150,throttle_movement&&0===autotickinterval&&logWarning("throttle_movement is designed for use in conjunction with realtime_interval. Using it in other situations makes games gross and unresponsive, broadly speaking.  Please don't."),norepeat_action=void 0!==state.metadata.norepeat_action,storage_remove(document.URL+"_checkpoint"),storage_remove(document.URL),t[0]){case"restart":if(1==restarting){logWarning('A "restart" command is being triggered in the "run_rules_on_level_start" section of level creation, which would cause an infinite loop if it was actually triggered, but it\'s being ignored, so it\'s not.');break}winning=!1,timer=0,titleScreen=!0,tryPlayTitleSound(),textMode=!0,titleSelection=0,titleSelected=!1,quittingMessageScreen=!1,quittingTitleScreen=!1,messageselected=!1,titleMode=0,showContinueOptionOnTitleScreen()&&(titleMode=1),void 0!==state.metadata.skip_title_screen?(consolePrint("skip_title_screen enabled, proceeding to do exactly as it says on the tin."),void 0!==state.metadata.continue_is_level_select?gotoLevelSelectScreen():titleMode<=1?nextLevel():2==titleMode&&gotoLevel(titleSelection)):(titleMode=4,playIntro9());break;case"rebuild":break;case"loadFirstNonMessageLevel":for(var a=0;a<state.levels.length;a++)if(!state.levels[a].hasOwnProperty("message")){curlevel=l=a,curlevelTarget=null,winning=!1,timer=0,titleScreen=!1,textMode=!1,titleSelected=!1,quittingMessageScreen=!1,quittingTitleScreen=!1,messageselected=!1,titleMode=0,loadLevelFromState(state,l,n);break}break;case"loadLevel":consolePrint("loading a level");var l=t[1];curlevel=l,curlevelTarget=null,winning=!1,timer=0,titleScreen=!1,textMode=!1,titleSelected=!1,quittingMessageScreen=!1,quittingTitleScreen=!1,messageselected=!1,titleMode=0,loadLevelFromState(state,l,n);break;case"levelline":var s=t[1];for(a=state.levels.length-1;a>=0;a--){if(state.levels[a].lineNumber<=s+1){curlevel=a,curlevelTarget=null,winning=!1,timer=0,titleScreen=!1,textMode=!1,titleSelected=!1,quittingMessageScreen=!1,quittingTitleScreen=!1,messageselected=!1,titleMode=0,loadLevelFromState(state,a);break}}}"rebuild"!==t[0]&&clearInputHistory(),canvasResize(),0==state.sounds.length&&null==state.metadata.youtube?killAudioButton():showAudioButton()}function RebuildLevelArrays(){level.movements=new Int32Array(level.n_tiles*STRIDE_MOV),level.rigidMovementAppliedMask=[],level.rigidGroupIndexMask=[],level.rowCellContents=[],level.rowCellContents_Movements=[],level.colCellContents=[],level.colCellContents_Movements=[],level.mapCellContents=new BitVec(STRIDE_OBJ),level.mapCellContents_Movements=new BitVec(STRIDE_MOV),_movementVecs=[new BitVec(STRIDE_MOV),new BitVec(STRIDE_MOV),new BitVec(STRIDE_MOV)],_o1=new BitVec(STRIDE_OBJ),_o2=new BitVec(STRIDE_OBJ),_o2_5=new BitVec(STRIDE_OBJ),_o3=new BitVec(STRIDE_OBJ),_o4=new BitVec(STRIDE_OBJ),_o5=new BitVec(STRIDE_OBJ),_o6=new BitVec(STRIDE_OBJ),_o7=new BitVec(STRIDE_OBJ),_o8=new BitVec(STRIDE_OBJ),_o9=new BitVec(STRIDE_OBJ),_o10=new BitVec(STRIDE_OBJ),_o11=new BitVec(STRIDE_OBJ),_o12=new BitVec(STRIDE_OBJ),_m1=new BitVec(STRIDE_MOV),_m2=new BitVec(STRIDE_MOV),_m3=new BitVec(STRIDE_MOV);for(var e=0;e<level.height;e++)level.rowCellContents[e]=new BitVec(STRIDE_OBJ);for(e=0;e<level.width;e++)level.colCellContents[e]=new BitVec(STRIDE_OBJ);for(e=0;e<level.height;e++)level.rowCellContents_Movements[e]=new BitVec(STRIDE_MOV);for(e=0;e<level.width;e++)level.colCellContents_Movements[e]=new BitVec(STRIDE_MOV);for(e=0;e<level.n_tiles;e++)level.rigidMovementAppliedMask[e]=new BitVec(STRIDE_MOV),level.rigidGroupIndexMask[e]=new BitVec(STRIDE_MOV)}var messagetext="",currentMovedEntities={},newMovedEntities={};function restoreLevel(e,t,n=!0,r=!0){var o=e.hasOwnProperty("diff");if(oldflickscreendat=e.oldflickscreendat.concat([]),n&&(currentMovedEntities={}),o)for(var i=0;i<e.dat.length;){var a=e.dat[i],l=e.dat[i+1];if(0===l)break;for(j=0;j<l;j++)level.objects[a+j]=e.dat[i+2+j];i+=2+l}else level.objects=new Int32Array(e.dat);if(level.width!==e.width||level.height!==e.height)level.width=e.width,level.height=e.height,level.n_tiles=e.width*e.height,RebuildLevelArrays();else{for(var s=0;s<level.n_tiles;s++)level.movements[s]=0,level.rigidMovementAppliedMask[s]=0,level.rigidGroupIndexMask[s]=0;for(s=0;s<level.height;s++){level.rowCellContents[s].setZero()}for(s=0;s<level.width;s++){level.colCellContents[s].setZero()}}e.cameraPositionTarget&&(cameraPositionTarget=Object.assign({},e.cameraPositionTarget),t&&(cameraPosition=Object.assign({},cameraPositionTarget))),void 0!==state.metadata.runtime_metadata_twiddling&&(void 0===e.metadata&&(e.metadata=deepClone(state.default_metadata),consolePrint("RUNTIME METADATA TWIDDLING: Reloaded level state that did not have saved metadata. Likely this state was recovered from a CHECKPOINT. Using the default metadata instead.",!0)),state.metadata=deepClone(e.metadata),twiddleMetadataExtras(r)),againing=!1,level.commandQueue=[],level.commandQueueSourceRules=[]}var zoomscreen=!1,flickscreen=!1,smoothscreen=!1,screenwidth=0,screenheight=0;function consolidateDiff(e,t){if(e.width!==t.width||e.height!==t.height||e.dat.length!==t.dat.length)return e;if(e.hasOwnProperty("diff")||t.hasOwnProperty("diff"))return e;if(e.dat.length<1024)return e;for(var n=new Int32Array(128),r=0,o=!1,i=-1,a=e.dat,l=t.dat,s=0;s<a.length;s++)if(!1===o){if(a[s]!==l[s]){if(o=!0,i=r,n.length<r+4)(c=new Int32Array(2*n.length)).set(n),n=c;n[r+0]=s,n[r+1]=1,n[r+2]=a[s],r+=3}}else if(a[s]!==l[s]){var c;if(r+1>=n.length)if(n.length<r+4)(c=new Int32Array(2*n.length)).set(n),n=c;n[i+1]++,n[r]=a[s],r++}else o=!1;return{diff:!0,dat:n,width:e.width,height:e.height,oldflickscreendat:e.oldflickscreendat}}function addUndoState(e){backups.push(e),backups.length>2&&!backups[backups.length-1].hasOwnProperty("diff")&&(backups[backups.length-3]=consolidateDiff(backups[backups.length-3],backups[backups.length-2]))}function DoRestart(e){!0!==restarting&&(!0!==e&&"norestart"in state.metadata||(restarting=!0,!0!==e&&addUndoState(backupLevel()),verbose_logging&&consolePrint("--- restarting ---",!0),restoreLevel(restartTarget,!0),tryPlayRestartSound(),document.dispatchEvent(new CustomEvent("psplusLevelRestarted",{detail:curlevel})),"run_rules_on_level_start"in state.metadata&&processInput(-1,!0),twiddleMetadataExtras(),level.commandQueue=[],level.commandQueueSourceRules=[],restarting=!1))}function backupDiffers(){if(0==backups.length)return!0;var e=backups[backups.length-1];if(e.hasOwnProperty("diff"))return 0!==e.dat.length&&0!==e.dat[1];for(var t=0;t<level.objects.length;t++)if(level.objects[t]!==e.dat[t])return!0;return!1}function DoUndo(e,t,n=!0,r=!0){if(levelEditorOpened||!("noundo"in state.metadata)||!0===e){if(verbose_logging&&consolePrint("--- undoing ---",!0),t)for(;0==backupDiffers();)backups.pop();if(backups.length>0)restoreLevel(backups[backups.length-1],null,n,r),backups=backups.splice(0,backups.length-1),e||tryPlayUndoSound()}}function getPlayerPositions(){var e=[],t=state.playerMask;for(i=0;i<level.n_tiles;i++)level.getCellInto(i,_o11),t.anyBitsInCommon(_o11)&&e.push(i);return e}function getLayersOfMask(e){for(var t=[],n=0;n<state.objectCount;n++)if(e.get(n)){var r=state.idDict[n],o=state.objects[r];t.push(o.layer)}return t}function moveEntitiesAtIndex(e,t,n){var r=level.getCell(e);r.iand(t);for(var o=getLayersOfMask(r),i=level.getMovements(e),a=0;a<o.length;a++)i.ishiftor(n,5*o[a]);level.setMovements(e,i);var l=e/level.height|0,s=e%level.height;level.colCellContents_Movements[l].ior(i),level.rowCellContents_Movements[s].ior(i),level.mapCellContents_Movements.ior(i)}function startMovement(e){for(var t=getPlayerPositions(),n=0;n<t.length;n++){moveEntitiesAtIndex(t[n],state.playerMask,e)}return t}var _movementVecs,dirMasksDelta={1:[0,-1],2:[0,1],4:[-1,0],8:[1,0],15:[0,0],16:[0,0],3:[0,0]},dirMaskName={1:"up",2:"down",4:"left",8:"right",15:"?",16:"action",3:"no"},seedsToPlay_CanMove=[],seedsToPlay_CantMove=[];function repositionEntitiesOnLayer(e,t,n){var r=dirMasksDelta[n],o=r[0],i=r[1],a=e/level.height|0,l=e%level.height,s=level.width-1,c=level.height-1;if(0===a&&o<0||a===s&&o>0||0===l&&i<0||l===c&&i>0)return!1;var u=e+r[1]+r[0]*level.height,d=state.layerMasks[t],h=level.getCellInto(u,_o7),f=level.getCellInto(e,_o8);if(d.anyBitsInCommon(h)&&16!=n)return!1;for(var p=0;p<state.sfx_MovementMasks.length;p++){var g=state.sfx_MovementMasks[p];if(g.objectMask.anyBitsInCommon(f)){var m=level.getMovements(e),v=g.directionMask;m.anyBitsInCommon(v)&&-1===seedsToPlay_CanMove.indexOf(g.seed)&&seedsToPlay_CanMove.push(g.seed)}}var y=f.clone();f.iclear(d),y.iand(d),h.ior(y),level.setCell(e,f),level.setCell(u,h);var _=u/level.height|0,b=u%level.height;return level.colCellContents[_].ior(y),level.rowCellContents[b].ior(y),level.mapCellContents.ior(y),!0}function repositionEntitiesAtCell(e){var t=level.getMovements(e);if(t.iszero())return!1;for(var n=!1,r=0;r<level.layerCount;r++){var o=t.getshiftor(31,5*r);if(0!==o)if(repositionEntitiesOnLayer(e,r,o)){if(state.metadata.tween_length){var i=dirMasksDelta[o],a=e+i[1]+i[0]*level.height;newMovedEntities["p"+a+"-l"+r]=o}t.ishiftclear(o,5*r),n=!0}}return level.setMovements(e,t),n}function Level(e,t,n,r,o,i){this.lineNumber=e,this.width=t,this.height=n,this.n_tiles=t*n,this.objects=o,this.section=i,this.layerCount=r,this.commandQueue=[],this.commandQueueSourceRules=[]}Level.prototype.delta_index=function(e){const[t,n]=dirMasksDelta[e];return t*this.height+n},Level.prototype.clone=function(){var e=new Level(this.lineNumber,this.width,this.height,this.layerCount,null,this.section);return e.objects=new Int32Array(this.objects),e},Level.prototype.getCell=function(e){return new BitVec(this.objects.subarray(e*STRIDE_OBJ,e*STRIDE_OBJ+STRIDE_OBJ))},Level.prototype.getCellInto=function(e,t){for(var n=0;n<STRIDE_OBJ;n++)t.data[n]=this.objects[e*STRIDE_OBJ+n];return t},Level.prototype.setCell=function(e,t){for(var n=0;n<t.data.length;++n)this.objects[e*STRIDE_OBJ+n]=t.data[n]};var _movementVecIndex=0;Level.prototype.getMovements=function(e){var t=_movementVecs[_movementVecIndex];_movementVecIndex=(_movementVecIndex+1)%_movementVecs.length;for(var n=0;n<STRIDE_MOV;n++)t.data[n]=this.movements[e*STRIDE_MOV+n];return t},Level.prototype.getMovementsInto=function(e,t){for(var n=t,r=0;r<STRIDE_MOV;r++)n.data[r]=this.movements[e*STRIDE_MOV+r];return n},Level.prototype.setMovements=function(e,t){for(var n=0;n<t.data.length;++n)this.movements[e*STRIDE_MOV+n]=t.data[n];var r=e/this.height|0,o=e%this.height;level.colCellContents_Movements[r].ior(t),level.rowCellContents_Movements[o].ior(t),level.mapCellContents_Movements.ior(t)};var ellipsisPattern=["ellipsis"];function BitVec(e){return this.data=new Int32Array(e),this}function Rule(e){this.direction=e[0],this.patterns=e[1],this.hasReplacements=e[2],this.lineNumber=e[3],this.isEllipsis=e[4],this.groupNumber=e[5],this.isRigid=e[6],this.commands=e[7],this.isRandom=e[8],this.cellRowMasks=e[9],this.cellRowMasks_Movements=e[10],this.isGlobal=e[11],this.ruleMask=this.cellRowMasks.reduce(((e,t)=>(e.ior(t),e)),new BitVec(STRIDE_OBJ)),this.cellRowMatches=[];for(var t=0;t<this.patterns.length;t++)this.cellRowMatches.push(this.generateCellRowMatchesFunction(this.patterns[t],this.isEllipsis[t]))}BitVec.prototype.cloneInto=function(e){for(var t=0;t<this.data.length;++t)e.data[t]=this.data[t];return e},BitVec.prototype.clone=function(){return new BitVec(this.data)},BitVec.prototype.iand=function(e){for(var t=0;t<this.data.length;++t)this.data[t]&=e.data[t]},BitVec.prototype.inot=function(){for(var e=0;e<this.data.length;++e)this.data[e]=~this.data[e]},BitVec.prototype.ior=function(e){for(var t=0;t<this.data.length;++t)this.data[t]|=e.data[t]},BitVec.prototype.iclear=function(e){for(var t=0;t<this.data.length;++t)this.data[t]&=~e.data[t]},BitVec.prototype.ibitset=function(e){this.data[e>>5]|=1<<(31&e)},BitVec.prototype.ibitclear=function(e){this.data[e>>5]&=~(1<<(31&e))},BitVec.prototype.get=function(e){return 0!=(this.data[e>>5]&1<<(31&e))},BitVec.prototype.getshiftor=function(e,t){var n=31&t,r=this.data[t>>5]>>>n;return n&&(r|=this.data[1+(t>>5)]<<32-n),r&e},BitVec.prototype.ishiftor=function(e,t){var n=31&t,r=e<<n;if(this.data[t>>5]|=r,n){var o=e>>32-n;this.data[1+(t>>5)]|=o}},BitVec.prototype.ishiftclear=function(e,t){var n=31&t,r=e<<n;if(this.data[t>>5]&=~r,n){var o=e>>32-(31&t);this.data[1+(t>>5)]&=~o}},BitVec.prototype.equals=function(e){if(this.data.length!==e.data.length)return!1;for(var t=0;t<this.data.length;++t)if(this.data[t]!==e.data[t])return!1;return!0},BitVec.prototype.setZero=function(){for(var e=0;e<this.data.length;++e)this.data[e]=0},BitVec.prototype.iszero=function(){for(var e=0;e<this.data.length;++e)if(this.data[e])return!1;return!0},BitVec.prototype.bitsSetInArray=function(e){for(var t=0;t<this.data.length;++t)if((this.data[t]&e[t])!==this.data[t])return!1;return!0},BitVec.prototype.bitsClearInArray=function(e){for(var t=0;t<this.data.length;++t)if(this.data[t]&e[t])return!1;return!0},BitVec.prototype.anyBitsInCommon=function(e){return!this.bitsClearInArray(e.data)},Rule.prototype.generateCellRowMatchesFunction=function(e,t){if(0==t){for(var n=e.length,r="",o=1===STRIDE_OBJ?"":"*"+STRIDE_OBJ,i=0;i<STRIDE_OBJ;++i)r+="var cellObjects"+i+" = objects[i"+o+(i?"+"+i:"")+"];\n";o=1===STRIDE_MOV?"":"*"+STRIDE_MOV;for(i=0;i<STRIDE_MOV;++i)r+="var cellMovements"+i+" = movements[i"+o+(i?"+"+i:"")+"];\n";r+="return "+e[0].generateMatchString("0_");for(var a=1;a<n;a++)r+="&&cellRow["+a+"].matches(i+"+a+"*d, objects, movements)";return(r+=";")in matchCache?matchCache[r]:matchCache[r]=new Function("cellRow","i","d","objects","movements",r)}n=e.length,r="var result = [];\n";r+="if(cellRow[0].matches(i, objects, movements)";for(a=1;e[a]!==ellipsisPattern;a++)r+="&&cellRow["+a+"].matches(i+"+a+"*d, objects, movements)";for(r+=") {\n",r+="\tfor (var k=kmin;k<kmax;k++) {\n",r+="\t\tif(cellRow["+ ++a+"].matches((i+d*(k+"+(a-1)+")), objects, movements)",a++;a<n;a++)r+="&&cellRow["+a+"].matches((i+d*(k+"+(a-1)+")), objects, movements)";return r+="){\n",r+="\t\t\tresult.push([i,k]);\n",r+="\t\t}\n",r+="\t}\n",r+="}\n",(r+="return result;")in matchCache?matchCache[r]:matchCache[r]=new Function("cellRow","i","kmax","kmin","d","objects","movements",r)},Rule.prototype.toJSON=function(){return[this.direction,this.patterns,this.hasReplacements,this.lineNumber,this.isEllipsis,this.groupNumber,this.isRigid,this.commands,this.isRandom,this.cellRowMasks,this.cellRowMasks_Movements]};var STRIDE_OBJ=1,STRIDE_MOV=1;function CellPattern(e){this.objectsPresent=e[0],this.objectsMissing=e[1],this.anyObjectsPresent=e[2],this.movementsPresent=e[3],this.movementsMissing=e[4],this.matches=this.generateMatchFunction(),this.replacement=e[5]}function CellReplacement(e){this.objectsClear=e[0],this.objectsSet=e[1],this.movementsClear=e[2],this.movementsSet=e[3],this.movementsLayerMask=e[4],this.randomEntityMask=e[5],this.randomDirMask=e[6]}var _o1,_o2,_o2_5,_o3,_o4,_o5,_o6,_o7,_o8,_o9,_o10,_o11,_o12,_m1,_m2,_m3,matchCache={};function matchCellRow(e,t,n,r,o,i,a){var l=[];if(!r.bitsSetInArray(level.mapCellContents.data)||!o.bitsSetInArray(level.mapCellContents_Movements.data))return l;if(a||void 0===state.metadata.local_radius)xmin=0,xmax=level.width,ymin=0,ymax=level.height;else{var s=parseInt(state.metadata.local_radius);xmin=Math.max(0,(playerPositions[0]/level.height|0)-s),xmax=Math.min(level.width,(playerPositions[0]/level.height|0)+s+1),ymin=Math.max(0,playerPositions[0]%level.height-s),ymax=Math.min(level.height,playerPositions[0]%level.height+s+1)}var c=n.length;switch(e){case 1:ymin+=c-1;break;case 2:ymax-=c-1;break;case 4:xmin+=c-1;break;case 8:xmax-=c-1;break;default:window.console.log("EEEP "+e)}if(e>2){for(var u=ymin;u<ymax;u++)if(r.bitsSetInArray(level.rowCellContents[u].data)&&o.bitsSetInArray(level.rowCellContents_Movements[u].data))for(var d=xmin;d<xmax;d++){t(n,h=d*level.height+u,i,level.objects,level.movements)&&l.push(h)}}else for(d=xmin;d<xmax;d++)if(r.bitsSetInArray(level.colCellContents[d].data)&&o.bitsSetInArray(level.colCellContents_Movements[d].data))for(u=ymin;u<ymax;u++){var h;t(n,h=d*level.height+u,i,level.objects,level.movements)&&l.push(h)}return l}function matchCellRowWildCard(e,t,n,r,o,i){var a=[];if(!r.bitsSetInArray(level.mapCellContents.data)||!o.bitsSetInArray(level.mapCellContents_Movements.data))return a;var l=0,s=level.width,c=0,u=level.height,d=n.length-1;switch(e){case 1:c+=d-1;break;case 2:u-=d-1;break;case 4:l+=d-1;break;case 8:s-=d-1;break;default:window.console.log("EEEP2 "+e)}if(e>2){for(var h=c;h<u;h++)if(r.bitsSetInArray(level.rowCellContents[h].data)&&o.bitsSetInArray(level.rowCellContents_Movements[h].data))for(var f=l;f<s;f++){var p=f*level.height+h;4===e?g=f-d+2:8===e?g=level.width-(f+d)+1:window.console.log("EEEP2 "+e),a.push.apply(a,t(n,p,g,0,i,level.objects,level.movements))}}else for(f=l;f<s;f++)if(r.bitsSetInArray(level.colCellContents[f].data)&&o.bitsSetInArray(level.colCellContents_Movements[f].data))for(h=c;h<u;h++){var g;p=f*level.height+h;2===e?g=level.height-(h+d)+1:1===e?g=h-d+2:window.console.log("EEEP2 "+e),a.push.apply(a,t(n,p,g,0,i,level.objects,level.movements))}return a}function generateTuples(e){for(var t=[[]],n=0;n<e.length;n++){for(var r=e[n],o=[],i=0;i<r.length;i++)for(var a=r[i],l=0;l<t.length;l++){var s=t[l].concat([a]);o.push(s)}t=o}return t}function twiddleMetadataExtras(e=!0){void 0!==state.metadata.realtime_interval?(e&&(autotick=0),autotickinterval=1e3*state.metadata.realtime_interval):(autotick=0,autotickinterval=0),againinterval=void 0!==state.metadata.again_interval?1e3*state.metadata.again_interval:150,tweeninterval=void 0!==state.metadata.tween_length?Math.max(1e3*state.metadata.tween_length,0):0,repeatinterval=void 0!==state.metadata.key_repeat_interval?1e3*state.metadata.key_repeat_interval:150,"background_color"in state.metadata?state.bgcolor=colorToHex(colorPalette,state.metadata.background_color):state.bgcolor="#000000","text_color"in state.metadata?state.fgcolor=colorToHex(colorPalette,state.metadata.text_color):state.fgcolor="#FFFFFF"}function showTempMessage(){solving||(keybuffer=[],textMode=!0,titleScreen=!1,quittingMessageScreen=!1,messageselected=!1,ignoreNotJustPressedAction=!0,tryPlayShowMessageSound(),drawMessageScreen(),canvasResize())}function processOutputCommands(e){for(var t=0;t<e.length;t++){var n=e[t];"f"===n.charAt(1)&&tryPlaySimpleSound(n),!1===unitTesting&&"message"===n&&showTempMessage()}}function applyRandomRuleGroup(e,t){for(var n=[],r=0;r<t.length;r++){var o=(c=t[r]).findMatches();if(o.length>0)for(var i=generateTuples(o),a=0;a<i.length;a++){var l=i[a];n.push([r,l])}}if(0===n.length)return!1;var s=n[Math.floor(RandomGen.uniform()*n.length)],c=t[r=s[0]];l=s[1];const u=e.delta_index(c.direction);var d=c.applyAt(e,l,!1,u);return c.queueCommands(),d}function applyRuleGroup(e){if(e[0].isRandom)return applyRandomRuleGroup(level,e);for(var t=!1,n=!0,r=0,o=-1;n;){if(++r>200){logErrorCacheable("Got caught looping lots in a rule group :O",e[0].lineNumber,!0);break}n=!1;for(var i=0;i<e.length;i++){if(e[i].tryApply(level)?(n=!0,o=0):o++,o===e.length)break}n&&(t=!0,verbose_logging&&(debugger_turnIndex++,addToDebugTimeline(level,-2)))}return t}function applyRules(e,t,n,r){playerPositions=getPlayerPositions();for(var o=n>0,i=0,a=n;a<e.length;){if(r&&r[a]);else o=applyRuleGroup(e[a])||o;if(o&&void 0!==t[a]){if(a=t[a],o=!1,++i>200){logErrorCacheable("got caught in an endless startloop...endloop vortex, escaping!",e[a][0].lineNumber,!0);break}verbose_logging&&(debugger_turnIndex++,addToDebugTimeline(level,-2))}else{if(++a===e.length&&o&&void 0!==t[a]&&(a=t[a],o=!1,++i>200)){logErrorCacheable("got caught in an endless startloop...endloop vortex, escaping!",e[a][0].lineNumber,!0);break}verbose_logging&&(debugger_turnIndex++,addToDebugTimeline(level,-2))}}}function resolveMovements(e,t){for(var n=!0;n;){n=!1;for(var r=0;r<e.n_tiles;r++)n=repositionEntitiesAtCell(r)||n}var o=!1;for(r=0;r<e.n_tiles;r++){var i=e.getCellInto(r,_o6),a=e.getMovements(r);if(!a.iszero()){var l=e.rigidMovementAppliedMask[r];if(0!==l&&(a.iand(l),!a.iszero()))for(var s=0;s<e.layerCount;s++){if(0!==a.getshiftor(31,5*s)){var c=e.rigidGroupIndexMask[r].getshiftor(31,5*s);c--,t[state.rigidGroupIndex_to_GroupIndex[c]]=!0,o=!0;break}}for(s=0;s<state.sfx_MovementFailureMasks.length;s++){var u=state.sfx_MovementFailureMasks[s];if(u.objectMask.anyBitsInCommon(i)){var d=u.directionMask;a.anyBitsInCommon(d)&&-1===seedsToPlay_CantMove.indexOf(u.seed)&&seedsToPlay_CantMove.push(u.seed)}}}for(s=0;s<STRIDE_MOV;s++)e.movements[s+r*STRIDE_MOV]=0;e.rigidGroupIndexMask[r]=0,e.rigidMovementAppliedMask[r]=0}return o}CellPattern.prototype.generateMatchString=function(){for(var e="(true",t=0;t<Math.max(STRIDE_OBJ,STRIDE_MOV);++t){var n="cellObjects"+t,r="cellMovements"+t,o=this.objectsPresent.data[t],i=this.objectsMissing.data[t],a=this.movementsPresent.data[t],l=this.movementsMissing.data[t];o&&(e+=o&o-1?"\t\t&& (("+n+"&"+o+")==="+o+")\n":"\t\t&& ("+n+"&"+o+")\n"),i&&(e+="\t\t&& !("+n+"&"+i+")\n"),a&&(e+=a&a-1?"\t\t&& (("+r+"&"+a+")==="+a+")\n":"\t\t&& ("+r+"&"+a+")\n"),l&&(e+="\t\t&& !("+r+"&"+l+")\n")}for(var s=0;s<this.anyObjectsPresent.length;s++){e+="\t\t&& (0";for(t=0;t<STRIDE_OBJ;++t){var c=this.anyObjectsPresent[s].data[t];c&&(e+="|(cellObjects"+t+"&"+c+")")}e+=")"}return e+="\t)"},CellPattern.prototype.generateMatchFunction=function(){for(var e="",t=1===STRIDE_OBJ?"":"*"+STRIDE_OBJ,n=0;n<STRIDE_OBJ;++n)e+="\tvar cellObjects"+n+" = objects[i"+t+(n?"+"+n:"")+"];\n";t=1===STRIDE_MOV?"":"*"+STRIDE_MOV;for(n=0;n<STRIDE_MOV;++n)e+="\tvar cellMovements"+n+" = movements[i"+t+(n?"+"+n:"")+"];\n";return(e+="return "+this.generateMatchString()+";")in matchCache?matchCache[e]:matchCache[e]=new Function("i","objects","movements",e)},CellPattern.prototype.toJSON=function(){return[this.movementMask,this.cellMask,this.nonExistenceMask,this.moveNonExistenceMask,this.moveStationaryMask,this.randomDirOrEntityMask,this.movementsToRemove]},CellPattern.prototype.replace=function(e,t){var n=this.replacement;if(null===n)return!1;var r=n.randomEntityMask,o=n.randomDirMask,i=n.objectsSet.cloneInto(_o1),a=n.objectsClear.cloneInto(_o2),l=n.movementsSet.cloneInto(_m1),s=n.movementsClear.cloneInto(_m2);if(s.ior(n.movementsLayerMask),!r.iszero()){for(var c=[],u=0;u<32*STRIDE_OBJ;u++)r.get(u)&&c.push(u);var d=c[Math.floor(RandomGen.uniform()*c.length)],h=state.idDict[d],f=state.objects[h];i.ibitset(d),a.ior(state.layerMasks[f.layer]),s.ishiftor(31,5*f.layer)}if(!o.iszero())for(var p=0;p<level.layerCount;p++)if(o.get(5*p)){var g=Math.floor(4*RandomGen.uniform());l.ibitset(g+5*p)}var m=level.getCellInto(t,_o2_5),v=level.getMovements(t),y=m.cloneInto(_o3),_=v.cloneInto(_m3);m.iclear(a),m.ior(i),v.iclear(s),v.ior(l);var b=!1,w=0,x=0;if(e.isRigid){var S=state.groupNumber_to_RigidGroupIndex[e.groupNumber];S++;for(var k=new BitVec(STRIDE_MOV),C=0;C<level.layerCount;C++)k.ishiftor(S,5*C);k.iand(n.movementsLayerMask),w=level.rigidGroupIndexMask[t]||new BitVec(STRIDE_MOV),x=level.rigidMovementAppliedMask[t]||new BitVec(STRIDE_MOV),k.bitsSetInArray(w.data)||n.movementsLayerMask.bitsSetInArray(x.data)||(w.ior(k),x.ior(n.movementsLayerMask),b=!0)}var M=!1;if(!y.equals(m)||!_.equals(v)||b){M=!0,b&&(level.rigidGroupIndexMask[t]=w,level.rigidMovementAppliedMask[t]=x);var T=m.cloneInto(_o4);T.iclear(y),sfxCreateMask.ior(T);var E=y.cloneInto(_o5);E.iclear(m),sfxDestroyMask.ior(E),level.setCell(t,m),level.setMovements(t,v);var I=t/level.height|0,L=t%level.height;level.colCellContents[I].ior(m),level.rowCellContents[L].ior(m),level.mapCellContents.ior(m),level.colCellContents_Movements[I].ior(v),level.rowCellContents_Movements[L].ior(v),level.mapCellContents_Movements.ior(v)}return M},Rule.prototype.findMatches=function(){if(!this.ruleMask.bitsSetInArray(level.mapCellContents.data))return[];const e=level.delta_index(this.direction);for(var t=[],n=this.cellRowMasks,r=this.cellRowMasks_Movements,o=0;o<this.patterns.length;o++){var i=this.patterns[o],a=this.cellRowMatches[o];if(this.isEllipsis[o])var l=matchCellRowWildCard(this.direction,a,i,n[o],r[o],e);else l=matchCellRow(this.direction,a,i,n[o],r[o],e,this.isGlobal);if(0===l.length)return[];t.push(l)}return t},Rule.prototype.directional=function(){for(var e=0;e<state.rules.length;e++)for(var t=state.rules[e],n=0,r=0;r<t.length;r++)if(this.lineNumber===t[r].lineNumber&&n++,n>1)return!0;return!1},Rule.prototype.applyAt=function(e,t,n,r){var o=this;if(n)for(var i=0;i<this.patterns.length;i++)if(this.isEllipsis[i]){if(0==this.cellRowMatches[i](this.patterns[i],t[i][0],t[i][1]+1,t[i][1],r,e.objects,e.movements).length)return!1}else if(!this.cellRowMatches[i](this.patterns[i],t[i],r,e.objects,e.movements))return!1;var a=!1;for(i=0;i<o.patterns.length;i++)for(var l=o.patterns[i],s=o.isEllipsis[i]?t[i][0]:t[i],c=0;c<l.length;c++){var u=l[c];if(u!==ellipsisPattern)a=u.replace(o,s)||a,s+=r;else s+=r*t[i][1]}if(verbose_logging&&a){var d=dirMaskName[o.direction];o.directional()||(d="");var h=addToDebugTimeline(e,o.lineNumber);consolePrint(`<font color="green">Rule <a onclick="jumpToLine(${o.lineNumber});"  href="javascript:void(0);">${o.lineNumber}</a> ${d} applied.</font>`,!1,o.lineNumber,h)}return a},Rule.prototype.tryApply=function(e){const t=e.delta_index(this.direction);var n=this.findMatches();if(0===n.length)return!1;var r=!1;if(this.hasReplacements)for(var o=generateTuples(n),i=0;i<o.length;i++){var a=o[i],l=i>0;r=this.applyAt(e,a,l,t)||r}return n.length>0&&this.queueCommands(),r},Rule.prototype.queueCommands=function(){var e=this.commands;if(0!=e.length){for(var t=level.commandQueue.indexOf("cancel")>=0,n=level.commandQueue.indexOf("restart")>=0,r=!1,o=!1,i=0;i<e.length;i++){var a=e[i][0];"cancel"===a?r=!0:"restart"===a&&(o=!0)}if(!t&&(!n||r)){(r||o)&&(level.commandQueue=[],level.commandQueueSourceRules=[],messagetext="");for(i=0;i<e.length;i++){var l=e[i];if(!(level.commandQueue.indexOf(l[0])>=0)){if(level.commandQueue.push(l[0]),level.commandQueueSourceRules.push(this),verbose_logging){var s=this.lineNumber;dirMaskName[this.direction];consolePrint('<font color="green">Rule <a onclick="jumpToLine('+s.toString()+');"  href="javascript:void(0);">'+s.toString()+"</a> triggers command "+l[0]+".</font>",!1,s,null)}if("message"===l[0]&&(messagetext=l[1]),"goto"===l[0]&&gotoLevel(l[1]),void 0!==state.metadata.runtime_metadata_twiddling&&twiddleable_params.includes(l[0])&&(value=l[1],"wipe"==value?(delete state.metadata[l[0]],value=null):"default"==value&&(value=deepClone(state.default_metadata[l[0]])),null!=value&&(state.metadata[l[0]]=value),"zoomscreen"!==l[0]&&"flickscreen"!==l[0]||(twiddleMetaData(state,!0),canvasResize()),"smoothscreen"===l[0]&&(void 0!==value?(twiddleMetaData(state,!0),initSmoothCamera()):smoothscreen=!1,canvasResize()),twiddleMetadataExtras(),void 0!==state.metadata.runtime_metadata_twiddling_debug)){var c="Metadata twiddled: Flag "+l[0]+" set to "+value;value!=l[1]&&(c+=" ("+l[1]+")"),consolePrintFromRule(c,this,!0)}}}}}};var playerPositions,playerPositionsAtTurnStart,sfxCreateMask=null,sfxDestroyMask=null;function calculateRowColMasks(){for(var e=0;e<level.mapCellContents.length;e++)level.mapCellContents[e]=0,level.mapCellContents_Movements[e]=0;for(e=0;e<level.width;e++){level.colCellContents[e].setZero(),level.colCellContents_Movements[e].setZero()}for(e=0;e<level.height;e++){level.rowCellContents[e].setZero(),level.rowCellContents_Movements[e].setZero()}for(e=0;e<level.width;e++)for(var t=0;t<level.height;t++){var n=t+e*level.height,r=level.getCellInto(n,_o9);level.mapCellContents.ior(r),level.rowCellContents[t].ior(r),level.colCellContents[e].ior(r);var o=level.getMovementsInto(n,_m1);level.mapCellContents_Movements.ior(o),level.rowCellContents_Movements[t].ior(o),level.colCellContents_Movements[e].ior(o)}}function processInput(e,t,n,r){n||(newMovedEntities={});var o=e;if(againing=!1,null==r&&(r=backupLevel()),playerPositions=[],playerPositionsAtTurnStart=getPlayerPositions(),e<=5){if(verbose_logging&&(debugger_turnIndex++,addToDebugTimeline(level,-2)),e>=0&&e<=4){switch(e){case 0:e=parseInt("00001",2);break;case 1:e=parseInt("00100",2);break;case 2:e=parseInt("00010",2);break;case 3:e=parseInt("01000",2);break;case 4:e=parseInt("10000",2)}playerPositions=startMovement(e)}if(verbose_logging){consolePrint("Applying rules");var i=addToDebugTimeline(level,-1);consolePrint(-1===e?"Turn starts with no input.":`Turn starts with input of ${["up","left","down","right","action","mouse"][o]}.`,!1,null,i)}bannedGroup=[],level.commandQueue=[],level.commandQueueSourceRules=[];var a=0,l=!1;const b={objects:new Int32Array(level.objects),movements:new Int32Array(level.movements),rigidGroupIndexMask:level.rigidGroupIndexMask.concat([]),rigidMovementAppliedMask:level.rigidMovementAppliedMask.concat([]),commandQueue:[],commandQueueSourceRules:[]};sfxCreateMask.setZero(),sfxDestroyMask.setZero(),seedsToPlay_CanMove=[],seedsToPlay_CantMove=[],calculateRowColMasks();var s=0;do{if(l=!1,s++,applyRules(state.rules,state.loopPoint,a,bannedGroup),resolveMovements(level,bannedGroup))l=!0,consolePrint("Rigid movement application failed. Rolling back..."),level.objects=new Int32Array(b.objects),level.movements=new Int32Array(b.movements),level.rigidGroupIndexMask=b.rigidGroupIndexMask.concat([]),level.rigidMovementAppliedMask=b.rigidMovementAppliedMask.concat([]),level.commandQueue=b.commandQueue.concat([]),level.commandQueueSourceRules=b.commandQueueSourceRules.concat([]),sfxCreateMask.setZero(),sfxDestroyMask.setZero(),verbose_logging&&l&&s>0&&(consolePrint("Relooping through rules because of rigid."),debugger_turnIndex++,addToDebugTimeline(level,-2)),a=0;else{if(verbose_logging){var c=debug_visualisation_array[debugger_turnIndex].length+1;consolePrint("Processed movements.",!1,null,i=addToDebugTimeline(level,c)),state.lateRules.length>0&&(debugger_turnIndex++,addToDebugTimeline(level,-2),consolePrint("Applying late rules"))}applyRules(state.lateRules,state.lateLoopPoint,0),a=0}}while(s<250&&l);if(s>=250)return consolePrint("looped through 250 times, gave up. Too many loops!"),applyRules(state.lateRules,state.lateLoopPoint,0),a=0,backups.push(r),DoUndo(!0,!1),!1;if(level.commandQueue.indexOf("undo")>=0)return verbose_logging&&(consoleCacheDump(),consolePrint("UNDO command executed, undoing turn.",!0)),messagetext="",DoUndo(!0,!1),!0;if(playerPositionsAtTurnStart.length>0&&void 0!==state.metadata.require_player_movement&&e>=0){var u=!1;for(s=0;s<playerPositionsAtTurnStart.length;s++){var d=playerPositionsAtTurnStart[s],h=level.getCell(d);if(state.playerMask.bitsClearInArray(h.data)){u=!0;break}}if(!1===u)return verbose_logging&&(consolePrint("require_player_movement set, but no player movement detected, so cancelling turn."),consoleCacheDump()),addUndoState(r),DoUndo(!0,!1),!1}if(level.commandQueue.indexOf("cancel")>=0){if(verbose_logging)consoleCacheDump(),consolePrintFromRule("CANCEL command executed, cancelling turn.",v=level.commandQueueSourceRules[level.commandQueue.indexOf("cancel")],!0);return processOutputCommands(level.commandQueue),addUndoState(r),DoUndo(!0,!1,!0,!1),tryPlayCancelSound(),!1}if(level.commandQueue.indexOf("restart")>=0){if(verbose_logging)consolePrintFromRule("RESTART command executed, reverting to restart state.",v=level.commandQueueSourceRules[level.commandQueue.indexOf("restart")]),consoleCacheDump();return processOutputCommands(level.commandQueue),addUndoState(r),DoRestart(!0),!0}if(level.commandQueue.indexOf("quit")>=0&&!solving){if(verbose_logging)consolePrintFromRule("QUIT command executed, exiting level.",v=level.commandQueueSourceRules[level.commandQueue.indexOf("restart")]),consoleCacheDump();return void 0!==state.metadata.level_select?gotoLevelSelectScreen():goToTitleScreen(),messagetext="",canvasResize(),!0}if(n&&level.commandQueue.indexOf("win")>=0)return!0;var f=!0;if(!winning&&level.commandQueue.indexOf("nosave")>=0){if(verbose_logging)consolePrintFromRule("NOSAVE command executed, not storing current state to undo queue.",v=level.commandQueueSourceRules[level.commandQueue.indexOf("nosave")]);f=!1}var p=!1;for(s=0;s<level.objects.length;s++)if(level.objects[s]!==r.dat[s]){if(n)return verbose_logging&&consoleCacheDump(),addUndoState(r),DoUndo(!0,!1,!1),!0;-1!==e&&f&&addUndoState(r),p=!0,updateCameraPositionTarget();break}if(n&&level.commandQueue.indexOf("win")>=0)return!0;if(n)return verbose_logging&&consoleCacheDump(),!1;for(s=0;s<seedsToPlay_CantMove.length;s++)playSound(seedsToPlay_CantMove[s]);for(s=0;s<seedsToPlay_CanMove.length;s++)playSound(seedsToPlay_CanMove[s]);for(s=0;s<state.sfx_CreationMasks.length;s++){var g=state.sfx_CreationMasks[s];sfxCreateMask.anyBitsInCommon(g.objectMask)&&playSound(g.seed)}for(s=0;s<state.sfx_DestructionMasks.length;s++){g=state.sfx_DestructionMasks[s];sfxDestroyMask.anyBitsInCommon(g.objectMask)&&playSound(g.seed)}if(processOutputCommands(level.commandQueue),!1===textMode&&(verbose_logging&&consolePrint("Checking win conditions."),void 0===t&&(t=!1),checkWin(t)),!winning){if(level.commandQueue.indexOf("checkpoint")>=0){if(verbose_logging)consolePrintFromRule("CHECKPOINT command executed, saving current state to the restart state.",v=level.commandQueueSourceRules[level.commandQueue.indexOf("checkpoint")]);restartTarget=level4Serialization(),hasUsedCheckpoint=!0;var m=JSON.stringify(restartTarget);storage_set(document.URL+"_checkpoint",m),storage_set(document.URL,curlevel)}if(level.commandQueue.indexOf("again")>=0){var v=level.commandQueueSourceRules[level.commandQueue.indexOf("again")],y=verbose_logging,_=messagetext;verbose_logging=!1,processInput(-1,!0,!0),(verbose_logging=y)&&consolePrintFromRule("AGAIN command executed, with changes detected - will execute another turn.",v),againing=!0,timer=0,verbose_logging=y,messagetext=_}}verbose_logging&&consolePrint("Turn complete"),currentMovedEntities=newMovedEntities,tweentimer=0,level.commandQueue=[],level.commandQueueSourceRules=[]}return verbose_logging&&consoleCacheDump(),winning&&(againing=!1),p}function checkWin(e){if(levelEditorOpened&&(e=!0),level.commandQueue.indexOf("win")>=0)return runrulesonlevelstart_phase?consolePrint("Win Condition Satisfied (However this is in the run_rules_on_level_start rule pass, so I'm going to ignore it for you.  Why would you want to complete a level before it's already started?!)"):solving||consolePrint("Win Condition Satisfied"),void(e||DoWin());var t=!1;if(state.winconditions.length>0){for(var n=!0,r=0;r<state.winconditions.length;r++){var o=state.winconditions[r],i=o[1],a=o[2],l=!0;switch(o[0]){case-1:for(var s=0;s<level.n_tiles;s++){var c=level.getCellInto(s,_o10);if(!i.bitsClearInArray(c.data)&&!a.bitsClearInArray(c.data)){l=!1;break}}break;case 0:var u=!1;for(s=0;s<level.n_tiles;s++){c=level.getCellInto(s,_o10);if(!i.bitsClearInArray(c.data)&&!a.bitsClearInArray(c.data)){u=!0;break}}!1===u&&(l=!1);break;case 1:for(s=0;s<level.n_tiles;s++){c=level.getCellInto(s,_o10);if(!i.bitsClearInArray(c.data)&&a.bitsClearInArray(c.data)){l=!1;break}}}!1===l&&(n=!1)}t=n}t&&(runrulesonlevelstart_phase?consolePrint("Win Condition Satisfied (However this is in the run_rules_on_level_start rule pass, so I'm going to ignore it for you.  Why would you want to complete a level before it's already started?!)"):solving||consolePrint("Win Condition Satisfied"),e||DoWin())}function DoWin(){winning||(againing=!1,tryPlayEndLevelSound(),unitTesting?nextLevel():(winning=!0,timer=0))}function nextLevel(){if(againing=!1,messagetext="",state&&state.levels&&curlevel>state.levels.length&&(curlevel=state.levels.length-1),ignoreNotJustPressedAction=!0,titleScreen&&titleMode<=1)isContinueOptionSelected()?loadLevelFromStateOrTarget():isNewGameOptionSelected()?(curlevel=0,curlevelTarget=null,void 0===state.metadata.level_select&&clearLocalStorage(),loadLevelFromStateOrTarget()):isLevelSelectOptionSelected()?(titleSelection=0,gotoLevelSelectScreen()):isCreditsOptionSelected()&&gotoCreditsScreen();else if(hasUsedCheckpoint&&(curlevelTarget=null,hasUsedCheckpoint=!1),curlevel<state.levels.length-1){var e=!1,t=state.levels[Number(curlevel)].section,n=state.levels[Number(curlevel)+1].section;n!=t&&(setSectionSolved(state.levels[Number(curlevel)].section),solvedSections.length==state.sections.length&&null!=state.winSection?curlevel=state.winSection.firstLevel-1:"__WIN__"==n&&(gotoLevelSelectScreen(),e=!0)),e||(curlevel++,curlevelTarget=null,textMode=!1,titleScreen=!1,quittingMessageScreen=!1,messageselected=!1,loadLevelFromStateOrTarget())}else if(solvedSections.length==state.sections.length){if(void 0===state.metadata.level_select){try{storage_remove(document.URL),storage_remove(document.URL+"_checkpoint")}catch(e){}curlevel=0,curlevelTarget=null,goToTitleScreen()}else gotoLevelSelectScreen();tryPlayEndGameSound()}else null!=state.levels[Number(curlevel)].section&&setSectionSolved(state.levels[Number(curlevel)].section),gotoLevelSelectScreen();updateLocalStorage(),resetFlickDat(),canvasResize()}function loadLevelFromStateOrTarget(){null!==curlevelTarget?loadLevelFromStateTarget(state,curlevel,curlevelTarget):loadLevelFromState(state,curlevel)}function goToTitleScreen(){againing=!1,messagetext="",titleScreen=!0,textMode=!0,hoverSelection=-1,doSetupTitleScreenLevelContinue(),state.metadata=deepClone(state.default_metadata),twiddleMetadataExtras(),null!==canvas&&regenSpriteImages(),generateTitleScreen()}function resetFlickDat(){void 0!==state&&void 0!==state.metadata.flickscreen&&(oldflickscreendat=[0,0,Math.min(state.metadata.flickscreen[0],level.width),Math.min(state.metadata.flickscreen[1],level.height)])}function updateLocalStorage(){try{if(storage_set(document.URL,curlevel),null!==curlevelTarget){restartTarget=level4Serialization();var e=JSON.stringify(restartTarget);storage_set(document.URL+"_checkpoint",e)}else storage_remove(document.URL+"_checkpoint")}catch(e){}}function setSectionSolved(e){if(null!=e&&null!=e&&"__WIN__"!=e.name&&!(solvedSections.indexOf(e)>=0))try{window.localStorage&&(solvedSections.push(e),localStorage.setItem(document.URL+"_sections",JSON.stringify(solvedSections)))}catch(e){}}function clearLocalStorage(){curlevel=0,curlevelTarget=null,solvedSections=[];try{window.localStorage&&(localStorage.removeItem(document.URL),localStorage.removeItem(document.URL+"_checkpoint"),localStorage.removeItem(document.URL+"_sections"))}catch(e){}}var cameraPositionTarget=null,cameraPosition={x:0,y:0};function initSmoothCamera(){if(void 0!==state&&void 0!==state.metadata.smoothscreen){screenwidth=state.metadata.smoothscreen.screenSize.width,screenheight=state.metadata.smoothscreen.screenSize.height;var e=state.metadata.smoothscreen.boundarySize,t=state.metadata.smoothscreen.flick,n=getPlayerPositions();if(n.length>0){var r={x:n[0]/level.height|0,y:n[0]%level.height|0};cameraPositionTarget={x:t?getFlickCameraPosition(r.x,level.width,screenwidth,e.width):getCameraPosition(r.x,level.width,screenwidth),y:t?getFlickCameraPosition(r.y,level.height,screenheight,e.height):getCameraPosition(r.y,level.height,screenheight)},cameraPosition.x=cameraPositionTarget.x,cameraPosition.y=cameraPositionTarget.y}}}function getCameraPosition(e,t,n){return Math.min(Math.max(e,Math.floor(n/2)),t-Math.ceil(n/2))}function getFlickCameraPosition(e,t,n,r){var o=Math.floor(n/2)-Math.floor(r/2),i=e-o,a=Math.floor(i/r),l=Math.floor((t-Math.ceil(n/2)-Math.floor(r/2)-o)/r);return Math.min(Math.max(a,0),l)*r+Math.floor(n/2)}function updateCameraPositionTarget(){var e=state.metadata.smoothscreen,t=getPlayerPositions();if(e&&0!==t.length){var n={x:t[0]/level.height|0,y:t[0]%level.height|0};["x","y"].forEach((function(t){var r="x"===t?screenwidth:screenheight,o="x"===t?"width":"height",i=level[o],a=e.boundarySize[o],l=n[t]-cameraPositionTarget[t],s=Math.sign(l),c=s>0?Math.ceil(a/2):-(Math.floor(a/2)+1);Math.abs(l)-Math.abs(c)>=0&&(cameraPositionTarget[t]=e.flick?getFlickCameraPosition(n[t],i,r,a):getCameraPosition(n[t]-c+s,i,r))}))}}function IsMouseGameInputEnabled(){return"mouse_left"in state.metadata||"mouse_drag"in state.metadata||"mouse_up"in state.metadata}var compiling=!1,errorStrings=[],errorCount=0,twiddleable_params=["background_color","text_color","key_repeat_interval","realtime_interval","again_interval","flickscreen","zoomscreen","smoothscreen","noundo","norestart","message_text_align"];function logErrorCacheable(e,t,n){if(compiling||n){if(void 0===t)return logErrorNoLine(e,n);var r='<a onclick="jumpToLine('+t.toString()+');"  href="javascript:void(0);"><span class="errorTextLineNumber"> line '+t.toString()+'</span></a> : <span class="errorText">'+e+"</span>";errorStrings.indexOf(r)>=0&&!n||(consolePrint(r),errorStrings.push(r),errorCount++)}}function logError(e,t,n){if(compiling||n){if(void 0===t)return logErrorNoLine(e,n);var r='<a onclick="jumpToLine('+t.toString()+');"  href="javascript:void(0);"><span class="errorTextLineNumber"> line '+t.toString()+'</span></a> : <span class="errorText">'+e+"</span>";errorStrings.indexOf(r)>=0&&!n||(consolePrint(r,!0),errorStrings.push(r),errorCount++)}}function logWarning(e,t,n){if(compiling||n){if(void 0===t)return logWarningNoLine(e,n);var r='<a onclick="jumpToLine('+t.toString()+');"  href="javascript:void(0);"><span class="errorTextLineNumber"> line '+t.toString()+'</span></a> : <span class="warningText">'+e+"</span>";errorStrings.indexOf(r)>=0&&!n||(consolePrint(r,!0),errorStrings.push(r))}}function logWarningNoLine(e,t){if(compiling||t){var n='<span class="warningText">'+e+"</span>";errorStrings.indexOf(n)>=0&&!t||(consolePrint(n,!0),errorStrings.push(n)),errorCount++}}function logErrorNoLine(e,t){if(compiling||t){var n='<span class="errorText">'+e+"</span>";errorStrings.indexOf(n)>=0&&!t||(consolePrint(n,!0),errorStrings.push(n)),errorCount++}}function logBetaMessage(e,t){if(compiling||t){var n='<span class="betaText">'+e+"</span>";errorStrings.indexOf(n)>=0&&!t||(consoleError(n),errorStrings.push(n))}}function blankLineHandle(e){"levels"===e.section?e.levels[e.levels.length-1].length>0&&e.levels.push([]):"objects"===e.section&&(e.objects_section=0)}"function"!=typeof Object.assign&&(Object.assign=function(e){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])}return t});var codeMirrorFn=function(){"use strict";var e=["objects","legend","sounds","collisionlayers","rules","winconditions","levels"],t=["sfx0","sfx1","sfx2","sfx3","sfx4","sfx5","sfx6","sfx7","sfx8","sfx9","sfx10","sfx11","sfx12","sfx13","cancel","checkpoint","restart","win","message","again","undo","nosave","quit","zoomscreen","flickscreen","smoothscreen","again_interval","realtime_interval","key_repeat_interval","noundo","norestart","background_color","text_color","goto","message_text_align"],n=/[\p{L}\p{N}_]+[\p{Z}\s]*/u,r=/\d+\b/,o=/(objects|collisionlayers|legend|sounds|rules|winconditions|levels)(?![\p{L}\p{N}_])[\p{Z}\s]*/u,i=/[\=]+/,a=/[^\(]+/,l=/[ \,]*/,s=/(move|action|create|destroy|cantmove|undo|restart|titlescreen|startgame|cancel|endgame|startlevel|endlevel|enterlevelselect|showmessage|closemessage|sfx0|sfx1|sfx2|sfx3|sfx4|sfx5|sfx6|sfx7|sfx8|sfx9|sfx10|sfx11|sfx12|sfx13)\b[\p{Z}\s]*/u,c=/^(action|up|down|left|right|\^|v|\<|\>|moving|stationary|parallel|perpendicular|horizontal|orthogonal|vertical|no|randomdir|random)$/,u=/^(startloop|endloop)$/,d=/^(up|down|left|right|horizontal|vertical|orthogonal|late|rigid)$/,h=/[\p{Z}\s]*(up|down|left|right|horizontal|vertical|orthogonal)(?![\p{L}\p{N}_])[\p{Z}\s]*/u,f=/^(all|any|no|some)$/,p=["title","author","homepage","background_color","text_color","key_repeat_interval","realtime_interval","again_interval","flickscreen","zoomscreen","smoothscreen","color_palette","youtube","sprite_size","level_select_unlocked_ahead","level_select_solve_symbol","custom_font","mouse_left","mouse_drag","mouse_right","mouse_rdrag","mouse_up","mouse_rup","local_radius","font_size","tween_length","tween_easing","tween_snap","message_text_align","text_controls","text_message_continue","level_select_unlocked_rollover","sitelock_origin_whitelist","sitelock_hostname_whitelist"],g=["run_rules_on_level_start","norepeat_action","require_player_movement","debug","verbose_logging","throttle_movement","noundo","noaction","norestart","scanline","case_sensitive","level_select","credits","continue_is_level_select","level_select_lock","settings","runtime_metadata_twiddling","runtime_metadata_twiddling_debug","smoothscreen_debug","skip_title_screen","nokeyboard"],m=["checkpoint","objects","collisionlayers","legend","sounds","rules","...","winconditions","levels","|","[","]","up","down","left","right","late","rigid","^","v",">","<","no","randomdir","random","horizontal","vertical","any","all","no","some","moving","stationary","parallel","perpendicular","action","nosave","message","global","zoomscreen","flickscreen","smoothscreen","noundo","norestart","background_color","text_color","goto","message_text_align"];return{copyState:function(e){var t={};for(var n in e.objects)if(e.objects.hasOwnProperty(n)){var r=e.objects[n];t[n]={colors:r.colors.concat([]),lineNumber:r.lineNumber,spritematrix:r.spritematrix.concat([])}}var o=[];for(n=0;n<e.collisionLayers.length;n++)o.push(e.collisionLayers[n].concat([]));var i=[],a=[],l=[],s=[],c=[],u=[];for(n=0;n<e.legend_synonyms.length;n++)i.push(e.legend_synonyms[n].concat([]));for(n=0;n<e.legend_aggregates.length;n++)a.push(e.legend_aggregates[n].concat([]));for(n=0;n<e.legend_properties.length;n++)l.push(e.legend_properties[n].concat([]));for(n=0;n<e.sounds.length;n++)s.push(e.sounds[n].concat([]));for(n=0;n<e.levels.length;n++)c.push(e.levels[n].concat([]));for(n=0;n<e.winconditions.length;n++)u.push(e.winconditions[n].concat([]));var d=Object.assign({},e.original_case_names);return{lineNumber:e.lineNumber,objects:t,collisionLayers:o,commentLevel:e.commentLevel,section:e.section,visitedSections:e.visitedSections.concat([]),objects_candname:e.objects_candname,objects_section:e.objects_section,objects_spritematrix:e.objects_spritematrix.concat([]),tokenIndex:e.tokenIndex,currentSection:e.currentSection,legend_synonyms:i,legend_aggregates:a,legend_properties:l,sounds:s,rules:e.rules.concat([]),names:e.names.concat([]),winconditions:u,original_case_names:d,abbrevNames:e.abbrevNames.concat([]),metadata:e.metadata.concat([]),sprite_size:e.sprite_size,case_sensitive:e.case_sensitive,levels:c,STRIDE_OBJ:e.STRIDE_OBJ,STRIDE_MOV:e.STRIDE_MOV}},blankLine:function(e){"levels"===e.section&&e.levels[e.levels.length-1].length>0&&e.levels.push([])},token:function(v,y){var _=v.string,b=v.sol();function w(e){function t(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var n;n=y.case_sensitive?new RegExp("\\b"+t(e)+"\\b"):new RegExp("\\b"+t(e)+"\\b","i");var r=_.match(n);null!=r&&(y.original_case_names[e]=r[0])}if(b&&(y.case_sensitive||(v.string=v.string.toLowerCase()),y.tokenIndex=0),v.eatWhile(/[ \t]/),"("===(I=v.peek())&&-4!==y.tokenIndex)v.next(),y.commentLevel++;else if(")"===I&&(v.next(),y.commentLevel>0&&(y.commentLevel--,0===y.commentLevel)))return"comment";if(y.commentLevel>0){for(;v.eatWhile(/[^\(\)]+/),!v.eol()&&("("===(I=v.peek())?y.commentLevel++:")"===I&&y.commentLevel--,v.next(),0!==y.commentLevel););return"comment"}if(v.eatWhile(/[ \t]/),b&&v.eol())return blankLineHandle(y);if(b&&v.match(i,!0))return"EQUALSBIT";if(b&&v.match(o,!0)){y.section=v.string.slice(0,v.pos).trim().toLowerCase(),y.visitedSections.indexOf(y.section)>=0&&logError('cannot duplicate sections (you tried to duplicate "'+y.section+'").',y.lineNumber),y.visitedSections.push(y.section);var x=e.indexOf(y.section);if(0==x?(y.objects_section=0,y.visitedSections.length>1&&logError('section "'+y.section+'" must be the first section',y.lineNumber)):-1==y.visitedSections.indexOf(e[x-1])&&logError(-1===x?'no such section as "'+y.section+'".':'section "'+y.section+'" is out of order, must follow  "'+e[x-1]+'".',y.lineNumber),"sounds"===y.section){for(var S in y.objects)y.objects.hasOwnProperty(S)&&y.names.push(S);for(var k=0;k<y.legend_synonyms.length;k++){S=y.legend_synonyms[k][0];y.names.push(S)}for(k=0;k<y.legend_aggregates.length;k++){S=y.legend_aggregates[k][0];y.names.push(S)}for(k=0;k<y.legend_properties.length;k++){S=y.legend_properties[k][0];y.names.push(S)}}else if("levels"===y.section){for(var S in y.objects)y.objects.hasOwnProperty(S)&&1==S.length&&y.abbrevNames.push(S);for(k=0;k<y.legend_synonyms.length;k++)1==y.legend_synonyms[k][0].length&&y.abbrevNames.push(y.legend_synonyms[k][0]);for(k=0;k<y.legend_aggregates.length;k++)1==y.legend_aggregates[k][0].length&&y.abbrevNames.push(y.legend_aggregates[k][0])}return"HEADER"}if(void 0===y.section&&logError('must start with section "OBJECTS"',y.lineNumber),v.eol())return null;switch(y.section){case"objects":var C=function(){var e=b?v.match(n,!0):v.match(/[^\p{Z}\s\()]+[\p{Z}\s]*/u,!0);if(null==e)return v.match(a,!0),v.pos>0&&logWarning('Unknown junk in object section (possibly: the main names for objects have to be words containing only the letters a-z0.9 - if you want to call them something like ",", do it in the legend section).',y.lineNumber),"ERROR";var t=e[0].trim();if(void 0!==y.objects[t])return logError('Object "'+t+'" defined multiple times.',y.lineNumber),"ERROR";for(var r=0;r<y.legend_synonyms.length;r++){y.legend_synonyms[r][0]==t&&logError('Name "'+t+'" already in use.',y.lineNumber)}if(m.indexOf(t)>=0&&logWarning('You named an object "'+t+"\", but this is a keyword. Don't do that!",y.lineNumber),b)y.objects_candname=t,w(t),y.objects[y.objects_candname]={lineNumber:y.lineNumber,colors:[],spritematrix:[],cloneSprite:""};else{if("copy:"==t.substring(0,5)&&t.length>5){var o=t.substring(5);return""!=y.objects[y.objects_candname].cloneSprite?(logError("You already assigned a sprite parent for "+o+", you can't have more than one!",y.lineNumber),"ERROR"):o==y.objects_candname?(logError("You attempted to set the sprite parent for "+o+" to "+o+"! Please don't, and keep the recursion in check.",y.lineNumber),"ERROR"):(y.objects[y.objects_candname].cloneSprite=o,"SPRITEPARENT")}var i;w(t),(i=[t,y.objects_candname]).lineNumber=y.lineNumber,y.legend_synonyms.push(i)}return y.case_sensitive&&("player"==t.toLowerCase()&&"player"!=t||"background"==t.toLowerCase()&&"background"!=t)&&((i=[t.toLowerCase(),y.objects_candname]).lineNumber=y.lineNumber,y.legend_synonyms.push(i)),y.objects_section=1,"NAME"};switch(b&&2==y.objects_section&&(y.objects_section=3),b&&1==y.objects_section&&(y.objects_section=2),y.objects_section){case 0:case 1:return y.objects_spritematrix=[],C();case 2:v.string=v.string.toLowerCase(),y.tokenIndex=0;var M=v.match(reg_color,!0);if(null==M){var T=v.match(n,!0)||v.match(a,!0);return logError("Was looking for color for object "+y.objects_candname+', got "'+T+'" instead.',y.lineNumber),null}void 0===y.objects[y.objects_candname].colors?y.objects[y.objects_candname].colors=[M[0].trim()]:y.objects[y.objects_candname].colors.push(M[0].trim());var E=M[0].trim().toLowerCase();return E in colorPalettes.arnecolors?"COLOR COLOR-"+E.toUpperCase():"transparent"===E?"COLOR FADECOLOR":"MULTICOLOR"+M[0];case 3:var I=v.eat(/[.\d]/),L=y.objects_spritematrix;if(void 0===I)return 0===L.length?C():(logError("Unknown junk in spritematrix for object "+y.objects_candname+".",y.lineNumber),v.match(a,!0),null);b&&L.push("");var A=y.objects[y.objects_candname];return L[L.length-1]+=I,L[L.length-1].length>y.sprite_size?(logError("Sprites must be "+y.sprite_size+" wide and "+y.sprite_size+" high.",y.lineNumber),v.match(a,!0),null):(A.spritematrix=y.objects_spritematrix,L.length===y.sprite_size&&L[L.length-1].length==y.sprite_size&&(y.objects_section=0),"."!==I?(S=parseInt(I))>=A.colors.length?(logError("Trying to access color number "+S+" from the color palette of sprite "+y.objects_candname+", but there are only "+A.colors.length+" defined in it.",y.lineNumber),"ERROR"):isNaN(S)?(logError('Invalid character "'+I+'" in sprite for '+y.objects_candname,y.lineNumber),"ERROR"):"COLOR BOLDCOLOR COLOR-"+A.colors[S].toUpperCase():"COLOR FADECOLOR");default:window.console.logError("EEK shouldn't get here.")}break;case"sounds":if(b){var R=!0;(W=a.exec(v.string)[0].split(/[\p{Z}\s]/u).filter((function(e){return""!==e}))).push(y.lineNumber),y.sounds.push(W)}if(null!==(D=v.match(s,!0)))return"SOUNDVERB";if(null!==(D=v.match(h,!0)))return"DIRECTION";if(null!==(D=v.match(r,!0)))return y.tokenIndex++,"SOUND";if(null!==(D=v.match(/[^\[\|\]\p{Z}\s]*/u,!0))){var O=D[0].trim();if(y.names.indexOf(O)>=0)return"NAME"}else D=v.match(a,!0);return logError('unexpected sound token "'+D+'".',y.lineNumber),v.match(a,!0),"ERROR";case"collisionlayers":if(b&&(y.collisionLayers.push([]),y.tokenIndex=0),null===(G=v.match(n,!0))){var F=v.pos;return v.match(l,!0),v.pos==F&&(logError("error detected - unexpected character "+v.peek(),y.lineNumber),v.next()),null}var D=G[0].trim(),P=function(e){if(y.case_sensitive||(e=e.toLowerCase()),e in y.objects)return[e];for(var t=0;t<y.legend_synonyms.length;t++){if((n=y.legend_synonyms[t])[0]===e)return P(n[1])}for(t=0;t<y.legend_aggregates.length;t++){if((n=y.legend_aggregates[t])[0]===e)return logError('"'+e+'" is an aggregate (defined using "and"), and cannot be added to a single layer because its constituent objects must be able to coexist.',y.lineNumber),[]}for(t=0;t<y.legend_properties.length;t++){var n;if((n=y.legend_properties[t])[0]===e)return[].concat.apply([],n.slice(1).map(P))}return logError('Cannot add "'+D+'" to a collision layer; it has not been declared.',y.lineNumber),[]};"background"===D.toLowerCase()?(y.collisionLayers.length>0&&y.collisionLayers[y.collisionLayers.length-1].length>0&&logError("Background must be in a layer by itself.",y.lineNumber),y.tokenIndex=1):0!==y.tokenIndex&&logError("Background must be in a layer by itself.",y.lineNumber);var N=P(D);if(0===y.collisionLayers.length)return logError("no layers found.",y.lineNumber),"ERROR";var B=[];for(k=0;k<N.length;k++){D=N[k];for(var H=0;H<=y.collisionLayers.length-1;H++){y.collisionLayers[H].indexOf(D)>=0&&H!=y.collisionLayers.length-1&&B.push(H)}}if(B.length>0){var z='Object "'+D+'" included in multiple collision layers ( layers ';for(k=0;k<B.length;k++)z+="#"+(B[k]+1)+", ";logWarning((z+="#"+y.collisionLayers.length)+" ). You should fix this!",y.lineNumber)}return y.collisionLayers[y.collisionLayers.length-1]=y.collisionLayers[y.collisionLayers.length-1].concat(N),N.length>0?"NAME":"ERROR";case"legend":if(b){var j=v.string.replace("="," = "),W=(j=a.exec(j)[0]).split(/[\p{Z}\s]/u).filter((function(e){return""!==e}));R=!0;if(W.length>0){D=W[0];y.case_sensitive||(D=D.toLowerCase()),m.indexOf(D)>=0&&logWarning('You named an object "'+D+"\", but this is a keyword. Don't do that!",y.lineNumber),W.indexOf(D,2)>=2&&logError("You can't define object "+D.toUpperCase()+" in terms of itself!",y.lineNumber),function(e,t){if(void 0!==e.objects[t])return logError('Object "'+t+'" defined multiple times.',e.lineNumber),"ERROR";for(var n=0;n<e.legend_synonyms.length;n++)e.legend_synonyms[n][0]==t&&logError('Name "'+t+'" already in use.',e.lineNumber);for(n=0;n<e.legend_aggregates.length;n++)e.legend_aggregates[n][0]==t&&logError('Name "'+t+'" already in use.',e.lineNumber);for(n=0;n<e.legend_properties.length;n++)e.legend_properties[n][0]==t&&logError('Name "'+t+'" already in use.',e.lineNumber)}(y,D)}if(R)if(W.length<3)R=!1;else if("="!==W[1])R=!1;else if(3===W.length){var V=[W[0],W[2]];y.case_sensitive||(V[1]=V[1].toLowerCase()),V.lineNumber=y.lineNumber,w(W[0]),y.legend_synonyms.push(V)}else if(W.length%2==0)R=!1;else{var U=W[3].toLowerCase();if("and"===U){for(P=function(e){if(y.case_sensitive||(e=e.toLowerCase()),e in y.objects)return[e];for(var t=0;t<y.legend_synonyms.length;t++){if((n=y.legend_synonyms[t])[0]===e)return P(n[1])}for(t=0;t<y.legend_aggregates.length;t++){if((n=y.legend_aggregates[t])[0]===e)return[].concat.apply([],n.slice(1).map(P))}for(t=0;t<y.legend_properties.length;t++){var n;if((n=y.legend_properties[t])[0]===e)return logError("Cannot define an aggregate (using 'and') in terms of properties (something that uses 'or').",y.lineNumber),R=!1,[e]}return[e]},k=5;k<W.length;k+=2)if("and"!==W[k].toLowerCase()){R=!1;break}if(R){var q=[W[0]].concat(P(W[2])).concat(P(W[4]));for(k=6;k<W.length;k+=2)q=q.concat(P(W[k]));q.lineNumber=y.lineNumber,w(q[0]),y.legend_aggregates.push(q)}}else if("or"===U){for(P=function(e){if(y.case_sensitive||(e=e.toLowerCase()),e in y.objects)return[e];for(var t=0;t<y.legend_synonyms.length;t++){if((n=y.legend_synonyms[t])[0]===e)return P(n[1])}for(t=0;t<y.legend_aggregates.length;t++){(n=y.legend_aggregates[t])[0]===e&&(logError("Cannot define a property (using 'or') in terms of aggregates (something that uses 'and').",y.lineNumber),R=!1)}for(t=0;t<y.legend_properties.length;t++){var n;if((n=y.legend_properties[t])[0]===e)return[].concat.apply([],n.slice(1).map(P))}return[e]},k=5;k<W.length;k+=2)if("or"!==W[k].toLowerCase()){R=!1;break}if(R){for(q=[W[0]].concat(P(W[2])).concat(P(W[4])),k=6;k<W.length;k+=2)y.case_sensitive?q.push(W[k]):q.push(W[k].toLowerCase());q.lineNumber=y.lineNumber,w(q[0]),y.legend_properties.push(q)}}else R=!1}else;if(!1===R)return logError("incorrect format of legend - should be one of A = B, A = B or C ( or D ...), A = B and C (and D ...)",y.lineNumber),v.match(a,!0),"ERROR";y.tokenIndex=0}if(0===y.tokenIndex)return v.match(/[^=]*/,!0),y.tokenIndex++,"NAME";if(1===y.tokenIndex)return v.next(),v.match(/[\p{Z}\s]*/u,!0),y.tokenIndex++,"ASSSIGNMENT";var G;if(null===(G=v.match(n,!0)))return logError("Something bad's happening in the LEGEND",y.lineNumber),v.match(a,!0),"ERROR";D=G[0].trim();if(y.tokenIndex%2==0){return!1===function(e){if(y.case_sensitive||(e=e.toLowerCase()),e in y.objects)return!0;for(var t=0;t<y.legend_aggregates.length;t++){if(y.legend_aggregates[t][0]===e)return!0}for(t=0;t<y.legend_properties.length;t++){if(y.legend_properties[t][0]===e)return!0}for(t=0;t<y.legend_synonyms.length;t++){if(y.legend_synonyms[t][0]===e)return!0}return!1}(D)?(logError('Cannot reference "'+D+'" in the LEGEND section; it has not been defined yet.',y.lineNumber),y.tokenIndex++,"ERROR"):(y.tokenIndex++,"NAME")}return y.tokenIndex++,"LOGICWORD";case"rules":if(b){var X=a.exec(v.string)[0];y.rules.push([X,y.lineNumber,_]),y.tokenIndex=0}if(-4===y.tokenIndex)return v.skipToEnd(),"MESSAGE";if(v.match(/[\p{Z}\s]*->[\p{Z}\s]*/u,!0))return"ARROW";if("["===I||"|"===I||"]"===I||"+"===I)return"+"!==I&&(y.tokenIndex=1),v.next(),v.match(/[\p{Z}\s]*/u,!0),"BRACKET";O=v.match(/[^\[\|\]\p{Z}\s]*/u,!0)[0].trim();return 0===y.tokenIndex&&u.exec(O)?"BRACKET":0===y.tokenIndex&&d.exec(O)||1===y.tokenIndex&&c.exec(O)?(v.match(/[\p{Z}\s]*/u,!0),"DIRECTION"):y.names.indexOf(O)>=0?b?(logError("Identifiers cannot appear outside of square brackets in rules, only directions can.",y.lineNumber),"ERROR"):(v.match(/[\p{Z}\s]*/u,!0),"NAME"):"..."===(O=O.toLowerCase())||"rigid"===O||"random"===O||"global"===O?"DIRECTION":t.indexOf(O)>=0?(("message"===O||"goto"===O||twiddleable_params.includes(O))&&(y.tokenIndex=-4),"COMMAND"):(logError('Name "'+O+'", referred to in a rule, does not exist.',y.lineNumber),"ERROR");case"winconditions":if(b){var Y=a.exec(v.string)[0].split(/[\p{Z}\s]/u).filter((function(e){return""!==e}));Y.push(y.lineNumber),y.winconditions.push(Y),y.tokenIndex=-1}if(y.tokenIndex++,null===(Z=v.match(/[\p{Z}\s]*[\p{L}\p{N}_]+[\p{Z}\s]*/u)))return logError("incorrect format of win condition.",y.lineNumber),v.match(a,!0),"ERROR";var Q=Z[0].trim();if(0===y.tokenIndex)return f.exec(Q)?"LOGICWORD":"ERROR";if(2===y.tokenIndex)return"on"!=Q?(logError('Expecting the word "ON" but got "'+Q.toUpperCase()+"'.",y.lineNumber),"ERROR"):"LOGICWORD";if(1===y.tokenIndex||3===y.tokenIndex)return-1===y.names.indexOf(Q)?(logError('Error in win condition: "'+Q+'" is not a valid object name.',y.lineNumber),"ERROR"):"NAME";break;case"levels":if(b){if(v.match(/[\p{Z}\s]*message\b[\p{Z}\s]*/u,!0)){y.tokenIndex=1;var K=["message",_.slice(v.pos).trim(),y.lineNumber,y.currentSection];return 0==y.levels[y.levels.length-1].length?y.levels.splice(y.levels.length-1,0,K):y.levels.push(K),"MESSAGE_VERB"}if(v.match(/[\p{Z}\s]*message[\p{Z}\s]*/u,!0)){logWarning("You probably meant to put a space after 'message' innit.  That's ok, I'll still interpret it as a message, but you probably want to put a space there.",y.lineNumber),y.tokenIndex=1;K=["message",_.slice(v.pos).trim(),y.lineNumber,y.currentSection];return 0==y.levels[y.levels.length-1].length?y.levels.splice(y.levels.length-1,0,K):y.levels.push(K),"MESSAGE_VERB"}if(v.match(/\s*section\s*/i,!0))return y.tokenIndex=3,y.currentSection=_.slice(v.pos).trim(),"SECTION_VERB";if(v.match(/\s*goto\s*/i,!0)){y.tokenIndex=4;K=["goto",_.slice(v.pos).trim(),y.lineNumber,y.currentSection];return 0==y.levels[y.levels.length-1].length?y.levels.splice(y.levels.length-1,0,K):y.levels.push(K),"GOTO_VERB"}var J=v.match(a,!1)[0].trim();y.tokenIndex=2;var $=y.levels[y.levels.length-1];"\n"==$[0]?y.levels.push([y.lineNumber,y.currentSection,J]):(0==$.length&&($.push(y.lineNumber),$.push(y.currentSection)),$.push(J),$.length>2&&J.length!=$[2].length&&logWarning("Maps must be rectangular, yo (In a level, the length of each row must be the same).",y.lineNumber))}else{if(1==y.tokenIndex)return v.skipToEnd(),"MESSAGE";if(3==y.tokenIndex)return v.skipToEnd(),"SECTION";if(4==y.tokenIndex)return v.skipToEnd(),"GOTO"}if(2===y.tokenIndex&&!v.eol()){I=v.peek();return v.next(),y.abbrevNames.indexOf(I)>=0?"LEVEL":(logError('Key "'+I+'" not found. Do you need to add it to the legend, or define a new object?',y.lineNumber),"ERROR")}break;default:if(b&&(y.tokenIndex=0),0!=y.tokenIndex)return v.match(a,!0),"METADATATEXT";var Z;if(null!==(Z=v.match(/[\p{Z}\s]*[\p{L}\p{N}_]+[\p{Z}\s]*/u))){var ee=Z[0].trim();if(b){if(p.indexOf(ee)>=0){"youtube"!==ee&&"author"!==ee&&"homepage"!==ee&&"title"!==ee&&"custom_font"!==ee&&"text_controls"!==ee&&"text_message_continue"!==ee||(v.string=_);var te=v.match(a,!1);return null!=te?"sprite_size"==ee?y.sprite_size=parseInt(te[0].trim(),10):(y.metadata.push(ee),y.metadata.push(te[0].trim())):logError('MetaData "'+ee+'" needs a value.',y.lineNumber),y.tokenIndex=1,"METADATA"}return g.indexOf(ee)>=0?("case_sensitive"==ee&&(y.case_sensitive=!0),y.metadata.push(ee),y.metadata.push("true"),y.tokenIndex=-1,"METADATA"):(logError("Unrecognised stuff in the prelude.",y.lineNumber),"ERROR")}return-1==y.tokenIndex?(logError('MetaData "'+ee+'" has no parameters.',y.lineNumber),"ERROR"):"METADATA"}}return v.eol()?null:v.eol()?void 0:(v.next(),null)},startState:function(){return{objects:{},lineNumber:0,commentLevel:0,section:"",visitedSections:[],objects_candname:"",objects_section:0,objects_spritematrix:[],collisionLayers:[],tokenIndex:0,currentSection:null,legend_synonyms:[],legend_aggregates:[],legend_properties:[],sounds:[],rules:[],names:[],winconditions:[],metadata:[],sprite_size:5,case_sensitive:!1,original_case_names:{},abbrevNames:[],levels:[[]],subsection:""}}}};window.CodeMirror.defineMode("puzzle",codeMirrorFn);var code=document.getElementById("code"),_editorDirty=!1,_editorCleanState="",fileToOpen=getParameterByName("demo");if(null!==fileToOpen&&fileToOpen.length>0)tryLoadFile(fileToOpen),code.value="loading...";else{var gistToLoad=getParameterByName("hack");if(null!==gistToLoad&&gistToLoad.length>0){var id=gistToLoad.replace(/[\\\/]/,"");tryLoadGist(id),code.value="loading..."}else try{if(storage_has("saves")){var curSaveArray=JSON.parse(storage_get("saves")),sd=curSaveArray[curSaveArray.length-1];code.value=sd.text,(loadDropdown=document.getElementById("loadDropDown")).selectedIndex=0}}catch(e){}}CodeMirror.commands.swapLineUp=function(e){for(var t=e.listSelections(),n=[],r=e.firstLine()-1,o=[],i=0;i<t.length;i++){var a=t[i],l=a.from().line-1,s=a.to().line;o.push({anchor:CodeMirror.Pos(a.anchor.line-1,a.anchor.ch),head:CodeMirror.Pos(a.head.line-1,a.head.ch)}),l>r?n.push(l,s):n.length&&(n[n.length-1]=s),r=s}0!==n.length&&e.operation((function(){for(var t=0;t<n.length;t+=2){var r=n[t],i=n[t+1],a=e.getLine(r);e.replaceRange("",CodeMirror.Pos(r,0),CodeMirror.Pos(r+1,0),"+swapLine"),i>e.lastLine()?e.replaceRange("\n"+a,CodeMirror.Pos(e.lastLine()),null,"+swapLine"):e.replaceRange(a+"\n",CodeMirror.Pos(i,0),null,"+swapLine")}e.setSelections(o),e.scrollIntoView()}))},CodeMirror.commands.swapLineDown=function(e){for(var t=e.listSelections(),n=[],r=e.lastLine()+1,o=t.length-1;o>=0;o--){var i=t[o],a=i.to().line+1,l=i.from().line;a<r?n.push(a,l):n.length&&(n[n.length-1]=l),r=l}e.operation((function(){for(var t=n.length-2;t>=0;t-=2){var r=n[t],o=n[t+1],i=e.getLine(r);r==e.lastLine()?e.replaceRange("",CodeMirror.Pos(r-1),CodeMirror.Pos(r),"+swapLine"):e.replaceRange("",CodeMirror.Pos(r,0),CodeMirror.Pos(r+1,0),"+swapLine"),e.replaceRange(i+"\n",CodeMirror.Pos(o,0),null,"+swapLine")}e.scrollIntoView()}))};var editor=window.CodeMirror.fromTextArea(code,{lineWrapping:!0,lineNumbers:!0,styleActiveLine:!0,extraKeys:{"Ctrl-/":"toggleComment","Cmd-/":"toggleComment",Esc:CodeMirror.commands.clearSearch,"Shift-Ctrl-Up":"swapLineUp","Shift-Ctrl-Down":"swapLineDown"}});function checkEditorDirty(){var e=document.getElementById("saveClickLink");_editorCleanState!==editor.getValue()?(_editorDirty=!0,e&&(e.innerHTML="SAVE*")):(_editorDirty=!1,e&&(e.innerHTML="SAVE"))}function setEditorClean(){if(_editorCleanState=editor.getValue(),!0===_editorDirty){var e=document.getElementById("saveClickLink");e&&(e.innerHTML="SAVE"),_editorDirty=!1}}editor.on("mousedown",(function(e,t){"cm-SOUND"==t.target.className?playSound(parseInt(t.target.innerHTML)):"cm-LEVEL"==t.target.className&&(t.ctrlKey||t.metaKey)&&(document.activeElement.blur(),editor.display.input.blur(),prevent(t),compile(["levelline",e.posFromMouse(t).line]))})),_editorCleanState=editor.getValue(),editor.on("change",(function(e,t){checkEditorDirty()}));var debugMode,colorPalette,mapObj={parallel:"&#8741;",perpendicular:"&#8869;"};function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function tryLoadGist(e){var t="https://api.github.com/gists/"+e;consolePrint("Contacting GitHub",!0);var n=new XMLHttpRequest;n.open("GET",t),n.onreadystatechange=function(){if(4==n.readyState){""===n.responseText&&consoleError("GitHub request returned nothing.  A connection fault, maybe?");var e=JSON.parse(n.responseText);if(403===n.status)consoleError(e.message);else if(200!==n.status&&201!==n.status)consoleError("HTTP Error "+n.status+" - "+n.statusText);else{var t=e.files["script.txt"].content;editor.setValue(t),editor.clearHistory(),clearConsole(),setEditorClean(),unloadGame(),compile(["restart"],t)}}},n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send()}function tryLoadFile(e){var t=new XMLHttpRequest;t.open("GET","demo/"+e+".txt"),t.onreadystatechange=function(){4==t.readyState&&(editor.setValue(t.responseText),clearConsole(),setEditorClean(),unloadGame(),compile(["restart"]))},t.send()}function canExit(){return!_editorDirty||confirm("You haven't saved your game! Are you sure you want to lose your unsaved changes?")}function dropdownChange(){canExit()?(tryLoadFile(this.value),this.selectedIndex=0):this.selectedIndex=0}function debugPreview(e,t){diffToVisualize=debug_visualisation_array[e][t],redraw()}function debugUnpreview(){diffToVisualize=null,redraw()}function addToDebugTimeline(e,t){debug_visualisation_array.hasOwnProperty(debugger_turnIndex)||(debug_visualisation_array[debugger_turnIndex]=[]);var n={width:e.width,height:e.height,layerCount:e.layerCount,turnIndex:debugger_turnIndex,lineNumber:t,objects:new Int32Array(e.objects),movements:new Int32Array(e.movements),commandQueue:e.commandQueue.concat([]),commandQueueSourceRules:e.commandQueueSourceRules.concat([])};return debug_visualisation_array[debugger_turnIndex][t]=n,`${debugger_turnIndex},${t}`}code.editorreference=editor,editor.setOption("theme","midnight"),editor.on("keyup",(function(e,t){CodeMirror.ExcludedIntelliSenseTriggerKeys[(t.keyCode||t.which).toString()]||CodeMirror.commands.autocomplete(e,null,{completeSingle:!1})}));"use strict";function isColor(e){return(e=e.trim())in colorPalettes.arnecolors||(!!/^#([0-9A-F]{2}){3,4}$/i.test(e)||(!!/^#([0-9A-F]{3})$/i.test(e)||"transparent"===e))}function colorToHex(e,t){return(t=t.trim())in e?e[t]:t}function generateSpriteMatrix(e){for(var t=[],n=0;n<e.length;n++){for(var r=[],o=0;o<e.length;o++){var i=e[n].charAt(o);"."==i?r.push(-1):r.push(i)}t.push(r)}return t}function generateExtraMembers(e){0===e.collisionLayers.length&&logError("No collision layers defined.  All objects need to be in collision layers."),e.idDict=[];for(var t=0,n=0;n<e.collisionLayers.length;n++)for(var r=0;r<e.collisionLayers[n].length;r++){if((c=e.collisionLayers[n][r])in e.objects)(f=e.objects[c]).layer=n,f.id=t,e.idDict[t]=c,t++}e.objectCount=t;for(var o=e.collisionLayers.length,i=[],a=0;a<o;a++)i.push(-1);STRIDE_OBJ=0|Math.ceil(e.objectCount/32),STRIDE_MOV=0|Math.ceil(o/5),e.STRIDE_OBJ=STRIDE_OBJ,e.STRIDE_MOV=STRIDE_MOV,debugMode=!1,verbose_logging=!1,throttle_movement=!1,colorPalette=colorPalettes.arnecolors;for(a=0;a<e.metadata.length;a+=2){var l=e.metadata[a],s=e.metadata[a+1];"color_palette"===l?(s in colorPalettesAliases&&(s=colorPalettesAliases[s]),void 0===colorPalettes[s]?logError('Palette "'+s+'" not found, defaulting to arnecolors.',0):colorPalette=colorPalettes[s]):"debug"===l?IDE&&!1===unitTesting&&(debugMode=!0,cache_console_messages=!0):"verbose_logging"===l?IDE&&!1===unitTesting&&(verbose_logging=!0,cache_console_messages=!0):"throttle_movement"===l&&(throttle_movement=!0)}for(var c in e.objects)if(e.objects.hasOwnProperty(c)){(f=e.objects[c]).colors.length>10&&logError("a sprite cannot have more than 10 colors.  Why you would want more than 10 is beyond me.",f.lineNumber+1);for(a=0;a<f.colors.length;a++){var u=f.colors[a];isColor(u)?(u=colorToHex(colorPalette,u),f.colors[a]=u):(logError('Invalid color specified for object "'+c+'", namely "'+f.colors[a]+'".',f.lineNumber+1),f.colors[a]="#ff00ff")}}for(var c in e.objects){if(e.objects.hasOwnProperty(c))if(0==(f=e.objects[c]).colors.length&&(logError('color not specified for object "'+c+'".',f.lineNumber),f.colors=["#ff00ff"]),""!==f.cloneSprite)e.objects.hasOwnProperty(f.cloneSprite)?""===e.objects[f.cloneSprite].cloneSprite?f.spritematrix=deepClone(e.objects[f.cloneSprite].spritematrix):logError("The sprite that "+c+" attempted to clone ("+f.cloneSprite+") clones a sprite itself ("+e.objects[f.cloneSprite].cloneSprite+"), so it can't clone the sprite! You'll need to set up the cloning differently.",f.lineNumber):logError(c+" attempted to clone the sprite matrix of "+f.cloneSprite+", but that object doesn't exist?!",f.lineNumber);else if(0===f.spritematrix.length){f.spritematrix=new Array(e.sprite_size);var d=new Array(e.sprite_size);for(a=0;a<e.sprite_size;a++)d[a]=0;for(a=0;a<e.sprite_size;a++)f.spritematrix[a]=d}else{if(f.spritematrix.length!==e.sprite_size)logWarning("Sprite graphics must be "+e.sprite_size+" wide and "+e.sprite_size+" high exactly.",f.lineNumber);else for(a=0;a<e.sprite_size;a++)if(f.spritematrix[a].length!==e.sprite_size){logWarning("Sprite graphics must be "+e.sprite_size+" wide and "+e.sprite_size+" high exactly.",f.lineNumber);break}f.spritematrix=generateSpriteMatrix(f.spritematrix)}}var h={};for(var c in e.objects)if(e.objects.hasOwnProperty(c)){var f=e.objects[c];(y=i.concat([]))[f.layer]=f.id,h[c]=y}for(var p=!0;p;){p=!1;for(a=0;a<e.legend_synonyms.length;a++){l=(g=e.legend_synonyms[a])[0],s=g[1];l in h&&void 0!==h[l]||void 0===h[s]||(p=!0,h[l]=h[s])}for(a=0;a<e.legend_aggregates.length;a++){l=(g=e.legend_aggregates[a])[0];var g,m=g.slice(1),v=!0;for(r=0;r<m.length;r++){if(void 0===h[m[r]]){v=!1;break}}if((!(l in h)||void 0===h[l])&&v){var y=i.concat([]);for(r=1;r<g.length;r++){c=g[r];if(null==(f=e.objects[c])&&logError("Object not found with name "+c,e.lineNumber),-1==y[f.layer])y[f.layer]=f.id;else if(void 0===f.layer)logError('Object "'+c.toUpperCase()+'" has been defined, but not assigned to a layer.',g.lineNumber);else{var _=c.toUpperCase(),b=e.idDict[y[f.layer]].toUpperCase();_!==b&&logError('Trying to create an aggregate object (defined in the legend) with both "'+_+'" and "'+b+"\", which are on the same layer and therefore can't coexist.",g.lineNumber)}}p=!0,h[g[0]]=y}}}e.glyphDict=h;var w={};for(a=0;a<e.legend_aggregates.length;a++){w[(k=e.legend_aggregates[a])[0]]=k.slice(1)}e.aggregatesDict=w;var x={};for(a=0;a<e.legend_properties.length;a++){x[(k=e.legend_properties[a])[0]]=k.slice(1)}e.propertiesDict=x;var S={};for(a=0;a<e.legend_synonyms.length;a++){var k;l=(k=e.legend_synonyms[a])[0];(A=k[1])in w?w[l]=w[A]:A in x?x[l]=x[A]:l!==A&&(S[l]=A)}e.synonymsDict=S;for(var C,M,T=!0;T;){for(var c in T=!1,S){if(S.hasOwnProperty(c))(A=S[c])in x?(delete S[c],x[c]=x[A],T=!0):A in w?(delete w[c],w[c]=w[A],T=!0):A in S&&(S[c]=S[A])}for(var c in x)if(x.hasOwnProperty(c)){var E=x[c];for(a=0;a<E.length;a++){if((A=E[a])in S)E[a]=S[A],T=!0;else if(A in x){E.splice(a,1);var I=x[A];for(r=0;r<I.length;r++){var L=I[r];-1===E.indexOf(L)&&E.push(L)}T=!0}A in w&&logError('Trying to define property "'+c.toUpperCase()+'" in terms of aggregate "'+A.toUpperCase()+'".')}}for(var c in w)if(w.hasOwnProperty(c))for(E=w[c],a=0;a<E.length;a++){var A;if((A=E[a])in S)E[a]=S[A],T=!0;else if(A in w){E.splice(a,1);for(I=w[A],r=0;r<I.length;r++){L=I[r];-1===E.indexOf(L)&&E.push(L)}T=!0}A in x&&logError('Trying to define aggregate "'+c.toUpperCase()+'" in terms of property "'+A.toUpperCase()+'".')}}for(var l in e.propertiesSingleLayer={},x)if(x.hasOwnProperty(l)){E=x[l];var R=!0;for(a=1;a<E.length;a++)if(e.objects[E[a-1]].layer!==e.objects[E[a]].layer){R=!1;break}R&&(e.propertiesSingleLayer[l]=e.objects[E[0]].layer)}if(void 0===e.idDict[0]&&e.collisionLayers.length>0&&logError("You need to have some objects defined"),void 0===e.objects.background)if("background"in e.synonymsDict){c=e.synonymsDict.background;C=(f=e.objects[c]).id,M=f.layer}else if("background"in e.propertiesDict){c=e.propertiesDict.background[0];C=(f=e.objects[c]).id,M=f.layer}else if("background"in e.aggregatesDict){C=(f=e.objects[e.idDict[0]]).id,M=f.layer,logError("background cannot be an aggregate (declared with 'and'), it has to be a simple type, or property (declared in terms of others using 'or').")}else{null!=(f=e.objects[e.idDict[0]])&&(C=f.id,M=f.layer),logError("you have to define something to be the background")}else C=e.objects.background.id,M=e.objects.background.layer;e.backgroundid=C,e.backgroundlayer=M}function generateExtraMembersPart2(e){function t(t,n){if(t in e.metadata){var r=e.metadata[t]||n,o=null;if(e.objects[r])o=e.objects[r].id;else if(r in e.synonymsDict){var i=e.synonymsDict[r];o=e.objects[i].id}else{o=e.objects[e.idDict[1]].id,logError(r+" object/alias has to be defined")}return o}}if(e.lmbID=t("mouse_left","lmb"),e.rmbID=t("mouse_right","rmb"),e.dragID=t("mouse_drag","drag"),e.rdragID=t("mouse_rdrag","rdrag"),e.lmbupID=t("mouse_up","lmbup"),e.rmbupID=t("mouse_rup","rmbup"),"mouse_obstacle"in e.metadata){var n=e.metadata.mouse_obstacle;n&&(e.obstacleMask=e.objectMasks[n],e.obstacleMask||(logError(n+" object/alias has to be defined."),e.obstacleMask=e.objectMasks.background))}}function levelFromString(e,t){var n=e.backgroundlayer,r=(e.backgroundid,e.layerMasks[n]),o=new Level(t[0],t[2].length,t.length-2,e.collisionLayers.length,null,t[1]);o.objects=new Int32Array(o.width*o.height*STRIDE_OBJ);for(var i=0;i<o.width;i++)for(var a=0;a<o.height;a++){var l=t[a+2].charAt(i);0==l.length&&(l=t[a+2].charAt(t[a+2].length-1));var s=e.glyphDict[l];null==s&&(void 0===e.propertiesDict[l]?logError('Error, symbol "'+l+'", used in map, not found.',t[0]+a):logError('Error, symbol "'+l+"\" is defined using 'or', and therefore ambiguous - it cannot be used in a map. Did you mean to define it in terms of 'and'?",t[0]+a));var c=new BitVec(STRIDE_OBJ);s=s.concat([]);for(var u=0;u<o.layerCount;u++)s[u]>=0&&c.ibitset(s[u]);for(var d=0;d<STRIDE_OBJ;++d)o.objects[STRIDE_OBJ*(i*o.height+a)+d]=c.data[d]}var h=o.calcBackgroundMask(e);for(i=0;i<o.n_tiles;i++){var f=o.getCell(i);r.anyBitsInCommon(f)||(f.ior(h),o.setCell(i,f))}return o}function levelsToArray(e){for(var t=e.levels,n=[],r=!1,o=null,i=0;i<t.length;i++){var a,l=t[i];if(0!=l.length)"message"==l[0]?(a={message:l[1],section:l[3]},(splitMessage=wordwrap(a.message,intro_template[0].length)).length>12&&logWarning("Message too long to fit on screen.",l[2]),a.section!=o&&(r=!1,o=a.section),r&&logWarning("Message unreachable due to previous GOTO.",l[2])):"goto"==l[0]?((a={target:l[1],lineNumber:l[2],section:l[3]}).section!=o&&(r=!1,o=a.section),r&&logWarning("GOTO unreachable due to previous GOTO.",a.lineNumber),r=!0):((a=levelFromString(e,l)).section!=o&&(r=!1,o=a.section),r&&logWarning("Level unreachable due to previous GOTO.",a.lineNumber)),n.push(a)}e.levels=n}function extractSections(e){for(var t=[],n=null,r=0;r<e.levels.length;r++){var o=e.levels[r];if(o.section!=n){var i={name:o.section,firstLevel:r};"__WIN__"==i.name?e.winSection=i:t.push(i),n=o.section}}e.sections=t}function convertSectionNamesToIndices(e){for(var t={},n={},r=0;r<e.sections.length;r++){void 0===t[s=e.sections[r].name.toLowerCase()]?t[s]=r:n[s]=!0}for(var o=0;o<e.rules.length;o++)for(var i=e.rules[o],a=0;a<i.commands.length;a++){var l=i.commands[a];if("goto"==l[0]){var s,c=t[s=l[1].toLowerCase()];void 0===c?(logError('Invalid GOTO command - There is no section named "'+l[1]+'". Either it does not exist, or it has zero levels.',i.lineNumber),c=-1):void 0!==n[s]&&(logError('Invalid GOTO command - There are multiple sections named "'+l[1]+'". Section names must be unique for GOTO to work.',i.lineNumber),c=-1),l[1]=c}}for(var u=0;u<e.levels.length;u++){var d=e.levels[u];if(void 0!==d.target){var h=d.target.toLowerCase(),f=t[h];void 0===f?(logError('Invalid GOTO command - There is no section named "'+l[1]+'".',d.lineNumber),f=0):void 0!==n[h]&&(logError('Invalid GOTO command - There are multiple sections named "'+l[1]+'".',d.lineNumber),f=0),d.target=f}}}Level.prototype.calcBackgroundMask=function(e){void 0===e.backgroundlayer&&logError("you have to have a background layer");for(var t=e.layerMasks[e.backgroundlayer],n=0;n<this.n_tiles;n++){var r=this.getCell(n);if(r.iand(t),!r.iszero())return r}return(r=new BitVec(STRIDE_OBJ)).ibitset(e.backgroundid),r};var directionaggregates={horizontal:["left","right"],horizontal_par:["left","right"],horizontal_perp:["left","right"],vertical:["up","down"],vertical_par:["up","down"],vertical_perp:["up","down"],moving:["up","down","left","right","action"],orthogonal:["up","down","left","right"],perpendicular:["^","v"],parallel:["<",">"]},relativeDirections=["^","v","<",">","perpendicular","parallel"],simpleAbsoluteDirections=["up","down","left","right"],simpleRelativeDirections=["^","v","<",">"],reg_directions_only=/^(\>|\<|\^|v|up|down|left|right|moving|stationary|no|randomdir|random|horizontal|vertical|orthogonal|perpendicular|parallel|action)$/i,commandwords=["sfx0","sfx1","sfx2","sfx3","sfx4","sfx5","sfx6","sfx7","sfx8","sfx9","sfx10","sfx11","sfx12","sfx13","cancel","checkpoint","restart","win","message","again","undo","nosave","quit","zoomscreen","flickscreen","smoothscreen","again_interval","realtime_interval","key_repeat_interval","noundo","norestart","background_color","text_color","goto","message_text_align"];function directionalRule(e){for(var t=0;t<e.lhs.length;t++){if((i=e.lhs[t]).length>1)return!0;for(var n=0;n<i.length;n++)for(var r=i[n],o=0;o<r.length;o+=2)if(relativeDirections.indexOf(r[o])>=0)return!0}for(t=0;t<e.rhs.length;t++){var i;if((i=e.rhs[t]).length>1)return!0;for(n=0;n<i.length;n++)for(r=i[n],o=0;o<r.length;o+=2)if(relativeDirections.indexOf(r[o])>=0)return!0}return!1}function findIndexAfterToken(e,t,n){e=e.toLowerCase();for(var r=0,o=0;o<=n;o++){var i=t[o];r=e.indexOf(i,r)+i.length}return r}function rightBracketToRightOf(e,t){for(;t<e.length;t++)if("]"===e[t])return!0;return!1}function processRuleString(e,t,n){var r=e[0],o=e[1],i=e[2];"+"===(r=(r=r.replace(/\[/g," [ ").replace(/\]/g," ] ").replace(/\|/g," | ").replace(/\-\>/g," -> ")).trim())[0]&&(r=r.substring(0,1)+" "+r.substring(1,r.length));var a=r.split(/\s/).filter((function(e){return""!==e}));0==a.length&&logError("Spooky error!  Empty line passed to rule function.",o);var l=0,s=[],c=null,u=[],d=!1,h=!1,f=[],p=[],g=!1,m=!1,v=o,y=[],_=!1,b=!1,w=!1;if(1===a.length){if("startloop"===a[0])return T={bracket:1};if("endloop"===a[0])return T={bracket:-1}}-1==a.indexOf("->")&&logError("A rule has to have an arrow in it.  There's no arrow here! Consider reading up about rules - you're clearly doing something weird",o);c=[];for(var x=0,S=0;S<a.length;S++){var k=a[S];switch(l){case 0:"+"===k?(b=!0,v===o?(0==n.length&&logError('The "+" symbol, for joining a rule with the group of the previous rule, needs a previous rule to be applied to.'),0!==S&&logError('The "+" symbol, for joining a rule with the group of the previous rule, must be the first symbol on the line '),v=n[n.length-1].groupNumber):logError('Two "+"s ("append to previous rule group" symbol) applied to the same rule.',o)):k in directionaggregates?s=s.concat(directionaggregates[k]):"late"===k?g=!0:"rigid"===k?m=!0:"random"===k?(_=!0,b&&logError("A rule-group can only be marked random by the opening rule in the group (aka, a '+' and 'random' can't appear as rule modifiers on the same line).  Why? Well, you see \"random\" isn't a property of individual rules, but of whole rule groups.  It indicates that a single possible application of some rule from the whole group should be applied at random.",o)):"global"===k?w=!0:simpleAbsoluteDirections.indexOf(k)>=0?s.push(k):simpleRelativeDirections.indexOf(k)>=0?logError('You cannot use relative directions ("^v<>") to indicate in which direction(s) a rule applies.  Use absolute directions indicators (Up, Down, Left, Right, Horizontal, or Vertical, for instance), or, if you want the rule to apply in all four directions, do not specify directions',o):"["==k?(0==s.length&&(s=s.concat(directionaggregates.orthogonal)),l=1,S--):logError("The start of a rule must consist of some number of directions (possibly 0), before the first bracket, specifying in what directions to look (with no direction specified, it applies in all four directions).  It seems you've just entered \""+k.toUpperCase()+'".',o);break;case 1:if("["==k)++x>1&&logWarning("Multiple opening brackets without closing brackets.  Something fishy here.  Every '[' has to be closed by a ']', and you can't nest them.",o),c.length>0&&logError('Error, malformed cell rule - encountered a "["" before previous bracket was closed',o),d=!0,c=[];else if(reg_directions_only.exec(k))c.length%2==1?logError("Error, an item can only have one direction/action at a time, but you're looking for several at once!",o):d?g&&"no"!==k&&"random"!==k&&"randomdir"!==k?logError("Movements cannot appear in late rules.",o):c.push(k):logWarning("Invalid syntax. Directions should be placed at the start of a rule.",o);else if("|"==k)d?c.length%2==1?logError("In a rule, if you specify a force, it has to act on an object.",o):(u.push(c),c=[]):logWarning('Janky syntax.  "|" should only be used inside cell rows (the square brackety bits).',o);else if("]"===k)--x<0&&logWarning("Multiple closing brackets without corresponding opening brackets.  Something fishy here.  Every '[' has to be closed by a ']', and you can't nest them.",o),c.length%2==1?"..."===c[0]?logError("Cannot end a rule with ellipses.",o):logError("In a rule, if you specify a force, it has to act on an object.",o):(u.push(c),c=[]),h?p.push(u):f.push(u),u=[],d=!1;else if("->"===k)d?logError('Encountered an unexpected "->" inside square brackets.  It\'s used to separate states, it has no place inside them >:| .',o):h?logError('Error, you can only use "->" once in a rule; it\'s used to separate before and after states.',o):h=!0;else if(t.names.indexOf(k)>=0)d?c.length%2==0?(c.push(""),c.push(k)):c.length%2==1&&c.push(k):logWarning("Invalid token "+k.toUpperCase()+". Object names should only be used within cells (square brackets).",o);else if("..."===k)d?(c.push(k),c.push(k)):logWarning("Invalid syntax, ellipses should only be used within cells (square brackets).",o);else if(commandwords.indexOf(k.toLowerCase())>=0)if(!1===h?logError("Commands should only appear at the end of rules, not in or before the pattern-detection/-replacement sections.",o):(d||rightBracketToRightOf(a,S))&&logWarning("Commands should only appear at the end of rules, not in or before the pattern-detection/-replacement sections.",o),"message"===k.toLowerCase()){var C=findIndexAfterToken(i,a,S);""===(M=i.substring(C).trim())&&(M=" "),y.push([k.toLowerCase(),M]),S=a.length}else if("goto"===k.toLowerCase()){C=findIndexAfterToken(i,a,S);""===(M=i.substring(C).trim())&&(M=" "),y.push([k.toLowerCase(),M]),S=a.length}else if(twiddleable_params.includes(k.toLowerCase())){if(t.metadata.includes("runtime_metadata_twiddling")){var M;C=findIndexAfterToken(i,a,S);""===(M=i.substring(C).trim())&&(M=" "),y.push([k.toLowerCase(),M])}else logError("You can only change a flag at runtime if you have the 'runtime_metadata_twiddling' prelude flag defined!",o);S=a.length}else y.push([k.toLowerCase()]);else logError('Error, malformed cell rule - was looking for cell contents, but found "'+k+'".  What am I supposed to do with this, eh, please tell me that.',o)}}if(f.length!=p.length)y.length>0&&0==p.length||logError("Error, when specifying a rule, the number of matches (square bracketed bits) on the left hand side of the arrow must equal the number on the right",o);else for(S=0;S<f.length;S++)f[S].length!=p[S].length&&(logError("In a rule, each pattern to match on the left must have a corresponding pattern on the right of equal length (number of cells).",o),t.invalid=!0),0==f[S].length&&logError("You have an totally empty pattern on the left-hand side.  This will match *everything*.  You certainly don't want this.");0==f.length&&logError("This rule refers to nothing.  What the heck? :O",o);var T={directions:s,lhs:f,rhs:p,lineNumber:o,late:g,rigid:m,groupNumber:v,commands:y,randomRule:_,globalRule:w};return!1===directionalRule(T)&&T.directions.length>1&&T.directions.splice(1),T}function deepCloneHS(e){return e.map((function(e){return e.map((function(e){return e.slice()}))}))}function deepCloneRule(e){return{direction:e.direction,lhs:deepCloneHS(e.lhs),rhs:deepCloneHS(e.rhs),lineNumber:e.lineNumber,late:e.late,rigid:e.rigid,groupNumber:e.groupNumber,commands:e.commands,randomRule:e.randomRule,globalRule:e.globalRule}}function rulesToArray(e){for(var t=e.rules,n=[],r=[],o=0;o<t.length;o++){var i=t[o][1],a=processRuleString(t[o],e,n);void 0===a.bracket?n.push(a):r.push([i,a.bracket])}e.loops=r;var l=[];for(o=0;o<n.length;o++)for(var s=(g=n[o]).directions,c=0;c<s.length;c++){var u=s[c];if(u in directionaggregates&&directionalRule(g))for(var d=directionaggregates[u],h=0;h<d.length;h++){var f;(f=deepCloneRule(g)).direction=d[h],l.push(f)}else(f=deepCloneRule(g)).direction=u,l.push(f)}for(o=0;o<l.length;o++){if(convertRelativeDirsToAbsolute(g=l[o]),rewriteUpLeftRules(g),atomizeAggregates(e,g),e.invalid)return;rephraseSynonyms(e,g)}var p=[];for(o=0;o<l.length;o++){var g=l[o];p=p.concat(concretizeMovingRule(e,g,g.lineNumber))}var m=[];for(o=0;o<p.length;o++){g=p[o];m=m.concat(concretizePropertyRule(e,g,g.lineNumber))}for(o=0;o<m.length;o++)makeSpawnedObjectsStationary(e,m[o],g.lineNumber);e.rules=m}function containsEllipsis(e){for(var t=0;t<e.lhs.length;t++)for(var n=0;n<e.lhs[t].length;n++)if("..."===e.lhs[t][n][1])return!0;return!1}function rewriteUpLeftRules(e){if(!containsEllipsis(e)){if("up"==e.direction)e.direction="down";else{if("left"!=e.direction)return;e.direction="right"}for(var t=0;t<e.lhs.length;t++)e.lhs[t].reverse(),e.rhs.length>0&&e.rhs[t].reverse()}}function getPossibleObjectsFromCell(e,t){for(var n=[],r=0;r<t.length;r+=2){t[r];var o=t[r+1];if(o in e.objects)n.push(o);else if(o in e.propertiesDict)for(var i=e.propertiesDict[o],a=0;a<i.length;a++){var l=i[a];n.push(l)}}return n}function getPropertiesFromCell(e,t){for(var n=[],r=0;r<t.length;r+=2){var o=t[r],i=t[r+1];"random"!=o&&(i in e.propertiesDict&&n.push(i))}return n}function getMovings(e,t){for(var n=[],r=0;r<t.length;r+=2){var o=t[r],i=t[r+1];o in directionaggregates&&n.push([i,o])}return n}function concretizePropertyInCell(e,t,n){for(var r=0;r<e.length;r+=2)e[r+1]===t&&"random"!==e[r]&&(e[r+1]=n)}function concretizeMovingInCell(e,t,n,r){for(var o=0;o<e.length;o+=2)e[o]===t&&e[o+1]===n&&(e[o]=r)}function concretizeMovingInCellByAmbiguousMovementName(e,t,n){for(var r=0;r<e.length;r+=2)e[r]===t&&(e[r]=n)}function expandNoPrefixedProperties(e,t){for(var n=[],r=0;r<t.length;r+=2){var o=t[r],i=t[r+1];if("no"===o&&i in e.propertiesDict)for(var a=e.propertiesDict[i],l=0;l<a.length;l++){var s=a[l];n.push(o),n.push(s)}else n.push(o),n.push(i)}return n}function concretizePropertyRule(e,t,n){for(var r=0;r<t.lhs.length;r++)for(var o=t.lhs[r],i=0;i<o.length;i++)o[i]=expandNoPrefixedProperties(e,o[i]),t.rhs.length>0&&(t.rhs[r][i]=expandNoPrefixedProperties(e,t.rhs[r][i]));var a,l={};for(i=0;i<t.rhs.length;i++)for(var s=t.lhs[i],c=t.rhs[i],u=0;u<c.length;u++)for(var d=getPropertiesFromCell(e,s[u]),h=getPropertiesFromCell(e,c[u]),f=0;f<h.length;f++){var p=h[f];-1==d.indexOf(p)&&(l[p]=!0)}for(var g=[t],m=!0;m;){m=!1;for(r=0;r<g.length;r++){var v=g[r];a=!1;for(i=0;i<v.lhs.length&&!a;i++){var y=v.lhs[i];for(u=0;u<y.length&&!a;u++){var _=getPropertiesFromCell(e,y[u]);for(f=0;f<_.length;++f){p=_[f];if(!e.propertiesSingleLayer.hasOwnProperty(p)||!0===l[p]){var b=e.propertiesDict[p];a=!0,m=!0;for(var w=0;w<b.length;w++){var x=b[w],S=deepCloneRule(v);for(var k in S.propertyReplacement={},v.propertyReplacement)if(v.propertyReplacement.hasOwnProperty(k)){var C=v.propertyReplacement[k];S.propertyReplacement[k]=[C[0],C[1]]}concretizePropertyInCell(S.lhs[i][u],p,x),S.rhs.length>0&&concretizePropertyInCell(S.rhs[i][u],p,x),void 0===S.propertyReplacement[p]?S.propertyReplacement[p]=[x,1]:S.propertyReplacement[p][1]=S.propertyReplacement[p][1]+1,g.push(S)}break}}}}a&&(g.splice(r,1),r--)}}for(r=0;r<g.length;r++){if(void 0!==(v=g[r]).propertyReplacement)for(var p in v.propertyReplacement)if(v.propertyReplacement.hasOwnProperty(p)){var M=v.propertyReplacement[p];x=M[0];if(1===M[1])for(i=0;i<v.rhs.length;i++){var T=v.rhs[i];for(u=0;u<T.length;u++){concretizePropertyInCell(T[u],p,x)}}}}var E="";for(r=0;r<g.length;r++){v=g[r];delete g.propertyReplacement;for(i=0;i<v.rhs.length;i++)for(y=v.rhs[i],u=0;u<y.length;u++)for(_=getPropertiesFromCell(e,y[u]),f=0;f<_.length;f++)l.hasOwnProperty(_[f])&&(E=_[f])}return E.length>0&&logError('This rule has a property on the right-hand side, "'+E.toUpperCase()+"\", that can't be inferred from the left-hand side.  (either for every property on the right there has to be a corresponding one on the left in the same cell, OR, if there's a single occurrence of a particular property name on the left, all properties of the same name on the right are assumed to be the same).",n),g}function makeSpawnedObjectsStationary(e,t,n){if(!t.late)for(var r=0;r<t.rhs.length;r++)for(var o=t.lhs[r],i=t.rhs[r],a=0;a<i.length;a++)for(var l=i[a],s=getPossibleObjectsFromCell(e,o[a]),c=s.map((t=>e.objects[t].layer)),u=0;u<l.length;u+=2){if(""===l[u]){var d=l[u+1];if(!(d in e.propertiesDict||s.indexOf(d)>=0)){var h=e.objects[d].layer;-1===c.indexOf(h)&&(l[u]="stationary")}}}}function concretizeMovingRule(e,t,n){for(var r,o=[t],i=!0;i;){i=!1;for(var a=0;a<o.length;a++){var l=o[a];r=!1;for(var s=0;s<l.lhs.length;s++)for(var c=l.lhs[s],u=0;u<c.length;u++){if((I=getMovings(e,c[u])).length>0){r=!0,i=!0;for(var d=I[0][0],h=I[0][1],f=directionaggregates[h],p=0;p<f.length;p++){var g=f[p],m=deepCloneRule(l);for(var v in m.movingReplacement={},l.movingReplacement)if(l.movingReplacement.hasOwnProperty(v)){var y=l.movingReplacement[v];m.movingReplacement[v]=[y[0],y[1],y[2],y[3],y[4],y[5]]}for(var v in m.aggregateDirReplacement={},l.aggregateDirReplacement)if(l.aggregateDirReplacement.hasOwnProperty(v)){y=l.aggregateDirReplacement[v];m.aggregateDirReplacement[v]=[y[0],y[1],y[2]]}if(concretizeMovingInCell(m.lhs[s][u],h,d,g),m.rhs.length>0&&concretizeMovingInCell(m.rhs[s][u],h,d,g),void 0===m.movingReplacement[d+h])m.movingReplacement[d+h]=[g,1,h,d,s,u];else{var _=m.movingReplacement[d+h];s===_[4]&&u===_[5]||(_[1]=_[1]+1)}void 0===m.aggregateDirReplacement[h]?m.aggregateDirReplacement[h]=[g,1,h]:m.aggregateDirReplacement[h][1]=m.aggregateDirReplacement[h][1]+1,o.push(m)}}}r&&(o.splice(a,1),a--)}}for(a=0;a<o.length;a++){if(void 0!==(l=o[a]).movingReplacement){var b={};for(var d in l.movingReplacement)if(l.movingReplacement.hasOwnProperty(d)){var w=(T=l.movingReplacement[d])[0],x=T[1],S=T[2],k=T[3];if(1===x)for(s=0;s<l.rhs.length;s++){var C=l.rhs[s];for(u=0;u<C.length;u++){concretizeMovingInCell(C[u],S,k,w)}}}var M={};for(var d in l.aggregateDirReplacement)if(l.aggregateDirReplacement.hasOwnProperty(d)){var T;w=(T=l.aggregateDirReplacement[d])[0],x=T[1];M[S=T[2]]=S in M||1!==x?"INVALID":w}for(var S in b)if(b.hasOwnProperty(S)&&"INVALID"!==S){if("INVALID"===(w=b[S]))continue;for(s=0;s<l.rhs.length;s++)for(C=l.rhs[s],u=0;u<C.length;u++){concretizeMovingInCellByAmbiguousMovementName(C[u],S,w)}}for(var S in M)if(M.hasOwnProperty(S)&&"INVALID"!==S){if("INVALID"===(w=M[S]))continue;for(s=0;s<l.rhs.length;s++)for(C=l.rhs[s],u=0;u<C.length;u++){concretizeMovingInCellByAmbiguousMovementName(C[u],S,w)}}}}var E="";for(a=0;a<o.length;a++){l=o[a];delete o.movingReplacement;for(s=0;s<l.rhs.length;s++)for(c=l.rhs[s],u=0;u<c.length;u++){var I;(I=getMovings(e,c[u])).length>0&&(E=I[0][1])}}return E.length>0&&(logError('This rule has an ambiguous movement on the right-hand side, "'+E+"\", that can't be inferred from the left-hand side.  (either for every ambiguous movement associated to an entity on the right there has to be a corresponding one on the left attached to the same entity, OR, if there's a single occurrence of a particular ambiguous movement on the left, all properties of the same movement attached to the same object on the right are assumed to be the same (or something like that)).",n),e.invalid=!0),o}function rephraseSynonyms(e,t){for(var n=0;n<t.lhs.length;n++)for(var r=t.lhs[n],o=t.rhs[n],i=0;i<r.length;i++){for(var a=r[i],l=1;l<a.length;l+=2){a[l]in e.synonymsDict&&(a[l]=e.synonymsDict[a[l]])}if(t.rhs.length>0){var s=o[i];for(l=1;l<s.length;l+=2){s[l]in e.synonymsDict&&(s[l]=e.synonymsDict[s[l]])}}}}function atomizeAggregates(e,t){for(var n=0;n<t.lhs.length;n++)for(var r=t.lhs[n],o=0;o<r.length;o++){atomizeCellAggregates(e,r[o],t.lineNumber)}for(n=0;n<t.rhs.length;n++)for(r=t.rhs[n],o=0;o<r.length;o++){atomizeCellAggregates(e,r[o],t.lineNumber)}}function atomizeCellAggregates(e,t,n){for(var r=0;r<t.length;r+=2){var o=t[r],i=t[r+1];if(i in e.aggregatesDict){"no"===o&&logError("You cannot use 'no' to exclude the aggregate object "+i.toUpperCase()+" (defined using 'AND'), only regular objects, or properties (objects defined using 'OR').  If you want to do this, you'll have to write it out yourself the long way.",n);var a=e.aggregatesDict[i];t[r+1]=a[0];for(var l=1;l<a.length;l++)t.push(t[r]),t.push(a[l])}}}function convertRelativeDirsToAbsolute(e){for(var t=e.direction,n=0;n<e.lhs.length;n++)for(var r=e.lhs[n],o=0;o<r.length;o++){absolutifyRuleCell(t,r[o])}for(n=0;n<e.rhs.length;n++)for(r=e.rhs[n],o=0;o<r.length;o++){absolutifyRuleCell(t,r[o])}}var relativeDirs=["^","v","<",">","parallel","perpendicular"],relativeDict={right:["up","down","left","right","horizontal_par","vertical_perp"],up:["left","right","down","up","vertical_par","horizontal_perp"],down:["right","left","up","down","vertical_par","horizontal_perp"],left:["down","up","right","left","horizontal_par","vertical_perp"]};function absolutifyRuleCell(e,t){for(var n=0;n<t.length;n+=2){var r=t[n],o=relativeDirs.indexOf(r);o>=0&&(t[n]=relativeDict[e][o])}}var dirMasks={up:parseInt("00001",2),down:parseInt("00010",2),left:parseInt("00100",2),right:parseInt("01000",2),moving:parseInt("01111",2),no:parseInt("00011",2),randomdir:parseInt("00101",2),random:parseInt("10010",2),action:parseInt("10000",2),"":parseInt("00000",2)};function rulesToMask(e){for(var t=e.collisionLayers.length,n=[],r=0;r<t;r++)n.push(null);for(r=0;r<e.rules.length;r++)for(var o=e.rules[r],i=0;i<o.lhs.length;i++)for(var a=o.lhs[i],l=o.rhs[i],s=0;s<a.length;s++){for(var c=a[s],u=n.concat([]),d=new BitVec(STRIDE_OBJ),h=new BitVec(STRIDE_OBJ),f=[],p=new BitVec(STRIDE_MOV),g=new BitVec(STRIDE_MOV),m=new BitVec(STRIDE_MOV),v=0;v<c.length;v+=2){if("..."===(P=c[v])){if(d=ellipsisPattern,2!==c.length)logError("You can't have anything in with an ellipsis. Sorry.",o.lineNumber);else if(0===s||s===a.length-1)logError("There's no point in putting an ellipsis at the very start or the end of a rule",o.lineNumber);else if(o.rhs.length>0){2===(x=l[s]).length&&"..."===x[0]||logError("An ellipsis on the left must be matched by one in the corresponding place on the right.",o.lineNumber)}break}if("random"!==P){var y=c[v+1],_=e.objects[y],b=e.objectMasks[y];if(_)var w=0|_.layer;else w=e.propertiesSingleLayer[y];if(void 0===w&&logError("Oops!  "+y.toUpperCase()+" not assigned to a layer.",o.lineNumber),"no"===P)h.ior(b);else null!==(j=u[w])&&(o.discard=[y.toUpperCase(),j.toUpperCase()]),u[w]=y,_?(d.ior(b),m.ishiftor(31,5*w)):f.push(b),"stationary"===P?g.ishiftor(31,5*w):p.ishiftor(dirMasks[P],5*w)}else logError("'random' cannot be matched on the left-hand side, it can only appear on the right",o.lineNumber)}if(o.rhs.length>0){var x=l[s],S=a[s];"..."===x[0]&&"..."!==S[0]&&logError("An ellipsis on the right must be matched by one in the corresponding place on the left.",o.lineNumber);for(v=0;v<x.length;v+=2){"..."===x[v]&&2!==x.length&&logError("You can't have anything in with an ellipsis. Sorry.",o.lineNumber)}}if(d!==ellipsisPattern){if(a[s]=new CellPattern([d,h,f,p,g,null]),d.anyBitsInCommon(h)){var k=o.lineNumber;r>0&&e.rules[r-1].lineNumber===k||r+1<e.rules.length&&e.rules[r+1].lineNumber===k||logError('This rule has some content of the form "X no X" which can never match and so the rule is getting removed during compilation.',o.lineNumber),e.rules.splice(r,1),r--}else if(0!==o.rhs.length){var C=l[s],M=n.concat([]),T=n.concat([]),E=new BitVec(STRIDE_OBJ),I=new BitVec(STRIDE_OBJ),L=new BitVec(STRIDE_MOV),A=new BitVec(STRIDE_MOV),R=new BitVec(STRIDE_MOV),O=new BitVec(STRIDE_OBJ),F=new BitVec(STRIDE_MOV),D=new BitVec(STRIDE_MOV);for(v=0;v<C.length;v+=2){var P=C[v];y=C[v+1];if("..."===P)break;if("random"!==P){_=e.objects[y],b=e.objectMasks[y];if(_)w=0|_.layer;else w=e.propertiesSingleLayer[y];if("no"==P)E.ior(b);else{null===(j=M[w])&&(j=T[w]),null!==j&&(o.hasOwnProperty("discard")||logError("Rule matches object types that can't overlap: \""+y.toUpperCase()+'" and "'+j.toUpperCase()+'".',o.lineNumber)),M[w]=y,P.length>0&&F.ishiftor(31,5*w);var N=e.layerMasks[w];_&&(I.ibitset(_.id),E.ior(N),R.ishiftor(31,5*w)),"stationary"===P&&L.ishiftor(31,5*w),"randomdir"===P?D.ishiftor(dirMasks[P],5*w):A.ishiftor(dirMasks[P],5*w)}}else if(y in e.objectMasks){var B,H=e.objectMasks[y];O.ior(H),B=e.propertiesDict.hasOwnProperty(y)?e.propertiesDict[y]:[y];for(var z=0;z<B.length;z++){var j,W=B[z];if(null!==(j=M[w=0|e.objects[W].layer])){var V=W.toUpperCase(),U=j.toUpperCase();V!==U&&logWarning("This rule may try to spawn a "+V+" with random, but also requires a "+U+" be here, which is on the same layer - they shouldn't be able to coexist!",o.lineNumber)}T[w]=W}}else logError('You want to spawn a random "'+y.toUpperCase()+"\", but I don't know how to do that",o.lineNumber)}d.bitsSetInArray(I.data)||E.ior(d),p.bitsSetInArray(A.data)||L.ior(p);for(v=0;v<t;v++)null!==u[v]&&null===M[v]&&(E.ior(e.layerMasks[v]),F.ishiftor(31,5*v));m.iclear(R),F.ior(m),E.iszero()&&I.iszero()&&L.iszero()&&A.iszero()&&F.iszero()&&O.iszero()&&D.iszero()||(a[s].replacement=new CellReplacement([E,I,L,A,F,O,D]))}}else a[s]=ellipsisPattern}}function cellRowMasks(e){for(var t=[],n=e[1],r=0;r<n.length;r++){for(var o=n[r],i=new BitVec(STRIDE_OBJ),a=0;a<o.length;a++)o[a]!==ellipsisPattern&&i.ior(o[a].objectsPresent);t.push(i)}return t}function cellRowMasks_Movements(e){for(var t=[],n=e[1],r=0;r<n.length;r++){for(var o=n[r],i=new BitVec(STRIDE_MOV),a=0;a<o.length;a++)o[a]!==ellipsisPattern&&i.ior(o[a].movementsPresent);t.push(i)}return t}function collapseRules(e){for(var t=0;t<e.length;t++)for(var n=e[t],r=0;r<n.length;r++){for(var o=n[r],i=[0,[],o.rhs.length>0,o.lineNumber],a=[],l=0;l<o.lhs.length;l++)a.push(!1);i[0]=dirMasks[o.direction];for(l=0;l<o.lhs.length;l++){for(var s=o.lhs[l],c=0;c<s.length;c++)s[c]===ellipsisPattern&&(a[l]&&logError("You can't use two ellipses in a single cell match pattern.  If you really want to, please implement it yourself and send me a patch :) ",o.lineNumber),a[l]=!0);i[1][l]=s}i.push(a),i.push(o.groupNumber),i.push(o.rigid),i.push(o.commands),i.push(o.randomRule),i.push(cellRowMasks(i)),i.push(cellRowMasks_Movements(i)),i.push(o.globalRule),n[r]=new Rule(i)}matchCache={}}function ruleGroupDiscardOverlappingTest(e){if(0!==e.length)for(var t=0;t<e.length;t++){var n=e[t];if(n.hasOwnProperty("discard")){if(e.splice(t,1),(0===t||e[t-1].lineNumber!==n.lineNumber)&&t<e.length-1&&e[t+1].lineNumber!==n.lineNumber||0===e.length){var r=n.discard;logError(r[0]+" and "+r[1]+" can never overlap, but this rule requires that to happen.",n.lineNumber)}t--}}}function arrangeRulesByGroupNumber(e){for(var t={},n={},r=0;r<e.rules.length;r++){var o=e.rules[r],i=t;o.late&&(i=n),null==i[o.groupNumber]&&(i[o.groupNumber]=[]),i[o.groupNumber].push(o)}var a=[];for(var l in t){if(t.hasOwnProperty(l))ruleGroupDiscardOverlappingTest(c=t[l]),c.length>0&&a.push(c)}var s=[];for(var l in n){var c;if(n.hasOwnProperty(l))ruleGroupDiscardOverlappingTest(c=n[l]),c.length>0&&s.push(c)}e.rules=a,e.lateRules=s}function generateRigidGroupList(e){for(var t=[],n=[],r=[],o=[],i=[],a=0;a<e.rules.length;a++){for(var l=e.rules[a],s=!1,c=0;c<l.length;c++){l[c].isRigid&&(s=!0)}if(i[a]=s,s){var u=l[0].groupNumber;r[u]=a;var d=t.length;n[a]=d,o[u]=d,t.push(a)}}t.length>60&&logError("There can't be more than 60 rigid groups (rule groups containing rigid members).",rules[0][0][3]),e.rigidGroups=i,e.rigidGroupIndex_to_GroupIndex=t,e.groupNumber_to_RigidGroupIndex=o,e.groupIndex_to_RigidGroupIndex=n}function getMaskFromName(e,t){var n=new BitVec(STRIDE_OBJ);if(t in e.objects){var r=e.objects[t];n.ibitset(r.id)}if(t in e.aggregatesDict)for(var o=e.aggregatesDict[t],i=0;i<o.length;i++){var a=o[i];r=e.objects[a];n.ibitset(r.id)}if(t in e.propertiesDict)for(o=e.propertiesDict[t],i=0;i<o.length;i++){a=o[i],r=e.objects[a];n.ibitset(r.id)}if(t in e.synonymsDict){a=e.synonymsDict[t],r=e.objects[a];n.ibitset(r.id)}return!e.metadata.includes("nokeyboard")&&n.iszero()&&logErrorNoLine("error, didn't find any object called player, either in the objects section, or the legends section. there must be a player!"),n}function generateMasks(e){e.playerMask=getMaskFromName(e,"player");for(var t=[],n=e.collisionLayers.length,r=0;r<n;r++){for(var o=new BitVec(STRIDE_OBJ),i=0;i<e.objectCount;i++){var a=e.idDict[i];(s=e.objects[a]).layer==r&&o.ibitset(s.id)}t.push(o)}e.layerMasks=t;var l={};for(var a in e.objects)if(e.objects.hasOwnProperty(a)){var s=e.objects[a];l[a]=new BitVec(STRIDE_OBJ),l[a].ibitset(s.id)}var c=e.legend_synonyms.concat(e.legend_properties);c.sort((function(e,t){return e.lineNumber-t.lineNumber}));for(var u=0;u<c.length;u++){var d=c[u];if(2==d.length)l[d[0]]=l[d[1]];else{var h=new BitVec(STRIDE_OBJ);for(i=1;i<d.length;i++){a=d[i];h.ior(l[a])}l[d[0]]=h}}var f=new BitVec(STRIDE_OBJ);f.inot(),l["\nall\n"]=f,e.objectMasks=l}function checkObjectsAreLayered(e){for(var t in e.objects)if(e.objects.hasOwnProperty(t)){for(var n=!1,r=0;r<e.collisionLayers.length;r++){for(var o=e.collisionLayers[r],i=0;i<o.length;i++)if(o[i]===t){n=!0;break}if(n)break}if(!1===n){var a=e.objects[t];logError('Object "'+t.toUpperCase()+'" has been defined, but not assigned to a layer.',a.lineNumber)}}}function twiddleMetaData(e,t=!1){var n;if(t)n=e.metadata;else{n={};for(var r=0;r<e.metadata.length;r+=2){var o=e.metadata[r],i=e.metadata[r+1];n[o]=i}}if(void 0!==n.flickscreen){var a=(i=n.flickscreen).split("x"),l=[parseInt(a[0]),parseInt(a[1])];n.flickscreen=l}if(void 0!==n.zoomscreen){a=(i=n.zoomscreen).split("x"),l=[parseInt(a[0]),parseInt(a[1])];n.zoomscreen=l}if(void 0!==n.smoothscreen){var s=(i=n.smoothscreen).split(/\s+/),c=!0;s.length<1?(logErrorNoLine("smoothscreen given no arguments but expects at least 1: smoothscreen [flick] WxH [IxJ] [S]"),c=!1):s.length>4&&(logErrorNoLine("smoothscreen given "+s.length+" arguments but expects at most 4: smoothscreen [flick] WxH [IxJ] [S]"),c=!1);const e={screenSize:{width:0,height:0},boundarySize:{width:1,height:1},cameraSpeed:.125,flick:!1,debug:!!n.smoothscreen_debug};"flick"===s[0]&&(e.flick=!0,s.shift());const t=s[0].match(/^(?<width>\d+)x(?<height>\d+)$/);if(t?(e.screenSize.width=parseInt(t.groups.width),e.screenSize.height=parseInt(t.groups.height),e.flick&&(e.boundarySize.width=e.screenSize.width,e.boundarySize.height=e.screenSize.height)):(logErrorNoLine("smoothscreen given first argument "+s[0]+" but must be formatted WxH where W and H are integers"),c=!1),s.length>1){const t=s[1].match(/^(?<width>\d+)x(?<height>\d+)$/);t?(e.boundarySize.width=parseInt(t.groups.width),e.boundarySize.height=parseInt(t.groups.height)):(logErrorNoLine("smoothscreen given second argument "+s[1]+" but must be formatted IxJ where I and J are integers"),c=!1)}if(s.length>2){const t=s[2].match(/^(?<speed>\d+(\.\d+)?)$/);t?e.cameraSpeed=clamp(parseFloat(t.groups.speed),0,1):(logErrorNoLine("smoothscreen given third argument "+s[2]+" but must be a number"),c=!1)}c?n.smoothscreen=e:delete n.smoothscreen}e.metadata=n,t||(e.default_metadata=deepClone(n))}function processWinConditions(e){for(var t=[],n=0;n<e.winconditions.length;n++){var r=e.winconditions[n];if(0==r.length)return;var o=0;switch(r[0]){case"no":o=-1;break;case"all":o=1}var i,a=r[r.length-1],l=r[1];i=5==r.length?r[3]:"\nall\n";var s=0,c=0;l in e.objectMasks?s=e.objectMasks[l]:logError('Unwelcome term "'+l+'" found in win condition. Win conditions objects have to be objects or properties (defined using "or", in terms of other properties)',a),i in e.objectMasks?c=e.objectMasks[i]:logError('Unwelcome term "'+i+'" found in win condition. Win conditions objects have to be objects or properties (defined using "or", in terms of other properties)',a);var u=[o,s,c,a];t.push(u)}e.winconditions=t}function printCellRow(e){for(var t="[ ",n=0;n<e.length;n++){n>0&&(t+="| ");for(var r=e[n],o=0;o<r.length;o+=2){var i=r[o],a=r[o+1];t+="..."===i?i+" ":i+" "+a+" "}}return t+="] "}function cacheRuleStringRep(e){var t="(<a onclick=\"jumpToLine('"+e.lineNumber.toString()+'\');"  href="javascript:void(0);">'+e.lineNumber+"</a>) "+e.direction.toString().toUpperCase()+" ";e.rigid&&(t="RIGID "+t+" "),e.randomRule&&(t="RANDOM "+t+" "),e.globalRule&&(t="GLOBAL "+t+" "),e.late&&(t="LATE "+t+" ");for(var n=0;n<e.lhs.length;n++){t+=printCellRow(e.lhs[n])}t+="-> ";for(n=0;n<e.rhs.length;n++){t+=printCellRow(e.rhs[n])}for(n=0;n<e.commands.length;n++){var r=e.commands[n];1===r.length?t+=r[0].toString():t=t+"("+r[0].toString()+", "+r[1].toString()+") "}e.stringRep=t}function cacheAllRuleNames(e){for(var t=0;t<e.rules.length;t++){cacheRuleStringRep(e.rules[t])}}function printRules(e){for(var t="",n=0,r=-1,o=0,i=0;i<e.rules.length;i++){var a=e.rules[i];n<e.loops.length&&e.loops[n][0]<a.lineNumber&&(t+="STARTLOOP<br>",++n<e.loops.length&&(r=e.loops[n][0],n++)),-1!==r&&r<a.lineNumber&&(t+="ENDLOOP<br>",r=-1),a.hasOwnProperty("discard")?o++:t+=a.stringRep+"<br>"}-1!==r&&(t+="ENDLOOP<br>"),t+="===========<br>",consolePrint(t="<br>Rule Assembly : ("+(e.rules.length-o)+" rules)<br>===========<br>"+t)}function removeDuplicateRules(e){for(var t={},n=-1,r=e.rules.length-1;r>=0;r--){var o=e.rules[r],i=o.groupNumber;i!==n&&(t={});var a=o.stringRep;t.hasOwnProperty(a)?e.rules.splice(r,1):t[a]=!0,n=i}}function generateLoopPoints(e){var t={},n=!0,r=0;e.loops.length%2==1&&logErrorNoLine("have to have matching number of  'startLoop' and 'endLoop' loop points.");for(var o=0;o<e.loops.length;o++)for(var i=e.loops[o],a=0;a<e.rules.length;a++){var l=(u=e.rules[a])[0],s=u[u.length-1],c=l.lineNumber;s.lineNumber;if(n){if(c>=i[0]){r=a,n=!1,-1===i[1]&&logErrorNoLine("Need have to have matching number of  'startLoop' and 'endLoop' loop points.");break}}else if(c>=i[0]){t[a-1]=r,n=!0,1===i[1]&&logErrorNoLine("Need have to have matching number of  'startLoop' and 'endLoop' loop points.");break}}!1===n&&(t[e.rules.length]=r);e.loopPoint=t,t={},n=!0;for(o=0;o<e.loops.length;o++)for(i=e.loops[o],a=0;a<e.lateRules.length;a++){var u;l=(u=e.lateRules[a])[0],s=u[u.length-1],c=l.lineNumber,s.lineNumber;if(n){if(c>=i[0]){r=a,n=!1,-1===i[1]&&logErrorNoLine("Need have to have matching number of  'startLoop' and 'endLoop' loop points.");break}}else if(c>=i[0]){t[a-1]=r,n=!0,1===i[1]&&logErrorNoLine("Need have to have matching number of  'startLoop' and 'endLoop' loop points.");break}}!1===n&&(t[e.lateRules.length]=r);e.lateLoopPoint=t}var soundEvents=["titlescreen","startgame","cancel","endgame","startlevel","undo","restart","endlevel","enterlevelselect","showmessage","closemessage","sfx0","sfx1","sfx2","sfx3","sfx4","sfx5","sfx6","sfx7","sfx8","sfx9","sfx10","sfx11","sfx12","sfx13"],soundMaskedEvents=["create","destroy","move","cantmove","action"],soundVerbs=soundEvents.concat(soundMaskedEvents);function validSeed(e){return null!==/^\s*\d+\s*$/.exec(e)}var soundDirectionIndicatorMasks={up:parseInt("00001",2),down:parseInt("00010",2),left:parseInt("00100",2),right:parseInt("01000",2),horizontal:parseInt("01100",2),vertical:parseInt("00011",2),orthogonal:parseInt("01111",2),___action____:parseInt("10000",2)},soundDirectionIndicators=["up","down","left","right","horizontal","vertical","orthogonal","___action____"];function generateSoundData(e){for(var t={},n=[],r=[],o=[],i=[],a=0;a<e.sounds.length;a++){var l=e.sounds[a];if(!(l.length<=1)){var s=l[l.length-1];if(2!==l.length)if(soundEvents.indexOf(l[0])>=0){l.length>4&&logError("too much stuff to define a sound event.",s),validSeed(h=l[1])?(void 0!==t[l[0]]&&logWarning(l[0].toUpperCase()+" already declared.",s),t[l[0]]=l[1]):logError('Expecting sfx data, instead found "'+l[1]+'".',s)}else{var c=l[0].trim(),u=l[1].trim(),d=l.slice(2,l.length-2);d.length>0&&"move"!==u&&"cantmove"!==u&&logError("incorrect sound declaration.",s),"action"===u&&(u="move",d=["___action____"]),0==d.length&&(d=["orthogonal"]);var h=l[l.length-2];c in e.aggregatesDict?logError('cannot assign sound events to aggregate objects (declared with "and"), only to regular objects, or properties, things defined in terms of "or" ("'+c+'").',s):c in e.objectMasks||logError('Object "'+c+'" not found.',s);for(var f=e.objectMasks[c],p=0,g=0;g<d.length;g++){d[g]=d[g].trim();var m=d[g];if(-1===soundDirectionIndicators.indexOf(m))logError('Was expecting a direction, instead found "'+m+'".',s);else p|=soundDirectionIndicatorMasks[m]}for(var v=[c],y=!0;y;){y=!1;for(var _=0;_<v.length;_++){var b=v[_];if(b in e.synonymsDict)v[_]=e.synonymsDict[b],y=!0;else if(b in e.propertiesDict){y=!0;var w=e.propertiesDict[b];v.splice(_,1),_--;for(var x=0;x<w.length;x++)v.push(w[x])}}}if("move"===u||"cantmove"===u)for(g=0;g<v.length;g++){var S=v[g],k=e.objects[S].layer,C=new BitVec(STRIDE_MOV);C.ishiftor(p,5*k);var M={objectMask:f,directionMask:C,seed:h};"move"===u?o.push(M):i.push(M)}switch(validSeed(h)||logError('Expecting sfx data, instead found "'+h+'".',s),u){case"create":M={objectMask:f,seed:h};n.push(M);break;case"destroy":M={objectMask:f,seed:h};r.push(M)}}else logError("incorrect sound declaration.",s)}}e.sfx_Events=t,e.sfx_CreationMasks=n,e.sfx_DestructionMasks=r,e.sfx_MovementMasks=o,e.sfx_MovementFailureMasks=i}function formatHomePage(e){if("background_color"in e.metadata?e.bgcolor=colorToHex(colorPalette,e.metadata.background_color):e.bgcolor="#000000","text_color"in e.metadata?e.fgcolor=colorToHex(colorPalette,e.metadata.text_color):e.fgcolor="#FFFFFF",!1===isColor(e.fgcolor)&&(logError("text_color in incorrect format - found "+e.fgcolor+", but I expect a color name (like 'pink') or hex-formatted color (like '#1412FA').  Defaulting to white."),e.fgcolor="#FFFFFF"),!1===isColor(e.bgcolor)&&(logError("background_color in incorrect format - found "+e.bgcolor+", but I expect a color name (like 'pink') or hex-formatted color (like '#1412FA').  Defaulting to black."),e.bgcolor="#000000"),canSetHTMLColors&&("background_color"in e.metadata&&(document.body.style.backgroundColor=e.bgcolor),"text_color"in e.metadata)){var t=document.getElementById("separator");null!=t&&(t.style.color=e.fgcolor);for(var n=document.getElementsByTagName("a"),r=0;r<n.length;r++)n[r].style.color=e.fgcolor;for(n=document.getElementsByTagName("h1"),r=0;r<n.length;r++)n[r].style.color=e.fgcolor}if("homepage"in e.metadata){var o=e.metadata.homepage;o=(o=o.replace("http://","")).replace("https://",""),e.metadata.homepage=o}}var ifrm,MAX_ERRORS=5;function loadFile(e){for(var t=new codeMirrorFn,n=t.startState(),r=e.split("\n"),o=0;o<r.length;o++){var i=r[o];n.lineNumber=o+1;var a=new CodeMirror.StringStream(i,4);do{if(t.token(a,n),errorCount>MAX_ERRORS)return void consolePrint("too many errors, aborting compilation")}while(!1===a.eol())}return generateExtraMembers(n),generateMasks(n),levelsToArray(n),extractSections(n),rulesToArray(n),n.invalid>0?null:(cacheAllRuleNames(n),removeDuplicateRules(n),n.invalid>0?null:(convertSectionNamesToIndices(n),rulesToMask(n),debugMode&&printRules(n),arrangeRulesByGroupNumber(n),collapseRules(n.rules),collapseRules(n.lateRules),generateRigidGroupList(n),processWinConditions(n),checkObjectsAreLayered(n),twiddleMetaData(n),generateExtraMembersPart2(n),generateLoopPoints(n),generateSoundData(n),formatHomePage(n),IDE&&(n.metadata.tween_length&&n.lateRules.length>=1&&logWarning("[PS+] Using tweens in a game that also has LATE rules is currently experimental! If you change objects that moved with LATE then tweens might not play!",void 0,!1),void 0!==n.metadata.level_select_unlocked_ahead&&void 0!==n.metadata.level_select_unlocked_rollover&&logWarning("[PS+] You can't use both level_select_unlocked_ahead and level_select_unlocked_rollover at the same time, so please choose only one!",void 0,!1)),delete n.commentLevel,delete n.names,delete n.abbrevNames,delete n.objects_candname,delete n.objects_section,delete n.objects_spritematrix,delete n.section,delete n.subsection,delete n.tokenIndex,delete n.visitedSections,delete n.loops,n))}function compile(e,t,n){(matchCache={},forceRegenImages=!0,void 0===e&&(e=["restart"]),void 0===n&&(n=null),lastDownTarget=canvas,void 0===t)&&(t=window.form1.code.editorreference.getValue()+"\n");!0===canDump&&(compiledText=t),errorCount=0,compiling=!0,errorStrings=[],consolePrint("=================================");try{var r=loadFile(t)}finally{compiling=!1}if(r&&r.levels&&0===r.levels.length&&logError("No levels found.  Add some levels!",void 0,!0),!(errorCount>MAX_ERRORS)){if(errorCount>0)consoleError(!1===IDE?'<span class="systemMessage">Errors detected during compilation; the game may not work correctly.  If this is an older game, and you think it just broke because of recent changes in the puzzlescript plus engine, consider letting me know via the issue tracker.</span>':'<span class="systemMessage">Errors detected during compilation; the game may not work correctly.</span>');else{for(var o=0,i=0;i<r.rules.length;i++)o+=r.rules[i].length;for(i=0;i<r.lateRules.length;i++)o+=r.lateRules[i].length;"restart"==e[0]?consolePrint('<span class="systemMessage">Successful Compilation, generated '+o+" instructions.</span>"):consolePrint('<span class="systemMessage">Successful live recompilation, generated '+o+" instructions.</span>"),IDE&&void 0!==r.metadata.title&&(document.title="PS Plus - "+r.metadata.title)}null!==r&&setGameState(r,e,n),clearInputHistory(),isSitelocked()&&IDE&&logError("The game is sitelocked. To continue testing, add the current domain '"+window.location.origin+"' to the list.",void 0,!0),consoleCacheDump()}}function qualifyURL(e){var t=document.createElement("a");return t.href=e,t.href}function isSitelocked(){if(void 0===state.metadata.sitelock_origin_whitelist&&void 0===state.metadata.sitelock_hostname_whitelist)return!1;if(1==IDE)return!1;if(void 0===state.metadata.sitelock_origin_whitelist)for(var e=state.metadata.sitelock_origin_whitelist.split(" "),t=window.location.origin,n=0;n<e.length;n+=1)if(t==e[n])return!1;if(null==state.metadata.sitelock_hostname_whitelist){var r=state.metadata.sitelock_hostname_whitelist.split(" "),o=window.location.hostname;for(n=0;n<r.length;n+=1)if(o==r[n])return!1}return!0}function jumpToLine(e){var t=parent.form1.code.editorreference,n=t.doc.lastLine(),r=e-1-10,o=e-1+10,i=e-1;r<0&&(r=0),o>n&&(o=n),i>n&&(i=n),t.scrollIntoView(r),t.scrollIntoView(o),t.scrollIntoView(i),t.setCursor(i,0)}var consolecache=[];function consolePrintFromRule(e,t,n){void 0===n&&(n=!1);var r=dirMaskName[t.direction],o='<font color="green">Rule <a onclick="jumpToLine('+t.lineNumber+');"  href="javascript:void(0);">'+t.lineNumber+"</a> "+r+" : "+e+"</font>";cache_console_messages&&0==n?consolecache.push([o,null,null,1]):addToConsole(o)}function consolePrint(e,t,n,r){void 0===t&&(t=!1),cache_console_messages&&!1===t?consolecache.push([e,n,r,1]):(consoleCacheDump(),addToConsole(e))}var cache_n=0;function addToConsole(e){cache=document.createElement("div"),cache.id="cache"+cache_n,cache.innerHTML=e,cache_n++,document.getElementById("consoletextarea").appendChild(cache),consolecache=[];var t=document.getElementById("lowerarea");t.scrollTop=t.scrollHeight}function consoleCacheDump(){if(!1!==cache_console_messages){for(var e=0;e<consolecache.length-1;e++){var t=consolecache[e],n=t[0],r=consolecache[e+1];n===r[0]&&(consolecache.splice(e,1),e--,r[3]=t[3]+1)}var o=[],i=[];for(e=0;e<consolecache.length;e++){var a=consolecache[e],l=(a[0],a[1]),s=a[2];a[3];if(0!==e&&null!=l){var c=i[0];i[1];null===s&&l==c?i[2].push(a):(i=[l,s,[a]],o.push(i))}else i=[l,s,[a]],o.push(i)}for(var u="<br>",d=0;d<o.length;d++){var h=o[d],f=(c=h[0],s=h[1],h[2]);u+="<br>",null!=s&&(u+=`<span class="hoverpreview" onmouseover="debugPreview(${s})" onmouseleave="debugUnpreview()">`);for(e=0;e<f.length;e++){e>0&&(u+='<br><span class="noeye_indent"></span>');var p=f[e],g=p[0],m=p[3];m>1&&(g+=` (x${m})`),u+=g}null!=s&&(u+="</span>")}addToConsole(u)}}function consoleError(e){consolePrint('<span class="errorText">'+e+"</span>",!0)}function clearConsole(){document.getElementById("consoletextarea").innerHTML="";var e=document.getElementById("lowerarea");e.scrollTop=e.scrollHeight,debugger_turnIndex=0,debug_visualisation_array=[],diffToVisualize=null}var clearConsoleClick=document.getElementById("clearConsoleClick");function verboseToggle(){if(titleScreen)consolePrint("Once your game is running, you can use this button to toggle Verbose Logging",!0);else{var e=!verbose_logging;cache_console_messages=e,consolePrint("Verbose logging is now "+((verbose_logging=e)?"ENABLED":"DISABLED"),!0)}}clearConsoleClick.addEventListener("click",clearConsole,!1),clearConsoleClick.addEventListener("click",clearConsole,!1);var audio,loadDropdown,verboseLoggingClick=document.getElementById("verboseLoggingClick");function newSound(e){var t=e+100*(1e6*Math.random()|1);parent.frames[4],document.getElementById("consoletextarea");consolePrint(generatorNames[e]+' : <span class="cm-SOUND" onclick="playSound('+t.toString()+')">'+t.toString()+"</span>",!0);var n=generateFromSeed(t);n.sound_vol=SOUND_VOL,n.sample_rate=SAMPLE_RATE,n.bit_depth=BIT_DEPTH,SoundEffect.generate(n).play()}function buttonPress(){var e=document.getElementById("sounddat").value,t=generateFromSeed(e);t.sound_vol=SOUND_VOL,t.sample_rate=SAMPLE_RATE,t.bit_depth=BIT_DEPTH,SoundEffect.generate(t).play()}function solveClick(){confirm("Use the solver? It can be slow & crash on big levels, so please save beforehand. Doesn't work for mouse controlled games.")&&solve()}function runClick(){clearConsole(),compile(["restart"])}function levelEditorClick_Fn(){textMode||0===state.levels.length?(compile(["loadLevel",0]),levelEditorOpened=!0,canvasResize()):(levelEditorOpened=!levelEditorOpened,canvasResize()),lastDownTarget=canvas}function printUnauthorized(){consolePrint('<br>PuzzleScript needs permission to share games through GitHub:<br><ul><li><a target="_blank" href="'+getAuthURL()+'">Give PuzzleScript permission</a></li></ul>',!0)}function cancelClick(){stopSolving()}function runClick(){clearConsole(),compile(["restart"])}function dateToReadable(e,t){var n=t.getFullYear(),r=t.getMonth()+1,o=t.getDate(),i=t.getHours(),a=t.getMinutes(),l=t.getSeconds();return r<10&&(r="0"+r),o<10&&(o="0"+o),i<10&&(i="0"+i),a<10&&(a="0"+a),l<10&&(l="0"+l),i+":"+a+" "+n+"-"+r+"-"+o+" "+e}function saveClick(){var e="Untitled";void 0!==state.metadata.title&&(e=state.metadata.title);var t={title:e,text:editor.getValue(),date:new Date},n=[];if(storage_has("saves"))n=JSON.parse(storage_get("saves"));n.length>maximumsavedprojects&&n.splice(0,1),n.push(t);var r=JSON.stringify(n);try{storage_set("saves",r)}catch(e){return console.log(e),void consoleError("Was not able to save the project. This likely has something to do with your cookie settings or, if you've already saved some projects, with local storage size limits.")}if(repopulateSaveDropdown(n),document.getElementById("loadDropDown").selectedIndex=0,setEditorClean(),consolePrint("saved file '"+e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"' to local storage",!0),window.location.href.indexOf("?hack")>=0){var o=window.location.href,i=o.substring(o.lastIndexOf("/")+1).split("?")[0];window.history.pushState({},document.title,"./"+i)}n.length===maximumsavedprojects&&consolePrint("WARNING: your <i>locally saved file list</i> has reached its maximum capacity of "+maximumsavedprojects+" files - older saved files will be deleted when you save in future.",!0)}function loadDropDownChange(){if(canExit()){var e=storage_get("saves");null===e&&consolePrint("Eek, trying to load a file, but there's no local storage found. Eek!",!0),saves=JSON.parse(e);for(var t=0;t<saves.length;t++){var n=saves[t];if(dateToReadable(n.title,new Date(n.date))==this.value){var r=n.text;return editor.setValue(r),clearConsole(),setEditorClean(),document.getElementById("loadDropDown").selectedIndex=0,unloadGame(),void compile(["restart"])}}consolePrint("Eek, trying to load a save, but couldn't find it. :(",!0)}else this.selectedIndex=0}function repopulateSaveDropdown(e){var t=document.getElementById("loadDropDown");if(t.options.length=0,void 0===e)try{if(!storage_has("saves"))return;e=JSON.parse(storage_get("saves"))}catch(e){return}(o=document.createElement("OPTION")).text="Load",o.value="Load",t.options.add(o);for(var n=e.length-1;n>=0;n--){var r=e[n],o=document.createElement("OPTION"),i=dateToReadable(r.title,new Date(r.date));o.text=i,o.value=i,t.options.add(o)}t.selectedIndex=0}function levelEditorClick_Fn(){textMode||0===state.levels.length?(compile(["loadLevel",0]),levelEditorOpened=!0,canvasResize()):(levelEditorOpened=!levelEditorOpened,canvasResize()),lastDownTarget=canvas}verboseLoggingClick.addEventListener("click",verboseToggle,!1),verboseLoggingClick.addEventListener("click",verboseToggle,!1),maximumsavedprojects=50,repopulateSaveDropdown(),(loadDropdown=document.getElementById("loadDropDown")).selectedIndex=0,window.addEventListener("pageshow",(function(e){(e.persisted||void 0!==window.performance&&2===window.performance.navigation.type)&&window.location.reload()})),window.addEventListener("popstate",(function(e){console.log("hey"),location.reload()})),repopulateSaveDropdown(),(loadDropdown=document.getElementById("loadDropDown")).selectedIndex=0;const HOSTPAGEURL="https://auroriax.github.io/PuzzleScript",PSFORKNAME="Puzzlescript Plus";function getAuthURL(){return HOSTPAGEURL+"/auth_pat.html"}function printUnauthorized(){const e=getAuthURL();consolePrint("<br>"+PSFORKNAME+' needs permission to share/save games through GitHub:<br><ul><li><a target="_blank" href="'+e+'">Give '+PSFORKNAME+" permission</a></li></ul>",!0)}function shareClick(){return shareOnGitHub(!0)}function cloudSaveClick(){return shareOnGitHub(!1)}function shareClick(){var e=storage_get("oauth_access_token");if("string"!=typeof e)return void printUnauthorized();consolePrint("<br>Sending code to github...",!0);const t=void 0!==state.metadata.title?state.metadata.title+" ("+PSFORKNAME+" Script)":"Untitled "+PSFORKNAME+" Script";compile(["rebuild"]);const n=editor.getValue();var r={description:t,public:!0,files:{"readme.txt":{content:"Play this game by pasting the script in "+HOSTPAGEURL+"/editor.html"},"script.txt":{content:n}}};var o=new XMLHttpRequest;o.open("POST","https://api.github.com/gists"),o.onreadystatechange=function(){if(4==o.readyState){var e=JSON.parse(o.responseText);if(403===o.status)consoleError(e.message);else if(200!==o.status&&201!==o.status)"Unauthorized"===o.statusText?(consoleError("Authorization check failed.  You have to log back into GitHub (or give it permission again or something)."),storage_remove("oauth_access_token")):(consoleError("HTTP Error "+o.status+" - "+o.statusText),consoleError("Try giving "+PSFORKNAME+" permission again, that might fix things...")),printUnauthorized();else{const t=e.id,n=qualifyURL("play.html?p="+t),r=qualifyURL("editor.html?hack="+t),o='Link to source code:<br><a target="_blank"  href="'+r+'">'+r+"</a>";consolePrint('GitHub (<a onclick="githubLogOut();"  href="javascript:void(0);">log out</a>) submission successful.<br>',!0),consolePrint("<br>"+o,!0),consolePrint('<br>The game can now be played at this url:<br><a target="_blank" href="'+n+'">'+n+"</a>",!0)}}},o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("Authorization","token "+e);const i=JSON.stringify(r);o.send(i),lastDownTarget=canvas}function githubLogOut(){storage_remove("oauth_access_token");consolePrint('<br>Logged out of Github.<br><ul><li><a target="_blank" href="'+getAuthURL()+'">Give '+PSFORKNAME+" permission</a></li></ul>",!0)}function rebuildClick(){compile(["rebuild"])}function post_to_url(e,t,n){n=n||"post";var r=document.createElement("form");for(var o in r.setAttribute("method",n),r.setAttribute("action",e),t)if(t.hasOwnProperty(o)){var i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name",o),i.setAttribute("value",t[o]),r.appendChild(i)}document.body.appendChild(r),r.submit()}function exportClick(){var e=editor.getValue();compile("restart"),buildStandalone(JSON.stringify(e))}var soundbarwidth=100,lowerbarheight=document.getElementById("soundbar").clientHeight,upperbarheight=document.getElementById("uppertoolbar").clientHeight,winwidth=window.innerWidth,winheight=window.innerHeight,verticaldragbarWidth=document.getElementById("verticaldragbar").clientWidth,horizontaldragbarHeight=document.getElementById("horizontaldragbar").clientHeight,minimumDimension=100;function resize_widths(e){document.getElementById("leftpanel").style.width=e+"px",document.getElementById("righttophalf").style.left=e+verticaldragbarWidth+"px",document.getElementById("rightbottomhalf").style.left=e+verticaldragbarWidth+"px",document.getElementById("horizontaldragbar").style.left=e+verticaldragbarWidth+"px",document.getElementById("verticaldragbar").style.left=e+"px",canvasResize()}function resize_heights(e){document.getElementById("leftpanel").style.height=window.innerHeight-upperbarheight+"px",document.getElementById("verticaldragbar").style.height=window.innerHeight-upperbarheight+"px",document.getElementById("righttophalf").style.height=e-upperbarheight+"px",document.getElementById("rightbottomhalf").style.top=e+horizontaldragbarHeight+"px",document.getElementById("horizontaldragbar").style.top=e+"px",canvasResize()}function resize_all(e){smallmovelimit=100,hdiff=window.innerWidth-winwidth,verticaldragbarX=parseInt(document.getElementById("verticaldragbar").style.left.replace("px","")),hdiff>-smallmovelimit&&hdiff<smallmovelimit?verticaldragbarX+=hdiff:verticaldragbarX*=window.innerWidth/winwidth,verticaldragbarX<=minimumDimension?verticaldragbarX=minimumDimension:window.innerWidth-verticaldragbarX<soundbarwidth&&(verticaldragbarX=window.innerWidth-soundbarwidth),resize_widths(verticaldragbarX),horizontaldragbarY=parseInt(document.getElementById("horizontaldragbar").style.top.replace("px","")),vdiff=window.innerHeight-winheight,vdiff>-smallmovelimit&&vdiff<smallmovelimit?horizontaldragbarY+=vdiff:horizontaldragbarY*=window.innerHeight/winheight,horizontaldragbarY<=upperbarheight+minimumDimension?horizontaldragbarY=upperbarheight+minimumDimension:window.innerHeight-horizontaldragbarY<lowerbarheight+minimumDimension&&(horizontaldragbarY=window.innerHeight-(lowerbarheight+minimumDimension+5)),resize_heights(horizontaldragbarY),winwidth=window.innerWidth,winheight=window.innerHeight}function verticalDragbarMouseDown(e){e.preventDefault(),document.body.style.cursor="col-resize",window.addEventListener("mousemove",verticalDragbarMouseMove,!1),window.addEventListener("mouseup",verticalDragbarMouseUp,!1)}function verticalDragbarMouseMove(e){e.pageX<=minimumDimension?resize_widths(minimumDimension):window.innerWidth-e.pageX>soundbarwidth?resize_widths(e.pageX-1):resize_widths(window.innerWidth-soundbarwidth)}function verticalDragbarMouseUp(e){document.body.style.cursor="",window.removeEventListener("mousemove",verticalDragbarMouseMove,!1)}function horizontalDragbarMouseDown(e){e.preventDefault(),document.body.style.cursor="row-resize",window.addEventListener("mousemove",horizontalDragbarMouseMove,!1),window.addEventListener("mouseup",horizontalDragbarMouseUp,!1)}function horizontalDragbarMouseMove(e){e.pageY<=upperbarheight+minimumDimension?resize_heights(upperbarheight+minimumDimension):window.innerHeight-e.pageY>lowerbarheight+minimumDimension?resize_heights(e.pageY-1):resize_heights(window.innerHeight-lowerbarheight-minimumDimension)}function horizontalDragbarMouseUp(e){document.body.style.cursor="",window.removeEventListener("mousemove",horizontalDragbarMouseMove,!1)}function reset_panels(){resize_widths(Math.floor(window.innerWidth/2)),resize_heights(Math.floor(window.innerHeight/2)),winwidth=window.innerWidth,winheight=window.innerHeight}for(i=0;i<10;i++){var idname="newsound"+i,el=document.getElementById(idname);el.addEventListener("click",function(e){return function(){return newSound(e)}}(i),!1)}var solveClickLink=document.getElementById("solveClickLink");solveClickLink.addEventListener("click",solveClick,!1);var cancelClickLink=document.getElementById("cancelClickLink");cancelClickLink.addEventListener("click",cancelClick,!1);var runClickLink=document.getElementById("runClickLink");runClickLink.addEventListener("click",runClick,!1);var saveClickLink=document.getElementById("saveClickLink");saveClickLink.addEventListener("click",saveClick,!1);var rebuildClickLink=document.getElementById("rebuildClickLink");rebuildClickLink.addEventListener("click",rebuildClick,!1);var shareClickLink=document.getElementById("shareClickLink");shareClickLink.addEventListener("click",shareClick,!1);var levelEditorClickLink=document.getElementById("levelEditorClickLink");levelEditorClickLink.addEventListener("click",levelEditorClick_Fn,!1);var exportClickLink=document.getElementById("exportClickLink");exportClickLink.addEventListener("click",exportClick,!1);var exampleDropdown=document.getElementById("exampleDropdown");exampleDropdown.addEventListener("change",dropdownChange,!1);var loadDropDown=document.getElementById("loadDropDown");loadDropDown.addEventListener("change",loadDropDownChange,!1);var horizontalDragbar=document.getElementById("horizontaldragbar");horizontalDragbar.addEventListener("mousedown",horizontalDragbarMouseDown,!1);var verticalDragbar=document.getElementById("verticaldragbar");verticalDragbar.addEventListener("mousedown",verticalDragbarMouseDown,!1),window.addEventListener("resize",resize_all,!1),window.addEventListener("load",reset_panels,!1),window.onbeforeunload=function(e){e=e||window.event;var t="You have unsaved changes!";if(_editorDirty)return e&&(e.returnValue=t),t};var gestureHandler=Mobile.enable();gestureHandler&&gestureHandler.setFocusElement(document.getElementById("gameCanvas"));var abortSolver=!1,solving=!1;const timeout=e=>new Promise((t=>setTimeout(t,e)));function byScoreAndLength(e,t){return e[0]!=t[0]?e[0]<t[0]:e[2].length<t[2].length}var distanceTable;async function solve(){if(!levelEditorOpened&&!solving&&!textMode&&0!==state.levels.length){var e=!1;verbose_logging&&(verbose_logging=!1,cache_console_messages=!1,e=!0,consolePrint("Disabling verbose logging to speed up solver")),precalcDistances(),abortSolver=!1,muted=!0,solving=!0,restartTarget=backupLevel(),hasUsedCheckpoint=!1,backups=[];var t=deltatime;deltatime=0;var n=[0,1,2,3,4];"noaction"in state.metadata&&(n=[0,1,2,3]);var r="uldrx",o={};o[level.objects]=!0;var i=new FastPriorityQueue(byScoreAndLength);i.add([0,level.objects.slice(0),""]),consolePrint("searching...");var a=document.getElementById("solvingProgress"),l=document.getElementById("cancelClickLink");l.hidden=!1;for(var s=0,c=1;!i.isEmpty();){if(abortSolver){consolePrint("solver aborted"),l.hidden=!0,verbose_logging=e,cache_console_messages=e;break}++s>250&&(s=0,a.innerHTML="searched: "+c,redraw(),await timeout(1));var u=i.poll(),d=u[1],h=u[2];shuffleALittle(n);for(var f=0,p=n.length;f<p;f++){for(var g=0,m=d.length;g<m;g++)level.objects[g]=d[g];for(var v=processInput(n[f]);againing;)v=processInput(-1)||v;if(v){if(level.objects in o)continue;var y=h+r[n[f]];if(winning||hasUsedCheckpoint){hasUsedCheckpoint=!1;var _="("+chunkString(y,5).join(" ")+")";verbose_logging=!0,cache_console_messages=!0,consolePrint("solution found: ("+y.length+" steps, "+c+" positions explored)"),consolePrint(_),console.log("solution found:\n"+_);if(y.length>=200)consolePrint("More than 200 steps needed to solve puzzle, not printing individual states");else{winning=!1,verbose_logging=!1,DoRestart(),addToDebugTimeline(level,0);for(f=0;f!=y.length;f++){var b=y[f],w=-1;for(j=0;j!=r.length;j++)if(b==r[j]){w=j;break}verbose_logging=!1;var x=0;for(processInput(w);againing;)processInput(-1),x++;verbose_logging=!0;var S="Turn "+(f+1)+", input "+b;x>=1&&(S+=" (again turns: "+x+")"),consolePrint(S,!1,null,addToDebugTimeline(level,f+2))}}return a.innerHTML="",deltatime=t,DoRestart(),cache_console_messages=e,verbose_logging=e,solving=!1,muted=!1,winning=!1,playSound(13219900),redraw(),void(l.hidden=!0)}o[level.objects]=!0,c++,i.add([getScore(),level.objects.slice(0),y])}}}muted=!1,solving=!1,DoRestart(),consolePrint("no solution found ("+c+" positions explored)"),console.log("no solution found"),verbose_logging=e,cache_console_messages=e,a.innerHTML="",deltatime=t,playSound(52291704),redraw(),l.hidden=!0}}function stopSolving(){abortSolver=!0}function chunkString(e,t){return e.match(new RegExp(".{1,"+t+"}","g"))}function shuffleALittle(e){randomIndex=1+Math.floor(Math.random()*(e.length-1)),temporaryValue=e[0],e[0]=e[randomIndex],e[randomIndex]=temporaryValue}function distance(e,t){return Math.abs(Math.floor(e/level.height)-Math.floor(t/level.height))+Math.abs(e%level.height-t%level.height)}function precalcDistances(){distanceTable=[];for(var e=0;e<level.n_tiles;e++){ds=[];for(var t=0;t<level.n_tiles;t++)ds.push(distance(e,t));distanceTable.push(ds)}}function getScore(){var e=0,t=level.width+level.height;if(state.winconditions.length>0)for(var n=0;n<state.winconditions.length;n++){var r=state.winconditions[n],o=r[1],i=r[2];if(-1==r[0])for(var a=0;a<level.n_tiles;a++){var l=level.getCellInto(a,_o10);o.bitsClearInArray(l.data)||i.bitsClearInArray(l.data)||(e+=1)}else for(a=0;a<level.n_tiles;a++)if(!o.bitsClearInArray(level.getCellInto(a,_o10).data)){for(var s=t,c=0;c<level.n_tiles;c++)if(!i.bitsClearInArray(level.getCellInto(c,_o10).data)){var u=distanceTable[a][c];u<s&&(s=u)}e+=s}}return e}var defaultcomparator=function(e,t){return e<t};function FastPriorityQueue(e){if(!(this instanceof FastPriorityQueue))return new FastPriorityQueue(e);this.array=[],this.size=0,this.compare=e||defaultcomparator}FastPriorityQueue.prototype.clone=function(){var e=new FastPriorityQueue(this.compare);e.size=this.size;for(var t=0;t<this.size;t++)e.array.push(this.array[t]);return e},FastPriorityQueue.prototype.add=function(e){var t,n,r=this.size;for(this.array[this.size]=e,this.size+=1;r>0&&(t=r-1>>1,n=this.array[t],this.compare(e,n));)this.array[r]=n,r=t;this.array[r]=e},FastPriorityQueue.prototype.heapify=function(e){var t;for(this.array=e,this.size=e.length,t=this.size>>1;t>=0;t--)this._percolateDown(t)},FastPriorityQueue.prototype._percolateUp=function(e,t){for(var n,r,o=this.array[e];e>0&&(n=e-1>>1,r=this.array[n],t||this.compare(o,r));)this.array[e]=r,e=n;this.array[e]=o},FastPriorityQueue.prototype._percolateDown=function(e){for(var t,n,r,o=this.size,i=this.size>>>1,a=this.array[e];e<i&&(n=(t=1+(e<<1))+1,r=this.array[t],n<o&&this.compare(this.array[n],r)&&(t=n,r=this.array[n]),this.compare(r,a));)this.array[e]=r,e=t;this.array[e]=a},FastPriorityQueue.prototype._removeAt=function(e){return!(this.isEmpty()||e>this.size-1||e<0)&&(this._percolateUp(e,!0),this.poll(),!0)},FastPriorityQueue.prototype.remove=function(e,t){if(t||(t=this.compare),this.isEmpty())return!1;for(var n=0;n<this.size;n++)if(!t(this.array[n],e)&&!t(e,this.array[n]))return this._removeAt(n);return!1},FastPriorityQueue.prototype.peek=function(){if(0!=this.size)return this.array[0]},FastPriorityQueue.prototype.poll=function(){if(0!=this.size){var e=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,e}},FastPriorityQueue.prototype.replaceTop=function(e){if(0!=this.size){var t=this.array[0];return this.array[0]=e,this._percolateDown(0),t}},FastPriorityQueue.prototype.trim=function(){this.array=this.array.slice(0,this.size)},FastPriorityQueue.prototype.isEmpty=function(){return 0===this.size},FastPriorityQueue.prototype.forEach=function(e){if(!this.isEmpty()&&"function"==typeof e)for(var t=0,n=this.clone();!n.isEmpty();)e(n.poll(),t++)},FastPriorityQueue.prototype.kSmallest=function(e){if(0==this.size)return[];var t=this.compare,n=this.array,r=new FastPriorityQueue((function(e,r){return t(n[e],n[r])}));e=Math.min(this.size,e);var o=new Array(e),i=0;for(r.add(0);i<e;){var a=r.poll();o[i++]=this.array[a];var l=1+(a<<1),s=l+1;l<this.size&&r.add(l),s<this.size&&r.add(s)}return o};
//# sourceMappingURL=scripts_compiled.js.map