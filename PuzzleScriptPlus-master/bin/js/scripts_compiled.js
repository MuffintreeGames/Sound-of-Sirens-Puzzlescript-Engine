/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */
if("function"!=typeof Blob||void 0===URL)if("function"==typeof Blob&&"undefined"!=typeof webkitURL)var URL=webkitURL;else var Blob=function(e){"use strict";var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},r=function(e,t,n){this.data=e,this.size=e.length,this.type=t,this.encoding=n},o=n.prototype,i=r.prototype,s=e.FileReaderSync,a=function(e){this.code=this[this.name=e]},l="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=l.length,u=e.URL||e.webkitURL||e,d=u.createObjectURL,h=u.revokeObjectURL,p=u,f=e.btoa,g=e.atob,m=!1,v=e.ArrayBuffer,y=e.Uint8Array;for(r.fake=i.fake=!0;c--;)a.prototype[l[c]]=c+1;try{y&&function(e){m=!e}.apply(0,new y(1))}catch(e){}return u.createObjectURL||(p=e.URL={}),p.createObjectURL=function(e){var t,n=e.type;return null===n&&(n="application/octet-stream"),e instanceof r?(t="data:"+n,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):f?t+";base64,"+f(e.data):t+","+encodeURIComponent(e.data)):d?d.call(u,e):void 0},p.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&h&&h.call(u,e)},o.append=function(e){var n=this.data;if(y&&(e instanceof v||e instanceof y))if(m)n.push(String.fromCharCode.apply(String,new y(e)));else for(var o=new y(e),i=0,l=o.length;i<l;i++)String.fromCharCode(o[i]);else if("Blob"===t(e)||"File"===t(e)){if(!s)throw new a("NOT_READABLE_ERR");var c=new s;n.push(c.readAsBinaryString(e))}else e instanceof r?"base64"===e.encoding&&g?n.push(g(e.data)):"URI"===e.encoding?n.push(decodeURIComponent(e.data)):"raw"===e.encoding&&n.push(e.data):("string"!=typeof e&&(e+=""),n.push(unescape(encodeURIComponent(e))))},o.getBlob=function(e){return arguments.length||(e=null),new r(this.data.join(""),e,"raw")},o.toString=function(){return"[object BlobBuilder]"},i.slice=function(e,t,n){var o=arguments.length;return o<3&&(n=null),new r(this.data.slice(e,o>1?t:this.data.length),n,this.encoding)},i.toString=function(){return"[object Blob]"},n}(e);return function(e,n){var r=n&&n.type||"",o=new t;if(e)for(var i=0,s=e.length;i<s;i++)o.append(e[i]);return o.getBlob(r)}}(self);
/*! @source http://purl.eligrey.com/github/canvas-toBlob.js/blob/master/canvas-toBlob.js */!function(e){"use strict";var t,n=e.Uint8Array,r=e.HTMLCanvasElement,o=/\s*;\s*base64\s*(?:;|$)/i,i=function(e){for(var r,o,i=e.length,s=new n(i/4*3|0),a=0,l=0,c=[0,0],u=0,d=0;i--;)o=e.charCodeAt(a++),255!==(r=t[o-43])&&undefined!==r&&(c[1]=c[0],c[0]=o,d=d<<6|r,4===++u&&(s[l++]=d>>>16,61!==c[1]&&(s[l++]=d>>>8),61!==c[0]&&(s[l++]=d),u=0));return s.buffer};n&&(t=new n([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),r&&!r.prototype.toBlob&&(r.prototype.toBlob=function(e,t){if(t||(t="image/png"),this.mozGetAsFile)e(this.mozGetAsFile("canvas",t));else{var r,s=Array.prototype.slice.call(arguments,1),a=this.toDataURL.apply(this,s),l=a.indexOf(","),c=a.substring(l+1),u=o.test(a.substring(0,l));Blob.fake?((r=new Blob).encoding=u?"base64":"URI",r.data=c,r.size=c.length):n&&(r=new Blob(u?[i(c)]:[decodeURIComponent(c)],{type:t})),e(r)}})}(self);
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){"use strict";var t=e.document,n=e.URL||e.webkitURL||e,r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,i=e.webkitRequestFileSystem,s=e.requestFileSystem||i||e.mozRequestFileSystem,a=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},l="application/octet-stream",c=0,u=[],d=function(e,t,n){for(var r=(t=[].concat(t)).length;r--;){var o=e["on"+t[r]];if("function"==typeof o)try{o.call(e,n||e)}catch(e){a(e)}}},h=function(n,a){var h,p,f,g,m,v=this,y=n.type,_=!1,b=function(){var t=(e.URL||e.webkitURL||e).createObjectURL(n);return u.push(t),t},w=function(){d(v,"writestart progress write writeend".split(" "))},S=function(){!_&&h||(h=b()),p&&(p.location.href=h),v.readyState=v.DONE,w()},C=function(e){return function(){if(v.readyState!==v.DONE)return e.apply(this,arguments)}},I={create:!0,exclusive:!1};if(v.readyState=v.INIT,a||(a="download"),o)return h=b(),r.href=h,r.download=a,g=r,(m=t.createEvent("MouseEvents")).initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),g.dispatchEvent(m),v.readyState=v.DONE,void w();e.chrome&&y&&y!==l&&(f=n.slice||n.webkitSlice,n=f.call(n,0,n.size,l),_=!0),i&&"download"!==a&&(a+=".download"),p=y===l||i?e:e.open(),s?(c+=n.size,s(e.TEMPORARY,c,C((function(e){e.root.getDirectory("saved",I,C((function(e){var t=function(){e.getFile(a,I,C((function(e){e.createWriter(C((function(t){t.onwriteend=function(t){p.location.href=e.toURL(),u.push(e),v.readyState=v.DONE,d(v,"writeend",t)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&S()},"writestart progress write abort".split(" ").forEach((function(e){t["on"+e]=v["on"+e]})),t.write(n),v.abort=function(){t.abort(),v.readyState=v.DONE},v.readyState=v.WRITING})),S)})),S)};e.getFile(a,{create:!1},C((function(e){e.remove(),t()})),C((function(e){e.code===e.NOT_FOUND_ERR?t():S()})))})),S)})),S)):S()},p=h.prototype;return p.abort=function(){var e=this;e.readyState=e.DONE,d(e,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,e.addEventListener("unload",(function(){for(var e=u.length;e--;){var t=u[e];"string"==typeof t?n.revokeObjectURL(t):t.remove()}u.length=0}),!1),function(e,t){return new h(e,t)}}(self);function storage_has(e){return null!==localStorage.getItem(e)}function storage_get(e){return localStorage.getItem(e)}function storage_set(e,t){return localStorage.setItem(e,t)}function storage_remove(e){localStorage.removeItem(e)}LZWEncoder=function(){var e,t,n,r,o,i,s,a,l,c,u,d,h={},p=-1,f=12,g=5003,m=f,v=1<<f,y=new Array,_=new Array,b=g,w=0,S=!1,C=0,I=0,x=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],O=[],M=h.LZWEncoder=function(o,i,s,a){e=o,t=i,n=s,r=Math.max(2,a)},k=function(e,t){O[d++]=e,d>=254&&L(t)},E=function(e){N(b),w=c+2,S=!0,D(c,e)},N=function(e){for(var t=0;t<e;++t)y[t]=-1},T=h.compress=function(e,t){var n,r,o,i,h,f,g;for(S=!1,a=A(s=l=e),u=(c=1<<e-1)+1,w=c+2,d=0,i=R(),g=0,n=b;n<65536;n*=2)++g;g=8-g,N(f=b),D(c,t);e:for(;(o=R())!=p;)if(n=(o<<m)+i,y[r=o<<g^i]!=n){if(y[r]>=0){h=f-r,0==r&&(h=1);do{if((r-=h)<0&&(r+=f),y[r]==n){i=_[r];continue e}}while(y[r]>=0)}D(i,t),i=o,w<v?(_[r]=w++,y[r]=n):E(t)}else i=_[r];D(i,t),D(u,t)},L=(h.encode=function(n){n.writeByte(r),o=e*t,i=0,T(r+1,n),n.writeByte(0)},function(e){d>0&&(e.writeByte(d),e.writeBytes(O,0,d),d=0)}),A=function(e){return(1<<e)-1},R=function(){return 0==o?p:(--o,255&n[i++])},D=function(e,t){for(C&=x[I],I>0?C|=e<<I:C=e,I+=s;I>=8;)k(255&C,t),C>>=8,I-=8;if((w>a||S)&&(S?(a=A(s=l),S=!1):(++s,a=s==m?v:A(s))),e==u){for(;I>0;)k(255&C,t),C>>=8,I-=8;L(t)}};return M.apply(this,arguments),h},NeuQuant=function(){var e,t,n,r,o,i={},s=256,a=499,l=491,c=487,u=503,d=3*u,h=s-1,p=4,f=100,g=16,m=1<<g,v=10,y=10,_=m>>y,b=m<<v-y,w=s>>3,S=6,C=1<<S,I=w*C,x=30,O=10,M=1<<O,k=8,E=1<<k,N=O+k,T=1<<N,L=new Array,A=new Array,R=new Array,D=new Array,P=i.NeuQuant=function(e,i,a){var l,c;for(t=e,n=i,r=a,o=new Array(s),l=0;l<s;l++)o[l]=new Array(4),(c=o[l])[0]=c[1]=c[2]=(l<<p+8)/s,R[l]=m/s,A[l]=0},F=function(){for(var e=[],t=new Array(s),n=0;n<s;n++)t[o[n][3]]=n;for(var r=0,i=0;i<s;i++){var a=t[i];e[r++]=o[a][0],e[r++]=o[a][1],e[r++]=o[a][2]}return e},B=function(){var e,t,n,r,i,a,l,c;for(l=0,c=0,e=0;e<s;e++){for(n=e,r=(i=o[e])[1],t=e+1;t<s;t++)(a=o[t])[1]<r&&(n=t,r=a[1]);if(a=o[n],e!=n&&(t=a[0],a[0]=i[0],i[0]=t,t=a[1],a[1]=i[1],i[1]=t,t=a[2],a[2]=i[2],i[2]=t,t=a[3],a[3]=i[3],i[3]=t),r!=l){for(L[l]=c+e>>1,t=l+1;t<r;t++)L[t]=e;l=r,c=e}}for(L[l]=c+h>>1,t=l+1;t<256;t++)L[t]=h},j=function(){var o,i,s,h,g,m,v,y,_,b,w,C,O,k;for(n<d&&(r=1),e=30+(r-1)/3,C=t,O=0,k=n,b=(w=n/(3*r))/f|0,y=M,(v=(m=I)>>S)<=1&&(v=0),o=0;o<v;o++)D[o]=y*((v*v-o*o)*E/(v*v));for(_=n<d?3:n%a!=0?3*a:n%l!=0?3*l:n%c!=0?3*c:3*u,o=0;o<w;)if(s=(255&C[O+0])<<p,h=(255&C[O+1])<<p,g=(255&C[O+2])<<p,i=H(s,h,g),U(y,i,s,h,g),0!=v&&V(v,i,s,h,g),(O+=_)>=k&&(O-=n),0==b&&(b=1),++o%b==0)for(y-=y/e,(v=(m-=m/x)>>S)<=1&&(v=0),i=0;i<v;i++)D[i]=y*((v*v-i*i)*E/(v*v))},z=(i.map=function(e,t,n){var r,i,a,l,c,u,d;for(c=1e3,d=-1,i=(r=L[t])-1;r<s||i>=0;)r<s&&((a=(u=o[r])[1]-t)>=c?r=s:(r++,a<0&&(a=-a),(l=u[0]-e)<0&&(l=-l),(a+=l)<c&&((l=u[2]-n)<0&&(l=-l),(a+=l)<c&&(c=a,d=u[3])))),i>=0&&((a=t-(u=o[i])[1])>=c?i=-1:(i--,a<0&&(a=-a),(l=u[0]-e)<0&&(l=-l),(a+=l)<c&&((l=u[2]-n)<0&&(l=-l),(a+=l)<c&&(c=a,d=u[3]))));return d},i.process=function(){return j(),z(),B(),F()},function(){var e;for(e=0;e<s;e++)o[e][0]>>=p,o[e][1]>>=p,o[e][2]>>=p,o[e][3]=e}),V=function(e,t,n,r,i){var a,l,c,u,d,h,p;for((c=t-e)<-1&&(c=-1),(u=t+e)>s&&(u=s),a=t+1,l=t-1,h=1;a<u||l>c;){if(d=D[h++],a<u){p=o[a++];try{p[0]-=d*(p[0]-n)/T,p[1]-=d*(p[1]-r)/T,p[2]-=d*(p[2]-i)/T}catch(e){}}if(l>c){p=o[l--];try{p[0]-=d*(p[0]-n)/T,p[1]-=d*(p[1]-r)/T,p[2]-=d*(p[2]-i)/T}catch(e){}}}},U=function(e,t,n,r,i){var s=o[t];s[0]-=e*(s[0]-n)/M,s[1]-=e*(s[1]-r)/M,s[2]-=e*(s[2]-i)/M},H=function(e,t,n){var r,i,a,l,c,u,d,h,f,m;for(f=h=~(1<<31),d=u=-1,r=0;r<s;r++)(i=(m=o[r])[0]-e)<0&&(i=-i),(a=m[1]-t)<0&&(a=-a),i+=a,(a=m[2]-n)<0&&(a=-a),(i+=a)<h&&(h=i,u=r),(l=i-(A[r]>>g-p))<f&&(f=l,d=r),c=R[r]>>y,R[r]-=c,A[r]+=c<<v;return R[u]+=_,A[u]-=b,d};return P.apply(this,arguments),i},GIFEncoder=function(){for(var e=0,t={};e<256;e++)t[e]=String.fromCharCode(e);function n(){this.bin=[]}n.prototype.getData=function(){for(var e="",n=this.bin.length,r=0;r<n;r++)e+=t[this.bin[r]];return e},n.prototype.writeByte=function(e){this.bin.push(e)},n.prototype.writeUTFBytes=function(e){for(var t=e.length,n=0;n<t;n++)this.writeByte(e.charCodeAt(n))},n.prototype.writeBytes=function(e,t,n){for(var r=n||e.length,o=t||0;o<r;o++)this.writeByte(e[o])};var r,o,i,s,a,l,c,u,d,h={},p=null,f=-1,g=0,m=!1,v=new Array,y=7,_=-1,b=!0,w=!1,S=10,C=(h.setDelay=function(e){g=Math.round(e/10)},h.setDispose=function(e){e>=0&&(_=e)},h.setRepeat=function(e){e>=0&&(f=e)},h.setTransparent=function(e){p=e},h.addFrame=function(e,t){if(null==e||!m||null==s)throw new Error("Please call start method before calling addFrame");var n=!0;try{t?a=e:(a=e.getImageData(0,0,e.canvas.width,e.canvas.height).data,w||I(e.canvas.width,e.canvas.height)),M(),x(),b&&(N(),L(),f>=0&&T()),k(),E(),b||L(),R(),b=!1}catch(e){n=!1}return n},h.finish=function(){if(!m)return!1;var e=!0;m=!1;try{s.writeByte(59)}catch(t){e=!1}return e},function(){i=0,a=null,l=null,c=null,d=null,!1,b=!0}),I=(h.setFrameRate=function(e){15!=e&&(g=Math.round(100/e))},h.setQuality=function(e){e<1&&(e=1),S=e},h.setSize=function(e,t){m&&!b||((r=e)<1&&(r=320),(o=t)<1&&(o=240),w=!0)}),x=(h.start=function(){C();var e=!0;!1,s=new n;try{s.writeUTFBytes("GIF89a")}catch(t){e=!1}return m=e},h.cont=function(){C();return!1,s=new n,m=!0},function(){var e=l.length,t=e/3;c=[];for(var n=new Set,r=0,o=0;o<t&&(n.add(((255&l[r++])<<16)+((255&l[r++])<<8)+(255&l[r++])),!(n.length>256));o++);if(n.length>256){y=7;var s=new NeuQuant(l,e,S);d=s.process(),r=0;for(o=0;o<t;o++){var a=s.map(255&l[r++],255&l[r++],255&l[r++]);v[a]=!0,c[o]=a}}else{d=Array.from(n),r=0;for(o=0;o<t;o++){a=d.indexOf(((255&l[r++])<<16)+((255&l[r++])<<8)+(255&l[r++]));v[a]=!0,c[o]=a}d=d.reduce((function(e,t,n,r){return e.concat(t>>>16,t>>>8&255,255&t)}),[]),-1===(y=Math.ceil(Math.log2(d.length/3))-1)&&(y=0)}l=null,u=8,null!=p&&(i=O(p))}),O=function(e){if(null==d)return-1;for(var t=(16711680&e)>>16,n=(65280&e)>>8,r=255&e,o=0,i=16777216,s=d.length,a=0;a<s;){var l=t-(255&d[a++]),c=n-(255&d[a++]),u=r-(255&d[a]),h=l*l+c*c+u*u,p=a/3;v[p]&&h<i&&(i=h,o=p),a++}return o},M=function(){var e=r,t=o;l=[];for(var n=a,i=0,s=0;s<t;s++)for(var c=0;c<e;c++){var u=s*e*4+4*c;l[i++]=n[u],l[i++]=n[u+1],l[i++]=n[u+2]}},k=function(){var e,t;s.writeByte(33),s.writeByte(249),s.writeByte(4),null==p?(e=0,t=0):(e=1,t=2),_>=0&&(t=7&_),t<<=2,s.writeByte(0|t|e),A(g),s.writeByte(i),s.writeByte(0)},E=function(){s.writeByte(44),A(0),A(0),A(r),A(o),b?s.writeByte(0):s.writeByte(128|y)},N=function(){A(r),A(o),s.writeByte(240|y),s.writeByte(0),s.writeByte(0)},T=function(){s.writeByte(33),s.writeByte(255),s.writeByte(11),s.writeUTFBytes("NETSCAPE2.0"),s.writeByte(3),s.writeByte(1),A(f),s.writeByte(0)},L=function(){s.writeBytes(d);for(var e=3*Math.pow(2,y+1)-d.length,t=0;t<e;t++)s.writeByte(0)},A=function(e){s.writeByte(255&e),s.writeByte(e>>8&255)},R=function(){new LZWEncoder(r,o,c,u).encode(s)};h.stream=function(){return s},h.setProperties=function(e,t){m=e,b=t};return h};var compiledText,canSetHTMLColors=!1,canDump=!0,canYoutube=!1,recordingStartsFromLevel=0,inputHistory=[],canOpenEditor=!0,IDE=!0;solving=!1;var debugger_turnIndex=0,debug_visualisation_array=[],diffToVisualize=null;function convertLevelToString(){for(var e="",t={},n=0,r=0;r<level.height;r++){for(var o=0;o<level.width;o++){for(var i=level.getCell(o+r*level.width),s=[],a=0;a<32*STRIDE_OBJ;++a)i.get(a)&&s.push(state.idDict[a]);s.sort(),s=s.join(" "),t.hasOwnProperty(s)||(t[s]=n++,e+=s+":"),e+=t[s]+","}e+="\n"}return e}function stripHTMLTags(e){var t=document.createElement("div");return t.innerHTML=e,(t.textContent||t.innerText||"").trim()}function dumpTestCase(){var e=[compiledText,errorStrings.map(stripHTMLTags),errorCount],t=JSON.stringify(e);t=`<br>\n\t[<br>\n\t\t"${state.metadata.title||"untitled test"}",<br>\n\t\t${t}<br>\n\t],`,consolePrint('<br>Compilation error/warning data (for error message tests - errormessage_testdata.js):<br><br><br><span id="'+(n="selectable"+ ++selectableint)+'" onclick="selectText(\''+n+"',event)\">"+t+"</span><br><br><br>",!0);var n;e=[compiledText,inputHistory.concat([]),convertLevelToString(),recordingStartsFromLevel,loadedLevelSeed],t=JSON.stringify(e);t=`<br>\n\t[<br>\n\t\t"${state.metadata.title||"untitled test"}",<br>\n\t\t${t}<br>\n\t],`,consolePrint('<br>Recorded play session data (for play session tests - testdata.js):<br><br><br><span id="'+(n="selectable"+ ++selectableint)+'" onclick="selectText(\''+n+"',event)\">"+t+"</span><br><br><br>",!0)}function clearInputHistory(){!0===canDump&&(inputHistory=[],recordingStartsFromLevel=curlevel)}function pushInput(e){!0===canDump&&inputHistory.push(e)}var musicSetting,sfxSetting,earnedAchievements,placedArrows,crashes,unitTesting=!1,curlevel=0,solvedSections=[],curlevelTarget=null,hasUsedCheckpoint=!1,levelEditorOpened=!1,muted=0,runrulesonlevelstart_phase=!1,ignoreNotJustPressedAction=!0,currentMusic=null;function doSetupTitleScreenLevelContinue(){try{if(storage_has(document.URL)){if(storage_has(document.URL+"_checkpoint")){var e=storage_get(document.URL+"_checkpoint");curlevelTarget=JSON.parse(e);var t=[];for(var n in Object.keys(curlevelTarget.dat))t[n]=curlevelTarget.dat[n];curlevelTarget.dat=new Int32Array(t)}curlevel=storage_get(document.URL),void 0!==localStorage[document.URL+"_sections"]&&(solvedSections=JSON.parse(localStorage.getItem(document.URL+"_sections")))}sfxSetting=storage_has(document.URL+"_sfx")?JSON.parse(localStorage.getItem(document.URL+"_sfx")):10,musicSetting=storage_has(document.URL+"_music")?JSON.parse(localStorage.getItem(document.URL+"_music")):10,earnedAchievements=storage_has(document.URL+"_achievements")?JSON.parse(localStorage.getItem(document.URL+"_achievements")):{},placedArrows=storage_has(document.URL+"_arrows")?JSON.parse(localStorage.getItem(document.URL+"_arrows")):0,crashes=storage_has(document.URL+"_crashes")?JSON.parse(localStorage.getItem(document.URL+"_crashes")):0}catch(e){}}doSetupTitleScreenLevelContinue();for(var verbose_logging=!1,throttle_movement=!1,cache_console_messages=!1,quittingTitleScreen=!1,quittingMessageScreen=!1,deltatime=17,timer=0,repeatinterval=150,autotick=0,autotickinterval=0,winning=!1,againing=!1,againinterval=150,norepeat_action=!1,oldflickscreendat=[],keybuffer=[],tweeninterval=0,tweentimer=0,restarting=!1,messageselected=!1,textImages={},initLevel={width:5,height:5,layerCount:2,dat:[1,3,3,1,1,2,2,3,3,1,2,1,2,2,3,3,1,1,2,2,3,2,1,3,2,1,3,2,1,3,1,3,3,1,1,2,2,3,3,1,2,1,2,2,3,3,1,1,2,2],movementMask:[1,3,3,1,1,2,2,3,3,1,2,1,2,2,3,3,1,1,2,2,3,2,1,3,2,1,3,2,1,3,1,3,3,1,1,2,2,3,3,1,2,1,2,2,3,3,1,1,2,2],rigidGroupIndexMask:[],rigidMovementAppliedMask:[],bannedGroup:[],colCellContents:[],rowCellContents:[],colCellContents_Movements:[],rowCellContents_Movements:[]},level=initLevel,font={0:"\n00000\n00000\n00000\n01110\n10001\n10011\n10101\n11001\n10001\n01110\n00000\n00000",1:"\n00000\n00000\n00000\n11100\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000",2:"\n00000\n00000\n00000\n11110\n00001\n00001\n01110\n10000\n10000\n11111\n00000\n00000",3:"\n00000\n00000\n00000\n11110\n00001\n00110\n00001\n00001\n00001\n11110\n00000\n00000",4:"\n00000\n00000\n00000\n10000\n10000\n10000\n10010\n11111\n00010\n00010\n00000\n00000",5:"\n00000\n00000\n00000\n11111\n10000\n11110\n00001\n00001\n00001\n11110\n00000\n00000",6:"\n00000\n00000\n00000\n01110\n10000\n11110\n10001\n10001\n10001\n01110\n00000\n00000",7:"\n00000\n00000\n00000\n11111\n00001\n00010\n00100\n00100\n00100\n00100\n00000\n00000",8:"\n00000\n00000\n00000\n01110\n10001\n01110\n10001\n10001\n10001\n01110\n00000\n00000",9:"\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n01111\n00001\n01110\n00000\n00000",a:"\n00000\n00000\n00000\n00000\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000",b:"\n00000\n00000\n00000\n10000\n10000\n11110\n10001\n10001\n10001\n01110\n00000\n00000",c:"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n01111\n00000\n00000",d:"\n00000\n00000\n00000\n00001\n00001\n01111\n10001\n10001\n10001\n01111\n00000\n00000",e:"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000",f:"\n00000\n00000\n00000\n00011\n00100\n11111\n00100\n00100\n00100\n00100\n00000\n00000",g:"\n00000\n00000\n00000\n00000\n00000\n01111\n10001\n10001\n10001\n01111\n00001\n01110",h:"\n00000\n00000\n00000\n10000\n10000\n11110\n10001\n10001\n10001\n10001\n00000\n00000",i:"\n00000\n00000\n00000\n00100\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000",j:"\n00000\n00000\n00000\n00100\n00000\n01100\n00100\n00100\n00100\n00100\n10100\n01000",k:"\n00000\n00000\n00000\n10000\n10000\n10001\n10010\n11100\n10010\n10001\n00000\n00000",l:"\n00000\n00000\n00000\n01100\n00100\n00100\n00100\n00100\n00100\n01110\n00000\n00000",m:"\n00000\n00000\n00000\n00000\n00000\n01010\n10101\n10101\n10101\n10101\n00000\n00000",n:"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n10001\n00000\n00000",o:"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000",p:"\n00000\n00000\n00000\n00000\n00000\n11110\n10001\n10001\n10001\n11110\n10000\n10000",q:"\n00000\n00000\n00000\n00000\n00000\n01111\n10001\n10001\n10001\n01111\n00001\n00001",r:"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10000\n00000\n00000",s:"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n01110\n00001\n11110\n00000\n00000",t:"\n00000\n00000\n00000\n00100\n00100\n11111\n00100\n00100\n00100\n00011\n00000\n00000",u:"\n00000\n00000\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000",v:"\n00000\n00000\n00000\n00000\n00000\n10001\n10010\n10100\n11000\n10000\n00000\n00000",w:"\n00000\n00000\n00000\n00000\n00000\n10101\n10101\n10101\n10101\n01010\n00000\n00000",x:"\n00000\n00000\n00000\n00000\n00000\n10001\n01010\n00100\n01010\n10001\n00000\n00000","×":"\n00000\n00000\n00000\n00000\n00000\n10001\n01010\n00100\n01010\n10001\n00000\n00000",y:"\n00000\n00000\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n01111\n00001\n11110",z:"\n00000\n00000\n00000\n00000\n00000\n11111\n00010\n00100\n01000\n11111\n00000\n00000",A:"\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000",B:"\n00000\n00000\n00000\n11110\n10001\n11110\n10001\n10001\n10001\n11110\n00000\n00000",C:"\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10000\n10000\n01111\n00000\n00000",D:"\n00000\n00000\n00000\n11110\n10001\n10001\n10001\n10001\n10001\n11110\n00000\n00000",E:"\n00000\n00000\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000",F:"\n00000\n00000\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n10000\n00000\n00000",G:"\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10011\n10001\n01111\n00000\n00000",H:"\n00000\n00000\n00000\n10001\n10001\n11111\n10001\n10001\n10001\n10001\n00000\n00000",I:"\n00000\n00000\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000",J:"\n00000\n00000\n00000\n01111\n00001\n00001\n00001\n00001\n00001\n01110\n00000\n00000",K:"\n00000\n00000\n00000\n10001\n10010\n10100\n11000\n10100\n10010\n10001\n00000\n00000",L:"\n00000\n00000\n00000\n10000\n10000\n10000\n10000\n10000\n10000\n11111\n00000\n00000",M:"\n00000\n00000\n00000\n11111\n10101\n10101\n10101\n10101\n10101\n10101\n00000\n00000",N:"\n00000\n00000\n00000\n10001\n11001\n10101\n10011\n10001\n10001\n10001\n00000\n00000",O:"\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000",P:"\n00000\n00000\n00000\n11110\n10001\n10001\n10001\n11110\n10000\n10000\n00000\n00000",Q:"\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n10001\n10101\n01110\n00100\n00000",R:"\n00000\n00000\n00000\n11110\n10001\n10001\n11110\n10001\n10001\n10001\n00000\n00000",S:"\n00000\n00000\n00000\n01111\n10000\n01110\n00001\n00001\n00001\n11110\n00000\n00000",T:"\n00000\n00000\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n00100\n00000\n00000",U:"\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000",V:"\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n10001\n01010\n00100\n00000\n00000",W:"\n00000\n00000\n00000\n10101\n10101\n10101\n10101\n10101\n10101\n01010\n00000\n00000",X:"\n00000\n00000\n00000\n10001\n10001\n01010\n00100\n01010\n10001\n10001\n00000\n00000",Y:"\n00000\n00000\n00000\n10001\n10001\n01010\n00100\n00100\n00100\n00100\n00000\n00000",Z:"\n00000\n00000\n00000\n11111\n00001\n00010\n00100\n01000\n10000\n11111\n00000\n00000",".":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00100\n00000\n00000","·":"\n00000\n00000\n00000\n00000\n00000\n00000\n00100\n00000\n00000\n00000\n00000\n00000","•":"\n00000\n00000\n00000\n00000\n00000\n01110\n01110\n01110\n00000\n00000\n00000\n00000","…":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n10101\n00000\n00000","†":"\n00000\n00100\n00100\n01110\n00100\n00100\n00100\n00100\n00100\n00100\n00000\n00000","‡":"\n00000\n00100\n00100\n01110\n00100\n00100\n00100\n00100\n01110\n00100\n00000\n00000","ƒ":"\n00000\n00000\n00000\n00011\n00100\n11111\n00100\n00100\n00100\n00100\n01000\n00000","‚":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00100\n01100\n00000\n00000","„":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n01001\n11011\n00000\n00000",",":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00100\n01100\n00000\n00000",";":"\n00000\n00000\n00000\n00000\n00000\n00100\n00000\n00000\n00100\n01100\n00000\n00000",":":"\n00000\n00000\n00000\n00000\n00000\n00100\n00000\n00000\n00000\n00100\n00000\n00000","?":"\n00000\n00000\n00000\n01110\n10001\n00001\n00001\n00110\n00000\n00100\n00000\n00000","¿":"\n00000\n00000\n00000\n00100\n00000\n01100\n10000\n10000\n10001\n01110\n00000\n00000","!":"\n00000\n00000\n00000\n00100\n00100\n00100\n00100\n00100\n00000\n00100\n00000\n00000","¡":"\n00000\n00000\n00000\n00100\n00000\n00100\n00100\n00100\n00100\n00100\n00000\n00000","@":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10111\n10000\n01110\n00000\n00000","£":"\n00000\n00000\n00000\n00000\n00000\n01110\n01001\n11100\n01000\n11111\n00000\n00000",$:"\n00000\n00000\n00000\n00000\n00100\n01111\n10100\n01110\n00101\n11110\n00100\n00000","%":"\n00000\n00000\n00000\n00000\n00000\n11001\n11010\n00100\n01011\n10011\n00000\n00000","‰":"\n00000\n00000\n00000\n00000\n11001\n11010\n00100\n01011\n10011\n00000\n00011\n00011","^":"\n00000\n00000\n00000\n00100\n01010\n00000\n00000\n00000\n00000\n00000\n00000\n00000","&":"\n00000\n00000\n00000\n00000\n00000\n01100\n10000\n01011\n10010\n01100\n00000\n00000","*":"\n00000\n00000\n00000\n00000\n00000\n01010\n00100\n01010\n00000\n00000\n00000\n00000","(":"\n00000\n00000\n00000\n00010\n00100\n00100\n00100\n00100\n00100\n00010\n00000\n00000",")":"\n00000\n00000\n00000\n01000\n00100\n00100\n00100\n00100\n00100\n01000\n00000\n00000","+":"\n00000\n00000\n00000\n00000\n00000\n00100\n00100\n11111\n00100\n00100\n00000\n00000","÷":"\n00000\n00000\n00000\n00000\n00000\n00100\n00000\n11111\n00000\n00100\n00000\n00000","±":"\n00000\n00000\n00000\n00000\n00000\n00100\n00100\n11111\n00100\n11111\n00000\n00000","-":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n01110\n00000\n00000\n00000\n00000","–":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n11110\n00000\n00000\n00000\n00000","—":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n11111\n00000\n00000\n00000\n00000",_:"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n11111\n00000\n00000","=":"\n00000\n00000\n00000\n00000\n00000\n00000\n11111\n00000\n11111\n00000\n00000\n00000"," ":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000","{":"\n00000\n00000\n00000\n00110\n00100\n00100\n01100\n00100\n00100\n00110\n00000\n00000","}":"\n00000\n00000\n00000\n01100\n00100\n00100\n00110\n00100\n00100\n01100\n00000\n00000","[":"\n00000\n00000\n00000\n00110\n00100\n00100\n00100\n00100\n00100\n00110\n00000\n00000","]":"\n00000\n00000\n00000\n01100\n00100\n00100\n00100\n00100\n00100\n01100\n00000\n00000","'":"\n00000\n00000\n00000\n00100\n00100\n00100\n00000\n00000\n00000\n00000\n00000\n00000","‘":"\n00000\n00000\n00000\n00110\n00100\n00000\n00000\n00000\n00000\n00000\n00000\n00000","’":"\n00000\n00000\n00000\n00100\n01100\n00000\n00000\n00000\n00000\n00000\n00000\n00000","“":"\n00000\n00000\n00000\n11011\n10010\n00000\n00000\n00000\n00000\n00000\n00000\n00000","”":"\n00000\n00000\n00000\n01001\n11011\n00000\n00000\n00000\n00000\n00000\n00000\n00000",'"':"\n00000\n00000\n00000\n01010\n01010\n01010\n00000\n00000\n00000\n00000\n00000\n00000","/":"\n00000\n00000\n00000\n00000\n00000\n00001\n00010\n00100\n01000\n10000\n00000\n00000","\\":"\n00000\n00000\n00000\n00000\n00000\n10000\n01000\n00100\n00010\n00001\n00000\n00000","|":"\n00100\n00100\n00100\n00100\n00100\n00100\n00100\n00100\n00100\n00100\n00100\n00100","¦":"\n00000\n00000\n00000\n00000\n00100\n00100\n00000\n00100\n00100\n00100\n00000\n00000","<":"\n00000\n00000\n00000\n00000\n00000\n00010\n00100\n01000\n00100\n00010\n00000\n00000","‹":"\n00000\n00000\n00000\n00000\n00000\n00000\n00100\n01000\n00100\n00000\n00000\n00000","«":"\n00000\n00000\n00000\n00000\n00000\n00000\n01001\n10010\n01001\n00000\n00000\n00000",">":"\n00000\n00000\n00000\n00000\n00000\n01000\n00100\n00010\n00100\n01000\n00000\n00000","›":"\n00000\n00000\n00000\n00000\n00000\n00000\n00100\n00010\n00100\n00000\n00000\n00000","»":"\n00000\n00000\n00000\n00000\n00000\n00000\n10010\n01001\n10010\n00000\n00000\n00000","~":"\n00000\n00000\n00000\n00000\n00000\n00000\n01000\n10101\n00010\n00000\n00000\n00000","˜":"\n00000\n00000\n00000\n00000\n00000\n01010\n10100\n00000\n00000\n00000\n00000\n00000","`":"\n00000\n00000\n00000\n00000\n00000\n01000\n00100\n00000\n00000\n00000\n00000\n00000","#":"\n00000\n00000\n00000\n00000\n00000\n01010\n11111\n01010\n11111\n01010\n00000\n00000","À":"\n01000\n00100\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","Á":"\n00010\n00100\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","Â":"\n00100\n01010\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","Ã":"\n01000\n10101\n00010\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","Ä":"\n00000\n01010\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","Å":"\n00100\n01010\n00100\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","Æ":"\n00000\n00000\n00000\n01111\n10100\n10100\n10100\n11111\n10100\n10111\n00000\n00000","Ç":"\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10000\n10000\n01111\n00100\n01000","È":"\n01000\n00100\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","É":"\n00010\n00100\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","Ê":"\n00100\n01010\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","Ë":"\n00000\n01010\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","Ì":"\n01000\n00100\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","Í":"\n00010\n00100\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","Î":"\n00100\n01010\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","Ï":"\n00000\n01010\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","Ð":"\n00000\n00000\n00000\n01110\n01001\n01001\n11101\n01001\n01001\n01110\n00000\n00000","Ñ":"\n01001\n10110\n00000\n10001\n11001\n10101\n10011\n10001\n10001\n10001\n00000\n00000","Ò":"\n01000\n00100\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ó":"\n00010\n00100\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ô":"\n00100\n01010\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Õ":"\n01001\n10110\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ö":"\n00000\n01010\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ø":"\n00000\n00010\n00100\n01110\n10101\n10101\n10101\n10101\n10101\n01110\n00100\n01000","Ù":"\n00000\n01000\n00100\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ú":"\n00000\n00010\n00100\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Û":"\n00100\n01010\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ü":"\n00000\n01010\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","Ý":"\n\t00000\n\t00000\n\t00000\n\t00000\n\t00000\n\t10001\n\t10010\n\t10100\n\t11000\n\t10000\n\t00000\n\t00000","Þ":"\n00000\n00000\n10000\n11110\n10001\n10001\n10001\n10001\n10001\n11110\n10000\n00000","ß":"\n00000\n00000\n00000\n01110\n10001\n10110\n10001\n10001\n10001\n10110\n10000\n00000","ẞ":"\n00000\n00000\n00000\n01110\n10001\n10110\n10001\n10001\n10001\n10110\n00000\n00000","à":"\n00000\n00000\n01000\n00100\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","á":"\n00000\n00000\n00010\n00100\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","â":"\n00000\n00000\n00100\n01010\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","ã":"\n00000\n00000\n01001\n10110\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","ä":"\n00000\n00000\n00000\n01010\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","å":"\n00000\n00100\n01010\n00100\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","æ":"\n00000\n00000\n00000\n00000\n00000\n01110\n10101\n10110\n10100\n01111\n00000\n00000","ç":"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n01111\n00100\n01000","è":"\n00000\n00000\n01000\n00100\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","é":"\n00000\n00000\n00010\n00100\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","ê":"\n00000\n00000\n00100\n01010\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","ë":"\n00000\n00000\n00000\n01010\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","ì":"\n00000\n00000\n01000\n00100\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","í":"\n00000\n00000\n00010\n00100\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","î":"\n00000\n00000\n00100\n01010\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","ï":"\n00000\n00000\n00000\n01010\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","ð":"\n00000\n00000\n00010\n00111\n00010\n01110\n10010\n10010\n10010\n01110\n00000\n00000","ñ":"\n\t00000\n\t00000\n\t00000\n\t00000\n\t00000\n\t01010\n\t10101\n\t10101\n\t10101\n\t10101\n\t00000\n\t00000","ò":"\n00000\n00000\n01000\n00100\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","ó":"\n00000\n00000\n00010\n00100\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","ô":"\n00000\n00000\n00100\n01010\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","õ":"\n00000\n00000\n01001\n10110\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","ö":"\n00000\n00000\n00000\n01010\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","ø":"\n00000\n00000\n00000\n00010\n00100\n01110\n10101\n10101\n10101\n01110\n00100\n01000","ù":"\n00000\n00000\n00000\n01000\n00100\n10001\n10001\n10001\n10001\n01111\n00000\n00000","ú":"\n00000\n00000\n00000\n00010\n00100\n10001\n10001\n10001\n10001\n01111\n00000\n00000","û":"\n00000\n00000\n00100\n01010\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000","ü":"\n00000\n00000\n00000\n01010\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000","ý":"\n00000\n00000\n00000\n00010\n00100\n10001\n10001\n10001\n10001\n01111\n00001\n11110","þ":"\n00000\n00000\n00000\n10000\n10000\n11110\n10001\n10001\n10001\n11110\n10000\n10000","ÿ":"\n00000\n00000\n00000\n01010\n00000\n10001\n10001\n10001\n10001\n01111\n00001\n11110","Ā":"\n00000\n01110\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","ā":"\n00000\n00000\n00000\n00000\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","Ă":"\n01010\n00100\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00000\n00000","ă":"\n00000\n00000\n01010\n00100\n00000\n01111\n10001\n10001\n10001\n01111\n00000\n00000","Ą":"\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n11111\n10001\n10001\n00010\n00001","ą":"\n00000\n00000\n00000\n00000\n00000\n01111\n10001\n10001\n10001\n01111\n00010\n00001","Ć":"\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10000\n10000\n01111\n00000\n00000","ć":"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n01111\n00000\n00000","Ĉ":"\n00100\n01010\n00000\n01111\n10000\n10000\n10000\n10000\n10000\n01111\n00000\n00000","ĉ":"\n00000\n00000\n00100\n01010\n00000\n01111\n10000\n10000\n10000\n01111\n00000\n00000","Ċ":"\n00000\n00100\n00000\n01111\n10000\n10000\n10000\n10000\n10000\n01111\n00000\n00000","ċ":"\n00000\n00000\n00000\n00100\n00000\n01111\n10000\n10000\n10000\n01111\n00000\n00000","Č":"\n01010\n00100\n00000\n01111\n10000\n10000\n10000\n10000\n10000\n01111\n00000\n00000","č":"\n00000\n00000\n01010\n00100\n00000\n01111\n10000\n10000\n10000\n01111\n00000\n00000","Ď":"\n01010\n00100\n00000\n11110\n10001\n10001\n10001\n10001\n10001\n11110\n00000\n00000","ď":"\n\t00000\n\t00000\n\t00000\n\t00001\n\t00001\n\t01111\n\t10001\n\t10001\n\t10001\n\t01111\n\t00000\n\t00000","Đ":"\n\t00000\n\t00000\n\t00000\n\t01110\n\t10001\n\t10001\n\t10001\n\t11111\n\t10001\n\t10001\n\t00000\n\t00000","đ":"\n00000\n00000\n00010\n00111\n00010\n01110\n10010\n10010\n10010\n01110\n00000\n00000","Ē":"\n00000\n01110\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","ē":"\n00000\n00000\n00000\n01110\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","Ĕ":"\n01010\n00100\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","ĕ":"\n00000\n00000\n01010\n00100\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","Ė":"\n00000\n00100\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00000\n00000","ė":"\n00000\n00000\n00000\n00100\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","Ę":"\n00000\n00000\n00000\n11111\n10000\n11111\n10000\n10000\n10000\n11111\n00010\n00001","ę":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n11111\n10000\n01110\n00010\n00001","Ě":"\n\t00000\n\t00000\n\t00000\n\t11111\n\t10101\n\t10101\n\t10101\n\t10101\n\t10101\n\t10101\n\t00000\n\t00000","ě":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n11111\n10000\n01110\n00000\n00000","Ĝ":"\n00100\n01010\n00000\n01111\n10000\n10000\n10000\n10011\n10001\n01111\n00000\n00000","ĝ":"\n00000\n00000\n00100\n01010\n00000\n01111\n10001\n10001\n10001\n01111\n00001\n01110","Ğ":"\n01010\n00100\n00000\n01111\n10000\n10000\n10000\n10011\n10001\n01111\n00000\n00000","ğ":"\n00000\n00000\n00000\n00000\n00000\n01111\n10001\n10001\n10001\n01111\n00001\n01110","Ġ":"\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10011\n10001\n01111\n00000\n00000","ġ":"\n00000\n00000\n00000\n00100\n00000\n01111\n10001\n10001\n10001\n01111\n00001\n01110","Ģ":"\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10011\n10001\n01111\n00000\n01100","ģ":"\n00010\n00100\n00000\n01111\n10000\n10000\n10000\n10011\n10001\n01111\n00000\n00000","Ĥ":"\n11111\n11111\n11111\n11111\n11111\n11111\n11111\n11111\n11111\n11111\n11111\n11111","ĥ":"\n00100\n01010\n00000\n10000\n10000\n11110\n10001\n10001\n10001\n10001\n00000\n00000","Ħ":"\n00000\n00000\n01010\n11111\n01010\n01110\n01010\n01010\n01010\n01010\n00000\n00000","ħ":"\n\t00000\n\t00000\n\t00000\n\t10000\n\t10000\n\t11110\n\t10001\n\t10001\n\t10001\n\t10001\n\t00000\n\t00000","Ĩ":"\n01001\n10110\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","ĩ":"\n01010\n10100\n00000\n00100\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","Ī":"\n00000\n01110\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","ī":"\n00000\n00000\n00000\n01110\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","Ĭ":"\n01010\n00100\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","ĭ":"\n00000\n00000\n01010\n00100\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","Į":"\n00000\n00000\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00010\n00001","į":"\n00000\n00000\n00000\n00100\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","İ":"\n00000\n00100\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n11111\n00000\n00000","ı":"\n00000\n00000\n00000\n00000\n00000\n01100\n00100\n00100\n00100\n01110\n00000\n00000","Ĳ":"\n00000\n00000\n00000\n10010\n10010\n10010\n10010\n10010\n10010\n10110\n00000\n00000","ĳ":"\n00000\n00000\n00000\n01001\n00000\n11001\n01001\n01001\n01001\n11101\n00001\n00010","Ĵ":"\n00010\n00101\n00000\n01111\n00001\n00001\n00001\n00001\n00001\n01110\n00000\n00000","ĵ":"\n00000\n00000\n00100\n01010\n00000\n01100\n00100\n00100\n00100\n00100\n10100\n01000","Ķ":"\n00000\n00000\n00000\n10001\n10010\n10100\n11000\n10100\n10010\n10001\n00100\n01000","ķ":"\n00000\n00000\n00000\n10000\n10000\n10001\n10010\n11100\n10010\n10001\n00000\n00000","ĸ":"\n00000\n00000\n00000\n00000\n00000\n10001\n10010\n11100\n10010\n10001\n00000\n00000","Ĺ":"\n00000\n00000\n00000\n10000\n10000\n10000\n10000\n10000\n10000\n11111\n00000\n00000","ĺ":"\n00010\n00100\n00000\n01100\n00100\n00100\n00100\n00100\n00100\n01110\n00000\n00000","Ļ":"\n00000\n00000\n00000\n10000\n10000\n10000\n10000\n10000\n10000\n11111\n00000\n00100","ļ":"\n00000\n00000\n00000\n01100\n00100\n00100\n00100\n00100\n00100\n01110\n00000\n00100","Ľ":"\n00000\n00000\n00000\n10010\n10010\n10000\n10000\n10000\n10000\n11111\n00000\n00000","ľ":"\n00000\n00000\n00000\n01100\n00100\n00100\n00100\n00100\n00100\n01110\n00000\n00000","Ŀ":"\n00000\n00000\n00000\n10000\n10000\n10100\n10000\n10000\n10000\n11111\n00000\n00000","ŀ":"\n00000\n00000\n00000\n01100\n00100\n00100\n00101\n00100\n00100\n01110\n00000\n00000","Ł":"\n01110\n01110\n01110\n01110\n01110\n01110\n01110\n01110\n01110\n01110\n01110\n01110","ł":"\n00000\n00000\n00000\n01100\n00100\n00100\n00110\n01100\n00100\n01110\n00000\n00000","Ń":"\n00000\n00000\n00000\n10001\n11001\n10101\n10011\n10001\n10001\n10001\n00000\n00000","ń":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n10001\n00000\n00000","Ņ":"\n00000\n00000\n00000\n10001\n11001\n10101\n10011\n10001\n10001\n10001\n00100\n01000","ņ":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n10001\n00100\n01000","Ň":"\n00000\n01010\n00100\n10001\n11001\n10101\n10011\n10001\n10001\n10001\n00000\n00000","ň":"\n00000\n00000\n01010\n00100\n00000\n01110\n10001\n10001\n10001\n10001\n00000\n00000","ŉ":"\n00000\n00000\n00000\n10000\n10000\n00110\n01001\n01001\n01001\n01001\n00000\n00000","Ŋ":"\n00000\n00000\n00000\n10001\n11001\n10101\n10011\n10001\n10001\n10001\n00001\n00010","ŋ":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n10001\n00001\n00010","Ō":"\n00000\n01110\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ō":"\n00000\n00000\n00000\n01110\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","Ŏ":"\n01010\n00100\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ŏ":"\n00000\n00000\n00000\n00000\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","Ő":"\n01001\n10010\n00000\n01110\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ő":"\n00000\n00000\n01001\n10010\n00000\n01110\n10001\n10001\n10001\n01110\n00000\n00000","Œ":"\n00000\n00000\n00000\n01111\n10100\n10100\n10111\n10100\n10100\n01111\n00000\n00000","œ":"\n00000\n00000\n00000\n00000\n00000\n01110\n10101\n10110\n10100\n01111\n00000\n00000","Ŕ":"\n00010\n00100\n00000\n11110\n10001\n10001\n11110\n10001\n10001\n10001\n00000\n00000","ŕ":"\n00000\n00000\n00010\n00100\n00000\n01111\n10000\n10000\n10000\n10000\n00000\n00000","Ŗ":"\n00000\n00000\n00000\n11110\n10001\n10001\n11110\n10001\n10001\n10001\n00100\n01000","ŗ":"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10000\n00100\n01000","Ř":"\n01010\n00100\n00000\n11110\n10001\n10001\n11110\n10001\n10001\n10001\n00000\n00000","ř":"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n10000\n10000\n10000\n00000\n00000","Ś":"\n00000\n00000\n00000\n01111\n10000\n01110\n00001\n00001\n00001\n11110\n00000\n00000","ś":"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n01110\n00001\n11110\n00000\n00000","Ŝ":"\n00100\n01010\n00000\n01111\n10000\n01110\n00001\n00001\n00001\n11110\n00000\n00000","ŝ":"\n00000\n00000\n00100\n01010\n00000\n01111\n10000\n01110\n00001\n11110\n00000\n00000","Ş":"\n00000\n00000\n00000\n01111\n10000\n01110\n00001\n00001\n00001\n11110\n00100\n00000","ş":"\n00000\n00000\n00000\n00000\n00000\n01111\n10000\n01110\n00001\n11110\n00100\n01000","Š":"\n01010\n00100\n00000\n01111\n10000\n01110\n00001\n00001\n00001\n11110\n00000\n00000","š":"\n00000\n00000\n01010\n00100\n00000\n01111\n10000\n01110\n00001\n11110\n00000\n00000","Ţ":"\n00000\n00000\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n00100\n00010\n00100","ţ":"\n00000\n00000\n00000\n00100\n00100\n11111\n00100\n00100\n00100\n00011\n00000\n01100","Ť":"\n01010\n00100\n00000\n11111\n00100\n00100\n00100\n00100\n00100\n00100\n00000\n00000","ť":"\n00000\n00000\n00000\n00100\n00100\n11111\n00100\n00100\n00100\n00011\n00000\n00000","Ŧ":"\n00000\n00000\n00000\n11111\n00100\n00100\n01110\n00100\n00100\n00100\n00000\n00000","ŧ":"\n00000\n00000\n00000\n00100\n00100\n11111\n00100\n01110\n00100\n00011\n00000\n00000","Ũ":"\n01001\n10110\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ũ":"\n00000\n00000\n01001\n10110\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000","Ū":"\n00000\n01110\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ū":"\n00000\n00000\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000","Ŭ":"\n01010\n00100\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ŭ":"\n00000\n00000\n01010\n00100\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000","Ů":"\n00100\n01010\n00100\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ů":"\n00000\n00000\n00100\n01010\n00100\n10001\n10001\n10001\n10001\n01111\n00000\n00000","Ű":"\n01001\n10010\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00000\n00000","ű":"\n00000\n00000\n01001\n10010\n00000\n10001\n10001\n10001\n10001\n01111\n00000\n00000","Ų":"\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n10001\n10001\n01110\n00100\n00010","ų":"\n00000\n00000\n00000\n00000\n00000\n10001\n10001\n10001\n10001\n01111\n00010\n00001","Ŵ":"\n00100\n01010\n00000\n10101\n10101\n10101\n10101\n10101\n10101\n01010\n00000\n00000","ŵ":"\n\t00000\n\t00000\n\t00000\n\t00000\n\t00000\n\t10101\n\t10101\n\t10101\n\t10101\n\t01010\n\t00000\n\t00000","Ŷ":"\n00100\n01010\n00000\n10001\n10001\n01010\n00100\n00100\n00100\n00100\n00000\n00000","ŷ":"\n00000\n00000\n00100\n01010\n00000\n10001\n10001\n10001\n10001\n01111\n00001\n11110","Ÿ":"\n00000\n01010\n00000\n10001\n10001\n01010\n00100\n00100\n00100\n00100\n00000\n00000","Ź":"\n00010\n00100\n00000\n11111\n00001\n00010\n00100\n01000\n10000\n11111\n00000\n00000","ź":"\n00000\n00000\n00010\n00100\n00000\n11111\n00010\n00100\n01000\n11111\n00000\n00000","Ż":"\n00000\n00100\n00000\n11111\n00001\n00010\n00100\n01000\n10000\n11111\n00000\n00000","ż":"\n00000\n00000\n00000\n00100\n00000\n11111\n00010\n00100\n01000\n11111\n00000\n00000","Ž":"\n01010\n00100\n00000\n11111\n00001\n00010\n00100\n01000\n10000\n11111\n00000\n00000","ž":"\n00000\n00000\n01010\n00100\n00000\n11111\n00010\n00100\n01000\n11111\n00000\n00000","€":"\n00000\n00000\n00000\n00111\n01000\n11110\n01000\n11110\n01000\n00111\n00000\n00000","™":"\n00000\n11111\n00100\n00100\n00100\n00000\n01010\n10101\n10101\n10101\n00000\n00000","¢":"\n00000\n00000\n00000\n00010\n00100\n01111\n10100\n10100\n10100\n01111\n00100\n01000","¤":"\n00000\n00000\n00000\n00000\n10001\n01110\n10001\n10001\n01110\n10001\n00000\n00000","¥":"\n00000\n01110\n01110\n01110\n01110\n01110\n01110\n01110\n01110\n01110\n00000","§":"\n00000\n00000\n00000\n01110\n10000\n01110\n10001\n01110\n00001\n01110\n00000\n00000","¨":"\n00000\n00000\n00000\n01010\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000","©":"\n00000\n00000\n00000\n01110\n10001\n10111\n10101\n10111\n10001\n01110\n00000\n00000","®":"\n00000\n00000\n00000\n01110\n10001\n10111\n10101\n10101\n10001\n01110\n00000\n00000","ª":"\n00000\n01110\n00010\n01110\n01010\n01110\n00000\n00000\n00000\n00000\n00000\n00000","º":"\n00000\n00100\n01010\n01010\n01010\n00100\n00000\n00000\n00000\n00000\n00000\n00000","¬":"\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n01110\n00010\n00000\n00000\n00000","¯":"\n00000\n00000\n00000\n01110\n00000\n00000\n00000\n00000\n00000\n00000\n00000\n00000","°":"\n00000\n00000\n00100\n01010\n00100\n00000\n00000\n00000\n00000\n00000\n00000\n00000","✓":"\n00000\n00000\n00000\n00000\n00000\n00001\n00010\n10100\n01000\n00000\n00000\n00000"},fontKeys=Object.keys(font),fontIndex={},i=0;i<fontKeys.length;i++)fontIndex[fontKeys[i]]=i;function RC4(e){this.s=new Array(256),this.i=0,this.j=0;for(var t=0;t<256;t++)this.s[t]=t;e&&this.mix(e)}function print_call_stack(){var e=(new Error).stack;console.log(e)}function RNG(e){this.seed=e,null==e?e=(Math.random()+Date.now()).toString():"function"==typeof e?(this.uniform=e,this.nextByte=function(){return~~(256*this.uniform())},e=null):"[object String]"!==Object.prototype.toString.call(e)&&(e=JSON.stringify(e)),this._normal=null,this._state=e?new RC4(e):null}
/**
 * Seedable random number generator functions.
 * @version 1.0.0
 * @license Public Domain
 *
 * @example
 * var rng = new RNG('Example');
 * rng.random(40, 50);  // =>  42
 * rng.uniform();       // =>  0.7972798995050903
 * rng.normal();        // => -0.6698504543216376
 * rng.exponential();   // =>  1.0547367609131555
 * rng.poisson(4);      // =>  2
 * rng.gamma(4);        // =>  2.781724687386858
 */
String.prototype.getBytes=function(){for(var e=[],t=0;t<this.length;t++){var n=this.charCodeAt(t),r=[];do{r.push(255&n),n>>=8}while(n>0);e=e.concat(r.reverse())}return e},RC4.prototype._swap=function(e,t){var n=this.s[e];this.s[e]=this.s[t],this.s[t]=n},RC4.prototype.mix=function(e){for(var t=e.getBytes(),n=0,r=0;r<this.s.length;r++)n+=this.s[r]+t[r%t.length],n%=256,this._swap(r,n)},RC4.prototype.next=function(){return this.i=(this.i+1)%256,this.j=(this.j+this.s[this.i])%256,this._swap(this.i,this.j),this.s[(this.s[this.i]+this.s[this.j])%256]},RNG.prototype.nextByte=function(){return this._state.next()},RNG.prototype.uniform=function(){for(var e=0,t=0;t<7;t++)e*=256,e+=this.nextByte();return e/(Math.pow(2,56)-1)},RNG.prototype.random=function(e,t){return null==e?this.uniform():(null==t&&(t=e,e=0),e+Math.floor(this.uniform()*(t-e)))},RNG.prototype.normal=function(){if(null!==this._normal){var e=this._normal;return this._normal=null,e}var t=this.uniform()||Math.pow(2,-53),n=this.uniform();return this._normal=Math.sqrt(-2*Math.log(t))*Math.sin(2*Math.PI*n),Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*n)},RNG.prototype.exponential=function(){return-Math.log(this.uniform()||Math.pow(2,-53))},RNG.prototype.poisson=function(e){var t=Math.exp(-(e||1)),n=0,r=1;do{n++,r*=this.uniform()}while(r>t);return n-1},RNG.prototype.gamma=function(e){var t=(e<1?1+e:e)-1/3,n=1/Math.sqrt(9*t);do{do{var r=this.normal(),o=Math.pow(n*r+1,3)}while(o<=0);var i=this.uniform(),s=Math.pow(r,2)}while(i>=1-.0331*s*s&&Math.log(i)>=.5*s+t*(1-o+Math.log(o)));return e<1?t*o*Math.exp(this.exponential()/-e):t*o},RNG.roller=function(e,t){var n=e.split(/(\d+)?d(\d+)([+-]\d+)?/).slice(1),r=parseFloat(n[0])||1,o=parseFloat(n[1]),i=parseFloat(n[2])||0;return t=t||new RNG,function(){for(var e=r+i,n=0;n<r;n++)e+=t.random(o);return e}};var FastBase64_chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",FastBase64_encLookup=[];function FastBase64_Init(){for(var e=0;e<4096;e++)FastBase64_encLookup[e]=FastBase64_chars[e>>6]+FastBase64_chars[63&e]}function FastBase64_Encode(e){for(var t=e.length,r="",o=0;t>2;)n=e[o]<<16|e[o+1]<<8|e[o+2],r+=FastBase64_encLookup[n>>12]+FastBase64_encLookup[4095&n],t-=3,o+=3;if(t>0){var i=(252&e[o])>>2,s=(3&e[o])<<4;if(t>1&&(s|=(240&e[++o])>>4),r+=FastBase64_chars[i],r+=FastBase64_chars[s],2==t){var a=(15&e[o++])<<2;a|=(192&e[o])>>6,r+=FastBase64_chars[a]}1==t&&(r+="="),r+="="}return r}function u32ToArray(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function u16ToArray(e){return[255&e,e>>8&255]}function MakeRiff(e,t,n){var r,o={chunkId:[82,73,70,70],chunkSize:0,format:[87,65,86,69],subChunk1Id:[102,109,116,32],subChunk1Size:16,audioFormat:1,numChannels:1,sampleRate:e,byteRate:0,blockAlign:0,bitsPerSample:t,subChunk2Id:[100,97,116,97],subChunk2Size:0};return o.byteRate=o.sampleRate*o.numChannels*o.bitsPerSample>>3,o.blockAlign=o.numChannels*o.bitsPerSample>>3,o.subChunk2Size=n.length,o.chunkSize=36+o.subChunk2Size,{dat:[],wav:r=o.chunkId.concat(u32ToArray(o.chunkSize),o.format,o.subChunk1Id,u32ToArray(o.subChunk1Size),u16ToArray(o.audioFormat),u16ToArray(o.numChannels),u32ToArray(o.sampleRate),u32ToArray(o.byteRate),u16ToArray(o.blockAlign),u16ToArray(o.bitsPerSample),o.subChunk2Id,u32ToArray(o.subChunk2Size),n),header:o,dataURI:"data:audio/wav;base64,"+FastBase64_Encode(r)}}FastBase64_Init(),"undefined"!=typeof exports&&(exports.RIFFWAVE=RIFFWAVE);var AUDIO_CONTEXT,SOUND_VOL=.25,QUIET_SOUND_VOL=.1,SAMPLE_RATE=5512,BIT_DEPTH=8,SQUARE=0,SAWTOOTH=1,SINE=2,NOISE=3,TRIANGLE=4,BREAKER=5,SHAPES=["square","sawtooth","sine","noise","triangle","breaker"];function checkAudioContextExists(){try{null==AUDIO_CONTEXT&&("undefined"!=typeof AudioContext?AUDIO_CONTEXT=new AudioContext:"undefined"!=typeof webkitAudioContext&&(AUDIO_CONTEXT=new webkitAudioContext))}catch(e){window.console.log(e)}}checkAudioContextExists();var rng,masterVolume=1;function Params(){var e={};return e.wave_type=SQUARE,e.p_env_attack=0,e.p_env_sustain=.3,e.p_env_punch=0,e.p_env_decay=.4,e.p_base_freq=.3,e.p_freq_limit=0,e.p_freq_ramp=0,e.p_freq_dramp=0,e.p_vib_strength=0,e.p_vib_speed=0,e.p_arp_mod=0,e.p_arp_speed=0,e.p_duty=0,e.p_duty_ramp=0,e.p_repeat_speed=0,e.p_pha_offset=0,e.p_pha_ramp=0,e.p_lpf_freq=1,e.p_lpf_ramp=0,e.p_lpf_resonance=0,e.p_hpf_freq=0,e.p_hpf_ramp=0,e.sound_vol=.5,e.sample_rate=44100,e.bit_depth=8,e}var seeded=!1;function frnd(e){return seeded?rng.uniform()*e:Math.random()*e}function rnd(e){return seeded?Math.floor(rng.uniform()*(e+1)):Math.floor(Math.random()*(e+1))}pickupCoin=function(){var e=Params();if(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=0),e.p_base_freq=.4+frnd(.5),e.p_env_attack=0,e.p_env_sustain=frnd(.1),e.p_env_decay=.1+frnd(.4),e.p_env_punch=.3+frnd(.3),rnd(1)){e.p_arp_speed=.5+frnd(.2);var t=1+(1|frnd(7)),n=t+(1|frnd(7))+2;e.p_arp_mod=+t/+n}return e},laserShoot=function(){var e=Params();return e.wave_type=rnd(2),e.wave_type===SINE&&rnd(1)&&(e.wave_type=rnd(1)),e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),e.p_base_freq=.5+frnd(.5),e.p_freq_limit=e.p_base_freq-.2-frnd(.6),e.p_freq_limit<.2&&(e.p_freq_limit=.2),e.p_freq_ramp=-.15-frnd(.2),0===rnd(2)&&(e.p_base_freq=.3+frnd(.6),e.p_freq_limit=frnd(.1),e.p_freq_ramp=-.35-frnd(.3)),rnd(1)?(e.p_duty=frnd(.5),e.p_duty_ramp=frnd(.2)):(e.p_duty=.4+frnd(.5),e.p_duty_ramp=-frnd(.7)),e.p_env_attack=0,e.p_env_sustain=.1+frnd(.2),e.p_env_decay=frnd(.4),rnd(1)&&(e.p_env_punch=frnd(.3)),0===rnd(2)&&(e.p_pha_offset=frnd(.2),e.p_pha_ramp=-frnd(.2)),rnd(1)&&(e.p_hpf_freq=frnd(.3)),e},explosion=function(){var e=Params();return rnd(1)?(e.p_base_freq=.1+frnd(.4),e.p_freq_ramp=-.1+frnd(.4)):(e.p_base_freq=.2+frnd(.7),e.p_freq_ramp=-.2-frnd(.2)),e.p_base_freq*=e.p_base_freq,0===rnd(4)&&(e.p_freq_ramp=0),0===rnd(2)&&(e.p_repeat_speed=.3+frnd(.5)),e.p_env_attack=0,e.p_env_sustain=.1+frnd(.3),e.p_env_decay=frnd(.5),0===rnd(1)&&(e.p_pha_offset=-.3+frnd(.9),e.p_pha_ramp=-frnd(.3)),e.p_env_punch=.2+frnd(.6),rnd(1)&&(e.p_vib_strength=frnd(.7),e.p_vib_speed=frnd(.6)),0===rnd(2)&&(e.p_arp_speed=.6+frnd(.3),e.p_arp_mod=.8-frnd(1.6)),e},birdSound=function(){var e=Params();return frnd(10)<1?(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),e.p_env_attack=.4304400932967592+frnd(.2)-.1,e.p_env_sustain=.15739346034252394+frnd(.2)-.1,e.p_env_punch=.004488201744871758+frnd(.2)-.1,e.p_env_decay=.07478075528212291+frnd(.2)-.1,e.p_base_freq=.9865265720147687+frnd(.2)-.1,e.p_freq_limit=0+frnd(.2)-.1,e.p_freq_ramp=-.2995018224359539+frnd(.2)-.1,frnd(1)<.5&&(e.p_freq_ramp=.1+frnd(.15)),e.p_freq_dramp=.004598608156964473+frnd(.1)-.05,e.p_vib_strength=-.2202799497929496+frnd(.2)-.1,e.p_vib_speed=.8084998703158364+frnd(.2)-.1,e.p_arp_mod=0,e.p_arp_speed=0,e.p_duty=-.9031808754347107+frnd(.2)-.1,e.p_duty_ramp=-.8128699999808343+frnd(.2)-.1,e.p_repeat_speed=.601486018931999+frnd(.2)-.1,e.p_pha_offset=-.9424902314367765+frnd(.2)-.1,e.p_pha_ramp=-.1055482222272056+frnd(.2)-.1,e.p_lpf_freq=.9989765717851521+frnd(.2)-.1,e.p_lpf_ramp=-.25051720626043017+frnd(.2)-.1,e.p_lpf_resonance=.32777871505494693+frnd(.2)-.1,e.p_hpf_freq=.0023548750981756753+frnd(.2)-.1,e.p_hpf_ramp=-.002375673204842568+frnd(.2)-.1,e):frnd(10)<1?(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),e.p_env_attack=.5277795946672003+frnd(.2)-.1,e.p_env_sustain=.18243733568468432+frnd(.2)-.1,e.p_env_punch=-.020159754546840117+frnd(.2)-.1,e.p_env_decay=.1561353422051903+frnd(.2)-.1,e.p_base_freq=.9028855606533718+frnd(.2)-.1,e.p_freq_limit=-.008842787837148716,e.p_freq_ramp=-.1,e.p_freq_dramp=-.012891241489551925,e.p_vib_strength=-.17923136138403065+frnd(.2)-.1,e.p_vib_speed=.908263385610142+frnd(.2)-.1,e.p_arp_mod=.41690153355414894+frnd(.2)-.1,e.p_arp_speed=.0010766233195860704+frnd(.2)-.1,e.p_duty=-.8735363011184684+frnd(.2)-.1,e.p_duty_ramp=-.7397985366747507+frnd(.2)-.1,e.p_repeat_speed=.0591789344172107+frnd(.2)-.1,e.p_pha_offset=-.9961184222777699+frnd(.2)-.1,e.p_pha_ramp=-.08234769395850523+frnd(.2)-.1,e.p_lpf_freq=.9412475115697335+frnd(.2)-.1,e.p_lpf_ramp=-.18261358925834958+frnd(.2)-.1,e.p_lpf_resonance=.24541438107389477+frnd(.2)-.1,e.p_hpf_freq=-.01831940280978611+frnd(.2)-.1,e.p_hpf_ramp=-.03857383633171346+frnd(.2)-.1,e):frnd(10)<1?(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),e.p_env_attack=.4304400932967592+frnd(.2)-.1,e.p_env_sustain=.15739346034252394+frnd(.2)-.1,e.p_env_punch=.004488201744871758+frnd(.2)-.1,e.p_env_decay=.07478075528212291+frnd(.2)-.1,e.p_base_freq=.9865265720147687+frnd(.2)-.1,e.p_freq_limit=0+frnd(.2)-.1,e.p_freq_ramp=-.2995018224359539+frnd(.2)-.1,e.p_freq_dramp=.004598608156964473+frnd(.2)-.1,e.p_vib_strength=-.2202799497929496+frnd(.2)-.1,e.p_vib_speed=.8084998703158364+frnd(.2)-.1,e.p_arp_mod=-.46410459213693644+frnd(.2)-.1,e.p_arp_speed=-.10955361249587248+frnd(.2)-.1,e.p_duty=-.9031808754347107+frnd(.2)-.1,e.p_duty_ramp=-.8128699999808343+frnd(.2)-.1,e.p_repeat_speed=.7014860189319991+frnd(.2)-.1,e.p_pha_offset=-.9424902314367765+frnd(.2)-.1,e.p_pha_ramp=-.1055482222272056+frnd(.2)-.1,e.p_lpf_freq=.9989765717851521+frnd(.2)-.1,e.p_lpf_ramp=-.25051720626043017+frnd(.2)-.1,e.p_lpf_resonance=.32777871505494693+frnd(.2)-.1,e.p_hpf_freq=.0023548750981756753+frnd(.2)-.1,e.p_hpf_ramp=-.002375673204842568+frnd(.2)-.1,e):frnd(5)>1?(e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),rnd(1)?(e.p_arp_mod=.2697849293151393+frnd(.2)-.1,e.p_arp_speed=-.3131172257760948+frnd(.2)-.1,e.p_base_freq=.8090588299313949+frnd(.2)-.1,e.p_duty=-.6210022920964955+frnd(.2)-.1,e.p_duty_ramp=-.00043441813553182567+frnd(.2)-.1,e.p_env_attack=.004321877246874195+frnd(.2)-.1,e.p_env_decay=.1+frnd(.2)-.1,e.p_env_punch=.061737781504416146+frnd(.2)-.1,e.p_env_sustain=.4987252564798832+frnd(.2)-.1,e.p_freq_dramp=.31700340314222614+frnd(.2)-.1,e.p_freq_limit=0+frnd(.2)-.1,e.p_freq_ramp=-.163380391341416+frnd(.2)-.1,e.p_hpf_freq=.4709005021145149+frnd(.2)-.1,e.p_hpf_ramp=.6924667290539194+frnd(.2)-.1,e.p_lpf_freq=.8351398631384511+frnd(.2)-.1,e.p_lpf_ramp=.36616557192873134+frnd(.2)-.1,e.p_lpf_resonance=-.08685777111664439+frnd(.2)-.1,e.p_pha_offset=-.036084571580025544+frnd(.2)-.1,e.p_pha_ramp=-.014806445085568108+frnd(.2)-.1,e.p_repeat_speed=-.8094368475518489+frnd(.2)-.1,e.p_vib_speed=.4496665457171294+frnd(.2)-.1,e.p_vib_strength=.23413762515532424+frnd(.2)-.1):(e.p_arp_mod=-.35697118026766184+frnd(.2)-.1,e.p_arp_speed=.3581140690559588+frnd(.2)-.1,e.p_base_freq=1.3260897696157528+frnd(.2)-.1,e.p_duty=-.30984900436710694+frnd(.2)-.1,e.p_duty_ramp=-.0014374759133411626+frnd(.2)-.1,e.p_env_attack=.3160357835682254+frnd(.2)-.1,e.p_env_decay=.1+frnd(.2)-.1,e.p_env_punch=.24323114016870148+frnd(.2)-.1,e.p_env_sustain=.4+frnd(.2)-.1,e.p_freq_dramp=.2866475886237244+frnd(.2)-.1,e.p_freq_limit=0+frnd(.2)-.1,e.p_freq_ramp=-.10956352368742976+frnd(.2)-.1,e.p_hpf_freq=.20772718017889846+frnd(.2)-.1,e.p_hpf_ramp=.1564090637378835+frnd(.2)-.1,e.p_lpf_freq=.6021372770637031+frnd(.2)-.1,e.p_lpf_ramp=.24016227139979027+frnd(.2)-.1,e.p_lpf_resonance=-.08787383821160144+frnd(.2)-.1,e.p_pha_offset=-.381597686151701+frnd(.2)-.1,e.p_pha_ramp=-.0002481687661373495+frnd(.2)-.1,e.p_repeat_speed=.07812112809425686+frnd(.2)-.1,e.p_vib_speed=-.13648848579133943+frnd(.2)-.1,e.p_vib_strength=.0018874158972302657+frnd(.2)-.1),e):(e.wave_type=Math.floor(frnd(SHAPES.length)),1!==e.wave_type&&3!==e.wave_type||(e.wave_type=2),e.p_base_freq=.85+frnd(.15),e.p_freq_ramp=.3+frnd(.15),e.p_env_attack=0+frnd(.09),e.p_env_sustain=.2+frnd(.3),e.p_env_decay=0+frnd(.1),e.p_duty=frnd(2)-1,e.p_duty_ramp=Math.pow(frnd(2)-1,3),e.p_repeat_speed=.5+frnd(.1),e.p_pha_offset=-.3+frnd(.9),e.p_pha_ramp=-frnd(.3),e.p_arp_speed=.4+frnd(.6),e.p_arp_mod=.8+frnd(.1),e.p_lpf_resonance=frnd(2)-1,e.p_lpf_freq=1-Math.pow(frnd(1),3),e.p_lpf_ramp=Math.pow(frnd(2)-1,3),e.p_lpf_freq<.1&&e.p_lpf_ramp<-.05&&(e.p_lpf_ramp=-e.p_lpf_ramp),e.p_hpf_freq=Math.pow(frnd(1),5),e.p_hpf_ramp=Math.pow(frnd(2)-1,5),e)},pushSound=function(){var e=Params();return e.wave_type=Math.floor(frnd(SHAPES.length)),2===e.wave_type&&e.wave_type++,0===e.wave_type&&(e.wave_type=NOISE),e.p_base_freq=.1+frnd(.4),e.p_freq_ramp=.05+frnd(.2),e.p_env_attack=.01+frnd(.09),e.p_env_sustain=.01+frnd(.09),e.p_env_decay=.01+frnd(.09),e.p_repeat_speed=.3+frnd(.5),e.p_pha_offset=-.3+frnd(.9),e.p_pha_ramp=-frnd(.3),e.p_arp_speed=.6+frnd(.3),e.p_arp_mod=.8-frnd(1.6),e},powerUp=function(){var e=Params();return rnd(1)?e.wave_type=SAWTOOTH:e.p_duty=frnd(.6),e.wave_type=Math.floor(frnd(SHAPES.length)),3===e.wave_type&&(e.wave_type=SQUARE),rnd(1)?(e.p_base_freq=.2+frnd(.3),e.p_freq_ramp=.1+frnd(.4),e.p_repeat_speed=.4+frnd(.4)):(e.p_base_freq=.2+frnd(.3),e.p_freq_ramp=.05+frnd(.2),rnd(1)&&(e.p_vib_strength=frnd(.7),e.p_vib_speed=frnd(.6))),e.p_env_attack=0,e.p_env_sustain=frnd(.4),e.p_env_decay=.1+frnd(.4),e},hitHurt=function(){return result=Params(),result.wave_type=rnd(2),result.wave_type===SINE&&(result.wave_type=NOISE),result.wave_type===SQUARE&&(result.p_duty=frnd(.6)),result.wave_type=Math.floor(frnd(SHAPES.length)),result.p_base_freq=.2+frnd(.6),result.p_freq_ramp=-.3-frnd(.4),result.p_env_attack=0,result.p_env_sustain=frnd(.1),result.p_env_decay=.1+frnd(.2),rnd(1)&&(result.p_hpf_freq=frnd(.3)),result},jump=function(){return result=Params(),result.wave_type=SQUARE,result.wave_type=Math.floor(frnd(SHAPES.length)),3===result.wave_type&&(result.wave_type=SQUARE),result.p_duty=frnd(.6),result.p_base_freq=.3+frnd(.3),result.p_freq_ramp=.1+frnd(.2),result.p_env_attack=0,result.p_env_sustain=.1+frnd(.3),result.p_env_decay=.1+frnd(.2),rnd(1)&&(result.p_hpf_freq=frnd(.3)),rnd(1)&&(result.p_lpf_freq=1-frnd(.6)),result},blipSelect=function(){return result=Params(),result.wave_type=rnd(1),result.wave_type=Math.floor(frnd(SHAPES.length)),3===result.wave_type&&(result.wave_type=rnd(1)),result.wave_type===SQUARE&&(result.p_duty=frnd(.6)),result.p_base_freq=.2+frnd(.4),result.p_env_attack=0,result.p_env_sustain=.1+frnd(.1),result.p_env_decay=frnd(.2),result.p_hpf_freq=.1,result},random=function(){return result=Params(),result.wave_type=Math.floor(frnd(SHAPES.length)),result.p_base_freq=Math.pow(frnd(2)-1,2),rnd(1)&&(result.p_base_freq=Math.pow(frnd(2)-1,3)+.5),result.p_freq_limit=0,result.p_freq_ramp=Math.pow(frnd(2)-1,5),result.p_base_freq>.7&&result.p_freq_ramp>.2&&(result.p_freq_ramp=-result.p_freq_ramp),result.p_base_freq<.2&&result.p_freq_ramp<-.05&&(result.p_freq_ramp=-result.p_freq_ramp),result.p_freq_dramp=Math.pow(frnd(2)-1,3),result.p_duty=frnd(2)-1,result.p_duty_ramp=Math.pow(frnd(2)-1,3),result.p_vib_strength=Math.pow(frnd(2)-1,3),result.p_vib_speed=frnd(2)-1,result.p_env_attack=Math.pow(frnd(2)-1,3),result.p_env_sustain=Math.pow(frnd(2)-1,2),result.p_env_decay=frnd(2)-1,result.p_env_punch=Math.pow(frnd(.8),2),result.p_env_attack+result.p_env_sustain+result.p_env_decay<.2&&(result.p_env_sustain+=.2+frnd(.3),result.p_env_decay+=.2+frnd(.3)),result.p_lpf_resonance=frnd(2)-1,result.p_lpf_freq=1-Math.pow(frnd(1),3),result.p_lpf_ramp=Math.pow(frnd(2)-1,3),result.p_lpf_freq<.1&&result.p_lpf_ramp<-.05&&(result.p_lpf_ramp=-result.p_lpf_ramp),result.p_hpf_freq=Math.pow(frnd(1),5),result.p_hpf_ramp=Math.pow(frnd(2)-1,5),result.p_pha_offset=Math.pow(frnd(2)-1,3),result.p_pha_ramp=Math.pow(frnd(2)-1,3),result.p_repeat_speed=frnd(2)-1,result.p_arp_speed=frnd(2)-1,result.p_arp_mod=frnd(2)-1,result};var generators=[pickupCoin,laserShoot,explosion,powerUp,hitHurt,jump,blipSelect,pushSound,random,birdSound],generatorNames=["pickupCoin","laserShoot","explosion","powerUp","hitHurt","jump","blipSelect","pushSound","random","birdSound"];function SoundEffect(e,t){this._buffer=AUDIO_CONTEXT.createBuffer(1,e,t)}function ULBS(){if("suspended"===AUDIO_CONTEXT.state){var e=function(){AUDIO_CONTEXT.resume().then((function(){document.body.removeEventListener("touchstart",e),document.body.removeEventListener("touchend",e),document.body.removeEventListener("mousedown",e),document.body.removeEventListener("mouseup",e),document.body.removeEventListener("keydown",e),document.body.removeEventListener("keyup",e)}))};document.body.addEventListener("touchstart",e,!1),document.body.addEventListener("touchend",e,!1),document.body.addEventListener("mousedown",e,!1),document.body.addEventListener("mouseup",e,!1),document.body.addEventListener("keydown",e,!1),document.body.addEventListener("keyup",e,!1)}}if(generateFromSeed=function(e){rng=new RNG(e/100|0);var t=generators[e%100%generators.length];seeded=!0;var n=t();return n.seed=e,seeded=!1,n},SoundEffect.prototype.getBuffer=function(){return this._buffer.getChannelData(0)},SoundEffect.prototype.play=function(){ULBS();var e=AUDIO_CONTEXT.createBufferSource(),t=AUDIO_CONTEXT.createBiquadFilter(),n=AUDIO_CONTEXT.createBiquadFilter(),r=AUDIO_CONTEXT.createBiquadFilter();e.buffer=this._buffer,e.connect(t),t.frequency.value=1600,n.frequency.value=1600,r.frequency.value=1600,t.connect(n),n.connect(r),r.connect(AUDIO_CONTEXT.destination);var o=AUDIO_CONTEXT.currentTime;void 0!==e.start?e.start(o):e.noteOn(o),e.onended=function(){r.disconnect()}},SoundEffect.MIN_SAMPLE_RATE=22050,void 0===AUDIO_CONTEXT&&((SoundEffect=function(e,t){this._sample_rate=t,this._buffer=new Array(e),this._audioElement=null}).prototype.getBuffer=function(){return this._audioElement=null,this._buffer},SoundEffect.prototype.play=function(){if(this._audioElement)this._audioElement.cloneNode(!1).play();else{for(var e=0;e<this._buffer.length;e++)this._buffer[e]=255&Math.floor(128*Math.max(0,Math.min(this._buffer[e]+1,2)));var t=MakeRiff(this._sample_rate,BIT_DEPTH,this._buffer);this._audioElement=new Audio,this._audioElement.src=t.dataURI,this._audioElement.play()}},SoundEffect.MIN_SAMPLE_RATE=1),SoundEffect.generate=function(e){function t(){n=0,r=100/(e.p_base_freq*e.p_base_freq+.001),o=Math.floor(r),i=100/(e.p_freq_limit*e.p_freq_limit+.001),s=1-.01*Math.pow(e.p_freq_ramp,3),a=1e-6*-Math.pow(e.p_freq_dramp,3),l=.5-.5*e.p_duty,c=5e-5*-e.p_duty_ramp,u=e.p_arp_mod>=0?1-.9*Math.pow(e.p_arp_mod,2):1+10*Math.pow(e.p_arp_mod,2),0,d=Math.floor(2e4*Math.pow(1-e.p_arp_speed,2)+32),1==e.p_arp_speed&&(d=0)}var n,r,o,i,s,a,l,c,u,d;t();var h=0,p=0,f=.1*Math.pow(e.p_lpf_freq,3),g=1+1e-4*e.p_lpf_ramp,m=5/(1+20*Math.pow(e.p_lpf_resonance,2))*(.01+f);m>.8&&(m=.8);var v=0,y=.1*Math.pow(e.p_hpf_freq,2),_=1+3e-4*e.p_hpf_ramp,b=0,w=.01*Math.pow(e.p_vib_speed,2),S=.5*e.p_vib_strength,C=0,I=0,x=0,O=[Math.floor(e.p_env_attack*e.p_env_attack*1e5),Math.floor(e.p_env_sustain*e.p_env_sustain*1e5),Math.floor(e.p_env_decay*e.p_env_decay*1e5)],M=O[0]+O[1]+O[2],k=0,E=1020*Math.pow(e.p_pha_offset,2);e.p_pha_offset<0&&(E=-E);var N=1*Math.pow(e.p_pha_ramp,2);e.p_pha_ramp<0&&(N=-N);for(var T=Math.abs(Math.floor(E)),L=0,A=[],R=0;R<1024;++R)A[R]=0;var D=[];for(R=0;R<32;++R)D[R]=2*Math.random()-1;var P=Math.floor(2e4*Math.pow(1-e.p_repeat_speed,2)+32);0==e.p_repeat_speed&&(P=0);for(var F,B=e.sound_vol,j=(B=Math.exp(e.sound_vol)-1,0),z=0,V=Math.floor(44100/e.sample_rate),U=0,H=Math.ceil(M/V),G=(F=e.sample_rate<SoundEffect.MIN_SAMPLE_RATE?new SoundEffect(4*H,SoundEffect.MIN_SAMPLE_RATE):new SoundEffect(H,e.sample_rate)).getBuffer(),q=0;;++q){0!=P&&++n>=P&&t(),0!=d&&q>=d&&(d=0,r*=u),(r*=s+=a)>i&&(r=i,e.p_freq_limit>0&&!0);var W=r;if(S>0&&(b+=w,W=r*(1+Math.sin(b)*S)),(o=Math.floor(W))<8&&(o=8),(l+=c)<0&&(l=0),l>.5&&(l=.5),++x>O[I]){for(x=1,I++;I<3&&0===O[I];)I++;if(3===I)break}C=0===I?x/O[0]:1===I?1+2*Math.pow(1-x/O[1],1)*e.p_env_punch:1-x/O[2],E+=N,(T=Math.abs(Math.floor(E)))>1023&&(T=1023),0!=_&&((y*=_)<1e-5&&(y=1e-5),y>.1&&(y=.1));for(var K=0,X=0;X<8;++X){var Y=0;if(++k>=o&&(k%=o,e.wave_type===NOISE))for(R=0;R<32;++R)D[R]=2*Math.random()-1;var J=k/o;if(e.wave_type===SQUARE)Y=J<l?.5:-.5;else if(e.wave_type===SAWTOOTH)Y=1-2*J;else if(e.wave_type===SINE)Y=Math.sin(2*J*Math.PI);else if(e.wave_type===NOISE)Y=D[Math.floor(32*k/o)];else if(e.wave_type===TRIANGLE)Y=Math.abs(1-2*J)-1;else{if(e.wave_type!==BREAKER)throw new Exception("bad wave type! "+e.wave_type);Y=Math.abs(1-J*J*2)-1}var Q=h;(f*=g)<0&&(f=0),f>.1&&(f=.1),1!=e.p_lpf_freq?(p+=(Y-h)*f,p-=p*m):(h=Y,p=0),v+=(h+=p)-Q,Y=v-=v*y,A[1023&L]=Y,Y+=A[L-T+1024&1023],L=L+1&1023,K+=Y*C}j+=K,++z>=V&&(z=0,K=j/V,j=0,K=K/8*masterVolume,K*=B,G[U++]=K,e.sample_rate<SoundEffect.MIN_SAMPLE_RATE&&(G[U++]=K,G[U++]=K,G[U++]=K))}return V>0&&(K=(K=j/V)/8*masterVolume,K*=B,G[U++]=K,e.sample_rate<SoundEffect.MIN_SAMPLE_RATE&&(G[U++]=K,G[U++]=K,G[U++]=K)),F},"undefined"!=typeof exports){var RIFFWAVE=require("./riffwave").RIFFWAVE;exports.Params=Params,exports.generate=generate}var sfxCache={},cachedSeeds=[],CACHE_MAX=50;function clearSFXCache(){sfxCache={},cachedSeeds=[]}function cacheSeed(e){if(e in sfxCache)return sfxCache[e];var t=generateFromSeed(e);t.sound_vol=SOUND_VOL*(sfxSetting/10),t.sample_rate=SAMPLE_RATE,t.bit_depth=BIT_DEPTH;var n=SoundEffect.generate(t);for(sfxCache[e]=n,cachedSeeds.push(e);cachedSeeds.length>CACHE_MAX;){var r=cachedSeeds[0];cachedSeeds=cachedSeeds.slice(1),delete sfxCache[r]}return n}function cacheQuietSeed(e){if(e in sfxCache)return sfxCache[e];var t=generateFromSeed(e);t.sound_vol=QUIET_SOUND_VOL*(sfxSetting/10),t.sample_rate=SAMPLE_RATE,t.bit_depth=BIT_DEPTH;var n=SoundEffect.generate(t);for(sfxCache[e]=n,cachedSeeds.push(e);cachedSeeds.length>CACHE_MAX;){var r=cachedSeeds[0];cachedSeeds=cachedSeeds.slice(1),delete sfxCache[r]}return n}function cacheLoudSeed(e){if(e in sfxCache)return sfxCache[e];var t=generateFromSeed(e);t.sound_vol=sfxSetting/10*.4,t.sample_rate=SAMPLE_RATE,t.bit_depth=BIT_DEPTH;var n=SoundEffect.generate(t);for(sfxCache[e]=n,cachedSeeds.push(e);cachedSeeds.length>CACHE_MAX;){var r=cachedSeeds[0];cachedSeeds=cachedSeeds.slice(1),delete sfxCache[r]}return n}function playSound(e){muted||(checkAudioContextExists(),unitTesting||cacheSeed(e).play())}function playQuietSound(e){muted||(checkAudioContextExists(),unitTesting||cacheQuietSeed(e).play())}function playLoudSound(e){muted||(checkAudioContextExists(),unitTesting||cacheLoudSeed(e).play())}function killAudioButton(){var e=document.getElementById("muteButton"),t=document.getElementById("unMuteButton");e&&(e.remove(),t.remove())}function showAudioButton(){var e=document.getElementById("muteButton"),t=document.getElementById("unMuteButton");e&&(e.style.display="block",t.style.display="none")}function toggleMute(){0===muted?muteAudio():unMuteAudio()}function muteAudio(){muted=1,currentMusic.pause(),tryDeactivateYoutube();var e=document.getElementById("muteButton"),t=document.getElementById("unMuteButton");e&&(e.style.display="none",t.style.display="block")}function unMuteAudio(){muted=0,currentMusic.play(),tryActivateYoutube();var e=document.getElementById("muteButton"),t=document.getElementById("unMuteButton");e&&(e.style.display="block",t.style.display="none")}class NGIO{static get STATUS_INITIALIZED(){return"initialized"}static get STATUS_CHECKING_LOCAL_VERSION(){return"checking-local-version"}static get STATUS_LOCAL_VERSION_CHECKED(){return"local-version-checked"}static get STATUS_PRELOADING_ITEMS(){return"preloading-items"}static get STATUS_ITEMS_PRELOADED(){return"items-preloaded"}static get STATUS_READY(){return"ready"}static get STATUS_SESSION_UNINITIALIZED(){return NewgroundsIO.SessionState.SESSION_UNINITIALIZED}static get STATUS_WAITING_FOR_SERVER(){return NewgroundsIO.SessionState.WAITING_FOR_SERVER}static get STATUS_LOGIN_REQUIRED(){return NewgroundsIO.SessionState.LOGIN_REQUIRED}static get STATUS_WAITING_FOR_USER(){return NewgroundsIO.SessionState.WAITING_FOR_USER}static get STATUS_LOGIN_CANCELLED(){return NewgroundsIO.SessionState.LOGIN_CANCELLED}static get STATUS_LOGIN_SUCCESSFUL(){return NewgroundsIO.SessionState.LOGIN_SUCCESSFUL}static get STATUS_LOGIN_FAILED(){return NewgroundsIO.SessionState.LOGIN_FAILED}static get STATUS_USER_LOGGED_OUT(){return NewgroundsIO.SessionState.USER_LOGGED_OUT}static get STATUS_SERVER_UNAVAILABLE(){return NewgroundsIO.SessionState.SERVER_UNAVAILABLE}static get STATUS_EXCEEDED_MAX_ATTEMPTS(){return NewgroundsIO.SessionState.EXCEEDED_MAX_ATTEMPTS}static get isWaitingStatus(){return 0<=NewgroundsIO.SessionState.SESSION_WAITING.indexOf(this.#e)||0<=[this.STATUS_PRELOADING_ITEMS,this.LOCAL_VERSION_CHECKED,this.STATUS_CHECKING_LOCAL_VERSION].indexOf(this.#e)}static get PERIOD_TODAY(){return"D"}static get PERIOD_CURRENT_WEEK(){return"W"}static get PERIOD_CURRENT_MONTH(){return"M"}static get PERIOD_CURRENT_YEAR(){return"Y"}static get PERIOD_ALL_TIME(){return"A"}static get PERIODS(){return[NGIO.PERIOD_TODAY,NGIO.PERIOD_CURRENT_WEEK,NGIO.PERIOD_CURRENT_MONTH,NGIO.PERIOD_CURRENT_YEAR,NGIO.PERIOD_ALL_TIME]}static get ngioCore(){return this.#t}static#t=null;static get medalScore(){return this.#n}static#n=-1;static get medals(){return this.#r}static#r=null;static get scoreBoards(){return this.#o}static#o=null;static get saveSlots(){return this.#i}static#i=null;static get lastExecution(){return this.#s}static#s=new Date;static get lastConnectionStatus(){return this.#e}static#e=new Date;static get sessionError(){return this.#a}static#a=null;static get legalHost(){return this.#l}static#l=!0;static get isDeprecated(){return this.#c}static#c=!0;static get newestVersion(){return this.#u}static#u=!0;static get loginPageOpen(){return this.#d}static#d=!1;static get gatewayVersion(){return this.#h}static#h=!0;static get lastMedalUnlocked(){return this.#p}static#p=!0;static get lastBoardPosted(){return this.#f}static#f=!0;static get lastScorePosted(){return this.#g}static#g=!0;static get lastGetScoresResult(){return this.#m}static#m=!0;static get lastSaveSlotLoaded(){return this.#v}static#v=!0;static get lastSaveSlotSaved(){return this.#y}static#y=!0;static get lastDateTime(){return this.#_}static#_="0000-00-00";static get lastLoggedEvent(){return this.#b}static#b=null;static get lastTimeStamp(){return this.#w}static#w=0;static get lastPingSuccess(){return this.#S}static#S=!0;static get isInitialized(){return null!==this.ngioCore}static get session(){return this.isInitialized?this.ngioCore.session:null}static get user(){return null===this.session?null:this.ngioCore.session.user}static get hasSession(){return null!==this.session}static get hasUser(){return null!==this.user}static get isReady(){return this.#e===this.STATUS_READY}static get version(){return this.#C}static#C="0.0.0";static get debugMode(){return this.#I}static#I=!1;static#x={autoLogNewView:!1,preloadMedals:!1,preloadScoreBoards:!1,preloadSaveSlots:!1};static#O=!1;static#M=!1;static#k=!1;static#E=!1;static init(e,t,n){if(!this.isInitialized){if(this.#t=new NewgroundsIO.Core(e,t),this.#t.addEventListener("serverResponse",(function(e){NGIO.#N(e)})),n&&"object"==typeof n){"string"==typeof n.version&&(this.#C=n.version);var r=["debugMode","checkHostLicense","autoLogNewView","preloadMedals","preloadScoreBoards","preloadSaveSlots"];for(let e=0;e<r.length;e++)void 0!==n[r[e]]&&(this.#x[r[e]]=!!n[r[e]])}this.#t.debug=this.debugMode,this.#e=this.STATUS_INITIALIZED,setTimeout((function(){NGIO.keepSessionAlive()}),3e4)}}static skipLogin(){this.#O||(this.#M=!0)}static openLoginPage(){this.#d?console.warn("loginPageOpen is true. Use CancelLogin to reset."):(this.#M=!1,this.#O=!1,this.#d=!0,this.session.openLoginPage())}static cancelLogin(){this.session?(this.session.cancelLogin(NewgroundsIO.SessionState.SESSION_UNINITIALIZED),this.#T(),this.skipLogin()):console.error("NGIO Error - Can't cancel non-existent session")}static logOut(){this.session?this.session.logOut((function(){this.#T(),this.skipLogin()}),this):console.error("NGIO Error - Can't cancel non-existent session")}static loadAuthorUrl(){this.ngioCore.loadComponent(this.ngioCore.getComponent("Loader.loadAuthorUrl"))}static loadOfficialUrl(){this.ngioCore.loadComponent(this.ngioCore.getComponent("Loader.loadOfficialUrl"))}static loadMoreGames(){this.ngioCore.loadComponent(this.ngioCore.getComponent("Loader.loadMoreGames"))}static loadNewgrounds(){this.ngioCore.loadComponent(this.ngioCore.getComponent("Loader.loadNewgrounds"))}static loadReferral(e){this.ngioCore.loadComponent(this.ngioCore.getComponent("Loader.loadReferral",{referral_name:e}))}static getMedal(e){if(null===this.medals)return console.error("NGIO Error: Can't use getMedal without setting preloadMedals option to true"),null;for(let t=0;t<this.medals.length;t++)if(this.medals[t].id===e)return this.medals[t]}static unlockMedal(e,t,n){if(null==this.medals)return console.error("unlockMedal called without any preloaded medals."),void("function"==typeof t&&(n?t.call(n,null):t(null)));let r=this.getMedal(e);if(null==r)return console.error("Medal #"+e+" does not exist."),void("function"==typeof t&&(n?t.call(n,null):t(null)));r.unlock((function(){"function"==typeof t&&(n?t.call(n,this.lastMedalUnlocked):t(this.lastMedalUnlocked))}),this)}static getScoreBoard(e){if(null===this.scoreBoards)return console.error("NGIO Error: Can't use getScoreBoard without setting preloadScoreBoards option to true"),null;for(let t=0;t<this.scoreBoards.length;t++)if(this.scoreBoards[t].id===e)return this.scoreBoards[t]}static postScore(e,t,n,r,o){return"function"==typeof n?(o=r,r=n,n=""):void 0===n&&(n=""),null==this.scoreBoards?(console.error("NGIO Error - postScore called without any preloaded scoreboards."),void("function"==typeof r&&(o?r.call(o,null,null):r(null,null)))):null==(i=this.getScoreBoard(e))?(console.error("NGIO Error - ScoreBoard #"+e+" does not exist."),void("function"==typeof r&&(o?r.call(o,null,null):r(null,null)))):void i.postScore(t,n,(function(){"function"==typeof r&&(o?r.call(o,this.lastBoardPosted,this.lastScorePosted):r(this.lastBoardPosted,this.lastScorePosted))}),this);var i}static getScores(e,t,n,r){let o={period:void 0===t.period?NGIO.PERIOD_TODAY:t.period,tag:"string"!=typeof t.tag?"":t.tag,social:void 0!==t.social&&!!t.social,skip:"number"!=typeof t.skip?0:t.skip,limit:"number"!=typeof t.limit?10:t.limit};return null==this.scoreBoards?(console.error("NGIO Error - getScores called without any preloaded scoreboards."),void("function"==typeof n&&(r?n.call(r,null,null,o):n(null,null,o)))):null==(i=this.getScoreBoard(e))?(console.error("NGIO Error - ScoreBoard #"+e+" does not exist."),void("function"==typeof n&&(r?n.call(r,null,null,o):n(null,null,o)))):void i.getScores(o,(function(){"function"==typeof n&&(r?n.call(r,i,this.lastGetScoresResult.scores,o):n(i,this.lastGetScoresResult.scores,o))}),this);var i}static getSaveSlot(e){if(null===this.saveSlots)return console.error("NGIO Error: Can't use getSaveSlot without setting preloadSaveSlots option to true"),null;for(let t=0;t<this.saveSlots.length;t++)if(this.saveSlots[t].id===e)return this.saveSlots[t]}static getTotalSaveSlots(){let e=0;return this.saveSlots.forEach((t=>{t.hasData&&e++})),e}static getSaveSlotData(e,t,n){null===this.saveSlots&&(console.error("getSaveSlotData data called without any preloaded save slots."),n?t.call(n,null):t(null));let r=this.getSaveSlot(e);(this.#v=r).getData(t,n)}static setSaveSlotData(e,t,n,r){return null==saveSlots?(console.error("setSaveSlotData data called without any preloaded save slots."),void("function"==typeof n&&(r?n(r,null):n(null)))):null==(o=this.getSaveSlot(e))?(console.error("Slot #"+e+" does not exist."),void("function"==typeof n&&(r?n(r,null):n(null)))):void o.SetData(t,(function(){"function"==typeof n&&(r?n(r,this.lastSaveSlotSaved):n(this.lastSaveSlotSaved))}),this);var o}static logEvent(e,t,n){this.ngioCore.executeComponent(this.ngioCore.getComponent("Event.logEvent",{event_name:e}),(function(){"function"==typeof t&&(n?t(n,this.lastLoggedEvent):t(this.lastLoggedEvent))}),this)}static getDateTime(e,t){this.ngioCore.executeComponent(this.ngioCore.getComponent("Gateway.getDatetime"),(function(){"function"==typeof e&&(t?e(t,this.lastDateTime,this.lastTimeStamp):e(this.lastDateTime,this.lastTimeStamp))}),this)}static keepSessionAlive(){this.hasUser&&3e4<=(new Date-this.#s).Seconds&&(this.#s=new Date,this.ngioCore.executeComponent(this.ngioCore.getComponent("Gateway.ping")))}static getConnectionStatus(e,t){this.#E||null===this.#e||null==this.session||(this.#E=!0,this.#e===this.STATUS_INITIALIZED?(this.#e=this.STATUS_CHECKING_LOCAL_VERSION,this.#L(e,t),this.#A(e,t)):this.#O?this.#e===this.STATUS_LOGIN_SUCCESSFUL?(this.#e=this.STATUS_PRELOADING_ITEMS,this.#L(e,t),this.#R((function(){this.#L(e,t),this.#M=!1}),this)):this.#e===this.STATUS_ITEMS_PRELOADED?(this.#d=!1,this.#e=this.STATUS_READY,this.#L(e,t),this.#M=!1):this.keepSessionAlive():this.#M?this.#D(e,t):this.#e!==this.STATUS_CHECKING_LOCAL_VERSION&&this.session.update((function(){this.#D(e,t)}),this),this.#E=!1)}static#D(e,t){(this.session.statusChanged||this.#M)&&(this.#e=this.session.status,this.session.status!=NewgroundsIO.SessionState.LOGIN_SUCCESSFUL&&!this.#M||(this.#e=NewgroundsIO.SessionState.LOGIN_SUCCESSFUL,this.#O=!0),this.#L(e,t)),this.#M=!1}static#L(e,t){t?e.call(t,this.#e):e(this.#e)}static#A(e,t){if(this.#k)return this.#e=this.STATUS_LOCAL_VERSION_CHECKED,void this.#L(e,t);this.ngioCore.queueComponent(this.ngioCore.getComponent("App.getCurrentVersion",{version:this.#C})),this.ngioCore.queueComponent(this.ngioCore.getComponent("Gateway.getVersion")),this.#x.autoLogNewView&&this.ngioCore.queueComponent(this.ngioCore.getComponent("App.logView")),this.#x.checkHostLicense&&this.ngioCore.queueComponent(this.ngioCore.getComponent("App.getHostLicense")),this.ngioCore.executeQueue((function(){this.#e=this.STATUS_LOCAL_VERSION_CHECKED,this.#k=!0,this.#L(e,t),this.#c&&console.warn("NGIO - Version mistmatch! Published version is: "+this.#u+", this version is: "+this.version),this.#l||(console.warn("NGIO - This host has been blocked fom hosting this game!"),this.#O=!0,this.#e=this.STATUS_ITEMS_PRELOADED,this.#L(e,t))}),this)}static#R(){this.#x.preloadMedals&&(this.ngioCore.queueComponent(this.ngioCore.getComponent("Medal.getMedalScore")),this.ngioCore.queueComponent(this.ngioCore.getComponent("Medal.getList"))),this.#x.preloadScoreBoards&&this.ngioCore.queueComponent(this.ngioCore.getComponent("ScoreBoard.getBoards")),null!==this.user&&this.#x.preloadSaveSlots&&this.ngioCore.queueComponent(this.ngioCore.getComponent("CloudSave.loadSlots")),this.ngioCore.hasQueue?this.ngioCore.executeQueue((function(){this.#e=this.STATUS_ITEMS_PRELOADED}),this):this.#e=this.STATUS_ITEMS_PRELOADED}static#T(){this.#e=this.STATUS_INITIALIZED,this.#d=!1,this.#M=!1,this.#O=!1}static#P(e){if(this.#i){let t=this.#i.length;for(let n=0;n<this.#i.length;n++)if(this.#i[n].id===e.id){t=n;break}this.#i[t]=e.clone(t<this.#i.length?this.#i[t]:null)}}static#F(e){if(this.#o){let t=this.#o.length;for(let n=0;n<this.#o.length;n++)if(this.#o[n].id===e.id){t=n;break}this.#o[t]=e.clone(t<this.#o.length?this.#o[t]:null)}}static#B(e){if(this.#r){let t=this.#r.length;for(let n=0;n<this.#r.length;n++)if(this.#r[n].id===e.id){t=n;break}this.#r[t]=e.clone(t<this.#r.length?this.#r[t]:null)}}static#N(e){var t=e.detail;if(t&&t.success)if(this.#s=new Date,Array.isArray(t.result))for(let e=0;e<t.result.length;e++)t.result[e]&&this.#j(t.result[e]);else t.result&&this.#j(t.result)}static#j(e){switch(e.success||104===e.error.code||110===e.error.code||console.error(e.error.message+" \ncode("+e.error.code+")"),e.__object){case"App.getCurrentVersion":if(!e.success)return;this.#u=e.current_version,this.#c=e.client_deprecated;break;case"App.getHostLicense":if(!e.success)return;this.#l=e.host_approved;break;case"App.endSession":this.#T();break;case"App.checkSession":e.success||this.#T();case"App.startSession":if(!e.success){this.#T();break}e.session.clone(this.session);break;case"CloudSave.loadSlots":if(!e.success)return;this.#i=e.slots;break;case"CloudSave.loadSlot":if(!e.success)return;this.#P(e.slot);break;case"CloudSave.setData":if(!e.success)return void(this.#y=null);this.#P(e.slot);break;case"CloudSave.clearSlot":if(!e.success)return;this.#P(e.slot);break;case"Event.logEvent":if(!e.success)return void(this.#b=null);this.#b=e.event_name;break;case"Gateway.getDatetime":if(!e.success)return this.#w=0,void(this.#_="0000-00-00");this.#_=e.datetime,this.#w=e.timestamp;break;case"Gateway.getVersion":if(!e.success)return void(this.#h=null);this.#h=e.version;break;case"Gateway.ping":this.#S=e.success;break;case"Medal.getList":if(!e.success)return;this.#r=[];for(let t=0;t<e.medals.length;t++)this.#r.push(e.medals[t].clone());break;case"Medal.unlock":if(!e.success)return void(this.#p=null);this.#r&&(this.#B(e.medal),this.#p=this.getMedal(e.medal.id)),this.#n=e.medal_score,window.top.postMessage(JSON.stringify({ngioComponent:"Medal.unlock",id:e.medal.id}),"*");break;case"Medal.getMedalScore":if(!e.success)return;this.#n=e.medal_score;break;case"ScoreBoard.getBoards":if(!e.success)return;this.#o=[];for(let t=0;t<e.scoreboards.length;t++)this.#o.push(e.scoreboards[t].clone());break;case"ScoreBoard.postScore":if(!e.success)return this.#g=null,void(this.#f=null);this.#o&&(this.#g=e.score,this.#f=this.getScoreBoard(e.scoreboard.id)),window.top.postMessage(JSON.stringify({ngioComponent:"ScoreBoard.postScore",id:e.scoreboard.id}),"*");break;case"ScoreBoard.getScores":if(!e.success)return void(this.#m=null);this.#m=e}}}var CryptoJS=CryptoJS||function(e){function t(){}var n={},r=n.lib={},o=r.Base={extend:function(e){t.prototype=this;var n=new t;return e&&n.mixIn(e),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),(n.init.prototype=n).$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},i=r.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var o=0;o<e;o++)t[r+o>>>2]|=(n[o>>>2]>>>24-o%4*8&255)<<24-(r+o)%4*8;else if(65535<n.length)for(o=0;o<e;o+=4)t[r+o>>>2]=n[o>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new i.init(n,t)}}),s=n.enc={},a=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var o=t[r>>>2]>>>24-r%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new i.init(n,t/2)}},l=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new i.init(n,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},u=r.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,o=n.sigBytes,s=this.blockSize,a=o/(4*s);a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0),o=e.min(4*(t=a*s),o);if(t){for(var l=0;l<t;l+=s)this._doProcessBlock(r,l);l=r.splice(0,t),n.sigBytes-=o}return new i.init(l,o)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(r.Hasher=u.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new d.HMAC.init(e,n).finalize(t)}}}),n.algo={});return n}(Math),NewgroundsIO=(function(){var e=CryptoJS,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var o=0;o<n;o+=3)for(var i=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<n;s++)e.push(r.charAt(i>>>6*(3-s)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,r=this._map;!(s=r.charAt(64))||-1!=(s=e.indexOf(s))&&(n=s);for(var o,i,s=[],a=0,l=0;l<n;l++)l%4&&(o=r.indexOf(e.charAt(l-1))<<l%4*2,i=r.indexOf(e.charAt(l))>>>6-l%4*2,s[a>>>2]|=(o|i)<<24-a%4*8,a++);return t.create(s,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,n,r,o,i,s){return((e=e+(t&n|~t&r)+o+s)<<i|e>>>32-i)+t}function n(e,t,n,r,o,i,s){return((e=e+(t&r|n&~r)+o+s)<<i|e>>>32-i)+t}function r(e,t,n,r,o,i,s){return((e=e+(t^n^r)+o+s)<<i|e>>>32-i)+t}function o(e,t,n,r,o,i,s){return((e=e+(n^(t|~r))+o+s)<<i|e>>>32-i)+t}for(var i=CryptoJS,s=(l=i.lib).WordArray,a=l.Hasher,l=i.algo,c=[],u=0;u<64;u++)c[u]=4294967296*e.abs(e.sin(u+1))|0;l=l.MD5=a.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,i){for(var s=0;s<16;s++){var a=e[l=i+s];e[l]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}s=this._hash.words;var l=e[i+0],u=(a=e[i+1],e[i+2]),d=e[i+3],h=e[i+4],p=e[i+5],f=e[i+6],g=e[i+7],m=e[i+8],v=e[i+9],y=e[i+10],_=e[i+11],b=e[i+12],w=e[i+13],S=e[i+14],C=e[i+15],I=t(s[0],M=s[1],O=s[2],x=s[3],l,7,c[0]),x=t(x,I,M,O,a,12,c[1]),O=t(O,x,I,M,u,17,c[2]),M=t(M,O,x,I,d,22,c[3]);I=t(I,M,O,x,h,7,c[4]),x=t(x,I,M,O,p,12,c[5]),O=t(O,x,I,M,f,17,c[6]),M=t(M,O,x,I,g,22,c[7]),I=t(I,M,O,x,m,7,c[8]),x=t(x,I,M,O,v,12,c[9]),O=t(O,x,I,M,y,17,c[10]),M=t(M,O,x,I,_,22,c[11]),I=t(I,M,O,x,b,7,c[12]),x=t(x,I,M,O,w,12,c[13]),O=t(O,x,I,M,S,17,c[14]),I=n(I,M=t(M,O,x,I,C,22,c[15]),O,x,a,5,c[16]),x=n(x,I,M,O,f,9,c[17]),O=n(O,x,I,M,_,14,c[18]),M=n(M,O,x,I,l,20,c[19]),I=n(I,M,O,x,p,5,c[20]),x=n(x,I,M,O,y,9,c[21]),O=n(O,x,I,M,C,14,c[22]),M=n(M,O,x,I,h,20,c[23]),I=n(I,M,O,x,v,5,c[24]),x=n(x,I,M,O,S,9,c[25]),O=n(O,x,I,M,d,14,c[26]),M=n(M,O,x,I,m,20,c[27]),I=n(I,M,O,x,w,5,c[28]),x=n(x,I,M,O,u,9,c[29]),O=n(O,x,I,M,g,14,c[30]),I=r(I,M=n(M,O,x,I,b,20,c[31]),O,x,p,4,c[32]),x=r(x,I,M,O,m,11,c[33]),O=r(O,x,I,M,_,16,c[34]),M=r(M,O,x,I,S,23,c[35]),I=r(I,M,O,x,a,4,c[36]),x=r(x,I,M,O,h,11,c[37]),O=r(O,x,I,M,g,16,c[38]),M=r(M,O,x,I,y,23,c[39]),I=r(I,M,O,x,w,4,c[40]),x=r(x,I,M,O,l,11,c[41]),O=r(O,x,I,M,d,16,c[42]),M=r(M,O,x,I,f,23,c[43]),I=r(I,M,O,x,v,4,c[44]),x=r(x,I,M,O,b,11,c[45]),O=r(O,x,I,M,C,16,c[46]),I=o(I,M=r(M,O,x,I,u,23,c[47]),O,x,l,6,c[48]),x=o(x,I,M,O,g,10,c[49]),O=o(O,x,I,M,S,15,c[50]),M=o(M,O,x,I,p,21,c[51]),I=o(I,M,O,x,b,6,c[52]),x=o(x,I,M,O,d,10,c[53]),O=o(O,x,I,M,y,15,c[54]),M=o(M,O,x,I,a,21,c[55]),I=o(I,M,O,x,m,6,c[56]),x=o(x,I,M,O,C,10,c[57]),O=o(O,x,I,M,f,15,c[58]),M=o(M,O,x,I,w,21,c[59]),I=o(I,M,O,x,h,6,c[60]),x=o(x,I,M,O,_,10,c[61]),O=o(O,x,I,M,u,15,c[62]),M=o(M,O,x,I,v,21,c[63]);s[0]=s[0]+I|0,s[1]=s[1]+M|0,s[2]=s[2]+O|0,s[3]=s[3]+x|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes,i=(n[o>>>5]|=128<<24-o%32,e.floor(r/4294967296));for(n[15+(64+o>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[14+(64+o>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,r=0;r<4;r++)o=n[r],n[r]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);return t},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),i.MD5=a._createHelper(l),i.HmacMD5=a._createHmacHelper(l)}(Math),function(){var e=CryptoJS,t=e.lib,n=t.Base,r=t.WordArray,o=(t=e.algo).EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(a=this.cfg).hasher.create(),o=r.create(),i=o.words,s=a.keySize,a=a.iterations;i.length<s;){l&&n.update(l);var l=n.update(e).finalize(t);n.reset();for(var c=1;c<a;c++)l=n.finalize(l),n.reset();o.concat(l)}return o.sigBytes=4*s,o}});e.EvpKDF=function(e,t,n){return o.create(n).compute(e,t)}}(),CryptoJS.lib.Cipher||function(){function e(e,t,n){var r=this._iv;r?this._iv=void 0:r=this._prevBlock;for(var o=0;o<n;o++)e[t+o]^=r[o]}var t=(h=CryptoJS).lib,n=t.Base,r=t.WordArray,o=t.BufferedBlockAlgorithm,i=h.enc.Base64,s=h.algo.EvpKDF,a=t.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?p:d).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?p:d).decrypt(e,t,n,r)}}}}),l=(t.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),h.mode={}),c=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend(),u=(c.Encryptor=c.extend({processBlock:function(t,n){var r=this._cipher,o=r.blockSize;e.call(this,t,n,o),r.encryptBlock(t,n),this._prevBlock=t.slice(n,n+o)}}),c.Decryptor=c.extend({processBlock:function(t,n){var r=this._cipher,o=r.blockSize,i=t.slice(n,n+o);r.decryptBlock(t,n),e.call(this,t,n,o),this._prevBlock=i}}),l=l.CBC=c,c=(h.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,o=(n-=e.sigBytes%n)<<24|n<<16|n<<8|n,i=[],s=0;s<n;s+=4)i.push(o);n=r.create(i,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=a.extend({cfg:a.cfg.extend({mode:l,padding:c}),reset:function(){a.reset.call(this);var e,t=(n=this.cfg).iv,n=n.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode=e.call(n,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),d=(l=(h.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?r.create([1398893684,1701076831]).concat(e).concat(t):t).toString(i)},parse:function(e){var t,n=(e=i.parse(e)).words;return 1398893684==n[0]&&1701076831==n[1]&&(t=r.create(n.slice(2,4)),n.splice(0,4),e.sigBytes-=16),u.create({ciphertext:e,salt:t})}},t.SerializableCipher=n.extend({cfg:n.extend({format:l}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var o=e.createEncryptor(n,r);return t=o.finalize(t),o=o.cfg,u.create({ciphertext:t,key:n,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),h=(h.kdf={}).OpenSSL={execute:function(e,t,n,o){return o=o||r.random(8),e=s.create({keySize:t+n}).compute(e,o),n=r.create(e.words.slice(t),4*n),e.sigBytes=4*t,u.create({key:e,iv:n,salt:o})}},p=t.PasswordBasedCipher=d.extend({cfg:d.cfg.extend({kdf:h}),encrypt:function(e,t,n,r){return n=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,(e=d.encrypt.call(this,e,t,n.key,r)).mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,d.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=CryptoJS,t=e.lib.BlockCipher,n=e.algo,r=[],o=[],i=[],s=[],a=[],l=[],c=[],u=[],d=[],h=[],p=[],f=0;f<256;f++)p[f]=f<128?f<<1:f<<1^283;var g=0,m=0;for(f=0;f<256;f++){var v=m^m<<1^m<<2^m<<3^m<<4,y=(r[g]=v=v>>>8^255&v^99,p[o[v]=g]),_=p[y],b=p[_],w=257*p[v]^16843008*v;i[g]=w<<24|w>>>8,s[g]=w<<16|w>>>16,a[g]=w<<8|w>>>24,l[g]=w,c[v]=(w=16843009*b^65537*_^257*y^16843008*g)<<24|w>>>8,u[v]=w<<16|w>>>16,d[v]=w<<8|w>>>24,h[v]=w,g?(g=y^p[p[p[b^y]]],m^=p[p[m]]):g=m=1}var S=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e,t=(o=this._key).words,n=o.sigBytes/4,o=4*((this._nRounds=n+6)+1),i=this._keySchedule=[],s=0;s<o;s++)s<n?i[s]=t[s]:(e=i[s-1],s%n?6<n&&4==s%n&&(e=r[e>>>24]<<24|r[e>>>16&255]<<16|r[e>>>8&255]<<8|r[255&e]):(e=r[(e=e<<8|e>>>24)>>>24]<<24|r[e>>>16&255]<<16|r[e>>>8&255]<<8|r[255&e],e^=S[s/n|0]<<24),i[s]=i[s-n]^e);for(t=this._invKeySchedule=[],n=0;n<o;n++)s=o-n,e=n%4?i[s]:i[s-4],t[n]=n<4||s<=4?e:c[r[e>>>24]]^u[r[e>>>16&255]]^d[r[e>>>8&255]]^h[r[255&e]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,i,s,a,l,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,c,u,d,h,o),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,o,i,s,a){for(var l=this._nRounds,c=e[t]^n[0],u=e[t+1]^n[1],d=e[t+2]^n[2],h=e[t+3]^n[3],p=4,f=1;f<l;f++){var g=r[c>>>24]^o[u>>>16&255]^i[d>>>8&255]^s[255&h]^n[p++],m=r[u>>>24]^o[d>>>16&255]^i[h>>>8&255]^s[255&c]^n[p++],v=r[d>>>24]^o[h>>>16&255]^i[c>>>8&255]^s[255&u]^n[p++];h=r[h>>>24]^o[c>>>16&255]^i[u>>>8&255]^s[255&d]^n[p++],c=g,u=m,d=v}g=(a[c>>>24]<<24|a[u>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^n[p++],m=(a[u>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&c])^n[p++],v=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[c>>>8&255]<<8|a[255&u])^n[p++],h=(a[h>>>24]<<24|a[c>>>16&255]<<16|a[u>>>8&255]<<8|a[255&d])^n[p++],e[t]=g,e[t+1]=m,e[t+2]=v,e[t+3]=h},keySize:8});e.AES=t._createHelper(n)}(),NewgroundsIO||{});NewgroundsIO.objects=NewgroundsIO.objects||{},NewgroundsIO.results=NewgroundsIO.results||{},NewgroundsIO.components=NewgroundsIO.components||{},(()=>{class e extends EventTarget{#z="https://www.newgrounds.io/gateway_v3.php";#V=!1;#U=null;#H=null;#G=[];#q=null;#W=null;#K={};get GATEWAY_URI(){return this.#z}get debug(){return this.#V}set debug(e){this.#V=!!e}get appID(){return this.#U}get componentQueue(){return this.#G}get hasQueue(){return 0<this.#G.length}get host(){return this.#q}get session(){return this.#W}get user(){return this.#W?this.#W.user:null}get uriParams(){return this.#K}constructor(e,t){if(super(),void 0===e)throw"Missing required appID!";if(void 0===t)throw"Missing required aesKey!";if(this.#U=e,this.#H=CryptoJS.enc.Base64.parse(t),this.#G=[],this.#K={},window&&window.location&&window.location.href?window.location.hostname?this.#q=window.location.hostname.toLowerCase():"file:"==window.location.href.toLowerCase().substr(0,5)?this.#q="<LocalHost>":this.#q="<Unknown>":this.#q="<AppView>","undefined"!=typeof window&&window.location&&(e=window.location.href.split("?").pop()))for(var n,r=e.split("&"),o=0;o<r.length;o++)n=r[o].split("="),this.#K[n[0]]=n[1];this.#W=this.getObject("Session"),this.#W._uri_id=this.getUriParam("ngio_session_id",null)}getUriParam(e,t){return void 0===this.#K[e]?t:this.#K[e]}encrypt(e){let t=CryptoJS.lib.WordArray.random(16);return e=CryptoJS.AES.encrypt(e,this.#H,{iv:t}),CryptoJS.enc.Base64.stringify(t.concat(e.ciphertext))}getObject(e,t){return void 0===NewgroundsIO.objects[e]?(console.error("NewgroundsIO - Invalid object name: "+e),null):((e=new NewgroundsIO.objects[e](t)).setCore(this),e)}getComponent(e,t){var n=e.split("."),r=!1;return(r=2===n.length&&void 0!==NewgroundsIO.components[n[0]]&&void 0!==NewgroundsIO.components[n[0]][n[1]]?r:"Invalid component name: "+e)?(console.error("NewgroundsIO - "+r),null):((e=new NewgroundsIO.components[n[0]][n[1]](t)).setCore(this),e)}queueComponent(e){this._verifyComponent(e)&&(e.setCore(this),this.#G.push(e))}executeQueue(e,t){this.#G.length<1||(this.executeComponent(this.#G,e,t),this.#G=[])}executeComponent(e,t,n){if(Array.isArray(e)){let t=!0,n=this;if(e.forEach((r=>{r instanceof NewgroundsIO.BaseComponent||(n._verifyComponent(e)||(t=!1),r.setCore(n))})),!t)return}else{if(!this._verifyComponent(e))return;e.setCore(this)}let r=this;var o=this._getRequest(e),i=(new NewgroundsIO.objects.Response,new XMLHttpRequest),s=(i.onreadystatechange=function(){if(4==i.readyState){try{e=JSON.parse(i.responseText)}catch(t){(e={success:!1,app_id:r.app_id}).error={message:String(t),code:8002}}var e=r._populateResponse(e);r.dispatchEvent(new CustomEvent("serverResponse",{detail:e})),t&&(n?t.call(n,e):t(e))}},void 0!==Array.prototype.toJSON?Array.prototype.toJSON:null);s&&delete Array.prototype.toJSON;let a=new FormData;a.append("request",JSON.stringify(o)),s&&(Array.prototype.toJSON=s),i.open("POST",this.GATEWAY_URI,!0),i.send(a)}loadComponent(e){this._verifyComponent(e)&&(e.setCore(this),e=this._getRequest(e),e=this.GATEWAY_URI+"?request="+encodeURIComponent(JSON.stringify(e)),window.open(e,"_blank"))}onServerResponse(e){}_populateResponse(e){if(e.success)if(Array.isArray(e.result))for(let t=0;t<e.result.length;t++)e.result[t]=this._populateResult(e.result[t]);else e.result=this._populateResult(e.result);else e.result&&delete e.result,e.error&&(e.error=new NewgroundsIO.objects.Error(e.error));return(e=new NewgroundsIO.objects.Response(e)).setCore(this),e}_populateResult(e){var t=e.component.split(".");let n=NewgroundsIO.results[t[0]][t[1]];if(!n)return null;e.data.component=e.component;let r=new n;return r.fromJSON(e.data,this),r}_getExecute(e){var t=new NewgroundsIO.objects.Execute;return t.setComponent(e),t.setCore(this),t}_getRequest(e){let t,n=this,r=(Array.isArray(e)?(t=[],e.forEach((e=>{e=n._getExecute(e),t.push(e)}))):t=this._getExecute(e),new NewgroundsIO.objects.Request({execute:t}));return this.debug&&(r.debug=!0),r.setCore(this),r}_verifyComponent(e){return e instanceof NewgroundsIO.BaseComponent?!!e.isValid():(console.error("NewgroundsIO Type Mismatch: Expecting a NewgroundsIO.components.XXXX instance, got",e),!1)}}NewgroundsIO.Core=e})(),(()=>{class e{get type(){return this.__type}__type="object";__object="BaseObject";__properties=[];__required=[];__ngioCore=null;isValid(){if(0===this.__required.length)return!0;let e=!0;return this.__required.forEach((function(t){null===this[t]?(console.error("NewgroundsIO Error: "+this.__object+" "+this.__type+" is invalid, missing value for '"+t+"'"),e=!1):this[t]instanceof NewgroundsIO.BaseObject&&(this[t].isValid()||(e=!1))}),this),e}setCore(e){this._doSetCore(e,[])}objectMap={};arrayMap={};fromJSON(e,t){var n,r,o={};for(this.setCore(t),n=0;n<this.__properties.length;n++){var i=this.__properties[n];if(void 0!==e[i]&&null!==e[i]){if(o[i]=e[i],void 0!==this.arrayMap[i]&&Array.isArray(o[i]))for(o[i]=[],r=0;r<e[i].length;r++){let n=NewgroundsIO.objects[this.arrayMap[i]];o[i][r]=new n,o[i][r].fromJSON(e[i][r],t)}else if(void 0!==this.objectMap[i]){let n=NewgroundsIO.objects[this.objectMap[i]];o[i]=new n,o[i].fromJSON(e[i],t)}this[i]=o[i]}}}_doSetCore(e,t){Array.isArray(t)||(t=[]),e instanceof NewgroundsIO.Core?(this.__ngioCore=e,t.push(this),this.__properties.forEach((function(n){this[n]instanceof NewgroundsIO.BaseObject&&-1===t.indexOf(this[n])?this[n]._doSetCore(e,t):Array.isArray(this[n])&&this[n].forEach((n=>{n instanceof NewgroundsIO.BaseObject&&-1===t.indexOf(n)&&n._doSetCore(e,t)}),this),"host"!==n||this.host||(this.host=e.host)}),this)):console.error("NewgroundsIO Error: Expecting NewgroundsIO.Core instance, got",e)}toJSON(){return this.__doToJSON()}__doToJSON(){if(void 0===this.__properties)return{};let e={};return this.__properties.forEach((function(t){null!==this[t]&&(e[t]="function"==typeof this[t].toJSON?this[t].toJSON():this[t])}),this),e}toSecureJSON(){return this.__ngioCore&&this.__ngioCore instanceof NewgroundsIO.Core?{secure:this.__ngioCore.encrypt(JSON.stringify(this.__doToJSON()))}:(console.error("NewgroundsIO Error: Unable to create secure JSON object without calling setCore() first."),this.__doToJSON())}toString(){return this.__type}clone(e){return void 0===e&&(e=new this.constructor),this.__properties.forEach((t=>{e[t]=this[t]})),e.__ngioCore=this.__ngioCore,e}}NewgroundsIO.BaseObject=e,NewgroundsIO.BaseComponent=class extends e{constructor(){super(),this.__type="component",this.__object="BaseComponent",this.__properties=["host","echo"],this._echo=null}get host(){return this.__ngioCore?this.__ngioCore.host:null}get echo(){return this._echo}set echo(e){this.echo=""+e}},NewgroundsIO.BaseResult=class extends e{constructor(){super(),this.__type="result",this.__object="BaseResult",this.__properties=["echo","error","success"],this._echo=null,this._error=null,this._success=null}get component(){return this.__object}get echo(){return this._echo}get error(){return this._error}set error(e){this._error=e}get success(){return!!this._success}set success(e){this._success=!!e}}})(),NewgroundsIO.SessionState={SESSION_UNINITIALIZED:"session-uninitialized",WAITING_FOR_SERVER:"waiting-for-server",LOGIN_REQUIRED:"login-required",WAITING_FOR_USER:"waiting-for-user",LOGIN_CANCELLED:"login-cancelled",LOGIN_SUCCESSFUL:"login-successful",LOGIN_FAILED:"login-failed",USER_LOGGED_OUT:"user-logged-out",SERVER_UNAVAILABLE:"server-unavailable",EXCEEDED_MAX_ATTEMPTS:"exceeded-max-attempts"},NewgroundsIO.SessionState.SESSION_WAITING=[NewgroundsIO.SessionState.SESSION_UNINITIALIZED,NewgroundsIO.SessionState.WAITING_FOR_SERVER,NewgroundsIO.SessionState.WAITING_FOR_USER,NewgroundsIO.SessionState.LOGIN_CANCELLED,NewgroundsIO.SessionStateLOGIN_FAILED],(()=>{class e extends NewgroundsIO.BaseComponent{constructor(){super(),this.__object="App.checkSession",this.__requireSession=!0}}void 0===NewgroundsIO.components.App&&(NewgroundsIO.components.App={}),NewgroundsIO.components.App.checkSession=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(){super(),this.__object="App.endSession",this.__requireSession=!0}}void 0===NewgroundsIO.components.App&&(NewgroundsIO.components.App={}),NewgroundsIO.components.App.endSession=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="App.getCurrentVersion",["version"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#C=null;get version(){return this.#C}set version(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#C=String(e)}}void 0===NewgroundsIO.components.App&&(NewgroundsIO.components.App={}),NewgroundsIO.components.App.getCurrentVersion=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="App.getHostLicense",["host"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}}void 0===NewgroundsIO.components.App&&(NewgroundsIO.components.App={}),NewgroundsIO.components.App.getHostLicense=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="App.logView",["host"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}}void 0===NewgroundsIO.components.App&&(NewgroundsIO.components.App={}),NewgroundsIO.components.App.logView=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="App.startSession",["force"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#X=null;get force(){return this.#X}set force(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#X=!!e}}void 0===NewgroundsIO.components.App&&(NewgroundsIO.components.App={}),NewgroundsIO.components.App.startSession=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="CloudSave.clearSlot",this.__requireSession=!0,["id"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Y=null;get id(){return this.#Y}set id(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#Y=Number(e),isNaN(this.#Y)&&(this.#Y=null)}}void 0===NewgroundsIO.components.CloudSave&&(NewgroundsIO.components.CloudSave={}),NewgroundsIO.components.CloudSave.clearSlot=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="CloudSave.loadSlot",this.__requireSession=!0,["id","app_id"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Y=null;get id(){return this.#Y}set id(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#Y=Number(e),isNaN(this.#Y)&&(this.#Y=null)}#J=null;get app_id(){return this.#J}set app_id(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#J=String(e)}}void 0===NewgroundsIO.components.CloudSave&&(NewgroundsIO.components.CloudSave={}),NewgroundsIO.components.CloudSave.loadSlot=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="CloudSave.loadSlots",this.__requireSession=!0,["app_id"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#J=null;get app_id(){return this.#J}set app_id(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#J=String(e)}}void 0===NewgroundsIO.components.CloudSave&&(NewgroundsIO.components.CloudSave={}),NewgroundsIO.components.CloudSave.loadSlots=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="CloudSave.setData",this.__requireSession=!0,["id","data"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Y=null;get id(){return this.#Y}set id(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#Y=Number(e),isNaN(this.#Y)&&(this.#Y=null)}#Q=null;get data(){return this.#Q}set data(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Q=String(e)}}void 0===NewgroundsIO.components.CloudSave&&(NewgroundsIO.components.CloudSave={}),NewgroundsIO.components.CloudSave.setData=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="Event.logEvent",["host","event_name"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Z=null;get event_name(){return this.#Z}set event_name(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Z=String(e)}}void 0===NewgroundsIO.components.Event&&(NewgroundsIO.components.Event={}),NewgroundsIO.components.Event.logEvent=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(){super(),this.__object="Gateway.getDatetime"}}void 0===NewgroundsIO.components.Gateway&&(NewgroundsIO.components.Gateway={}),NewgroundsIO.components.Gateway.getDatetime=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(){super(),this.__object="Gateway.getVersion"}}void 0===NewgroundsIO.components.Gateway&&(NewgroundsIO.components.Gateway={}),NewgroundsIO.components.Gateway.getVersion=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(){super(),this.__object="Gateway.ping"}}void 0===NewgroundsIO.components.Gateway&&(NewgroundsIO.components.Gateway={}),NewgroundsIO.components.Gateway.ping=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="Loader.loadAuthorUrl",["host","redirect","log_stat"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#$=null;get redirect(){return this.#$}set redirect(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#$=!!e}#ee=null;get log_stat(){return this.#ee}set log_stat(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#ee=!!e}}void 0===NewgroundsIO.components.Loader&&(NewgroundsIO.components.Loader={}),NewgroundsIO.components.Loader.loadAuthorUrl=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="Loader.loadMoreGames",["host","redirect","log_stat"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#$=null;get redirect(){return this.#$}set redirect(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#$=!!e}#ee=null;get log_stat(){return this.#ee}set log_stat(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#ee=!!e}}void 0===NewgroundsIO.components.Loader&&(NewgroundsIO.components.Loader={}),NewgroundsIO.components.Loader.loadMoreGames=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="Loader.loadNewgrounds",["host","redirect","log_stat"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#$=null;get redirect(){return this.#$}set redirect(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#$=!!e}#ee=null;get log_stat(){return this.#ee}set log_stat(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#ee=!!e}}void 0===NewgroundsIO.components.Loader&&(NewgroundsIO.components.Loader={}),NewgroundsIO.components.Loader.loadNewgrounds=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="Loader.loadOfficialUrl",["host","redirect","log_stat"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#$=null;get redirect(){return this.#$}set redirect(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#$=!!e}#ee=null;get log_stat(){return this.#ee}set log_stat(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#ee=!!e}}void 0===NewgroundsIO.components.Loader&&(NewgroundsIO.components.Loader={}),NewgroundsIO.components.Loader.loadOfficialUrl=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="Loader.loadReferral",["host","referral_name","redirect","log_stat"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#te=null;get referral_name(){return this.#te}set referral_name(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#te=String(e)}#$=null;get redirect(){return this.#$}set redirect(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#$=!!e}#ee=null;get log_stat(){return this.#ee}set log_stat(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#ee=!!e}}void 0===NewgroundsIO.components.Loader&&(NewgroundsIO.components.Loader={}),NewgroundsIO.components.Loader.loadReferral=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="Medal.getList",["app_id"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#J=null;get app_id(){return this.#J}set app_id(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#J=String(e)}}void 0===NewgroundsIO.components.Medal&&(NewgroundsIO.components.Medal={}),NewgroundsIO.components.Medal.getList=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(){super(),this.__object="Medal.getMedalScore",this.__requireSession=!0}}void 0===NewgroundsIO.components.Medal&&(NewgroundsIO.components.Medal={}),NewgroundsIO.components.Medal.getMedalScore=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="Medal.unlock",this.__isSecure=!0,this.__requireSession=!0,["id"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Y=null;get id(){return this.#Y}set id(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#Y=Number(e),isNaN(this.#Y)&&(this.#Y=null)}}void 0===NewgroundsIO.components.Medal&&(NewgroundsIO.components.Medal={}),NewgroundsIO.components.Medal.unlock=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(){super(),this.__object="ScoreBoard.getBoards"}}void 0===NewgroundsIO.components.ScoreBoard&&(NewgroundsIO.components.ScoreBoard={}),NewgroundsIO.components.ScoreBoard.getBoards=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="ScoreBoard.getScores",["id","period","tag","social","user","skip","limit","app_id"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Y=null;get id(){return this.#Y}set id(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#Y=Number(e),isNaN(this.#Y)&&(this.#Y=null)}#ne=null;get period(){return this.#ne}set period(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#ne=String(e)}#re=null;get tag(){return this.#re}set tag(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#re=String(e)}#oe=null;get social(){return this.#oe}set social(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#oe=!!e}#ie=null;get user(){return this.#ie}set user(e){this.#ie=e}#se=null;get skip(){return this.#se}set skip(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#se=Number(e),isNaN(this.#se)&&(this.#se=null)}#ae=null;get limit(){return this.#ae}set limit(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#ae=Number(e),isNaN(this.#ae)&&(this.#ae=null)}#J=null;get app_id(){return this.#J}set app_id(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#J=String(e)}}void 0===NewgroundsIO.components.ScoreBoard&&(NewgroundsIO.components.ScoreBoard={}),NewgroundsIO.components.ScoreBoard.getScores=e})(),(()=>{class e extends NewgroundsIO.BaseComponent{constructor(e){super();let t=this;if(this.__object="ScoreBoard.postScore",this.__isSecure=!0,this.__requireSession=!0,["id","value","tag"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Y=null;get id(){return this.#Y}set id(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#Y=Number(e),isNaN(this.#Y)&&(this.#Y=null)}#le=null;get value(){return this.#le}set value(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#le=Number(e),isNaN(this.#le)&&(this.#le=null)}#re=null;get tag(){return this.#re}set tag(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#re=String(e)}}void 0===NewgroundsIO.components.ScoreBoard&&(NewgroundsIO.components.ScoreBoard={}),NewgroundsIO.components.ScoreBoard.postScore=e})(),(()=>{class e extends NewgroundsIO.BaseObject{constructor(e){super();let t=this;if(this.__object="Debug",["exec_time","request"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#ce=null;get exec_time(){return this.#ce}set exec_time(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#ce=String(e)}#ue=null;get request(){return this.#ue}set request(e){null===(e=e instanceof NewgroundsIO.objects.Request||"object"!=typeof e?e:new NewgroundsIO.objects.Request(e))||e instanceof NewgroundsIO.objects.Request||console.warn("Type Mismatch: expecting NewgroundsIO.objects.Request, got ",e),this.#ue=e}objectMap={request:"Request"}}void 0===NewgroundsIO.objects&&(NewgroundsIO.objects={}),NewgroundsIO.objects.Debug=e})(),(()=>{class e extends NewgroundsIO.BaseObject{constructor(e){super();let t=this;if(this.__object="Error",["message","code"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#de=null;get message(){return this.#de}set message(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#de=String(e)}#he=null;get code(){return this.#he}set code(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#he=Number(e),isNaN(this.#he)&&(this.#he=null)}}void 0===NewgroundsIO.objects&&(NewgroundsIO.objects={}),NewgroundsIO.objects.Error=e})(),(()=>{class e extends NewgroundsIO.BaseObject{constructor(e){super();let t=this;if(this.__object="Execute",["component","parameters","secure"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#pe=null;get component(){return this.#pe}set component(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#pe=String(e)}#fe=null;get parameters(){return this.#fe}set parameters(e){if(Array.isArray(e)){let t=[];return e.forEach((function(e,n){"object"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a object, got",e),t[n]=e})),void(this.#fe=t)}"object"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a object, got",e),this.#fe=e}#ge=null;get secure(){return this.#ge}set secure(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#ge=String(e)}#me=null;setComponent(e){e instanceof NewgroundsIO.BaseComponent||console.error("NewgroundsIO Error: Expecting NewgroundsIO component, got "+typeof e),this.#me=e,this.component=e.__object,this.parameters=e.toJSON()}isValid(){return this.component||console.error("NewgroundsIO Error: Missing required component!"),this.__ngioCore?!this.#me||(this.#me.__requireSession&&!this.__ngioCore.session.isActive()?(console.warn("NewgroundsIO Warning: "+this.component+" can only be used with a valid user session."),this.__ngioCore.session.logProblems(),!1):this.#me instanceof NewgroundsIO.BaseComponent&&this.#me.isValid()):(console.error("NewgroundsIO Error: Must call setCore() before validating!"),!1)}toJSON(){return this.#me&&this.#me.__isSecure?this.toSecureJSON():super.toJSON()}}void 0===NewgroundsIO.objects&&(NewgroundsIO.objects={}),NewgroundsIO.objects.Execute=e})(),(()=>{class e extends NewgroundsIO.BaseObject{constructor(e){super();let t=this;if(this.__object="Medal",["id","name","description","icon","value","difficulty","secret","unlocked"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Y=null;get id(){return this.#Y}set id(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#Y=Number(e),isNaN(this.#Y)&&(this.#Y=null)}#ve=null;get name(){return this.#ve}set name(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#ve=String(e)}#ye=null;get description(){return this.#ye}set description(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#ye=String(e)}#_e=null;get icon(){return this.#_e}set icon(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#_e=String(e)}#le=null;get value(){return this.#le}set value(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#le=Number(e),isNaN(this.#le)&&(this.#le=null)}#be=null;get difficulty(){return this.#be}set difficulty(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#be=Number(e),isNaN(this.#be)&&(this.#be=null)}#we=null;get secret(){return this.#we}set secret(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#we=!!e}#Se=null;get unlocked(){return this.#Se}set unlocked(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#Se=!!e}unlock(e,t){var n;this.__ngioCore?(n=this.__ngioCore.getComponent("Medal.unlock",{id:this.id}),this.__ngioCore.executeComponent(n,e,t)):console.error("NewgroundsIO - Can not unlock medal object without attaching a NewgroundsIO.Core instance.")}}void 0===NewgroundsIO.objects&&(NewgroundsIO.objects={}),NewgroundsIO.objects.Medal=e})(),(()=>{class e extends NewgroundsIO.BaseObject{constructor(e){super();let t=this;if(this.__object="Request",["app_id","execute","session_id","debug"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Ce=null;get execute(){return this.#Ce}set execute(e){if(Array.isArray(e)||e instanceof NewgroundsIO.objects.Execute||"object"!=typeof e||(e=new NewgroundsIO.objects.Execute(e)),Array.isArray(e)){let t=[];return e.forEach((function(e,n){null===e||e instanceof NewgroundsIO.objects.Execute||console.warn("Type Mismatch: expecting NewgroundsIO.objects.Execute, got ",e),t[n]=e})),void(this.#Ce=t)}null===e||e instanceof NewgroundsIO.objects.Execute||console.warn("Type Mismatch: expecting NewgroundsIO.objects.Execute, got ",e),this.#Ce=e}#V=null;get debug(){return this.#V}set debug(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#V=!!e}objectMap={execute:"Execute"};arrayMap={execute:"Execute"};get app_id(){return this.__ngioCore?this.__ngioCore.appID:null}get session_id(){return this.__ngioCore&&this.__ngioCore.session?this.__ngioCore.session.id:null}}void 0===NewgroundsIO.objects&&(NewgroundsIO.objects={}),NewgroundsIO.objects.Request=e})(),(()=>{class e extends NewgroundsIO.BaseObject{constructor(e){super();let t=this;if(this.__object="Response",["app_id","success","debug","result","error","api_version","help_url"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#J=null;get app_id(){return this.#J}set app_id(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#J=String(e)}#Ie=null;get success(){return this.#Ie}set success(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#Ie=!!e}#V=null;get debug(){return this.#V}set debug(e){null===(e=e instanceof NewgroundsIO.objects.Debug||"object"!=typeof e?e:new NewgroundsIO.objects.Debug(e))||e instanceof NewgroundsIO.objects.Debug||console.warn("Type Mismatch: expecting NewgroundsIO.objects.Debug, got ",e),this.#V=e}#xe=null;get result(){return this.#xe}set result(e){if(Array.isArray(e)){let t=[];return e.forEach((function(e,n){e instanceof NewgroundsIO.BaseResult||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be a NewgroundsIO.results.XXXX instance, got",e),t[n]=e})),void(this.#xe=t)}e instanceof NewgroundsIO.BaseResult||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be a NewgroundsIO.results.XXXX instance, got",e),this.#xe=e}#Oe=null;get error(){return this.#Oe}set error(e){null===(e=e instanceof NewgroundsIO.objects.Error||"object"!=typeof e?e:new NewgroundsIO.objects.Error(e))||e instanceof NewgroundsIO.objects.Error||console.warn("Type Mismatch: expecting NewgroundsIO.objects.Error, got ",e),this.#Oe=e}#Me=null;get api_version(){return this.#Me}set api_version(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Me=String(e)}#ke=null;get help_url(){return this.#ke}set help_url(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#ke=String(e)}objectMap={debug:"Debug",error:"Error"}}void 0===NewgroundsIO.objects&&(NewgroundsIO.objects={}),NewgroundsIO.objects.Response=e})(),(()=>{class e extends NewgroundsIO.BaseObject{constructor(e){super();let t=this;if(this.__object="SaveSlot",["id","size","datetime","timestamp","url"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Y=null;get id(){return this.#Y}set id(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#Y=Number(e),isNaN(this.#Y)&&(this.#Y=null)}#Ee=null;get size(){return this.#Ee}set size(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#Ee=Number(e),isNaN(this.#Ee)&&(this.#Ee=null)}#Ne=null;get datetime(){return this.#Ne}set datetime(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Ne=String(e)}#Te=null;get timestamp(){return this.#Te}set timestamp(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#Te=Number(e),isNaN(this.#Te)&&(this.#Te=null)}#Le=null;get url(){return this.#Le}set url(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Le=String(e)}get hasData(){return null!==this.url}getData(e,t){var n;"function"!=typeof e?debug.error("NewgroundsIO - Missing required callback function"):((n=new XMLHttpRequest).onreadystatechange=function(){4==n.readyState&&(t?e.call(t,n.responseText):e(n.responseText))},n.open("GET",this.url,!0),n.send())}setData(e,t,n){this.__ngioCore?(e=this.__ngioCore.getComponent("CloudSave.setData",{id:this.id,data:e}),this.__ngioCore.executeComponent(e,t,n)):console.error("NewgroundsIO - Can not save data without attaching a NewgroundsIO.Core instance.")}clearData(e,t){var n;this.__ngioCore?(this.#Le=null,n=this.__ngioCore.getComponent("CloudSave.clearSlot",{id:this.id}),this.__ngioCore.executeComponent(n,e,t)):console.error("NewgroundsIO - Can not clear data without attaching a NewgroundsIO.Core instance.")}getDate(){return this.hasData?new Date(this.datetime):null}}void 0===NewgroundsIO.objects&&(NewgroundsIO.objects={}),NewgroundsIO.objects.SaveSlot=e})(),(()=>{class e extends NewgroundsIO.BaseObject{constructor(e){super();let t=this;if(this.__object="Score",["user","value","formatted_value","tag"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#ie=null;get user(){return this.#ie}set user(e){null===(e=e instanceof NewgroundsIO.objects.User||"object"!=typeof e?e:new NewgroundsIO.objects.User(e))||e instanceof NewgroundsIO.objects.User||console.warn("Type Mismatch: expecting NewgroundsIO.objects.User, got ",e),this.#ie=e}#le=null;get value(){return this.#le}set value(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#le=Number(e),isNaN(this.#le)&&(this.#le=null)}#Ae=null;get formatted_value(){return this.#Ae}set formatted_value(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Ae=String(e)}#re=null;get tag(){return this.#re}set tag(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#re=String(e)}objectMap={user:"User"}}void 0===NewgroundsIO.objects&&(NewgroundsIO.objects={}),NewgroundsIO.objects.Score=e})(),(()=>{class e extends NewgroundsIO.BaseObject{constructor(e){super();let t=this;if(this.__object="ScoreBoard",["id","name"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Y=null;get id(){return this.#Y}set id(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#Y=Number(e),isNaN(this.#Y)&&(this.#Y=null)}#ve=null;get name(){return this.#ve}set name(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#ve=String(e)}getScores(e,t,n){this.__ngioCore?("function"==typeof e&&(n=t,t=e,e={}),(e=e||{}).id=this.id,e=this.__ngioCore.getComponent("ScoreBoard.getScores",e),this.__ngioCore.executeComponent(e,t,n)):console.error("NewgroundsIO - Can not get scores without attaching a NewgroundsIO.Core instance.")}postScore(e,t,n,r){this.__ngioCore?("function"==typeof t&&(r=n,n=t,t=null),e=this.__ngioCore.getComponent("ScoreBoard.postScore",{id:this.id,value:e,tag:t}),this.__ngioCore.executeComponent(e,n,r)):console.error("NewgroundsIO - Can not post scores without attaching a NewgroundsIO.Core instance.")}}void 0===NewgroundsIO.objects&&(NewgroundsIO.objects={}),NewgroundsIO.objects.ScoreBoard=e})(),(()=>{class e extends NewgroundsIO.BaseObject{constructor(e){super();let t=this;if(this.__object="Session",["id","user","expired","remember","passport_url"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Y=null;get id(){return this.#Y}set id(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Y=String(e)}#ie=null;get user(){return this.#ie}set user(e){null===(e=e instanceof NewgroundsIO.objects.User||"object"!=typeof e?e:new NewgroundsIO.objects.User(e))||e instanceof NewgroundsIO.objects.User||console.warn("Type Mismatch: expecting NewgroundsIO.objects.User, got ",e),this.#ie=e}#Re=null;get expired(){return this.#Re}set expired(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#Re=!!e}#De=null;get remember(){return this.#De}set remember(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#De=!!e}#Pe=null;get passport_url(){return this.#Pe}set passport_url(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Pe=String(e)}objectMap={user:"User"};#Fe=NewgroundsIO.SessionState.SESSION_UNINITIALIZED;#Be=null;#je=!1;#ze=new Date((new Date).getTime()-3e4);#Ve=!0;#Ue="expired";#He=0;#Ge=5;#qe=null;#We=null;get status(){return this.#Fe}get statusChanged(){return this.#je}get waiting(){return this.#Be!=this.status}get storageKey(){return this.__ngioCore?"_ngio_"+this.__ngioCore.appID+"_session_":null}resetSession(){this.#qe=null,this.#We=null,this.remember=!1,this.user=null,this.expired=!1,localStorage.setItem(this.storageKey,null)}openLoginPage(){this.passport_url?(this.#Fe=NewgroundsIO.SessionState.WAITING_FOR_USER,this.mode="check",window.open(this.passport_url,"_blank")):console.warn("Can't open passport without getting a valis session first.")}logOut(e,t){this.mode="wait",this.endSession(e,t)}cancelLogin(e){this.endSession(),void 0===e&&(e=NewgroundsIO.SessionState.LOGIN_CANCELLED),this.resetSession(),this.id=null,this.#Fe=e,this.#He=0,this.#Ue="new",this.#ze=new Date((new Date).getTime()-3e4)}update(e,t){if(this.#je=!1,this.#Be!=this.status&&(this.#je=!0,this.#Be=this.status,"function"==typeof e&&(t?e.call(t,this):e(this))),this.#Ve&&"wait"!=this.mode){if(!this.__ngioCore)return console.error("NewgroundsIO - Can't update session without attaching a NewgroundsIO.Core instance."),void(this.#Ve=!1);if(this.status==NewgroundsIO.SessionState.SERVER_UNAVAILABLE&&(this.#He>=this.#Ge?this.#Fe=NewgroundsIO.SessionState.EXCEEDED_MAX_ATTEMPTS:(this.#Fe=NewgroundsIO.SessionState.SESSION_UNINITIALIZED,this.#He++)),this.status==NewgroundsIO.SessionState.SESSION_UNINITIALIZED&&(this.#We=localStorage.getItem(this.storageKey),this.#qe?this.id=this.#qe:this.#We&&(this.id=this.#We),this.mode=this.id&&"null"!==this.id?"check":"new"),!((e=(t=new Date)-this.#ze)<5e3))switch(this.#ze=t,this.mode){case"new":this.mode="wait",this.startSession();break;case"check":this.mode="wait",this.checkSession()}}}startSession(){this.#Ve=!1,this.resetSession(),this.#Fe=NewgroundsIO.SessionState.WAITING_FOR_SERVER;var e=this.__ngioCore.getComponent("App.startSession");this.__ngioCore.executeComponent(e,this._onStartSession,this)}_onStartSession(e){if(!0===e.success){let t=e.result;if(Array.isArray(t))for(let e=0;e<t.length;e++)if(t[e]&&t[e].__object&&"App.startSession"==t[e].__object){t=t[e];break}this.id=t.session.id,this.passport_url=t.session.passport_url,this.#Fe=NewgroundsIO.SessionState.LOGIN_REQUIRED,this.mode="wait"}else this.#Fe=NewgroundsIO.SessionState.SERVER_UNAVAILABLE;this.#Ve=!0}checkSession(){this.#Ve=!1;var e=this.__ngioCore.getComponent("App.checkSession");this.__ngioCore.executeComponent(e,this._onCheckSession,this)}_onCheckSession(e){!0===e.success?e.result.success?e.result.session.expired?(this.resetSession(),this.id=null,this.#Fe=NewgroundsIO.SessionState.SESSION_UNINITIALIZED):null!==e.result.session.user?(this.user=e.result.session.user,this.#Fe=NewgroundsIO.SessionState.LOGIN_SUCCESSFUL,this.mode="valid",e.result.session.remember&&(this.#We=this.id,this.remember=!0,localStorage.setItem(this.storageKey,this.id))):this.mode="check":(this.id=null,this.cancelLogin(111===e.result.error.code?NewgroundsIO.SessionState.LOGIN_CANCELLED:NewgroundsIO.SessionState.LOGIN_FAILED)):this.#Fe=NewgroundsIO.SessionState.SERVER_UNAVAILABLE,this.#Ve=!0}endSession(e,t){this.#Ve=!1;var n=this.__ngioCore.getComponent("App.endSession"),r=this.__ngioCore.getComponent("App.startSession");this.__ngioCore.queueComponent(n),this.__ngioCore.queueComponent(r),this.__ngioCore.executeQueue((function(n){this._onEndSession(n),this._onStartSession(n),"function"==typeof e&&(t?e.call(t,this):e(this))}),this)}_onEndSession(e){this.resetSession(),this.id=null,this.user=null,this.passport_url=null,this.mode="new",this.#Fe=NewgroundsIO.SessionState.USER_LOGGED_OUT,this.#Ve=!0}}void 0===NewgroundsIO.objects&&(NewgroundsIO.objects={}),NewgroundsIO.objects.Session=e})(),(()=>{class e extends NewgroundsIO.BaseObject{constructor(e){super();let t=this;if(this.__object="User",["id","name","icons","supporter"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Y=null;get id(){return this.#Y}set id(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#Y=Number(e),isNaN(this.#Y)&&(this.#Y=null)}#ve=null;get name(){return this.#ve}set name(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#ve=String(e)}#Ke=null;get icons(){return this.#Ke}set icons(e){null===(e=e instanceof NewgroundsIO.objects.UserIcons||"object"!=typeof e?e:new NewgroundsIO.objects.UserIcons(e))||e instanceof NewgroundsIO.objects.UserIcons||console.warn("Type Mismatch: expecting NewgroundsIO.objects.UserIcons, got ",e),this.#Ke=e}#Xe=null;get supporter(){return this.#Xe}set supporter(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#Xe=!!e}objectMap={icons:"UserIcons"}}void 0===NewgroundsIO.objects&&(NewgroundsIO.objects={}),NewgroundsIO.objects.User=e})(),(()=>{class e extends NewgroundsIO.BaseObject{constructor(e){super();let t=this;if(this.__object="UserIcons",["small","medium","large"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Ye=null;get small(){return this.#Ye}set small(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Ye=String(e)}#Je=null;get medium(){return this.#Je}set medium(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Je=String(e)}#Qe=null;get large(){return this.#Qe}set large(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Qe=String(e)}}void 0===NewgroundsIO.objects&&(NewgroundsIO.objects={}),NewgroundsIO.objects.UserIcons=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="App.checkSession",["session"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#W=null;get session(){return this.#W}set session(e){null===(e=e instanceof NewgroundsIO.objects.Session||"object"!=typeof e?e:new NewgroundsIO.objects.Session(e))||e instanceof NewgroundsIO.objects.Session||console.warn("Type Mismatch: expecting NewgroundsIO.objects.Session, got ",e),this.#W=e}objectMap={session:"Session"}}void 0===NewgroundsIO.results.App&&(NewgroundsIO.results.App={}),NewgroundsIO.results.App.checkSession=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="App.getCurrentVersion",["current_version","client_deprecated"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Ze=null;get current_version(){return this.#Ze}set current_version(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Ze=String(e)}#$e=null;get client_deprecated(){return this.#$e}set client_deprecated(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#$e=!!e}}void 0===NewgroundsIO.results.App&&(NewgroundsIO.results.App={}),NewgroundsIO.results.App.getCurrentVersion=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="App.getHostLicense",["host_approved"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#et=null;get host_approved(){return this.#et}set host_approved(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#et=!!e}}void 0===NewgroundsIO.results.App&&(NewgroundsIO.results.App={}),NewgroundsIO.results.App.getHostLicense=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="App.startSession",["session"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#W=null;get session(){return this.#W}set session(e){null===(e=e instanceof NewgroundsIO.objects.Session||"object"!=typeof e?e:new NewgroundsIO.objects.Session(e))||e instanceof NewgroundsIO.objects.Session||console.warn("Type Mismatch: expecting NewgroundsIO.objects.Session, got ",e),this.#W=e}objectMap={session:"Session"}}void 0===NewgroundsIO.results.App&&(NewgroundsIO.results.App={}),NewgroundsIO.results.App.startSession=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="CloudSave.clearSlot",["slot"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#tt=null;get slot(){return this.#tt}set slot(e){null===(e=e instanceof NewgroundsIO.objects.SaveSlot||"object"!=typeof e?e:new NewgroundsIO.objects.SaveSlot(e))||e instanceof NewgroundsIO.objects.SaveSlot||console.warn("Type Mismatch: expecting NewgroundsIO.objects.SaveSlot, got ",e),this.#tt=e}objectMap={slot:"SaveSlot"}}void 0===NewgroundsIO.results.CloudSave&&(NewgroundsIO.results.CloudSave={}),NewgroundsIO.results.CloudSave.clearSlot=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="CloudSave.loadSlot",["slot","app_id"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#tt=null;get slot(){return this.#tt}set slot(e){null===(e=e instanceof NewgroundsIO.objects.SaveSlot||"object"!=typeof e?e:new NewgroundsIO.objects.SaveSlot(e))||e instanceof NewgroundsIO.objects.SaveSlot||console.warn("Type Mismatch: expecting NewgroundsIO.objects.SaveSlot, got ",e),this.#tt=e}#J=null;get app_id(){return this.#J}set app_id(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#J=String(e)}objectMap={slot:"SaveSlot"}}void 0===NewgroundsIO.results.CloudSave&&(NewgroundsIO.results.CloudSave={}),NewgroundsIO.results.CloudSave.loadSlot=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="CloudSave.loadSlots",["slots","app_id"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#nt=null;get slots(){return this.#nt}set slots(e){if(Array.isArray(e)){let t=[];e.forEach((function(e,n){null===e||e instanceof NewgroundsIO.objects.SaveSlot||console.warn("Type Mismatch: expecting NewgroundsIO.objects.SaveSlot, got ",e),t[n]=e})),this.#nt=t}}#J=null;get app_id(){return this.#J}set app_id(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#J=String(e)}arrayMap={slots:"SaveSlot"}}void 0===NewgroundsIO.results.CloudSave&&(NewgroundsIO.results.CloudSave={}),NewgroundsIO.results.CloudSave.loadSlots=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="CloudSave.setData",["slot"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#tt=null;get slot(){return this.#tt}set slot(e){null===(e=e instanceof NewgroundsIO.objects.SaveSlot||"object"!=typeof e?e:new NewgroundsIO.objects.SaveSlot(e))||e instanceof NewgroundsIO.objects.SaveSlot||console.warn("Type Mismatch: expecting NewgroundsIO.objects.SaveSlot, got ",e),this.#tt=e}objectMap={slot:"SaveSlot"}}void 0===NewgroundsIO.results.CloudSave&&(NewgroundsIO.results.CloudSave={}),NewgroundsIO.results.CloudSave.setData=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="Event.logEvent",["event_name"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Z=null;get event_name(){return this.#Z}set event_name(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Z=String(e)}}void 0===NewgroundsIO.results.Event&&(NewgroundsIO.results.Event={}),NewgroundsIO.results.Event.logEvent=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="Gateway.getDatetime",["datetime","timestamp"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Ne=null;get datetime(){return this.#Ne}set datetime(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Ne=String(e)}#Te=null;get timestamp(){return this.#Te}set timestamp(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#Te=Number(e),isNaN(this.#Te)&&(this.#Te=null)}}void 0===NewgroundsIO.results.Gateway&&(NewgroundsIO.results.Gateway={}),NewgroundsIO.results.Gateway.getDatetime=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="Gateway.getVersion",["version"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#C=null;get version(){return this.#C}set version(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#C=String(e)}}void 0===NewgroundsIO.results.Gateway&&(NewgroundsIO.results.Gateway={}),NewgroundsIO.results.Gateway.getVersion=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="Gateway.ping",["pong"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#rt=null;get pong(){return this.#rt}set pong(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#rt=String(e)}}void 0===NewgroundsIO.results.Gateway&&(NewgroundsIO.results.Gateway={}),NewgroundsIO.results.Gateway.ping=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="Loader.loadAuthorUrl",["url"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Le=null;get url(){return this.#Le}set url(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Le=String(e)}}void 0===NewgroundsIO.results.Loader&&(NewgroundsIO.results.Loader={}),NewgroundsIO.results.Loader.loadAuthorUrl=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="Loader.loadMoreGames",["url"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Le=null;get url(){return this.#Le}set url(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Le=String(e)}}void 0===NewgroundsIO.results.Loader&&(NewgroundsIO.results.Loader={}),NewgroundsIO.results.Loader.loadMoreGames=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="Loader.loadNewgrounds",["url"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Le=null;get url(){return this.#Le}set url(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Le=String(e)}}void 0===NewgroundsIO.results.Loader&&(NewgroundsIO.results.Loader={}),NewgroundsIO.results.Loader.loadNewgrounds=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="Loader.loadOfficialUrl",["url"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Le=null;get url(){return this.#Le}set url(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Le=String(e)}}void 0===NewgroundsIO.results.Loader&&(NewgroundsIO.results.Loader={}),NewgroundsIO.results.Loader.loadOfficialUrl=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="Loader.loadReferral",["url"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#Le=null;get url(){return this.#Le}set url(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#Le=String(e)}}void 0===NewgroundsIO.results.Loader&&(NewgroundsIO.results.Loader={}),NewgroundsIO.results.Loader.loadReferral=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="Medal.getList",["medals","app_id"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#r=null;get medals(){return this.#r}set medals(e){if(Array.isArray(e)){let t=[];e.forEach((function(e,n){null===e||e instanceof NewgroundsIO.objects.Medal||console.warn("Type Mismatch: expecting NewgroundsIO.objects.Medal, got ",e),t[n]=e})),this.#r=t}}#J=null;get app_id(){return this.#J}set app_id(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#J=String(e)}arrayMap={medals:"Medal"}}void 0===NewgroundsIO.results.Medal&&(NewgroundsIO.results.Medal={}),NewgroundsIO.results.Medal.getList=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="Medal.getMedalScore",["medal_score"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#ot=null;get medal_score(){return this.#ot}set medal_score(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#ot=Number(e),isNaN(this.#ot)&&(this.#ot=null)}}void 0===NewgroundsIO.results.Medal&&(NewgroundsIO.results.Medal={}),NewgroundsIO.results.Medal.getMedalScore=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="Medal.unlock",["medal","medal_score"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#it=null;get medal(){return this.#it}set medal(e){null===(e=e instanceof NewgroundsIO.objects.Medal||"object"!=typeof e?e:new NewgroundsIO.objects.Medal(e))||e instanceof NewgroundsIO.objects.Medal||console.warn("Type Mismatch: expecting NewgroundsIO.objects.Medal, got ",e),this.#it=e}#ot=null;get medal_score(){return this.#ot}set medal_score(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#ot=Number(e),isNaN(this.#ot)&&(this.#ot=null)}objectMap={medal:"Medal"}}void 0===NewgroundsIO.results.Medal&&(NewgroundsIO.results.Medal={}),NewgroundsIO.results.Medal.unlock=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="ScoreBoard.getBoards",["scoreboards"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#st=null;get scoreboards(){return this.#st}set scoreboards(e){if(Array.isArray(e)){let t=[];e.forEach((function(e,n){null===e||e instanceof NewgroundsIO.objects.ScoreBoard||console.warn("Type Mismatch: expecting NewgroundsIO.objects.ScoreBoard, got ",e),t[n]=e})),this.#st=t}}arrayMap={scoreboards:"ScoreBoard"}}void 0===NewgroundsIO.results.ScoreBoard&&(NewgroundsIO.results.ScoreBoard={}),NewgroundsIO.results.ScoreBoard.getBoards=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="ScoreBoard.getScores",["period","social","limit","scoreboard","scores","user","app_id"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#ne=null;get period(){return this.#ne}set period(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#ne=String(e)}#oe=null;get social(){return this.#oe}set social(e){"boolean"!=typeof e&&"number"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a boolean, got",e),this.#oe=!!e}#ae=null;get limit(){return this.#ae}set limit(e){"number"!=typeof e&&null!==e?console.warn("NewgroundsIO Type Mismatch: Value should be a number, got",e):Number.isInteger(e)||null===e||console.warn("NewgroundsIO Type Mismatch: Value should be an integer, got a float"),this.#ae=Number(e),isNaN(this.#ae)&&(this.#ae=null)}#at=null;get scoreboard(){return this.#at}set scoreboard(e){null===(e=e instanceof NewgroundsIO.objects.ScoreBoard||"object"!=typeof e?e:new NewgroundsIO.objects.ScoreBoard(e))||e instanceof NewgroundsIO.objects.ScoreBoard||console.warn("Type Mismatch: expecting NewgroundsIO.objects.ScoreBoard, got ",e),this.#at=e}#lt=null;get scores(){return this.#lt}set scores(e){if(Array.isArray(e)){let t=[];e.forEach((function(e,n){null===e||e instanceof NewgroundsIO.objects.Score||console.warn("Type Mismatch: expecting NewgroundsIO.objects.Score, got ",e),t[n]=e})),this.#lt=t}}#ie=null;get user(){return this.#ie}set user(e){null===(e=e instanceof NewgroundsIO.objects.User||"object"!=typeof e?e:new NewgroundsIO.objects.User(e))||e instanceof NewgroundsIO.objects.User||console.warn("Type Mismatch: expecting NewgroundsIO.objects.User, got ",e),this.#ie=e}#J=null;get app_id(){return this.#J}set app_id(e){"string"!=typeof e&&null!==e&&console.warn("NewgroundsIO Type Mismatch: Value should be a string, got",e),this.#J=String(e)}objectMap={scoreboard:"ScoreBoard",user:"User"};arrayMap={scores:"Score"}}void 0===NewgroundsIO.results.ScoreBoard&&(NewgroundsIO.results.ScoreBoard={}),NewgroundsIO.results.ScoreBoard.getScores=e})(),(()=>{class e extends NewgroundsIO.BaseResult{constructor(e){super();let t=this;if(this.__object="ScoreBoard.postScore",["scoreboard","score"].forEach((e=>{t.__properties.indexOf(e)<0&&t.__properties.push(e)})),e&&"object"==typeof e)for(var n=0;n<this.__properties.length;n++)void 0!==e[this.__properties[n]]&&(this[this.__properties[n]]=e[this.__properties[n]])}#at=null;get scoreboard(){return this.#at}set scoreboard(e){null===(e=e instanceof NewgroundsIO.objects.ScoreBoard||"object"!=typeof e?e:new NewgroundsIO.objects.ScoreBoard(e))||e instanceof NewgroundsIO.objects.ScoreBoard||console.warn("Type Mismatch: expecting NewgroundsIO.objects.ScoreBoard, got ",e),this.#at=e}#ct=null;get score(){return this.#ct}set score(e){null===(e=e instanceof NewgroundsIO.objects.Score||"object"!=typeof e?e:new NewgroundsIO.objects.Score(e))||e instanceof NewgroundsIO.objects.Score||console.warn("Type Mismatch: expecting NewgroundsIO.objects.Score, got ",e),this.#ct=e}objectMap={scoreboard:"ScoreBoard",score:"Score"}}void 0===NewgroundsIO.results.ScoreBoard&&(NewgroundsIO.results.ScoreBoard={}),NewgroundsIO.results.ScoreBoard.postScore=e})(),function(e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else{if("function"==typeof define&&define.amd)return define([],e);this.CodeMirror=e()}}((function(){"use strict";var e=/gecko\/\d/i.test(navigator.userAgent),t=/MSIE \d/.test(navigator.userAgent),n=t&&(null==document.documentMode||document.documentMode<8),r=t&&(null==document.documentMode||document.documentMode<9),o=t&&(null==document.documentMode||document.documentMode<10),i=/Trident\/([7-9]|\d{2,})\./.test(navigator.userAgent),s=t||i,a=/WebKit\//.test(navigator.userAgent),l=a&&/Qt\/\d+\.\d+/.test(navigator.userAgent),c=/Chrome\//.test(navigator.userAgent),u=/Opera\//.test(navigator.userAgent),d=/Apple Computer/.test(navigator.vendor),h=/KHTML\//.test(navigator.userAgent),p=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),f=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),g=/PhantomJS/.test(navigator.userAgent),m=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),v=m||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),y=m||/Mac/.test(navigator.platform),_=/win/i.test(navigator.platform),b=u&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);b&&(b=Number(b[1])),b&&b>=15&&(u=!1,a=!0);var w=y&&(l||u&&(null==b||b<12.11)),S=e||s&&!r,C=!1,I=!1;function x(e,n){if(!(this instanceof x))return new x(e,n);for(var o in this.options=n=n||{},In)n.hasOwnProperty(o)||(n[o]=In[o]);F(n);var i=n.value;"string"==typeof i&&(i=new Dr(i,n.mode)),this.doc=i;var a=this.display=new O(e,i);a.wrapper.CodeMirror=this,R(this),L(this),n.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),n.autofocus&&!v&&Et(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new Mo},t&&setTimeout(Bo(kt,this,!0),20),function(e){var n,o=e.display;po(o.scroller,"mousedown",ft(e,Rt)),po(o.scroller,"dblclick",t?ft(e,(function(t){if(!_o(e,t)){var n=At(e,t);if(n&&!Pt(e,t)&&!Lt(e.display,t)){io(t);var r=Cn(e.doc,n);be(e.doc,r.anchor,r.head)}}})):function(t){_o(e,t)||io(t)});po(o.lineSpace,"selectstart",(function(e){Lt(o,e)||io(e)})),S||po(o.scroller,"contextmenu",(function(t){tn(e,t)}));function i(){e.state.focused&&setTimeout(Bo(Et,e),0)}function a(){null==n&&(n=setTimeout((function(){n=null,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=Zo=null,e.setSize()}),100))}function l(){Jo(document.body,o.wrapper)?setTimeout(l,5e3):fo(window,"resize",a)}function c(t){_o(e,t)||lo(t)}po(o.scroller,"scroll",(function(){o.scroller.clientHeight&&(jt(e,o.scroller.scrollTop),zt(e,o.scroller.scrollLeft,!0),go(e,"scroll",e))})),po(o.scrollbarV,"scroll",(function(){o.scroller.clientHeight&&jt(e,o.scrollbarV.scrollTop)})),po(o.scrollbarH,"scroll",(function(){o.scroller.clientHeight&&zt(e,o.scrollbarH.scrollLeft)})),po(o.scroller,"mousewheel",(function(t){Gt(e,t)})),po(o.scroller,"DOMMouseScroll",(function(t){Gt(e,t)})),po(o.scrollbarH,"mousedown",i),po(o.scrollbarV,"mousedown",i),po(o.wrapper,"scroll",(function(){o.wrapper.scrollTop=o.wrapper.scrollLeft=0})),po(window,"resize",a),setTimeout(l,5e3),po(o.input,"keyup",ft(e,Qt)),po(o.input,"input",(function(){s&&!r&&e.display.inputHasSelection&&(e.display.inputHasSelection=null),Ot(e)})),po(o.input,"keydown",ft(e,Jt)),po(o.input,"keypress",ft(e,Zt)),po(o.input,"focus",Bo($t,e)),po(o.input,"blur",Bo(en,e)),e.options.dragDrop&&(po(o.scroller,"dragstart",(function(n){!function(e,n){if(t&&(!e.state.draggingText||+new Date-Ft<100))return void lo(n);if(_o(e,n)||Lt(e.display,n))return;if(n.dataTransfer.setData("Text",e.getSelection()),n.dataTransfer.setDragImage&&!d){var r=Ko("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",u&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),n.dataTransfer.setDragImage(r,0,0),u&&r.parentNode.removeChild(r)}}(e,n)})),po(o.scroller,"dragenter",c),po(o.scroller,"dragover",c),po(o.scroller,"drop",ft(e,Bt)));function p(t){o.inaccurateSelection&&(o.prevInput="",o.inaccurateSelection=!1,o.input.value=e.getSelection(),Ao(o.input)),"cut"==t.type&&(e.state.cutIncoming=!0)}po(o.scroller,"paste",(function(t){Lt(o,t)||(e.state.pasteIncoming=!0,Et(e),Ot(e))})),po(o.input,"paste",(function(){e.state.pasteIncoming=!0,Ot(e)})),po(o.input,"cut",p),po(o.input,"copy",p),h&&po(o.sizer,"mouseup",(function(){Qo()==o.input&&o.input.blur(),Et(e)}))}(this);var l=this;pt(this,(function(){for(var e in l.curOp.forceUpdate=!0,jr(l,i),n.autofocus&&!v||Qo()==a.input?setTimeout(Bo($t,l),20):en(l),xn)xn.hasOwnProperty(e)&&xn[e](l,n[e],Mn);for(var t=0;t<Tn.length;++t)Tn[t](l)}))}function O(e,t){var r=this,o=r.input=Ko("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none");a?o.style.width="1000px":o.setAttribute("wrap","off"),m&&(o.style.border="1px solid black"),o.setAttribute("autocorrect","off"),o.setAttribute("autocapitalize","off"),o.setAttribute("spellcheck","false"),r.inputDiv=Ko("div",[o],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),r.scrollbarH=Ko("div",[Ko("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar"),r.scrollbarV=Ko("div",[Ko("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),r.scrollbarFiller=Ko("div",null,"CodeMirror-scrollbar-filler"),r.gutterFiller=Ko("div",null,"CodeMirror-gutter-filler"),r.lineDiv=Ko("div",null,"CodeMirror-code"),r.selectionDiv=Ko("div",null,null,"position: relative; z-index: 1"),r.cursorDiv=Ko("div",null,"CodeMirror-cursors"),r.measure=Ko("div",null,"CodeMirror-measure"),r.lineMeasure=Ko("div",null,"CodeMirror-measure"),r.lineSpace=Ko("div",[r.measure,r.lineMeasure,r.selectionDiv,r.cursorDiv,r.lineDiv],null,"position: relative; outline: none"),r.mover=Ko("div",[Ko("div",[r.lineSpace],"CodeMirror-lines")],null,"position: relative"),r.sizer=Ko("div",[r.mover],"CodeMirror-sizer"),r.heightForcer=Ko("div",null,null,"position: absolute; height: "+So+"px; width: 1px;"),r.gutters=Ko("div",null,"CodeMirror-gutters"),r.lineGutter=null,r.scroller=Ko("div",[r.sizer,r.heightForcer,r.gutters],"CodeMirror-scroll"),r.scroller.setAttribute("tabIndex","-1"),r.wrapper=Ko("div",[r.inputDiv,r.scrollbarH,r.scrollbarV,r.scrollbarFiller,r.gutterFiller,r.scroller],"CodeMirror"),n&&(r.gutters.style.zIndex=-1,r.scroller.style.paddingRight=0),m&&(o.style.width="0px"),a||(r.scroller.draggable=!0),h&&(r.inputDiv.style.height="1px",r.inputDiv.style.position="absolute"),n&&(r.scrollbarH.style.minHeight=r.scrollbarV.style.minWidth="18px"),e.appendChild?e.appendChild(r.wrapper):e(r.wrapper),r.viewFrom=r.viewTo=t.first,r.view=[],r.externalMeasured=null,r.viewOffset=0,r.lastSizeC=0,r.updateLineNumbers=null,r.lineNumWidth=r.lineNumInnerWidth=r.lineNumChars=null,r.prevInput="",r.alignWidgets=!1,r.pollingFast=!1,r.poll=new Mo,r.cachedCharWidth=r.cachedTextHeight=r.cachedPaddingH=null,r.inaccurateSelection=!1,r.maxLine=null,r.maxLineLength=0,r.maxLineChanged=!1,r.wheelDX=r.wheelDY=r.wheelStartX=r.wheelStartY=null,r.shift=!1}function M(e){e.doc.mode=x.getMode(e.options,e.doc.modeOption),k(e)}function k(e){e.doc.iter((function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)})),e.doc.frontier=e.doc.first,De(e,100),e.state.modeGen++,e.curOp&&_t(e)}function E(e){var t=st(e.display),n=e.options.lineWrapping,r=n&&Math.max(5,e.display.scroller.clientWidth/at(e.display)-3);return function(o){if(ur(e.doc,o))return 0;var i=0;if(o.widgets)for(var s=0;s<o.widgets.length;s++)o.widgets[s].height&&(i+=o.widgets[s].height);return n?i+(Math.ceil(o.text.length/r)||1)*t:i+t}}function N(e){var t=e.doc,n=E(e);t.iter((function(e){var t=n(e);t!=e.height&&Hr(e,t)}))}function T(e){var t=Pn[e.options.keyMap].style;e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(t?" cm-keymap-"+t:"")}function L(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Ye(e)}function A(e){R(e),_t(e),setTimeout((function(){V(e)}),20)}function R(e){var t=e.display.gutters,n=e.options.gutters;Xo(t);for(var r=0;r<n.length;++r){var o=n[r],i=t.appendChild(Ko("div",null,"CodeMirror-gutter "+o));"CodeMirror-linenumbers"==o&&(e.display.lineGutter=i,i.style.width=(e.display.lineNumWidth||1)+"px")}t.style.display=r?"":"none";var s=t.offsetWidth;e.display.sizer.style.marginLeft=s+"px",r&&(e.display.scrollbarH.style.left=e.options.fixedGutter?s+"px":0)}function D(e){if(0==e.height)return 0;for(var t,n=e.text.length,r=e;t=or(r);){r=(o=t.find(0,!0)).from.line,n+=o.from.ch-o.to.ch}for(r=e;t=ir(r);){var o=t.find(0,!0);n-=r.text.length-o.from.ch,n+=(r=o.to.line).text.length-o.to.ch}return n}function P(e){var t=e.display,n=e.doc;t.maxLine=zr(n,n.first),t.maxLineLength=D(t.maxLine),t.maxLineChanged=!0,n.iter((function(e){var n=D(e);n>t.maxLineLength&&(t.maxLineLength=n,t.maxLine=e)}))}function F(e){var t=Ro(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}function B(e){var t=e.display.scroller;return{clientHeight:t.clientHeight,barHeight:e.display.scrollbarV.clientHeight,scrollWidth:t.scrollWidth,clientWidth:t.clientWidth,barWidth:e.display.scrollbarH.clientWidth,docHeight:Math.round(e.doc.height+je(e.display))}}function j(e,t){t||(t=B(e));var n=e.display,r=t.docHeight+So,o=t.scrollWidth>t.clientWidth,i=r>t.clientHeight;if(i?(n.scrollbarV.style.display="block",n.scrollbarV.style.bottom=o?ni(n.measure)+"px":"0",n.scrollbarV.firstChild.style.height=Math.max(0,r-t.clientHeight+(t.barHeight||n.scrollbarV.clientHeight))+"px"):(n.scrollbarV.style.display="",n.scrollbarV.firstChild.style.height="0"),o?(n.scrollbarH.style.display="block",n.scrollbarH.style.right=i?ni(n.measure)+"px":"0",n.scrollbarH.firstChild.style.width=t.scrollWidth-t.clientWidth+(t.barWidth||n.scrollbarH.clientWidth)+"px"):(n.scrollbarH.style.display="",n.scrollbarH.firstChild.style.width="0"),o&&i?(n.scrollbarFiller.style.display="block",n.scrollbarFiller.style.height=n.scrollbarFiller.style.width=ni(n.measure)+"px"):n.scrollbarFiller.style.display="",o&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(n.gutterFiller.style.display="block",n.gutterFiller.style.height=ni(n.measure)+"px",n.gutterFiller.style.width=n.gutters.offsetWidth+"px"):n.gutterFiller.style.display="",p&&0===ni(n.measure)){n.scrollbarV.style.minWidth=n.scrollbarH.style.minHeight=f?"18px":"12px";var s=function(t){co(t)!=n.scrollbarV&&co(t)!=n.scrollbarH&&ft(e,Rt)(t)};po(n.scrollbarV,"mousedown",s),po(n.scrollbarH,"mousedown",s)}}function z(e,t,n){var r=n&&null!=n.top?n.top:e.scroller.scrollTop;r=Math.floor(r-Be(e));var o=n&&null!=n.bottom?n.bottom:r+e.wrapper.clientHeight,i=qr(t,r),s=qr(t,o);if(n&&n.ensure){var a=n.ensure.from.line,l=n.ensure.to.line;if(a<i)return{from:a,to:qr(t,Wr(zr(t,a))+e.wrapper.clientHeight)};if(Math.min(l,t.lastLine())>=s)return{from:qr(t,Wr(zr(t,l))-e.wrapper.clientHeight),to:l}}return{from:i,to:s}}function V(e){var t=e.display,n=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var r=H(t)-t.scroller.scrollLeft+e.doc.scrollLeft,o=t.gutters.offsetWidth,i=r+"px",s=0;s<n.length;s++)if(!n[s].hidden){e.options.fixedGutter&&n[s].gutter&&(n[s].gutter.style.left=i);var a=n[s].alignable;if(a)for(var l=0;l<a.length;l++)a[l].style.left=i}e.options.fixedGutter&&(t.gutters.style.left=r+o+"px")}}function U(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function H(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function G(e,t,n){for(var r,o=e.display.viewFrom,i=e.display.viewTo,s=z(e.display,e.doc,t),a=!0;;a=!1){var l=e.display.scroller.clientWidth;if(!q(e,s,n))break;r=!0,e.display.maxLineChanged&&!e.options.lineWrapping&&W(e);var c=B(e);if(Te(e),K(e,c),j(e,c),a&&e.options.lineWrapping&&l!=e.display.scroller.clientWidth)n=!0;else if(n=!1,t&&null!=t.top&&(t={top:Math.min(c.docHeight-So-c.clientHeight,t.top)}),(s=z(e.display,e.doc,t)).from>=e.display.viewFrom&&s.to<=e.display.viewTo)break}return e.display.updateLineNumbers=null,r&&(vo(e,"update",e),e.display.viewFrom==o&&e.display.viewTo==i||vo(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo)),r}function q(e,t,r){var o=e.display,i=e.doc;if(o.wrapper.offsetWidth){if(!(!r&&t.from>=o.viewFrom&&t.to<=o.viewTo&&0==It(e))){(function(e){if(!e.options.lineNumbers)return!1;var t=e.doc,n=U(e.options,t.first+t.size-1),r=e.display;if(n.length!=r.lineNumChars){var o=r.measure.appendChild(Ko("div",[Ko("div",n)],"CodeMirror-linenumber CodeMirror-gutter-elt")),i=o.firstChild.offsetWidth,s=o.offsetWidth-i;r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(i,r.lineGutter.offsetWidth-s),r.lineNumWidth=r.lineNumInnerWidth+s,r.lineNumChars=r.lineNumInnerWidth?n.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px";var a=r.gutters.offsetWidth;return r.scrollbarH.style.left=e.options.fixedGutter?a+"px":0,r.sizer.style.marginLeft=a+"px",!0}return!1})(e)&&wt(e);var s=Y(e),l=i.first+i.size,c=Math.max(t.from-e.options.viewportMargin,i.first),u=Math.min(l,t.to+e.options.viewportMargin);o.viewFrom<c&&c-o.viewFrom<20&&(c=Math.max(i.first,o.viewFrom)),o.viewTo>u&&o.viewTo-u<20&&(u=Math.min(l,o.viewTo)),I&&(c=lr(e.doc,c),u=cr(e.doc,u));var d=c!=o.viewFrom||u!=o.viewTo||o.lastSizeC!=o.wrapper.clientHeight;!function(e,t,n){var r=e.display;0==r.view.length||t>=r.viewTo||n<=r.viewFrom?(r.view=yt(e,t,n),r.viewFrom=t):(r.viewFrom>t?r.view=yt(e,t,r.viewFrom).concat(r.view):r.viewFrom<t&&(r.view=r.view.slice(St(e,t))),r.viewFrom=t,r.viewTo<n?r.view=r.view.concat(yt(e,r.viewTo,n)):r.viewTo>n&&(r.view=r.view.slice(0,St(e,n))));r.viewTo=n}(e,c,u),o.viewOffset=Wr(zr(e.doc,o.viewFrom)),e.display.mover.style.top=o.viewOffset+"px";var h=It(e);if(d||0!=h||r){var p=Qo();return h>4&&(o.lineDiv.style.display="none"),function(e,t,n){var r=e.display,o=e.options.lineNumbers,i=r.lineDiv,s=i.firstChild;function l(t){var n=t.nextSibling;return a&&y&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),n}for(var c=r.view,u=r.viewFrom,d=0;d<c.length;d++){var h=c[d];if(h.hidden);else if(h.node){for(;s!=h.node;)s=l(s);var p=o&&null!=t&&t<=u&&h.lineNumber;h.changes&&(Ro(h.changes,"gutter")>-1&&(p=!1),J(e,h,u,n)),p&&(Xo(h.lineNumber),h.lineNumber.appendChild(document.createTextNode(U(e.options,u)))),s=h.node.nextSibling}else{var f=re(e,h,u,n);i.insertBefore(f,s)}u+=h.size}for(;s;)s=l(s)}(e,o.updateLineNumbers,s),h>4&&(o.lineDiv.style.display=""),p&&Qo()!=p&&p.offsetHeight&&p.focus(),Xo(o.cursorDiv),Xo(o.selectionDiv),d&&(o.lastSizeC=o.wrapper.clientHeight,De(e,400)),function(e){for(var t=e.display,r=t.lineDiv.offsetTop,o=0;o<t.view.length;o++){var i,s=t.view[o];if(!s.hidden){if(n){var a=s.node.offsetTop+s.node.offsetHeight;i=a-r,r=a}else{var l=s.node.getBoundingClientRect();i=l.bottom-l.top}var c=s.line.height-i;if(i<2&&(i=st(t)),(c>.001||c<-.001)&&(Hr(s.line,i),X(s.line),s.rest))for(var u=0;u<s.rest.length;u++)X(s.rest[u])}}}(e),!0}}}else wt(e)}function W(e){var t=e.display,n=Ve(e,t.maxLine,t.maxLine.text.length).left;t.maxLineChanged=!1;var r=Math.max(0,n+3),o=Math.max(0,t.sizer.offsetLeft+r+So-t.scroller.clientWidth);t.sizer.style.minWidth=r+"px",o<e.doc.scrollLeft&&zt(e,Math.min(t.scroller.scrollLeft,o),!0)}function K(e,t){e.display.sizer.style.minHeight=e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=Math.max(t.docHeight,t.clientHeight-So)+"px"}function X(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.offsetHeight}function Y(e){for(var t=e.display,n={},r={},o=t.gutters.firstChild,i=0;o;o=o.nextSibling,++i)n[e.options.gutters[i]]=o.offsetLeft,r[e.options.gutters[i]]=o.offsetWidth;return{fixedPos:H(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:n,gutterWidth:r,wrapperWidth:t.wrapper.clientWidth}}function J(e,t,n,r){for(var o=0;o<t.changes.length;o++){var i=t.changes[o];"text"==i?$(e,t):"gutter"==i?te(e,t,n,r):"class"==i?ee(t):"widget"==i&&ne(t,r)}t.changes=null}function Q(e){return e.node==e.text&&(e.node=Ko("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),n&&(e.node.style.zIndex=2)),e.node}function Z(e,t){var n=e.display.externalMeasured;return n&&n.line==t.line?(e.display.externalMeasured=null,t.measure=n.measure,n.built):Ir(e,t)}function $(e,t){var n=t.text.className,r=Z(e,t);t.text==t.node&&(t.node=r.pre),t.text.parentNode.replaceChild(r.pre,t.text),t.text=r.pre,r.bgClass!=t.bgClass||r.textClass!=t.textClass?(t.bgClass=r.bgClass,t.textClass=r.textClass,ee(t)):n&&(t.text.className=n)}function ee(e){!function(e){var t=e.bgClass?e.bgClass+" "+(e.line.bgClass||""):e.line.bgClass;if(t&&(t+=" CodeMirror-linebackground"),e.background)t?e.background.className=t:(e.background.parentNode.removeChild(e.background),e.background=null);else if(t){var n=Q(e);e.background=n.insertBefore(Ko("div",null,t),n.firstChild)}}(e),e.line.wrapClass?Q(e).className=e.line.wrapClass:e.node!=e.text&&(e.node.className="");var t=e.textClass?e.textClass+" "+(e.line.textClass||""):e.line.textClass;e.text.className=t||""}function te(e,t,n,r){t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null);var o=t.line.gutterMarkers;if(e.options.lineNumbers||o){var i=Q(t),s=t.gutter=i.insertBefore(Ko("div",null,"CodeMirror-gutter-wrapper","position: absolute; left: "+(e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px"),t.text);if(!e.options.lineNumbers||o&&o["CodeMirror-linenumbers"]||(t.lineNumber=s.appendChild(Ko("div",U(e.options,n),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),o)for(var a=0;a<e.options.gutters.length;++a){var l=e.options.gutters[a],c=o.hasOwnProperty(l)&&o[l];c&&s.appendChild(Ko("div",[c],"CodeMirror-gutter-elt","left: "+r.gutterLeft[l]+"px; width: "+r.gutterWidth[l]+"px"))}}}function ne(e,t){e.alignable&&(e.alignable=null);for(var n=e.node.firstChild;n;n=r){var r=n.nextSibling;"CodeMirror-linewidget"==n.className&&e.node.removeChild(n)}oe(e,t)}function re(e,t,n,r){var o=Z(e,t);return t.text=t.node=o.pre,o.bgClass&&(t.bgClass=o.bgClass),o.textClass&&(t.textClass=o.textClass),ee(t),te(e,t,n,r),oe(t,r),t.node}function oe(e,t){if(ie(e.line,e,t,!0),e.rest)for(var n=0;n<e.rest.length;n++)ie(e.rest[n],e,t,!1)}function ie(e,t,n,r){if(e.widgets)for(var o=Q(t),i=0,s=e.widgets;i<s.length;++i){var a=s[i],l=Ko("div",[a.node],"CodeMirror-linewidget");a.handleMouseEvents||(l.ignoreEvents=!0),se(a,l,t,n),r&&a.above?o.insertBefore(l,t.gutter||t.text):o.appendChild(l),vo(a,"redraw")}}function se(e,t,n,r){if(e.noHScroll){(n.alignable||(n.alignable=[])).push(t);var o=r.wrapperWidth;t.style.left=r.fixedPos+"px",e.coverGutter||(o-=r.gutterTotalWidth,t.style.paddingLeft=r.gutterTotalWidth+"px"),t.style.width=o+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-r.gutterTotalWidth+"px"))}var ae=x.Pos=function(e,t){if(!(this instanceof ae))return new ae(e,t);this.line=e,this.ch=t},le=x.cmpPos=function(e,t){return e.line-t.line||e.ch-t.ch};function ce(e){return ae(e.line,e.ch)}function ue(e,t){return le(e,t)<0?t:e}function de(e,t){return le(e,t)<0?e:t}function he(e,t){this.ranges=e,this.primIndex=t}function pe(e,t){this.anchor=e,this.head=t}function fe(e,t){var n=e[t];e.sort((function(e,t){return le(e.from(),t.from())})),t=Ro(e,n);for(var r=1;r<e.length;r++){var o=e[r],i=e[r-1];if(le(i.to(),o.from())>=0){var s=de(i.from(),o.from()),a=ue(i.to(),o.to()),l=i.empty()?o.from()==o.head:i.from()==i.head;r<=t&&--t,e.splice(--r,2,new pe(l?a:s,l?s:a))}}return new he(e,t)}function ge(e,t){return new he([new pe(e,t||e)],0)}function me(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function ve(e,t){if(t.line<e.first)return ae(e.first,0);var n=e.first+e.size-1;return t.line>n?ae(n,zr(e,n).text.length):function(e,t){var n=e.ch;return null==n||n>t?ae(e.line,t):n<0?ae(e.line,0):e}(t,zr(e,t.line).text.length)}function ye(e,t){return t>=e.first&&t<e.first+e.size}function _e(e,t,n,r){if(e.cm&&e.cm.display.shift||e.extend){var o=t.anchor;if(r){var i=le(n,o)<0;i!=le(r,o)<0?(o=n,n=r):i!=le(n,r)<0&&(n=r)}return new pe(o,n)}return new pe(r||n,n)}function be(e,t,n,r){xe(e,new he([_e(e,e.sel.primary(),t,n)],0),r)}function we(e,t,n){for(var r=[],o=0;o<e.sel.ranges.length;o++)r[o]=_e(e,e.sel.ranges[o],t[o],null);xe(e,fe(r,e.sel.primIndex),n)}function Se(e,t,n,r){var o=e.sel.ranges.slice(0);o[t]=n,xe(e,fe(o,e.sel.primIndex),r)}function Ce(e,t,n,r){xe(e,ge(t,n),r)}function Ie(e,t,n){var r=e.history.done,o=Lo(r);o&&o.ranges?(r[r.length-1]=t,Oe(e,t,n)):xe(e,t,n)}function xe(e,t,n){Oe(e,t,n),function(e,t,n,r){var o=e.history,i=r&&r.origin;n==o.lastOp||i&&o.lastSelOrigin==i&&(o.lastModTime==o.lastSelTime&&o.lastOrigin==i||function(e,t,n,r){var o=t.charAt(0);return"*"==o||"+"==o&&n.ranges.length==r.ranges.length&&n.somethingSelected()==r.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}(e,i,Lo(o.done),t))?o.done[o.done.length-1]=t:Zr(t,o.done);o.lastSelTime=+new Date,o.lastSelOrigin=i,o.lastOp=n,r&&!1!==r.clearRedo&&Jr(o.undone)}(e,e.sel,e.cm?e.cm.curOp.id:NaN,n)}function Oe(e,t,n){(bo(e,"beforeSelectionChange")||e.cm&&bo(e.cm,"beforeSelectionChange"))&&(t=function(e,t){var n={ranges:t.ranges,update:function(t){this.ranges=[];for(var n=0;n<t.length;n++)this.ranges[n]=new pe(ve(e,t[n].anchor),ve(e,t[n].head))}};return go(e,"beforeSelectionChange",e,n),e.cm&&go(e.cm,"beforeSelectionChange",e.cm,n),n.ranges!=t.ranges?fe(n.ranges,n.ranges.length-1):t}(e,t));var r=le(t.primary().head,e.sel.primary().head)<0?-1:1;Me(e,Ee(e,t,r,!0)),n&&!1===n.scroll||!e.cm||mn(e.cm)}function Me(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=e.cm.curOp.cursorActivity=!0),vo(e,"cursorActivity",e))}function ke(e){Me(e,Ee(e,e.sel,null,!1))}function Ee(e,t,n,r){for(var o,i=0;i<t.ranges.length;i++){var s=t.ranges[i],a=Ne(e,s.anchor,n,r),l=Ne(e,s.head,n,r);(o||a!=s.anchor||l!=s.head)&&(o||(o=t.ranges.slice(0,i)),o[i]=new pe(a,l))}return o?fe(o,t.primIndex):t}function Ne(e,t,n,r){var o=!1,i=t,s=n||1;e.cantEdit=!1;e:for(;;){var a=zr(e,i.line);if(a.markedSpans)for(var l=0;l<a.markedSpans.length;++l){var c=a.markedSpans[l],u=c.marker;if((null==c.from||(u.inclusiveLeft?c.from<=i.ch:c.from<i.ch))&&(null==c.to||(u.inclusiveRight?c.to>=i.ch:c.to>i.ch))){if(r&&(go(u,"beforeCursorEnter"),u.explicitlyCleared)){if(a.markedSpans){--l;continue}break}if(!u.atomic)continue;var d=u.find(s<0?-1:1);if(0==le(d,i)&&(d.ch+=s,d.ch<0?d=d.line>e.first?ve(e,ae(d.line-1)):null:d.ch>a.text.length&&(d=d.line<e.first+e.size-1?ae(d.line+1,0):null),!d)){if(o)return r?(e.cantEdit=!0,ae(e.first,0)):Ne(e,t,n,!0);o=!0,d=t,s=-s}i=d;continue e}}return i}}function Te(e){for(var t=e.display,n=e.doc,r=document.createDocumentFragment(),o=document.createDocumentFragment(),i=0;i<n.sel.ranges.length;i++){var s=n.sel.ranges[i],a=s.empty();(a||e.options.showCursorWhenSelecting)&&Le(e,s,r),a||Ae(e,s,o)}if(e.options.moveInputWithCursor){var l=tt(e,n.sel.primary().head,"div"),c=t.wrapper.getBoundingClientRect(),u=t.lineDiv.getBoundingClientRect(),d=Math.max(0,Math.min(t.wrapper.clientHeight-10,l.top+u.top-c.top)),h=Math.max(0,Math.min(t.wrapper.clientWidth-10,l.left+u.left-c.left));t.inputDiv.style.top=d+"px",t.inputDiv.style.left=h+"px"}Yo(t.cursorDiv,r),Yo(t.selectionDiv,o)}function Le(e,t,n){var r=tt(e,t.head,"div"),o=n.appendChild(Ko("div"," ","CodeMirror-cursor"));if(o.style.left=r.left+"px",o.style.top=r.top+"px",o.style.height=Math.max(0,r.bottom-r.top)*e.options.cursorHeight+"px",r.other){var i=n.appendChild(Ko("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));i.style.display="",i.style.left=r.other.left+"px",i.style.top=r.other.top+"px",i.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function Ae(e,t,n){var r=e.display,o=e.doc,i=document.createDocumentFragment(),s=ze(e.display),a=s.left,l=r.lineSpace.offsetWidth-s.right;function c(e,t,n,r){t<0&&(t=0),i.appendChild(Ko("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px; top: "+t+"px; width: "+(null==n?l-e:n)+"px; height: "+(r-t)+"px"))}function u(t,n,r){var i,s,u=zr(o,t),d=u.text.length;function h(n,r){return et(e,ae(t,n),"div",u,r)}return function(e,t,n,r){if(!e)return r(t,n,"ltr");for(var o=!1,i=0;i<e.length;++i){var s=e[i];(s.from<n&&s.to>t||t==n&&s.to==t)&&(r(Math.max(s.from,t),Math.min(s.to,n),1==s.level?"rtl":"ltr"),o=!0)}o||r(t,n,"ltr")}(Kr(u),n||0,null==r?d:r,(function(e,t,o){var u,p,f,g=h(e,"left");if(e==t)u=g,p=f=g.left;else{if(u=h(t-1,"right"),"rtl"==o){var m=g;g=u,u=m}p=g.left,f=u.right}null==n&&0==e&&(p=a),u.top-g.top>3&&(c(p,g.top,null,g.bottom),p=a,g.bottom<u.top&&c(p,g.bottom,null,u.top)),null==r&&t==d&&(f=l),(!i||g.top<i.top||g.top==i.top&&g.left<i.left)&&(i=g),(!s||u.bottom>s.bottom||u.bottom==s.bottom&&u.right>s.right)&&(s=u),p<a+1&&(p=a),c(p,u.top,f-p,u.bottom)})),{start:i,end:s}}var d=t.from(),h=t.to();if(d.line==h.line)u(d.line,d.ch,h.ch);else{var p=zr(o,d.line),f=zr(o,h.line),g=ar(p)==ar(f),m=u(d.line,d.ch,g?p.text.length+1:null).end,v=u(h.line,g?0:null,h.ch).start;g&&(m.top<v.top-2?(c(m.right,m.top,null,m.bottom),c(a,v.top,v.left,v.bottom)):c(m.right,m.top,v.left-m.right,m.bottom)),m.bottom<v.top&&c(a,m.bottom,null,v.top)}n.appendChild(i)}function Re(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var n=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0&&(t.blinker=setInterval((function(){t.cursorDiv.style.visibility=(n=!n)?"":"hidden"}),e.options.cursorBlinkRate))}}function De(e,t){e.doc.mode.startState&&e.doc.frontier<e.display.viewTo&&e.state.highlight.set(t,Bo(Pe,e))}function Pe(e){var t=e.doc;if(t.frontier<t.first&&(t.frontier=t.first),!(t.frontier>=e.display.viewTo)){var n=+new Date+e.options.workTime,r=An(t.mode,Fe(e,t.frontier));pt(e,(function(){t.iter(t.frontier,Math.min(t.first+t.size,e.display.viewTo+500),(function(o){if(t.frontier>=e.display.viewFrom){var i=o.styles;o.styles=yr(e,o,r,!0);for(var s=!i||i.length!=o.styles.length,a=0;!s&&a<i.length;++a)s=i[a]!=o.styles[a];s&&bt(e,t.frontier,"text"),o.stateAfter=An(t.mode,r)}else br(e,o.text,r),o.stateAfter=t.frontier%5==0?An(t.mode,r):null;if(++t.frontier,+new Date>n)return De(e,e.options.workDelay),!0}))}))}}function Fe(e,t,n){var r=e.doc,o=e.display;if(!r.mode.startState)return!0;var i=function(e,t,n){for(var r,o,i=e.doc,s=n?-1:t-(e.doc.mode.innerMode?1e3:100),a=t;a>s;--a){if(a<=i.first)return i.first;var l=zr(i,a-1);if(l.stateAfter&&(!n||a<=i.frontier))return a;var c=ko(l.text,null,e.options.tabSize);(null==o||r>c)&&(o=a-1,r=c)}return o}(e,t,n),s=i>r.first&&zr(r,i-1).stateAfter;return s=s?An(r.mode,s):Rn(r.mode),r.iter(i,t,(function(n){br(e,n.text,s);var a=i==t-1||i%5==0||i>=o.viewFrom&&i<o.viewTo;n.stateAfter=a?An(r.mode,s):null,++i})),n&&(r.frontier=i),s}function Be(e){return e.lineSpace.offsetTop}function je(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function ze(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=Yo(e.measure,Ko("pre","x")),n=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle;return e.cachedPaddingH={left:parseInt(n.paddingLeft),right:parseInt(n.paddingRight)}}function Ve(e,t,n,r){return Ge(e,He(e,t),n,r)}function Ue(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[St(e,t)];var n=e.display.externalMeasured;return n&&t>=n.lineN&&t<n.lineN+n.size?n:void 0}function He(e,t){var n=Gr(t),r=Ue(e,n);r&&!r.text?r=null:r&&r.changes&&J(e,r,n,Y(e)),r||(r=function(e,t){var n=Gr(t=ar(t)),r=e.display.externalMeasured=new vt(e.doc,t,n);r.lineN=n;var o=r.built=Ir(e,r);return r.text=o.pre,Yo(e.display.lineMeasure,o.pre),r}(e,t));var o=function(e,t,n){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var r=0;r<e.rest.length;r++)if(e.rest[r]==t)return{map:e.measure.maps[r],cache:e.measure.caches[r]};for(r=0;r<e.rest.length;r++)if(Gr(e.rest[r])>n)return{map:e.measure.maps[r],cache:e.measure.caches[r],before:!0}}(r,t,n);return{line:t,view:r,rect:null,map:o.map,cache:o.cache,before:o.before,hasHeights:!1}}function Ge(e,t,n,o){t.before&&(n=-1);var i,a=n+(o||"");return t.cache.hasOwnProperty(a)?i=t.cache[a]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(!function(e,t,n){var r=e.options.lineWrapping,o=r&&e.display.scroller.clientWidth;if(!t.measure.heights||r&&t.measure.width!=o){var i=t.measure.heights=[];if(r){t.measure.width=o;for(var s=t.text.firstChild.getClientRects(),a=0;a<s.length-1;a++){var l=s[a],c=s[a+1];Math.abs(l.bottom-c.bottom)>2&&i.push((l.bottom+c.top)/2-n.top)}}i.push(n.bottom-n.top)}}(e,t.view,t.rect),t.hasHeights=!0),i=function(e,t,n,o){for(var i,a,l,c,u,d=t.map,h=0;h<d.length;h+=3){var p=d[h],f=d[h+1];if(n<p?(a=0,l=1,c="left"):n<f?l=(a=n-p)+1:(h==d.length-3||n==f&&d[h+3]>n)&&(a=(l=f-p)-1,n>=f&&(c="right")),null!=a){if(i=d[h+2],p==f&&o==(i.insertLeft?"left":"right")&&(c=o),"left"==o&&0==a)for(;h&&d[h-2]==d[h-3]&&d[h-1].insertLeft;)i=d[2+(h-=3)],c="left";if("right"==o&&a==f-p)for(;h<d.length-3&&d[h+3]==d[h+4]&&!d[h+5].insertLeft;)i=d[(h+=3)+2],c="right";break}}if(3==i.nodeType){for(;a&&Ho(t.line.text.charAt(p+a));)--a;for(;p+l<f&&Ho(t.line.text.charAt(p+l));)++l;if(r&&0==a&&l==f-p)u=i.parentNode.getBoundingClientRect();else if(s&&e.options.lineWrapping){u=(g=Go(i,a,l).getClientRects()).length?g["right"==o?g.length-1:0]:We}else u=Go(i,a,l).getBoundingClientRect()}else{var g;a>0&&(c=o="right"),u=e.options.lineWrapping&&(g=i.getClientRects()).length>1?g["right"==o?g.length-1:0]:i.getBoundingClientRect()}if(r&&!a&&(!u||!u.left&&!u.right)){var m=i.parentNode.getClientRects()[0];u=m?{left:m.left,right:m.left+at(e.display),top:m.top,bottom:m.bottom}:We}var v,y=(u.bottom+u.top)/2-t.rect.top,_=t.view.measure.heights;for(h=0;h<_.length-1&&!(y<_[h]);h++);v=h?_[h-1]:0,y=_[h];var b={left:("right"==c?u.right:u.left)-t.rect.left,right:("left"==c?u.left:u.right)-t.rect.left,top:v,bottom:y};u.left||u.right||(b.bogus=!0);return b}(e,t,n,o),i.bogus||(t.cache[a]=i)),{left:i.left,right:i.right,top:i.top,bottom:i.bottom}}he.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var n=this.ranges[t],r=e.ranges[t];if(0!=le(n.anchor,r.anchor)||0!=le(n.head,r.head))return!1}return!0},deepCopy:function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new pe(ce(this.ranges[t].anchor),ce(this.ranges[t].head));return new he(e,this.primIndex)},somethingSelected:function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},contains:function(e,t){t||(t=e);for(var n=0;n<this.ranges.length;n++){var r=this.ranges[n];if(le(t,r.from())>=0&&le(e,r.to())<=0)return n}return-1}},pe.prototype={from:function(){return de(this.anchor,this.head)},to:function(){return ue(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var qe,We={left:0,right:0,top:0,bottom:0};function Ke(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function Xe(e){e.display.externalMeasure=null,Xo(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)Ke(e.display.view[t])}function Ye(e){Xe(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function Je(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Qe(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function Ze(e,t,n,r){if(t.widgets)for(var o=0;o<t.widgets.length;++o)if(t.widgets[o].above){var i=fr(t.widgets[o]);n.top+=i,n.bottom+=i}if("line"==r)return n;r||(r="local");var s=Wr(t);if("local"==r?s+=Be(e.display):s-=e.display.viewOffset,"page"==r||"window"==r){var a=e.display.lineSpace.getBoundingClientRect();s+=a.top+("window"==r?0:Qe());var l=a.left+("window"==r?0:Je());n.left+=l,n.right+=l}return n.top+=s,n.bottom+=s,n}function $e(e,t,n){if("div"==n)return t;var r=t.left,o=t.top;if("page"==n)r-=Je(),o-=Qe();else if("local"==n||!n){var i=e.display.sizer.getBoundingClientRect();r+=i.left,o+=i.top}var s=e.display.lineSpace.getBoundingClientRect();return{left:r-s.left,top:o-s.top}}function et(e,t,n,r,o){return r||(r=zr(e.doc,t.line)),Ze(e,r,Ve(e,r,t.ch,o),n)}function tt(e,t,n,r,o){function i(t,i){var s=Ge(e,o,t,i?"right":"left");return i?s.left=s.right:s.right=s.left,Ze(e,r,s,n)}function s(e,t){var n=a[t],r=n.level%2;return e==di(n)&&t&&n.level<a[t-1].level?(e=hi(n=a[--t])-(n.level%2?0:1),r=!0):e==hi(n)&&t<a.length-1&&n.level<a[t+1].level&&(e=di(n=a[++t])-n.level%2,r=!1),r&&e==n.to&&e>n.from?i(e-1):i(e,r)}r=r||zr(e.doc,t.line),o||(o=He(e,r));var a=Kr(r),l=t.ch;if(!a)return i(l);var c=s(l,vi(a,l));return null!=si&&(c.other=s(l,si)),c}function nt(e,t){var n=0;t=ve(e.doc,t);e.options.lineWrapping||(n=at(e.display)*t.ch);var r=zr(e.doc,t.line),o=Wr(r)+Be(e.display);return{left:n,right:n,top:o,bottom:o+r.height}}function rt(e,t,n,r){var o=ae(e,t);return o.xRel=r,n&&(o.outside=!0),o}function ot(e,t,n){var r=e.doc;if((n+=e.display.viewOffset)<0)return rt(r.first,0,!0,-1);var o=qr(r,n),i=r.first+r.size-1;if(o>i)return rt(r.first+r.size-1,zr(r,i).text.length,!0,1);t<0&&(t=0);for(var s=zr(r,o);;){var a=it(e,s,o,t,n),l=ir(s),c=l&&l.find(0,!0);if(!l||!(a.ch>c.from.ch||a.ch==c.from.ch&&a.xRel>0))return a;o=Gr(s=c.to.line)}}function it(e,t,n,r,o){var i=o-Wr(t),s=!1,a=2*e.display.wrapper.clientWidth,l=He(e,t);function c(r){var o=tt(e,ae(n,r),"line",t,l);return s=!0,i>o.bottom?o.left-a:i<o.top?o.left+a:(s=!1,o.left)}var u=Kr(t),d=t.text.length,h=pi(t),p=fi(t),f=c(h),g=s,m=c(p),v=s;if(r>m)return rt(n,p,v,1);for(;;){if(u?p==h||p==_i(t,h,1):p-h<=1){for(var y=r<f||r-f<=m-r?h:p,_=r-(y==h?f:m);Ho(t.text.charAt(y));)++y;return rt(n,y,y==h?g:v,_<-1?-1:_>1?1:0)}var b=Math.ceil(d/2),w=h+b;if(u){w=h;for(var S=0;S<b;++S)w=_i(t,w,1)}var C=c(w);C>r?(p=w,m=C,(v=s)&&(m+=1e3),d=b):(h=w,f=C,g=s,d-=b)}}function st(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==qe){qe=Ko("pre");for(var t=0;t<49;++t)qe.appendChild(document.createTextNode("x")),qe.appendChild(Ko("br"));qe.appendChild(document.createTextNode("x"))}Yo(e.measure,qe);var n=qe.offsetHeight/50;return n>3&&(e.cachedTextHeight=n),Xo(e.measure),n||1}function at(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=Ko("span","xxxxxxxxxx"),n=Ko("pre",[t]);Yo(e.measure,n);var r=t.getBoundingClientRect(),o=(r.right-r.left)/10;return o>2&&(e.cachedCharWidth=o),o||10}var lt,ct,ut=0;function dt(e){e.curOp={viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivity:!1,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,id:++ut},mo++||(ho=[])}function ht(e){var t=e.curOp,n=e.doc,r=e.display;if(e.curOp=null,t.updateMaxLine&&P(e),t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<r.viewFrom||t.scrollToPos.to.line>=r.viewTo)||r.maxLineChanged&&e.options.lineWrapping){var o=G(e,{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate);e.display.scroller.offsetHeight&&(e.doc.scrollTop=e.display.scroller.scrollTop)}if(!o&&t.selectionChanged&&Te(e),o||t.startHeight==e.doc.height||j(e),null!=t.scrollTop&&r.scroller.scrollTop!=t.scrollTop){var i=Math.max(0,Math.min(r.scroller.scrollHeight-r.scroller.clientHeight,t.scrollTop));r.scroller.scrollTop=r.scrollbarV.scrollTop=n.scrollTop=i}if(null!=t.scrollLeft&&r.scroller.scrollLeft!=t.scrollLeft){var s=Math.max(0,Math.min(r.scroller.scrollWidth-r.scroller.clientWidth,t.scrollLeft));r.scroller.scrollLeft=r.scrollbarH.scrollLeft=n.scrollLeft=s,V(e)}if(t.scrollToPos){var a=function(e,t,n,r){null==r&&(r=0);for(;;){var o=!1,i=tt(e,t),s=n&&n!=t?tt(e,n):i,a=fn(e,Math.min(i.left,s.left),Math.min(i.top,s.top)-r,Math.max(i.left,s.left),Math.max(i.bottom,s.bottom)+r),l=e.doc.scrollTop,c=e.doc.scrollLeft;if(null!=a.scrollTop&&(jt(e,a.scrollTop),Math.abs(e.doc.scrollTop-l)>1&&(o=!0)),null!=a.scrollLeft&&(zt(e,a.scrollLeft),Math.abs(e.doc.scrollLeft-c)>1&&(o=!0)),!o)return i}}(e,ve(e.doc,t.scrollToPos.from),ve(e.doc,t.scrollToPos.to),t.scrollToPos.margin);t.scrollToPos.isCursor&&e.state.focused&&function(e,t){var n=e.display,r=n.sizer.getBoundingClientRect(),o=null;t.top+r.top<0?o=!0:t.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(o=!1);if(null!=o&&!g){var i=Ko("div","​",null,"position: absolute; top: "+(t.top-n.viewOffset-Be(e.display))+"px; height: "+(t.bottom-t.top+So)+"px; left: "+t.left+"px; width: 2px;");e.display.lineSpace.appendChild(i),i.scrollIntoView(o),e.display.lineSpace.removeChild(i)}}(e,a)}t.selectionChanged&&Re(e),e.state.focused&&t.updateInput&&kt(e,t.typing);var l,c=t.maybeHiddenMarkers,u=t.maybeUnhiddenMarkers;if(c)for(var d=0;d<c.length;++d)c[d].lines.length||go(c[d],"hide");if(u)for(d=0;d<u.length;++d)u[d].lines.length&&go(u[d],"unhide");if(--mo||(l=ho,ho=null),t.changeObjs){for(d=0;d<t.changeObjs.length;d++)go(e,"change",e,t.changeObjs[d]);go(e,"changes",e,t.changeObjs)}if(t.cursorActivity&&go(e,"cursorActivity",e),l)for(d=0;d<l.length;++d)l[d]()}function pt(e,t){if(e.curOp)return t();dt(e);try{return t()}finally{ht(e)}}function ft(e,t){return function(){if(e.curOp)return t.apply(e,arguments);dt(e);try{return t.apply(e,arguments)}finally{ht(e)}}}function gt(e){return function(){if(this.curOp)return e.apply(this,arguments);dt(this);try{return e.apply(this,arguments)}finally{ht(this)}}}function mt(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);dt(t);try{return e.apply(this,arguments)}finally{ht(t)}}}function vt(e,t,n){this.line=t,this.rest=function(e){var t,n;for(;t=ir(e);)e=t.find(1,!0).line,(n||(n=[])).push(e);return n}(t),this.size=this.rest?Gr(Lo(this.rest))-n+1:1,this.node=this.text=null,this.hidden=ur(e,t)}function yt(e,t,n){for(var r,o=[],i=t;i<n;i=r){var s=new vt(e.doc,zr(e.doc,i),i);r=i+s.size,o.push(s)}return o}function _t(e,t,n,r){null==t&&(t=e.doc.first),null==n&&(n=e.doc.first+e.doc.size),r||(r=0);var o=e.display;if(r&&n<o.viewTo&&(null==o.updateLineNumbers||o.updateLineNumbers>t)&&(o.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=o.viewTo)I&&lr(e.doc,t)<o.viewTo&&wt(e);else if(n<=o.viewFrom)I&&cr(e.doc,n+r)>o.viewFrom?wt(e):(o.viewFrom+=r,o.viewTo+=r);else if(t<=o.viewFrom&&n>=o.viewTo)wt(e);else if(t<=o.viewFrom){(i=Ct(e,n,n+r,1))?(o.view=o.view.slice(i.index),o.viewFrom=i.lineN,o.viewTo+=r):wt(e)}else if(n>=o.viewTo){var i;(i=Ct(e,t,t,-1))?(o.view=o.view.slice(0,i.index),o.viewTo=i.lineN):wt(e)}else{var s=Ct(e,t,t,-1),a=Ct(e,n,n+r,1);s&&a?(o.view=o.view.slice(0,s.index).concat(yt(e,s.lineN,a.lineN)).concat(o.view.slice(a.index)),o.viewTo+=r):wt(e)}var l=o.externalMeasured;l&&(n<l.lineN?l.lineN+=r:t<l.lineN+l.size&&(o.externalMeasured=null))}function bt(e,t,n){e.curOp.viewChanged=!0;var r=e.display,o=e.display.externalMeasured;if(o&&t>=o.lineN&&t<o.lineN+o.size&&(r.externalMeasured=null),!(t<r.viewFrom||t>=r.viewTo)){var i=r.view[St(e,t)];if(null!=i.node){var s=i.changes||(i.changes=[]);-1==Ro(s,n)&&s.push(n)}}}function wt(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function St(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var n=e.display.view,r=0;r<n.length;r++)if((t-=n[r].size)<0)return r}function Ct(e,t,n,r){var o,i=St(e,t),s=e.display.view;if(!I)return{index:i,lineN:n};for(var a=0,l=e.display.viewFrom;a<i;a++)l+=s[a].size;if(l!=t){if(r>0){if(i==s.length-1)return null;o=l+s[i].size-t,i++}else o=l-t;t+=o,n+=o}for(;lr(e.doc,n)!=n;){if(i==(r<0?0:s.length-1))return null;n+=r*s[i-(r<0?1:0)].size,i+=r}return{index:i,lineN:n}}function It(e){for(var t=e.display.view,n=0,r=0;r<t.length;r++){var o=t[r];o.hidden||o.node&&!o.changes||++n}return n}function xt(e){e.display.pollingFast||e.display.poll.set(e.options.pollInterval,(function(){Mt(e),e.state.focused&&xt(e)}))}function Ot(e){var t=!1;e.display.pollingFast=!0,e.display.poll.set(20,(function n(){Mt(e)||t?(e.display.pollingFast=!1,xt(e)):(t=!0,e.display.poll.set(60,n))}))}function Mt(e){var t=e.display.input,n=e.display.prevInput,o=e.doc;if(!e.state.focused||li(t)||Tt(e)||e.options.disableInput)return!1;var i=t.value;if(i==n&&!e.somethingSelected())return!1;if(s&&!r&&e.display.inputHasSelection===i)return kt(e),!1;var a=!e.curOp;a&&dt(e),e.display.shift=!1;for(var l=0,c=Math.min(n.length,i.length);l<c&&n.charCodeAt(l)==i.charCodeAt(l);)++l;for(var u=i.slice(l),d=ai(u),h=e.state.pasteIncoming&&d.length>1&&o.sel.ranges.length==d.length,p=o.sel.ranges.length-1;p>=0;p--){var f=o.sel.ranges[p],g=f.from(),m=f.to();l<n.length?g=ae(g.line,g.ch-(n.length-l)):e.state.overwrite&&f.empty()&&!e.state.pasteIncoming&&(m=ae(m.line,Math.min(zr(o,m.line).text.length,m.ch+Lo(d).length)));var v=e.curOp.updateInput,y={from:g,to:m,text:h?[d[p]]:d,origin:e.state.pasteIncoming?"paste":e.state.cutIncoming?"cut":"+input"};if(ln(e.doc,y),vo(e,"inputRead",e,y),u&&!e.state.pasteIncoming&&e.options.electricChars&&e.options.smartIndent&&f.head.ch<100&&(!p||o.sel.ranges[p-1].head.line!=f.head.line)){var _=e.getModeAt(f.head).electricChars;if(_)for(var b=0;b<_.length;b++)if(u.indexOf(_.charAt(b))>-1){yn(e,f.head.line,"smart");break}}}return mn(e),e.curOp.updateInput=v,e.curOp.typing=!0,i.length>1e3||i.indexOf("\n")>-1?t.value=e.display.prevInput="":e.display.prevInput=i,a&&ht(e),e.state.pasteIncoming=e.state.cutIncoming=!1,!0}function kt(e,t){var n,o,i=e.doc;if(e.somethingSelected()){e.display.prevInput="";var a=i.sel.primary(),l=(n=ci&&(a.to().line-a.from().line>100||(o=e.getSelection()).length>1e3))?"-":o||e.getSelection();e.display.input.value=l,e.state.focused&&Ao(e.display.input),s&&!r&&(e.display.inputHasSelection=l)}else t||(e.display.prevInput=e.display.input.value="",s&&!r&&(e.display.inputHasSelection=null));e.display.inaccurateSelection=n}function Et(e){"nocursor"==e.options.readOnly||v&&Qo()==e.display.input||e.display.input.focus()}function Nt(e){e.state.focused||(Et(e),$t(e))}function Tt(e){return e.options.readOnly||e.doc.cantEdit}function Lt(e,t){for(var n=co(t);n!=e.wrapper;n=n.parentNode)if(!n||n.ignoreEvents||n.parentNode==e.sizer&&n!=e.mover)return!0}function At(e,t,n,r){var o=e.display;if(!n){var i=co(t);if(i==o.scrollbarH||i==o.scrollbarV||i==o.scrollbarFiller||i==o.gutterFiller)return null}var s,a,l=o.lineSpace.getBoundingClientRect();try{s=t.clientX-l.left,a=t.clientY-l.top}catch(t){return null}var c,u=ot(e,s,a);if(r&&1==u.xRel&&(c=zr(e.doc,u.line).text).length==u.ch){var d=ko(c,c.length,e.options.tabSize)-c.length;u=ae(u.line,Math.round((s-ze(e.display).left)/at(e.display))-d)}return u}function Rt(e){if(!_o(this,e)){var n=this,i=n.display;if(i.shift=e.shiftKey,Lt(i,e))a||(i.scroller.draggable=!1,setTimeout((function(){i.scroller.draggable=!0}),100));else if(!Pt(n,e)){var l=At(n,e);switch(window.focus(),uo(e)){case 1:l?function(e,n,i){setTimeout(Bo(Nt,e),0);var l,c=+new Date;ct&&ct.time>c-400&&0==le(ct.pos,i)?l="triple":lt&&lt.time>c-400&&0==le(lt.pos,i)?(l="double",ct={time:c,pos:i}):(l="single",lt={time:c,pos:i});var u=e.doc.sel,d=!1;e.options.dragDrop&&ti&&!d&&!Tt(e)&&"single"==l&&u.contains(i)>-1&&u.somethingSelected()?function(e,n,o){var i=e.display,s=ft(e,(function(l){a&&(i.scroller.draggable=!1),e.state.draggingText=!1,fo(document,"mouseup",s),fo(i.scroller,"drop",s),Math.abs(n.clientX-l.clientX)+Math.abs(n.clientY-l.clientY)<10&&(io(l),be(e.doc,o),Et(e),t&&!r&&setTimeout((function(){document.body.focus(),Et(e)}),20))}));a&&(i.scroller.draggable=!0);e.state.draggingText=s,i.scroller.dragDrop&&i.scroller.dragDrop();po(document,"mouseup",s),po(i.scroller,"drop",s)}(e,n,i):function(e,t,n,r,i){var a=e.display,l=e.doc;io(t);var c,u,d=l.sel;i?(u=l.sel.contains(n),c=u>-1?l.sel.ranges[u]:new pe(n,n)):c=l.sel.primary();if(t.altKey)r="rect",i||(c=new pe(n,n)),n=At(e,t,!0,!0),u=-1;else if("double"==r){var h=Cn(l,n);c=e.display.shift||l.extend?_e(l,c,h.anchor,h.head):h}else if("triple"==r){var p=new pe(ae(n.line,0),ve(l,ae(n.line+1,0)));c=e.display.shift||l.extend?_e(l,c,p.anchor,p.head):p}else c=_e(l,c,n);i?u>-1?Se(l,u,c,xo):(u=l.sel.ranges.length,xe(l,fe(l.sel.ranges.concat([c]),u),{scroll:!1,origin:"*mouse"})):(u=0,xe(l,new he([c],0),xo));var f=n;function g(t){if(0!=le(f,t))if(f=t,"rect"==r){for(var o=[],i=e.options.tabSize,s=ko(zr(l,n.line).text,n.ch,i),a=ko(zr(l,t.line).text,t.ch,i),h=Math.min(s,a),p=Math.max(s,a),g=Math.min(n.line,t.line),m=Math.min(e.lastLine(),Math.max(n.line,t.line));g<=m;g++){var v=zr(l,g).text,y=Eo(v,h,i);h==p?o.push(new pe(ae(g,y),ae(g,y))):v.length>y&&o.push(new pe(ae(g,y),ae(g,Eo(v,p,i))))}o.length||o.push(new pe(n,n)),xe(l,fe(d.ranges.slice(0,u).concat(o),u),xo)}else{var _=c,b=_.anchor,w=t;if("single"!=r){if("double"==r)var S=Cn(l,t);else S=new pe(ae(t.line,0),ve(l,ae(t.line+1,0)));le(S.anchor,b)>0?(w=S.head,b=de(_.from(),S.anchor)):(w=S.anchor,b=ue(_.to(),S.head))}(o=d.ranges.slice(0))[u]=new pe(ve(l,b),w),xe(l,fe(o,u),xo)}}var m=a.wrapper.getBoundingClientRect(),v=0;function y(t){var n=++v,o=At(e,t,!0,"rect"==r);if(o)if(0!=le(o,f)){Nt(e),g(o);var i=z(a,l);(o.line>=i.to||o.line<i.from)&&setTimeout(ft(e,(function(){v==n&&y(t)})),150)}else{var s=t.clientY<m.top?-20:t.clientY>m.bottom?20:0;s&&setTimeout(ft(e,(function(){v==n&&(a.scroller.scrollTop+=s,y(t))})),50)}}function _(t){v=1/0,io(t),Et(e),fo(document,"mousemove",b),fo(document,"mouseup",w),l.history.lastSelOrigin=null}var b=ft(e,(function(e){(s&&!o?e.buttons:uo(e))?y(e):_(e)})),w=ft(e,_);po(document,"mousemove",b),po(document,"mouseup",w)}(e,n,i,l,d)}(n,e,l):co(e)==i.scroller&&io(e);break;case 2:a&&(n.state.lastMiddleDown=+new Date),l&&be(n.doc,l),setTimeout(Bo(Et,n),20),io(e);break;case 3:S&&tn(n,e)}}}}function Dt(e,t,n,r,o){try{var i=t.clientX,s=t.clientY}catch(t){return!1}if(i>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;r&&io(t);var a=e.display,l=a.lineDiv.getBoundingClientRect();if(s>l.bottom||!bo(e,n))return ao(t);s-=l.top-a.viewOffset;for(var c=0;c<e.options.gutters.length;++c){var u=a.gutters.childNodes[c];if(u&&u.getBoundingClientRect().right>=i)return o(e,n,e,qr(e.doc,s),e.options.gutters[c],t),ao(t)}}function Pt(e,t){return Dt(e,t,"gutterClick",!0,vo)}var Ft=0;function Bt(e){var n=this;if(!_o(n,e)&&!Lt(n.display,e)){io(e),t&&(Ft=+new Date);var r=At(n,e,!0),o=e.dataTransfer.files;if(r&&!Tt(n))if(o&&o.length&&window.FileReader&&window.File)for(var i=o.length,s=Array(i),a=0,l=function(e,t){var o=new FileReader;o.onload=function(){if(s[t]=o.result,++a==i){var e={from:r=ve(n.doc,r),to:r,text:ai(s.join("\n")),origin:"paste"};ln(n.doc,e),Ie(n.doc,ge(r,nn(e)))}},o.readAsText(e)},c=0;c<i;++c)l(o[c],c);else{if(n.state.draggingText&&n.doc.sel.contains(r)>-1)return n.state.draggingText(e),void setTimeout(Bo(Et,n),20);try{if(s=e.dataTransfer.getData("Text")){var u=n.state.draggingText&&n.listSelections();if(Oe(n.doc,ge(r,r)),u)for(c=0;c<u.length;++c)pn(n.doc,"",u[c].anchor,u[c].head,"drag");n.replaceSelection(s,"around","paste"),Et(n)}}catch(e){}}}}function jt(t,n){Math.abs(t.doc.scrollTop-n)<2||(t.doc.scrollTop=n,e||G(t,{top:n}),t.display.scroller.scrollTop!=n&&(t.display.scroller.scrollTop=n),t.display.scrollbarV.scrollTop!=n&&(t.display.scrollbarV.scrollTop=n),e&&G(t),De(t,100))}function zt(e,t,n){(n?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)||(t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),e.doc.scrollLeft=t,V(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbarH.scrollLeft!=t&&(e.display.scrollbarH.scrollLeft=t))}var Vt,Ut=0,Ht=null;function Gt(t,n){var r=n.wheelDeltaX,o=n.wheelDeltaY;null==r&&n.detail&&n.axis==n.HORIZONTAL_AXIS&&(r=n.detail),null==o&&n.detail&&n.axis==n.VERTICAL_AXIS?o=n.detail:null==o&&(o=n.wheelDelta);var i=t.display,s=i.scroller;if(r&&s.scrollWidth>s.clientWidth||o&&s.scrollHeight>s.clientHeight){if(o&&y&&a)e:for(var l=n.target,c=i.view;l!=s;l=l.parentNode)for(var d=0;d<c.length;d++)if(c[d].node==l){t.display.currentWheelTarget=l;break e}if(r&&!e&&!u&&null!=Ht)return o&&jt(t,Math.max(0,Math.min(s.scrollTop+o*Ht,s.scrollHeight-s.clientHeight))),zt(t,Math.max(0,Math.min(s.scrollLeft+r*Ht,s.scrollWidth-s.clientWidth))),io(n),void(i.wheelStartX=null);if(o&&null!=Ht){var h=o*Ht,p=t.doc.scrollTop,f=p+i.wrapper.clientHeight;h<0?p=Math.max(0,p+h-50):f=Math.min(t.doc.height,f+h+50),G(t,{top:p,bottom:f})}Ut<20&&(null==i.wheelStartX?(i.wheelStartX=s.scrollLeft,i.wheelStartY=s.scrollTop,i.wheelDX=r,i.wheelDY=o,setTimeout((function(){if(null!=i.wheelStartX){var e=s.scrollLeft-i.wheelStartX,t=s.scrollTop-i.wheelStartY,n=t&&i.wheelDY&&t/i.wheelDY||e&&i.wheelDX&&e/i.wheelDX;i.wheelStartX=i.wheelStartY=null,n&&(Ht=(Ht*Ut+n)/(Ut+1),++Ut)}}),200)):(i.wheelDX+=r,i.wheelDY+=o))}}function qt(e,t,n){if("string"==typeof t&&!(t=Dn[t]))return!1;e.display.pollingFast&&Mt(e)&&(e.display.pollingFast=!1);var r=e.display.shift,o=!1;try{Tt(e)&&(e.state.suppressEdits=!0),n&&(e.display.shift=!1),o=t(e)!=Co}finally{e.display.shift=r,e.state.suppressEdits=!1}return o}function Wt(e){var t=e.state.keyMaps.slice(0);return e.options.extraKeys&&t.push(e.options.extraKeys),t.push(e.options.keyMap),t}function Kt(e,t){var n=Fn(e.options.keyMap),r=n.auto;clearTimeout(Vt),r&&!jn(t)&&(Vt=setTimeout((function(){Fn(e.options.keyMap)==n&&(e.options.keyMap=r.call?r.call(null,e):r,T(e))}),50));var o=zn(t,!0),i=!1;if(!o)return!1;var s=Wt(e);return(i=t.shiftKey?Bn("Shift-"+o,s,(function(t){return qt(e,t,!0)}))||Bn(o,s,(function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return qt(e,t)})):Bn(o,s,(function(t){return qt(e,t)})))&&(io(t),Re(e),vo(e,"keyHandled",e,o,t)),i}s?Ht=-.53:e?Ht=15:c?Ht=-.7:d&&(Ht=-1/3);var Xt,Yt=null;function Jt(e){var n=this;if(Nt(n),!_o(n,e)){t&&27==e.keyCode&&(e.returnValue=!1);var r=e.keyCode;n.display.shift=16==r||e.shiftKey;var o=Kt(n,e);u&&(Yt=o?r:null,o||88!=r||ci||!(y?e.metaKey:e.ctrlKey)||n.replaceSelection("",null,"cut"))}}function Qt(e){_o(this,e)||16==e.keyCode&&(this.doc.sel.shift=!1)}function Zt(e){var t=this;if(!_o(t,e)){var n=e.keyCode,o=e.charCode;if(u&&n==Yt)return Yt=null,void io(e);if(!(u&&(!e.which||e.which<10)||h)||!Kt(t,e))(function(e,t,n){var r=Bn("'"+n+"'",Wt(e),(function(t){return qt(e,t,!0)}));return r&&(io(t),Re(e),vo(e,"keyHandled",e,"'"+n+"'",t)),r})(t,e,String.fromCharCode(null==o?n:o))||(s&&!r&&(t.display.inputHasSelection=null),Ot(t))}}function $t(e){"nocursor"!=e.options.readOnly&&(e.state.focused||(go(e,"focus",e),e.state.focused=!0,-1==e.display.wrapper.className.search(/\bCodeMirror-focused\b/)&&(e.display.wrapper.className+=" CodeMirror-focused"),e.curOp||(kt(e),a&&setTimeout(Bo(kt,e,!0),0))),xt(e),Re(e))}function en(e){e.state.focused&&(go(e,"blur",e),e.state.focused=!1,e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-focused","")),clearInterval(e.display.blinker),setTimeout((function(){e.state.focused||(e.display.shift=!1)}),150)}function tn(e,t){if(!_o(e,t,"contextmenu")){var n=e.display;if(!Lt(n,t)&&!function(e,t){return!!bo(e,"gutterContextMenu")&&Dt(e,t,"gutterContextMenu",!1,go)}(e,t)){var o=At(e,t),i=n.scroller.scrollTop;if(o&&!u){e.options.resetSelectionOnContextMenu&&-1==e.doc.sel.contains(o)&&ft(e,xe)(e.doc,ge(o),Io);var a=n.input.style.cssText;if(n.inputDiv.style.position="absolute",n.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(t.clientY-5)+"px; left: "+(t.clientX-5)+"px; z-index: 1000; background: "+(s?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",Et(e),kt(e),e.somethingSelected()||(n.input.value=n.prevInput=" "),s&&!r&&c(),S){lo(t);var l=function(){fo(window,"mouseup",l),setTimeout(d,20)};po(window,"mouseup",l)}else setTimeout(d,50)}}}function c(){if(null!=n.input.selectionStart){var t=n.input.value="​"+(e.somethingSelected()?n.input.value:"");n.prevInput="​",n.input.selectionStart=1,n.input.selectionEnd=t.length}}function d(){if(n.inputDiv.style.position="relative",n.input.style.cssText=a,r&&(n.scrollbarV.scrollTop=n.scroller.scrollTop=i),xt(e),null!=n.input.selectionStart){s&&!r||c(),clearTimeout(Xt);var t=0,o=function(){"​"==n.prevInput&&0==n.input.selectionStart?ft(e,Dn.selectAll)(e):t++<10?Xt=setTimeout(o,500):kt(e)};Xt=setTimeout(o,200)}}}var nn=x.changeEnd=function(e){return e.text?ae(e.from.line+e.text.length-1,Lo(e.text).length+(1==e.text.length?e.from.ch:0)):e.to};function rn(e,t){if(le(e,t.from)<0)return e;if(le(e,t.to)<=0)return nn(t);var n=e.line+t.text.length-(t.to.line-t.from.line)-1,r=e.ch;return e.line==t.to.line&&(r+=nn(t).ch-t.to.ch),ae(n,r)}function on(e,t){for(var n=[],r=0;r<e.sel.ranges.length;r++){var o=e.sel.ranges[r];n.push(new pe(rn(o.anchor,t),rn(o.head,t)))}return fe(n,e.sel.primIndex)}function sn(e,t,n){return e.line==t.line?ae(n.line,e.ch-t.ch+n.ch):ae(n.line+(e.line-t.line),e.ch)}function an(e,t,n){var r={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){this.canceled=!0}};return n&&(r.update=function(t,n,r,o){t&&(this.from=ve(e,t)),n&&(this.to=ve(e,n)),r&&(this.text=r),void 0!==o&&(this.origin=o)}),go(e,"beforeChange",e,r),e.cm&&go(e.cm,"beforeChange",e.cm,r),r.canceled?null:{from:r.from,to:r.to,text:r.text,origin:r.origin}}function ln(e,t,n){if(e.cm){if(!e.cm.curOp)return ft(e.cm,ln)(e,t,n);if(e.cm.state.suppressEdits)return}if(!(bo(e,"beforeChange")||e.cm&&bo(e.cm,"beforeChange"))||(t=an(e,t,!0))){var r=C&&!n&&function(e,t,n){var r=null;if(e.iter(t.line,n.line+1,(function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var n=e.markedSpans[t].marker;!n.readOnly||r&&-1!=Ro(r,n)||(r||(r=[])).push(n)}})),!r)return null;for(var o=[{from:t,to:n}],i=0;i<r.length;++i)for(var s=r[i],a=s.find(0),l=0;l<o.length;++l){var c=o[l];if(!(le(c.to,a.from)<0||le(c.from,a.to)>0)){var u=[l,1],d=le(c.from,a.from),h=le(c.to,a.to);(d<0||!s.inclusiveLeft&&!d)&&u.push({from:c.from,to:a.from}),(h>0||!s.inclusiveRight&&!h)&&u.push({from:a.to,to:c.to}),o.splice.apply(o,u),l+=u.length-1}}return o}(e,t.from,t.to);if(r)for(var o=r.length-1;o>=0;--o)cn(e,{from:r[o].from,to:r[o].to,text:o?[""]:t.text});else cn(e,t)}}function cn(e,t){if(1!=t.text.length||""!=t.text[0]||0!=le(t.from,t.to)){var n=on(e,t);Qr(e,t,n,e.cm?e.cm.curOp.id:NaN),hn(e,t,n,Yn(e,t));var r=[];Br(e,(function(e,n){n||-1!=Ro(r,e.history)||(oo(e.history,t),r.push(e.history)),hn(e,t,null,Yn(e,t))}))}}function un(e,t,n){if(!e.cm||!e.cm.state.suppressEdits){for(var r,o=e.history,i=e.sel,s="undo"==t?o.done:o.undone,a="undo"==t?o.undone:o.done,l=0;l<s.length&&(r=s[l],n?!r.ranges||r.equals(e.sel):r.ranges);l++);if(l!=s.length){for(o.lastOrigin=o.lastSelOrigin=null;(r=s.pop()).ranges;){if(Zr(r,a),n&&!r.equals(e.sel))return void xe(e,r,{clearRedo:!1});i=r}var c=[];Zr(i,a),a.push({changes:c,generation:o.generation}),o.generation=r.generation||++o.maxGeneration;var u=bo(e,"beforeChange")||e.cm&&bo(e.cm,"beforeChange");for(l=r.changes.length-1;l>=0;--l){var d=r.changes[l];if(d.origin=t,u&&!an(e,d,!1))return void(s.length=0);c.push(Yr(e,d));var h=l?on(e,d):Lo(s);hn(e,d,h,Qn(e,d)),e.cm&&mn(e.cm);var p=[];Br(e,(function(e,t){t||-1!=Ro(p,e.history)||(oo(e.history,d),p.push(e.history)),hn(e,d,null,Qn(e,d))}))}}}}function dn(e,t){e.first+=t,e.sel=new he(Do(e.sel.ranges,(function(e){return new pe(ae(e.anchor.line+t,e.anchor.ch),ae(e.head.line+t,e.head.ch))})),e.sel.primIndex),e.cm&&_t(e.cm,e.first,e.first-t,t)}function hn(e,t,n,r){if(e.cm&&!e.cm.curOp)return ft(e.cm,hn)(e,t,n,r);if(t.to.line<e.first)dn(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var o=t.text.length-1-(e.first-t.from.line);dn(e,o),t={from:ae(e.first,0),to:ae(t.to.line+o,t.to.ch),text:[Lo(t.text)],origin:t.origin}}var i=e.lastLine();t.to.line>i&&(t={from:t.from,to:ae(i,zr(e,i).text.length),text:[t.text[0]],origin:t.origin}),t.removed=Vr(e,t.from,t.to),n||(n=on(e,t)),e.cm?function(e,t,n){var r=e.doc,o=e.display,i=t.from,s=t.to,a=!1,l=i.line;e.options.lineWrapping||(l=Gr(ar(zr(r,i.line))),r.iter(l,s.line+1,(function(e){if(e==o.maxLine)return a=!0,!0})));r.sel.contains(t.from,t.to)>-1&&(e.curOp.cursorActivity=!0);Tr(r,t,n,E(e)),e.options.lineWrapping||(r.iter(l,i.line+t.text.length,(function(e){var t=D(e);t>o.maxLineLength&&(o.maxLine=e,o.maxLineLength=t,o.maxLineChanged=!0,a=!1)})),a&&(e.curOp.updateMaxLine=!0));r.frontier=Math.min(r.frontier,i.line),De(e,400);var c=t.text.length-(s.line-i.line)-1;i.line!=s.line||1!=t.text.length||Nr(e.doc,t)?_t(e,i.line,s.line+1,c):bt(e,i.line,"text");(bo(e,"change")||bo(e,"changes"))&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push({from:i,to:s,text:t.text,removed:t.removed,origin:t.origin})}(e.cm,t,r):Tr(e,t,r),Oe(e,n,Io)}}function pn(e,t,n,r,o){if(r||(r=n),le(r,n)<0){var i=r;r=n,n=i}"string"==typeof t&&(t=ai(t)),ln(e,{from:n,to:r,text:t,origin:o})}function fn(e,t,n,r,o){var i=e.display,s=st(e.display);n<0&&(n=0);var a=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:i.scroller.scrollTop,l=i.scroller.clientHeight-So,c={},u=e.doc.height+je(i),d=n<s,h=o>u-s;if(n<a)c.scrollTop=d?0:n;else if(o>a+l){var p=Math.min(n,(h?u:o)-l);p!=a&&(c.scrollTop=p)}var f=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:i.scroller.scrollLeft,g=i.scroller.clientWidth-So;t+=i.gutters.offsetWidth,r+=i.gutters.offsetWidth;var m=i.gutters.offsetWidth,v=t<m+10;return t<f+m||v?(v&&(t=0),c.scrollLeft=Math.max(0,t-10-m)):r>g+f-3&&(c.scrollLeft=r+10-g),c}function gn(e,t,n){null==t&&null==n||vn(e),null!=t&&(e.curOp.scrollLeft=(null==e.curOp.scrollLeft?e.doc.scrollLeft:e.curOp.scrollLeft)+t),null!=n&&(e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+n)}function mn(e){vn(e);var t=e.getCursor(),n=t,r=t;e.options.lineWrapping||(n=t.ch?ae(t.line,t.ch-1):t,r=ae(t.line,t.ch+1)),e.curOp.scrollToPos={from:n,to:r,margin:e.options.cursorScrollMargin,isCursor:!0}}function vn(e){var t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null;var n=nt(e,t.from),r=nt(e,t.to),o=fn(e,Math.min(n.left,r.left),Math.min(n.top,r.top)-t.margin,Math.max(n.right,r.right),Math.max(n.bottom,r.bottom)+t.margin);e.scrollTo(o.scrollLeft,o.scrollTop)}}function yn(e,t,n,r){var o,i=e.doc;null==n&&(n="add"),"smart"==n&&(e.doc.mode.indent?o=Fe(e,t):n="prev");var s=e.options.tabSize,a=zr(i,t),l=ko(a.text,null,s);a.stateAfter&&(a.stateAfter=null);var c,u=a.text.match(/^\s*/)[0];if(r||/\S/.test(a.text)){if("smart"==n&&(c=e.doc.mode.indent(o,a.text.slice(u.length),a.text))==Co){if(!r)return;n="prev"}}else c=0,n="not";"prev"==n?c=t>i.first?ko(zr(i,t-1).text,null,s):0:"add"==n?c=l+e.options.indentUnit:"subtract"==n?c=l-e.options.indentUnit:"number"==typeof n&&(c=l+n),c=Math.max(0,c);var d="",h=0;if(e.options.indentWithTabs)for(var p=Math.floor(c/s);p;--p)h+=s,d+="\t";if(h<c&&(d+=To(c-h)),d!=u)pn(e.doc,d,ae(t,0),ae(t,u.length),"+input");else for(p=0;p<i.sel.ranges.length;p++){var f=i.sel.ranges[p];if(f.head.line==t&&f.head.ch<u.length){Se(i,p,new pe(h=ae(t,u.length),h));break}}a.stateAfter=null}function _n(e,t,n,r){var o=t,i=t,s=e.doc;return"number"==typeof t?i=zr(s,me(s,t)):o=Gr(t),null==o?null:r(i,o)?(bt(e,o,n),i):null}function bn(e,t){for(var n=e.doc.sel.ranges,r=[],o=0;o<n.length;o++){for(var i=t(n[o]);r.length&&le(i.from,Lo(r).to)<=0;){var s=r.pop();if(le(s.from,i.from)<0){i.from=s.from;break}}r.push(i)}pt(e,(function(){for(var t=r.length-1;t>=0;t--)pn(e.doc,"",r[t].from,r[t].to,"+delete");mn(e)}))}function wn(e,t,n,r,o){var i=t.line,s=t.ch,a=n,l=zr(e,i),c=!0;function u(t){var r,a=(o?_i:bi)(l,s,n,!0);if(null==a){if(t||!((r=i+n)<e.first||r>=e.first+e.size?c=!1:(i=r,l=zr(e,r))))return c=!1;s=o?(n<0?fi:pi)(l):n<0?l.text.length:0}else s=a;return!0}if("char"==r)u();else if("column"==r)u(!0);else if("word"==r||"group"==r)for(var d=null,h="group"==r,p=!0;!(n<0)||u(!p);p=!1){var f=l.text.charAt(s)||"\n",g=zo(f)?"w":h&&"\n"==f?"n":!h||/\s/.test(f)?null:"p";if(!h||p||g||(g="s"),d&&d!=g){n<0&&(n=1,u());break}if(g&&(d=g),n>0&&!u(!p))break}var m=Ne(e,ae(i,s),a,!0);return c||(m.hitSide=!0),m}function Sn(e,t,n,r){var o,i=e.doc,s=t.left;if("page"==r){var a=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);o=t.top+n*(a-(n<0?1.5:.5)*st(e.display))}else"line"==r&&(o=n>0?t.bottom+3:t.top-3);for(;;){var l=ot(e,s,o);if(!l.outside)break;if(n<0?o<=0:o>=i.height){l.hitSide=!0;break}o+=5*n}return l}function Cn(e,t){var n=zr(e,t.line).text,r=t.ch,o=t.ch;if(n){(t.xRel<0||o==n.length)&&r?--r:++o;for(var i=n.charAt(r),s=zo(i)?zo:/\s/.test(i)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!zo(e)};r>0&&s(n.charAt(r-1));)--r;for(;o<n.length&&s(n.charAt(o));)++o}return new pe(ae(t.line,r),ae(t.line,o))}x.prototype={constructor:x,posFromMouse:function(e){return At(this,e,!0)},focus:function(){window.focus(),Et(this),Ot(this)},setOption:function(e,t){var n=this.options,r=n[e];n[e]==t&&"mode"!=e||(n[e]=t,xn.hasOwnProperty(e)&&ft(this,xn[e])(this,t,r))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](e)},removeKeyMap:function(e){for(var t=this.state.keyMaps,n=0;n<t.length;++n)if(t[n]==e||"string"!=typeof t[n]&&t[n].name==e)return t.splice(n,1),!0},addOverlay:gt((function(e,t){var n=e.token?e:x.getMode(this.options,e);if(n.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:n,modeSpec:e,opaque:t&&t.opaque}),this.state.modeGen++,_t(this)})),removeOverlay:gt((function(e){for(var t=this.state.overlays,n=0;n<t.length;++n){var r=t[n].modeSpec;if(r==e||"string"==typeof e&&r.name==e)return t.splice(n,1),this.state.modeGen++,void _t(this)}})),indentLine:gt((function(e,t,n){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),ye(this.doc,e)&&yn(this,e,t,n)})),indentSelection:gt((function(e){for(var t=this.doc.sel.ranges,n=-1,r=0;r<t.length;r++){var o=t[r];if(o.empty())o.head.line>n&&(yn(this,o.head.line,e,!0),n=o.head.line,r==this.doc.sel.primIndex&&mn(this));else{var i=Math.max(n,o.from().line),s=o.to();n=Math.min(this.lastLine(),s.line-(s.ch?0:1))+1;for(var a=i;a<n;++a)yn(this,a,e)}}})),getTokenAt:function(e,t){for(var n=this.doc,r=Fe(this,(e=ve(n,e)).line,t),o=this.doc.mode,i=zr(n,e.line),s=new Vn(i.text,this.options.tabSize);s.pos<e.ch&&!s.eol();){s.start=s.pos;var a=o.token(s,r)}return{start:s.start,end:s.pos,string:s.current(),type:a||null,state:r}},getTokenTypeAt:function(e){e=ve(this.doc,e);var t=_r(this,zr(this.doc,e.line)),n=0,r=(t.length-1)/2,o=e.ch;if(0==o)return t[2];for(;;){var i=n+r>>1;if((i?t[2*i-1]:0)>=o)r=i;else{if(!(t[2*i+1]<o))return t[2*i+2];n=i+1}}},getModeAt:function(e){var t=this.doc.mode;return t.innerMode?x.innerMode(t,this.getTokenAt(e).state).mode:t},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var n=[];if(!Ln.hasOwnProperty(t))return Ln;var r=Ln[t],o=this.getModeAt(e);if("string"==typeof o[t])r[o[t]]&&n.push(r[o[t]]);else if(o[t])for(var i=0;i<o[t].length;i++){var s=r[o[t][i]];s&&n.push(s)}else o.helperType&&r[o.helperType]?n.push(r[o.helperType]):r[o.name]&&n.push(r[o.name]);for(i=0;i<r._global.length;i++){var a=r._global[i];a.pred(o,this)&&-1==Ro(n,a.val)&&n.push(a.val)}return n},getStateAfter:function(e,t){var n=this.doc;return Fe(this,(e=me(n,null==e?n.first+n.size-1:e))+1,t)},cursorCoords:function(e,t){var n=this.doc.sel.primary();return tt(this,null==e?n.head:"object"==typeof e?ve(this.doc,e):e?n.from():n.to(),t||"page")},charCoords:function(e,t){return et(this,ve(this.doc,e),t||"page")},coordsChar:function(e,t){return ot(this,(e=$e(this,e,t||"page")).left,e.top)},lineAtHeight:function(e,t){return e=$e(this,{top:e,left:0},t||"page").top,qr(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t){var n=!1,r=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>r&&(e=r,n=!0);var o=zr(this.doc,e);return Ze(this,o,{top:0,left:0},t||"page").top+(n?this.doc.height-Wr(o):0)},defaultTextHeight:function(){return st(this.display)},defaultCharWidth:function(){return at(this.display)},setGutterMarker:gt((function(e,t,n){return _n(this,e,"gutter",(function(e){var r=e.gutterMarkers||(e.gutterMarkers={});return r[t]=n,!n&&Vo(r)&&(e.gutterMarkers=null),!0}))})),clearGutter:gt((function(e){var t=this,n=t.doc,r=n.first;n.iter((function(n){n.gutterMarkers&&n.gutterMarkers[e]&&(n.gutterMarkers[e]=null,bt(t,r,"gutter"),Vo(n.gutterMarkers)&&(n.gutterMarkers=null)),++r}))})),addLineClass:gt((function(e,t,n){return _n(this,e,"class",(function(e){var r="text"==t?"textClass":"background"==t?"bgClass":"wrapClass";if(e[r]){if(new RegExp("(?:^|\\s)"+n+"(?:$|\\s)").test(e[r]))return!1;e[r]+=" "+n}else e[r]=n;return!0}))})),removeLineClass:gt((function(e,t,n){return _n(this,e,"class",(function(e){var r="text"==t?"textClass":"background"==t?"bgClass":"wrapClass",o=e[r];if(!o)return!1;if(null==n)e[r]=null;else{var i=o.match(new RegExp("(?:^|\\s+)"+n+"(?:$|\\s+)"));if(!i)return!1;var s=i.index+i[0].length;e[r]=o.slice(0,i.index)+(i.index&&s!=o.length?" ":"")+o.slice(s)||null}return!0}))})),addLineWidget:gt((function(e,t,n){return function(e,t,n,r){var o=new hr(e,n,r);o.noHScroll&&(e.display.alignWidgets=!0);return _n(e,t,"widget",(function(t){var n=t.widgets||(t.widgets=[]);if(null==o.insertAt?n.push(o):n.splice(Math.min(n.length-1,Math.max(0,o.insertAt)),0,o),o.line=t,!ur(e.doc,t)){var r=Wr(t)<e.doc.scrollTop;Hr(t,t.height+fr(o)),r&&gn(e,null,o.height),e.curOp.forceUpdate=!0}return!0})),o}(this,e,t,n)})),removeLineWidget:function(e){e.clear()},lineInfo:function(e){if("number"==typeof e){if(!ye(this.doc,e))return null;var t=e;if(!(e=zr(this.doc,e)))return null}else{if(null==(t=Gr(e)))return null}return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,n,r,o){var i=this.display,s=(e=tt(this,ve(this.doc,e))).bottom,a=e.left;if(t.style.position="absolute",i.sizer.appendChild(t),"over"==r)s=e.top;else if("above"==r||"near"==r){var l=Math.max(i.wrapper.clientHeight,this.doc.height),c=Math.max(i.sizer.clientWidth,i.lineSpace.clientWidth);("above"==r||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight?s=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=l&&(s=e.bottom),a+t.offsetWidth>c&&(a=c-t.offsetWidth)}t.style.top=s+"px",t.style.left=t.style.right="","right"==o?(a=i.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==o?a=0:"middle"==o&&(a=(i.sizer.clientWidth-t.offsetWidth)/2),t.style.left=a+"px"),n&&function(e,t,n,r,o){var i=fn(e,t,n,r,o);null!=i.scrollTop&&jt(e,i.scrollTop),null!=i.scrollLeft&&zt(e,i.scrollLeft)}(this,a,s,a+t.offsetWidth,s+t.offsetHeight)},triggerOnKeyDown:gt(Jt),triggerOnKeyPress:gt(Zt),triggerOnKeyUp:gt(Qt),execCommand:function(e){if(Dn.hasOwnProperty(e))return Dn[e](this)},findPosH:function(e,t,n,r){var o=1;t<0&&(o=-1,t=-t);for(var i=0,s=ve(this.doc,e);i<t&&!(s=wn(this.doc,s,o,n,r)).hitSide;++i);return s},moveH:gt((function(e,t){var n=this;n.extendSelectionsBy((function(r){return n.display.shift||n.doc.extend||r.empty()?wn(n.doc,r.head,e,t,n.options.rtlMoveVisually):e<0?r.from():r.to()}),Oo)})),deleteH:gt((function(e,t){var n=this.doc.sel,r=this.doc;n.somethingSelected()?r.replaceSelection("",null,"+delete"):bn(this,(function(n){var o=wn(r,n.head,e,t,!1);return e<0?{from:o,to:n.head}:{from:n.head,to:o}}))})),findPosV:function(e,t,n,r){var o=1,i=r;t<0&&(o=-1,t=-t);for(var s=0,a=ve(this.doc,e);s<t;++s){var l=tt(this,a,"div");if(null==i?i=l.left:l.left=i,(a=Sn(this,l,o,n)).hitSide)break}return a},moveV:gt((function(e,t){var n=this,r=this.doc,o=[],i=!n.display.shift&&!r.extend&&r.sel.somethingSelected();if(r.extendSelectionsBy((function(s){if(i)return e<0?s.from():s.to();var a=tt(n,s.head,"div");null!=s.goalColumn&&(a.left=s.goalColumn),o.push(a.left);var l=Sn(n,a,e,t);return"page"==t&&s==r.sel.primary()&&gn(n,null,et(n,l,"div").top-a.top),l}),Oo),o.length)for(var s=0;s<r.sel.ranges.length;s++)r.sel.ranges[s].goalColumn=o[s]})),toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?this.display.cursorDiv.className+=" CodeMirror-overwrite":this.display.cursorDiv.className=this.display.cursorDiv.className.replace(" CodeMirror-overwrite",""),go(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return Qo()==this.display.input},scrollTo:gt((function(e,t){null==e&&null==t||vn(this),null!=e&&(this.curOp.scrollLeft=e),null!=t&&(this.curOp.scrollTop=t)})),getScrollInfo:function(){var e=this.display.scroller,t=So;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-t,width:e.scrollWidth-t,clientHeight:e.clientHeight-t,clientWidth:e.clientWidth-t}},scrollIntoView:gt((function(e,t){if(null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:ae(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line)vn(this),this.curOp.scrollToPos=e;else{var n=fn(this,Math.min(e.from.left,e.to.left),Math.min(e.from.top,e.to.top)-e.margin,Math.max(e.from.right,e.to.right),Math.max(e.from.bottom,e.to.bottom)+e.margin);this.scrollTo(n.scrollLeft,n.scrollTop)}})),setSize:gt((function(e,t){function n(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e}null!=e&&(this.display.wrapper.style.width=n(e)),null!=t&&(this.display.wrapper.style.height=n(t)),this.options.lineWrapping&&Xe(this),this.curOp.forceUpdate=!0,go(this,"refresh",this)})),operation:function(e){return pt(this,e)},refresh:gt((function(){var e=this.display.cachedTextHeight;_t(this),Ye(this),this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop),(null==e||Math.abs(e-st(this.display))>.5)&&N(this),go(this,"refresh",this)})),swapDoc:gt((function(e){var t=this.doc;return t.cm=null,jr(this,e),Ye(this),kt(this),this.scrollTo(e.scrollLeft,e.scrollTop),vo(this,"swapDoc",this,t),t})),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},wo(x);var In=x.defaults={},xn=x.optionHandlers={};function On(e,t,n,r){x.defaults[e]=t,n&&(xn[e]=r?function(e,t,r){r!=Mn&&n(e,t,r)}:n)}var Mn=x.Init={toString:function(){return"CodeMirror.Init"}};On("value","",(function(e,t){e.setValue(t)}),!0),On("mode",null,(function(e,t){e.doc.modeOption=t,M(e)}),!0),On("indentUnit",2,M,!0),On("indentWithTabs",!1),On("smartIndent",!0),On("tabSize",4,(function(e){k(e),Ye(e),_t(e)}),!0),On("specialChars",/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\ufeff]/g,(function(e,t){e.options.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),e.refresh()}),!0),On("specialCharPlaceholder",(function(e){var t=Ko("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t}),(function(e){e.refresh()}),!0),On("electricChars",!0),On("rtlMoveVisually",!_),On("wholeLineUpdateBefore",!0),On("theme","default",(function(e){L(e),A(e)}),!0),On("keyMap","default",T),On("extraKeys",null),On("lineWrapping",!1,(function(e){e.options.lineWrapping?(e.display.wrapper.className+=" CodeMirror-wrap",e.display.sizer.style.minWidth=""):(e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-wrap",""),P(e)),N(e),_t(e),Ye(e),setTimeout((function(){j(e)}),100)}),!0),On("gutters",[],(function(e){F(e.options),A(e)}),!0),On("fixedGutter",!0,(function(e,t){e.display.gutters.style.left=t?H(e.display)+"px":"0",e.refresh()}),!0),On("coverGutterNextToScrollbar",!1,j,!0),On("lineNumbers",!1,(function(e){F(e.options),A(e)}),!0),On("firstLineNumber",1,A,!0),On("lineNumberFormatter",(function(e){return e}),A,!0),On("showCursorWhenSelecting",!1,Te,!0),On("resetSelectionOnContextMenu",!0),On("readOnly",!1,(function(e,t){"nocursor"==t?(en(e),e.display.input.blur(),e.display.disabled=!0):(e.display.disabled=!1,t||kt(e))})),On("disableInput",!1,(function(e,t){t||kt(e)}),!0),On("dragDrop",!0),On("cursorBlinkRate",530),On("cursorScrollMargin",0),On("cursorHeight",1),On("workTime",100),On("workDelay",100),On("flattenSpans",!0,k,!0),On("addModeClass",!1,k,!0),On("pollInterval",100),On("undoDepth",200,(function(e,t){e.doc.history.undoDepth=t})),On("historyEventDelay",1250),On("viewportMargin",10,(function(e){e.refresh()}),!0),On("maxHighlightLength",1e4,k,!0),On("moveInputWithCursor",!0,(function(e,t){t||(e.display.inputDiv.style.top=e.display.inputDiv.style.left=0)})),On("tabindex",null,(function(e,t){e.display.input.tabIndex=t||""})),On("autofocus",null);var kn=x.modes={},En=x.mimeModes={};x.defineMode=function(e,t){if(x.defaults.mode||"null"==e||(x.defaults.mode=e),arguments.length>2){t.dependencies=[];for(var n=2;n<arguments.length;++n)t.dependencies.push(arguments[n])}kn[e]=t},x.defineMIME=function(e,t){En[e]=t},x.resolveMode=function(e){if("string"==typeof e&&En.hasOwnProperty(e))e=En[e];else if(e&&"string"==typeof e.name&&En.hasOwnProperty(e.name)){var t=En[e.name];"string"==typeof t&&(t={name:t}),(e=Po(t,e)).name=t.name}else if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return x.resolveMode("application/xml");return"string"==typeof e?{name:e}:e||{name:"null"}},x.getMode=function(e,t){t=x.resolveMode(t);var n=kn[t.name];if(!n)return x.getMode(e,"text/plain");var r=n(e,t);if(Nn.hasOwnProperty(t.name)){var o=Nn[t.name];for(var i in o)o.hasOwnProperty(i)&&(r.hasOwnProperty(i)&&(r["_"+i]=r[i]),r[i]=o[i])}if(r.name=t.name,t.helperType&&(r.helperType=t.helperType),t.modeProps)for(var i in t.modeProps)r[i]=t.modeProps[i];return r},x.defineMode("null",(function(){return{token:function(e){e.skipToEnd()}}})),x.defineMIME("text/plain","null");var Nn=x.modeExtensions={};x.extendMode=function(e,t){Fo(t,Nn.hasOwnProperty(e)?Nn[e]:Nn[e]={})},x.defineExtension=function(e,t){x.prototype[e]=t},x.defineDocExtension=function(e,t){Dr.prototype[e]=t},x.defineOption=On;var Tn=[];x.defineInitHook=function(e){Tn.push(e)};var Ln=x.helpers={};x.registerHelper=function(e,t,n){Ln.hasOwnProperty(e)||(Ln[e]=x[e]={_global:[]}),Ln[e][t]=n},x.registerGlobalHelper=function(e,t,n,r){x.registerHelper(e,t,r),Ln[e]._global.push({pred:n,val:r})};var An=x.copyState=function(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var n={};for(var r in t){var o=t[r];o instanceof Array&&(o=o.concat([])),n[r]=o}return n},Rn=x.startState=function(e,t,n){return!e.startState||e.startState(t,n)};x.innerMode=function(e,t){for(;e.innerMode;){var n=e.innerMode(t);if(!n||n.mode==e)break;t=n.state,e=n.mode}return n||{mode:e,state:t}};var Dn=x.commands={selectAll:function(e){e.setSelection(ae(e.firstLine(),0),ae(e.lastLine()),Io)},singleSelection:function(e){e.setSelection(e.getCursor("anchor"),e.getCursor("head"),Io)},killLine:function(e){bn(e,(function(t){if(t.empty()){var n=zr(e.doc,t.head.line).text.length;return t.head.ch==n&&t.head.line<e.lastLine()?{from:t.head,to:ae(t.head.line+1,0)}:{from:t.head,to:ae(t.head.line,n)}}return{from:t.from(),to:t.to()}}))},deleteLine:function(e){bn(e,(function(t){return{from:ae(t.from().line,0),to:ve(e.doc,ae(t.to().line+1,0))}}))},delLineLeft:function(e){bn(e,(function(e){return{from:ae(e.from().line,0),to:e.from()}}))},undo:function(e){e.undo()},redo:function(e){e.redo()},undoSelection:function(e){e.undoSelection()},redoSelection:function(e){e.redoSelection()},goDocStart:function(e){e.extendSelection(ae(e.firstLine(),0))},goDocEnd:function(e){e.extendSelection(ae(e.lastLine()))},goLineStart:function(e){e.extendSelectionsBy((function(t){return gi(e,t.head.line)}),Oo)},goLineStartSmart:function(e){e.extendSelectionsBy((function(t){var n=gi(e,t.head.line),r=e.getLineHandle(n.line),o=Kr(r);if(!o||0==o[0].level){var i=Math.max(0,r.text.search(/\S/)),s=t.head.line==n.line&&t.head.ch<=i&&t.head.ch;return ae(n.line,s?0:i)}return n}),Oo)},goLineEnd:function(e){e.extendSelectionsBy((function(t){return function(e,t){var n,r=zr(e.doc,t);for(;n=ir(r);)r=n.find(1,!0).line,t=null;var o=Kr(r),i=o?o[0].level%2?pi(r):fi(r):r.text.length;return ae(null==t?Gr(r):t,i)}(e,t.head.line)}),Oo)},goLineRight:function(e){e.extendSelectionsBy((function(t){var n=e.charCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:n},"div")}),Oo)},goLineLeft:function(e){e.extendSelectionsBy((function(t){var n=e.charCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:n},"div")}),Oo)},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goGroupRight:function(e){e.moveH(1,"group")},goGroupLeft:function(e){e.moveH(-1,"group")},goWordRight:function(e){e.moveH(1,"word")},delCharBefore:function(e){e.deleteH(-1,"char")},delCharAfter:function(e){e.deleteH(1,"char")},delWordBefore:function(e){e.deleteH(-1,"word")},delWordAfter:function(e){e.deleteH(1,"word")},delGroupBefore:function(e){e.deleteH(-1,"group")},delGroupAfter:function(e){e.deleteH(1,"group")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("\t")},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){pt(e,(function(){for(var t=e.listSelections(),n=0;n<t.length;n++){var r=t[n].head,o=zr(e.doc,r.line).text;r.ch>0&&r.ch<o.length-1&&e.replaceRange(o.charAt(r.ch)+o.charAt(r.ch-1),ae(r.line,r.ch-1),ae(r.line,r.ch+1))}}))},newlineAndIndent:function(e){pt(e,(function(){for(var t=e.listSelections().length,n=0;n<t;n++){var r=e.listSelections()[n];e.replaceRange("\n",r.anchor,r.head,"+input"),e.indentLine(r.from().line+1,null,!0),mn(e)}}))},toggleOverwrite:function(e){e.toggleOverwrite()}},Pn=x.keyMap={};function Fn(e){return"string"==typeof e?Pn[e]:e}Pn.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Pn.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Pn.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delLineLeft","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection",fallthrough:["basic","emacsy"]},Pn.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},Pn.default=y?Pn.macDefault:Pn.pcDefault;var Bn=x.lookupKey=function(e,t,n){function r(t){var o=(t=Fn(t))[e];if(!1===o)return"stop";if(null!=o&&n(o))return!0;if(t.nofallthrough)return"stop";var i=t.fallthrough;if(null==i)return!1;if("[object Array]"!=Object.prototype.toString.call(i))return r(i);for(var s=0;s<i.length;++s){var a=r(i[s]);if(a)return a}return!1}for(var o=0;o<t.length;++o){var i=r(t[o]);if(i)return"stop"!=i}},jn=x.isModifierKey=function(e){var t=ui[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t},zn=x.keyName=function(e,t){if(u&&34==e.keyCode&&e.char)return!1;var n=ui[e.keyCode];return null!=n&&!e.altGraphKey&&(e.altKey&&(n="Alt-"+n),(w?e.metaKey:e.ctrlKey)&&(n="Ctrl-"+n),(w?e.ctrlKey:e.metaKey)&&(n="Cmd-"+n),!t&&e.shiftKey&&(n="Shift-"+n),n)};x.fromTextArea=function(e,t){if(t||(t={}),t.value=e.value,!t.tabindex&&e.tabindex&&(t.tabindex=e.tabindex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var n=Qo();t.autofocus=n==e||null!=e.getAttribute("autofocus")&&n==document.body}function r(){e.value=a.getValue()}if(e.form&&(po(e.form,"submit",r),!t.leaveSubmitMethodAlone)){var o=e.form,i=o.submit;try{var s=o.submit=function(){r(),o.submit=i,o.submit(),o.submit=s}}catch(e){}}e.style.display="none";var a=x((function(t){e.parentNode.insertBefore(t,e.nextSibling)}),t);return a.save=r,a.getTextArea=function(){return e},a.toTextArea=function(){r(),e.parentNode.removeChild(a.getWrapperElement()),e.style.display="",e.form&&(fo(e.form,"submit",r),"function"==typeof e.form.submit&&(e.form.submit=i))},a};var Vn=x.StringStream=function(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};Vn.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(e){var t=this.string.charAt(this.pos);if("string"==typeof e)var n=t==e;else n=t&&(e.test?e.test(t):e(t));if(n)return++this.pos,t},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},backUp:function(e){this.pos-=e},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=ko(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?ko(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return ko(this.string,null,this.tabSize)-(this.lineStart?ko(this.string,this.lineStart,this.tabSize):0)},match:function(e,t,n){if("string"!=typeof e){var r=this.string.slice(this.pos).match(e);return r&&r.index>0?null:(r&&!1!==t&&(this.pos+=r[0].length),r)}var o=function(e){return n?e.toLowerCase():e};if(o(this.string.substr(this.pos,e.length))==o(e))return!1!==t&&(this.pos+=e.length),!0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}}};var Un=x.TextMarker=function(e,t){this.lines=[],this.type=t,this.doc=e};wo(Un),Un.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&dt(e),bo(this,"clear")){var n=this.find();n&&vo(this,"clear",n.from,n.to)}for(var r=null,o=null,i=0;i<this.lines.length;++i){var s=this.lines[i],a=Kn(s.markedSpans,this);e&&!this.collapsed?bt(e,Gr(s),"text"):e&&(null!=a.to&&(o=Gr(s)),null!=a.from&&(r=Gr(s))),s.markedSpans=Xn(s.markedSpans,a),null==a.from&&this.collapsed&&!ur(this.doc,s)&&e&&Hr(s,st(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(i=0;i<this.lines.length;++i){var l=ar(this.lines[i]),c=D(l);c>e.display.maxLineLength&&(e.display.maxLine=l,e.display.maxLineLength=c,e.display.maxLineChanged=!0)}null!=r&&e&&this.collapsed&&_t(e,r,o+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&ke(e.doc)),e&&vo(e,"markerCleared",e,this),t&&ht(e)}},Un.prototype.find=function(e,t){var n,r;null==e&&"bookmark"==this.type&&(e=1);for(var o=0;o<this.lines.length;++o){var i=this.lines[o],s=Kn(i.markedSpans,this);if(null!=s.from&&(n=ae(t?i:Gr(i),s.from),-1==e))return n;if(null!=s.to&&(r=ae(t?i:Gr(i),s.to),1==e))return r}return n&&{from:n,to:r}},Un.prototype.changed=function(){var e=this.find(-1,!0),t=this,n=this.doc.cm;e&&n&&pt(n,(function(){var r=e.line,o=Gr(e.line),i=Ue(n,o);if(i&&(Ke(i),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!ur(t.doc,r)&&null!=t.height){var s=t.height;t.height=null;var a=fr(t)-s;a&&Hr(r,r.height+a)}}))},Un.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=Ro(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},Un.prototype.detachLine=function(e){if(this.lines.splice(Ro(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}};var Hn=0;function Gn(e,t,n,r,o){if(r&&r.shared)return function(e,t,n,r,o){(r=Fo(r)).shared=!1;var i=[Gn(e,t,n,r,o)],s=i[0],a=r.widgetNode;return Br(e,(function(e){a&&(r.widgetNode=a.cloneNode(!0)),i.push(Gn(e,ve(e,t),ve(e,n),r,o));for(var l=0;l<e.linked.length;++l)if(e.linked[l].isParent)return;s=Lo(i)})),new qn(i,s)}(e,t,n,r,o);if(e.cm&&!e.cm.curOp)return ft(e.cm,Gn)(e,t,n,r,o);var i=new Un(e,o),s=le(t,n);if(r&&Fo(r,i),s>0||0==s&&!1!==i.clearWhenEmpty)return i;if(i.replacedWith&&(i.collapsed=!0,i.widgetNode=Ko("span",[i.replacedWith],"CodeMirror-widget"),r.handleMouseEvents||(i.widgetNode.ignoreEvents=!0),r.insertLeft&&(i.widgetNode.insertLeft=!0)),i.collapsed){if(sr(e,t.line,t,n,i)||t.line!=n.line&&sr(e,n.line,t,n,i))throw new Error("Inserting collapsed marker partially overlapping an existing one");I=!0}i.addToHistory&&Qr(e,{from:t,to:n,origin:"markText"},e.sel,NaN);var a,l=t.line,c=e.cm;if(e.iter(l,n.line+1,(function(e){c&&i.collapsed&&!c.options.lineWrapping&&ar(e)==c.display.maxLine&&(a=!0),i.collapsed&&l!=t.line&&Hr(e,0),function(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}(e,new Wn(i,l==t.line?t.ch:null,l==n.line?n.ch:null)),++l})),i.collapsed&&e.iter(t.line,n.line+1,(function(t){ur(e,t)&&Hr(t,0)})),i.clearOnEnter&&po(i,"beforeCursorEnter",(function(){i.clear()})),i.readOnly&&(C=!0,(e.history.done.length||e.history.undone.length)&&e.clearHistory()),i.collapsed&&(i.id=++Hn,i.atomic=!0),c){if(a&&(c.curOp.updateMaxLine=!0),i.collapsed)_t(c,t.line,n.line+1);else if(i.className||i.title||i.startStyle||i.endStyle)for(var u=t.line;u<=n.line;u++)bt(c,u,"text");i.atomic&&ke(c.doc),vo(c,"markerAdded",c,i)}return i}var qn=x.SharedTextMarker=function(e,t){this.markers=e,this.primary=t;for(var n=0,r=this;n<e.length;++n)e[n].parent=this,po(e[n],"clear",(function(){r.clear()}))};function Wn(e,t,n){this.marker=e,this.from=t,this.to=n}function Kn(e,t){if(e)for(var n=0;n<e.length;++n){var r=e[n];if(r.marker==t)return r}}function Xn(e,t){for(var n,r=0;r<e.length;++r)e[r]!=t&&(n||(n=[])).push(e[r]);return n}function Yn(e,t){var n=ye(e,t.from.line)&&zr(e,t.from.line).markedSpans,r=ye(e,t.to.line)&&zr(e,t.to.line).markedSpans;if(!n&&!r)return null;var o=t.from.ch,i=t.to.ch,s=0==le(t.from,t.to),a=function(e,t,n){if(e)for(var r,o=0;o<e.length;++o){var i=e[o],s=i.marker;if(null==i.from||(s.inclusiveLeft?i.from<=t:i.from<t)||i.from==t&&"bookmark"==s.type&&(!n||!i.marker.insertLeft)){var a=null==i.to||(s.inclusiveRight?i.to>=t:i.to>t);(r||(r=[])).push(new Wn(s,i.from,a?null:i.to))}}return r}(n,o,s),l=function(e,t,n){if(e)for(var r,o=0;o<e.length;++o){var i=e[o],s=i.marker;if(null==i.to||(s.inclusiveRight?i.to>=t:i.to>t)||i.from==t&&"bookmark"==s.type&&(!n||i.marker.insertLeft)){var a=null==i.from||(s.inclusiveLeft?i.from<=t:i.from<t);(r||(r=[])).push(new Wn(s,a?null:i.from-t,null==i.to?null:i.to-t))}}return r}(r,i,s),c=1==t.text.length,u=Lo(t.text).length+(c?o:0);if(a)for(var d=0;d<a.length;++d){if(null==(h=a[d]).to)(p=Kn(l,h.marker))?c&&(h.to=null==p.to?null:p.to+u):h.to=o}if(l)for(d=0;d<l.length;++d){var h,p;if(null!=(h=l[d]).to&&(h.to+=u),null==h.from)(p=Kn(a,h.marker))||(h.from=u,c&&(a||(a=[])).push(h));else h.from+=u,c&&(a||(a=[])).push(h)}a&&(a=Jn(a)),l&&l!=a&&(l=Jn(l));var f=[a];if(!c){var g,m=t.text.length-2;if(m>0&&a)for(d=0;d<a.length;++d)null==a[d].to&&(g||(g=[])).push(new Wn(a[d].marker,null,null));for(d=0;d<m;++d)f.push(g);f.push(l)}return f}function Jn(e){for(var t=0;t<e.length;++t){var n=e[t];null!=n.from&&n.from==n.to&&!1!==n.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function Qn(e,t){var n=function(e,t){var n=t["spans_"+e.id];if(!n)return null;for(var r=0,o=[];r<t.text.length;++r)o.push(eo(n[r]));return o}(e,t),r=Yn(e,t);if(!n)return r;if(!r)return n;for(var o=0;o<n.length;++o){var i=n[o],s=r[o];if(i&&s)e:for(var a=0;a<s.length;++a){for(var l=s[a],c=0;c<i.length;++c)if(i[c].marker==l.marker)continue e;i.push(l)}else s&&(n[o]=s)}return n}function Zn(e){var t=e.markedSpans;if(t){for(var n=0;n<t.length;++n)t[n].marker.detachLine(e);e.markedSpans=null}}function $n(e,t){if(t){for(var n=0;n<t.length;++n)t[n].marker.attachLine(e);e.markedSpans=t}}function er(e){return e.inclusiveLeft?-1:0}function tr(e){return e.inclusiveRight?1:0}function nr(e,t){var n=e.lines.length-t.lines.length;if(0!=n)return n;var r=e.find(),o=t.find(),i=le(r.from,o.from)||er(e)-er(t);if(i)return-i;var s=le(r.to,o.to)||tr(e)-tr(t);return s||t.id-e.id}function rr(e,t){var n,r=I&&e.markedSpans;if(r)for(var o,i=0;i<r.length;++i)(o=r[i]).marker.collapsed&&null==(t?o.from:o.to)&&(!n||nr(n,o.marker)<0)&&(n=o.marker);return n}function or(e){return rr(e,!0)}function ir(e){return rr(e,!1)}function sr(e,t,n,r,o){var i=zr(e,t),s=I&&i.markedSpans;if(s)for(var a=0;a<s.length;++a){var l=s[a];if(l.marker.collapsed){var c=l.marker.find(0),u=le(c.from,n)||er(l.marker)-er(o),d=le(c.to,r)||tr(l.marker)-tr(o);if(!(u>=0&&d<=0||u<=0&&d>=0)&&(u<=0&&(le(c.to,n)||tr(l.marker)-er(o))>0||u>=0&&(le(c.from,r)||er(l.marker)-tr(o))<0))return!0}}}function ar(e){for(var t;t=or(e);)e=t.find(-1,!0).line;return e}function lr(e,t){var n=zr(e,t),r=ar(n);return n==r?t:Gr(r)}function cr(e,t){if(t>e.lastLine())return t;var n,r=zr(e,t);if(!ur(e,r))return t;for(;n=ir(r);)r=n.find(1,!0).line;return Gr(r)+1}function ur(e,t){var n=I&&t.markedSpans;if(n)for(var r,o=0;o<n.length;++o)if((r=n[o]).marker.collapsed){if(null==r.from)return!0;if(!r.marker.widgetNode&&0==r.from&&r.marker.inclusiveLeft&&dr(e,t,r))return!0}}function dr(e,t,n){if(null==n.to){var r=n.marker.find(1,!0);return dr(e,r.line,Kn(r.line.markedSpans,n.marker))}if(n.marker.inclusiveRight&&n.to==t.text.length)return!0;for(var o,i=0;i<t.markedSpans.length;++i)if((o=t.markedSpans[i]).marker.collapsed&&!o.marker.widgetNode&&o.from==n.to&&(null==o.to||o.to!=n.from)&&(o.marker.inclusiveLeft||n.marker.inclusiveRight)&&dr(e,t,o))return!0}wo(qn),qn.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();vo(this,"clear")}},qn.prototype.find=function(e,t){return this.primary.find(e,t)};var hr=x.LineWidget=function(e,t,n){if(n)for(var r in n)n.hasOwnProperty(r)&&(this[r]=n[r]);this.cm=e,this.node=t};function pr(e,t,n){Wr(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&gn(e,null,n)}function fr(e){return null!=e.height?e.height:(Jo(document.body,e.node)||Yo(e.cm.display.measure,Ko("div",[e.node],null,"position: relative")),e.height=e.node.offsetHeight)}wo(hr),hr.prototype.clear=function(){var e=this.cm,t=this.line.widgets,n=this.line,r=Gr(n);if(null!=r&&t){for(var o=0;o<t.length;++o)t[o]==this&&t.splice(o--,1);t.length||(n.widgets=null);var i=fr(this);pt(e,(function(){pr(e,n,-i),bt(e,r,"widget"),Hr(n,Math.max(0,n.height-i))}))}},hr.prototype.changed=function(){var e=this.height,t=this.cm,n=this.line;this.height=null;var r=fr(this)-e;r&&pt(t,(function(){t.curOp.forceUpdate=!0,pr(t,n,r),Hr(n,n.height+r)}))};var gr=x.Line=function(e,t,n){this.text=e,$n(this,t),this.height=n?n(this):1};function mr(e){e.parent=null,Zn(e)}function vr(e,t,n,r,o,i){var s=n.flattenSpans;null==s&&(s=e.options.flattenSpans);var a,l=0,c=null,u=new Vn(t,e.options.tabSize);for(""==t&&n.blankLine&&n.blankLine(r);!u.eol();){if(u.pos>e.options.maxHighlightLength?(s=!1,i&&br(e,t,r,u.pos),u.pos=t.length,a=null):a=n.token(u,r),e.options.addModeClass){var d=x.innerMode(n,r).mode.name;d&&(a="m-"+(a?d+" "+a:d))}s&&c==a||(l<u.start&&o(u.start,c),l=u.start,c=a),u.start=u.pos}for(;l<u.pos;){var h=Math.min(u.pos,l+5e4);o(h,c),l=h}}function yr(e,t,n,r){var o=[e.state.modeGen];vr(e,t.text,e.doc.mode,n,(function(e,t){o.push(e,t)}),r);for(var i=0;i<e.state.overlays.length;++i){var s=e.state.overlays[i],a=1,l=0;vr(e,t.text,s.mode,!0,(function(e,t){for(var n=a;l<e;){var r=o[a];r>e&&o.splice(a,1,e,o[a+1],r),a+=2,l=Math.min(e,r)}if(t)if(s.opaque)o.splice(n,a-n,e,t),a=n+2;else for(;n<a;n+=2){var i=o[n+1];o[n+1]=i?i+" "+t:t}}))}return o}function _r(e,t){return t.styles&&t.styles[0]==e.state.modeGen||(t.styles=yr(e,t,t.stateAfter=Fe(e,Gr(t)))),t.styles}function br(e,t,n,r){var o=e.doc.mode,i=new Vn(t,e.options.tabSize);for(i.start=i.pos=r||0,""==t&&o.blankLine&&o.blankLine(n);!i.eol()&&i.pos<=e.options.maxHighlightLength;)o.token(i,n),i.start=i.pos}wo(gr),gr.prototype.lineNo=function(){return Gr(this)};var wr={},Sr={};function Cr(e,t){if(!e)return null;for(;;){var n=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!n)break;e=e.slice(0,n.index)+e.slice(n.index+n[0].length);var r=n[1]?"bgClass":"textClass";null==t[r]?t[r]=n[2]:new RegExp("(?:^|s)"+n[2]+"(?:$|s)").test(t[r])||(t[r]+=" "+n[2])}if(/^\s*$/.test(e))return null;var o=t.cm.options.addModeClass?Sr:wr;return o[e]||(o[e]=e.replace(/\S+/g,"cm-$&"))}function Ir(e,t){var n=Ko("span",null,null,a?"padding-right: .1px":null),r={pre:Ko("pre",[n]),content:n,col:0,pos:0,cm:e};t.measure={};for(var o=0;o<=(t.rest?t.rest.length:0);o++){var i,l=o?t.rest[o-1]:t.line;r.pos=0,r.addToken=xr,(s||a)&&e.getOption("lineWrapping")&&(r.addToken=Or(r.addToken)),oi(e.display.measure)&&(i=Kr(l))&&(r.addToken=Mr(r.addToken,i)),r.map=[],Er(l,r,_r(e,l)),0==r.map.length&&r.map.push(0,0,r.content.appendChild(ri(e.display.measure))),0==o?(t.measure.map=r.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(r.map),(t.measure.caches||(t.measure.caches=[])).push({}))}return go(e,"renderLine",e,t.line,r.pre),r}function xr(e,t,n,o,i,s){if(t){var a=e.cm.options.specialChars,l=!1;if(a.test(t)){g=document.createDocumentFragment();for(var c=0;;){a.lastIndex=c;var u=a.exec(t),d=u?u.index-c:t.length-c;if(d){var h=document.createTextNode(t.slice(c,c+d));r?g.appendChild(Ko("span",[h])):g.appendChild(h),e.map.push(e.pos,e.pos+d,h),e.col+=d,e.pos+=d}if(!u)break;if(c+=d+1,"\t"==u[0]){var p=e.cm.options.tabSize,f=p-e.col%p;h=g.appendChild(Ko("span",To(f),"cm-tab"));e.col+=f}else{h=e.cm.options.specialCharPlaceholder(u[0]);r?g.appendChild(Ko("span",[h])):g.appendChild(h),e.col+=1}e.map.push(e.pos,e.pos+1,h),e.pos++}}else{e.col+=t.length;var g=document.createTextNode(t);e.map.push(e.pos,e.pos+t.length,g),r&&(l=!0),e.pos+=t.length}if(n||o||i||l){var m=n||"";o&&(m+=o),i&&(m+=i);var v=Ko("span",[g],m);return s&&(v.title=s),e.content.appendChild(v)}e.content.appendChild(g)}}function Or(e){function t(e){for(var t=" ",n=0;n<e.length-2;++n)t+=n%2?" ":" ";return t+=" "}return function(n,r,o,i,s,a){e(n,r.replace(/ {3,}/g,t),o,i,s,a)}}function Mr(e,t){return function(n,r,o,i,s,a){o=o?o+" cm-force-border":"cm-force-border";for(var l=n.pos,c=l+r.length;;){for(var u=0;u<t.length;u++){var d=t[u];if(d.to>l&&d.from<=l)break}if(d.to>=c)return e(n,r,o,i,s,a);e(n,r.slice(0,d.to-l),o,i,null,a),i=null,r=r.slice(d.to-l),l=d.to}}}function kr(e,t,n,r){var o=!r&&n.widgetNode;o&&(e.map.push(e.pos,e.pos+t,o),e.content.appendChild(o)),e.pos+=t}function Er(e,t,n){var r=e.markedSpans,o=e.text,i=0;if(r)for(var s,a,l,c,u,d,h=o.length,p=0,f=(C=1,""),g=0;;){if(g==p){a=l=c=u="",d=null,g=1/0;for(var m=[],v=0;v<r.length;++v){var y=r[v],_=y.marker;y.from<=p&&(null==y.to||y.to>p)?(null!=y.to&&g>y.to&&(g=y.to,l=""),_.className&&(a+=" "+_.className),_.startStyle&&y.from==p&&(c+=" "+_.startStyle),_.endStyle&&y.to==g&&(l+=" "+_.endStyle),_.title&&!u&&(u=_.title),_.collapsed&&(!d||nr(d.marker,_)<0)&&(d=y)):y.from>p&&g>y.from&&(g=y.from),"bookmark"==_.type&&y.from==p&&_.widgetNode&&m.push(_)}if(d&&(d.from||0)==p&&(kr(t,(null==d.to?h+1:d.to)-p,d.marker,null==d.from),null==d.to))return;if(!d&&m.length)for(v=0;v<m.length;++v)kr(t,0,m[v])}if(p>=h)break;for(var b=Math.min(h,g);;){if(f){var w=p+f.length;if(!d){var S=w>b?f.slice(0,b-p):f;t.addToken(t,S,s?s+a:a,c,p+S.length==g?l:"",u)}if(w>=b){f=f.slice(b-p),p=b;break}p=w,c=""}f=o.slice(i,i=n[C++]),s=Cr(n[C++],t)}}else for(var C=1;C<n.length;C+=2)t.addToken(t,o.slice(i,i=n[C]),Cr(n[C+1],t))}function Nr(e,t){return 0==t.from.ch&&0==t.to.ch&&""==Lo(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function Tr(e,t,n,r){function o(e){return n?n[e]:null}function i(e,n,o){!function(e,t,n,r){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),Zn(e),$n(e,n);var o=r?r(e):1;o!=e.height&&Hr(e,o)}(e,n,o,r),vo(e,"change",e,t)}var s=t.from,a=t.to,l=t.text,c=zr(e,s.line),u=zr(e,a.line),d=Lo(l),h=o(l.length-1),p=a.line-s.line;if(Nr(e,t)){for(var f=0,g=[];f<l.length-1;++f)g.push(new gr(l[f],o(f),r));i(u,u.text,h),p&&e.remove(s.line,p),g.length&&e.insert(s.line,g)}else if(c==u)if(1==l.length)i(c,c.text.slice(0,s.ch)+d+c.text.slice(a.ch),h);else{for(g=[],f=1;f<l.length-1;++f)g.push(new gr(l[f],o(f),r));g.push(new gr(d+c.text.slice(a.ch),h,r)),i(c,c.text.slice(0,s.ch)+l[0],o(0)),e.insert(s.line+1,g)}else if(1==l.length)i(c,c.text.slice(0,s.ch)+l[0]+u.text.slice(a.ch),o(0)),e.remove(s.line+1,p);else{i(c,c.text.slice(0,s.ch)+l[0],o(0)),i(u,d+u.text.slice(a.ch),h);for(f=1,g=[];f<l.length-1;++f)g.push(new gr(l[f],o(f),r));p>1&&e.remove(s.line+1,p-1),e.insert(s.line+1,g)}vo(e,"change",e,t)}function Lr(e){this.lines=e,this.parent=null;for(var t=0,n=0;t<e.length;++t)e[t].parent=this,n+=e[t].height;this.height=n}function Ar(e){this.children=e;for(var t=0,n=0,r=0;r<e.length;++r){var o=e[r];t+=o.chunkSize(),n+=o.height,o.parent=this}this.size=t,this.height=n,this.parent=null}Lr.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var n=e,r=e+t;n<r;++n){var o=this.lines[n];this.height-=o.height,mr(o),vo(o,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,n){this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var r=0;r<t.length;++r)t[r].parent=this},iterN:function(e,t,n){for(var r=e+t;e<r;++e)if(n(this.lines[e]))return!0}},Ar.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var n=0;n<this.children.length;++n){var r=this.children[n],o=r.chunkSize();if(e<o){var i=Math.min(t,o-e),s=r.height;if(r.removeInner(e,i),this.height-=s-r.height,o==i&&(this.children.splice(n--,1),r.parent=null),0==(t-=i))break;e=0}else e-=o}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof Lr))){var a=[];this.collapse(a),this.children=[new Lr(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,n){this.size+=t.length,this.height+=n;for(var r=0;r<this.children.length;++r){var o=this.children[r],i=o.chunkSize();if(e<=i){if(o.insertInner(e,t,n),o.lines&&o.lines.length>50){for(;o.lines.length>50;){var s=new Lr(o.lines.splice(o.lines.length-25,25));o.height-=s.height,this.children.splice(r+1,0,s),s.parent=this}this.maybeSpill()}break}e-=i}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=new Ar(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var n=Ro(e.parent.children,e);e.parent.children.splice(n+1,0,t)}else{var r=new Ar(e.children);r.parent=e,e.children=[r,t],e=r}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,n){for(var r=0;r<this.children.length;++r){var o=this.children[r],i=o.chunkSize();if(e<i){var s=Math.min(t,i-e);if(o.iterN(e,s,n))return!0;if(0==(t-=s))break;e=0}else e-=i}}};var Rr=0,Dr=x.Doc=function(e,t,n){if(!(this instanceof Dr))return new Dr(e,t,n);null==n&&(n=0),Ar.call(this,[new Lr([new gr("",null)])]),this.first=n,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.frontier=n;var r=ae(n,0);this.sel=ge(r),this.history=new Xr(null),this.id=++Rr,this.modeOption=t,"string"==typeof e&&(e=ai(e)),Tr(this,{from:r,to:r,text:e}),xe(this,ge(r),Io)};Dr.prototype=Po(Ar.prototype,{constructor:Dr,iter:function(e,t,n){n?this.iterN(e-this.first,t-e,n):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var n=0,r=0;r<t.length;++r)n+=t[r].height;this.insertInner(e-this.first,t,n)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=Ur(this,this.first,this.first+this.size);return!1===e?t:t.join(e||"\n")},setValue:mt((function(e){var t=ae(this.first,0),n=this.first+this.size-1;ln(this,{from:t,to:ae(n,zr(this,n).text.length),text:ai(e),origin:"setValue"},!0),xe(this,ge(t))})),replaceRange:function(e,t,n,r){pn(this,e,t=ve(this,t),n=n?ve(this,n):t,r)},getRange:function(e,t,n){var r=Vr(this,ve(this,e),ve(this,t));return!1===n?r:r.join(n||"\n")},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(ye(this,e))return zr(this,e)},getLineNumber:function(e){return Gr(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=zr(this,e)),ar(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return ve(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:mt((function(e,t,n){Ce(this,ve(this,"number"==typeof e?ae(e,t||0):e),null,n)})),setSelection:mt((function(e,t,n){Ce(this,ve(this,e),ve(this,t||e),n)})),extendSelection:mt((function(e,t,n){be(this,ve(this,e),t&&ve(this,t),n)})),extendSelections:mt((function(e,t){we(this,function(e,t){for(var n=[],r=0;r<t.length;r++)n[r]=ve(e,t[r]);return n}(this,e))})),extendSelectionsBy:mt((function(e,t){we(this,Do(this.sel.ranges,e),t)})),setSelections:mt((function(e,t,n){if(e.length){for(var r=0,o=[];r<e.length;r++)o[r]=new pe(ve(this,e[r].anchor),ve(this,e[r].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),xe(this,fe(o,t),n)}})),addSelection:mt((function(e,t,n){var r=this.sel.ranges.slice(0);r.push(new pe(ve(this,e),ve(this,t||e))),xe(this,fe(r,r.length-1),n)})),getSelection:function(e){for(var t,n=this.sel.ranges,r=0;r<n.length;r++){var o=Vr(this,n[r].from(),n[r].to());t=t?t.concat(o):o}return!1===e?t:t.join(e||"\n")},getSelections:function(e){for(var t=[],n=this.sel.ranges,r=0;r<n.length;r++){var o=Vr(this,n[r].from(),n[r].to());!1!==e&&(o=o.join(e||"\n")),t[r]=o}return t},replaceSelection:mt((function(e,t,n){for(var r=[],o=0;o<this.sel.ranges.length;o++)r[o]=e;this.replaceSelections(r,t,n||"+input")})),replaceSelections:function(e,t,n){for(var r=[],o=this.sel,i=0;i<o.ranges.length;i++){var s=o.ranges[i];r[i]={from:s.from(),to:s.to(),text:ai(e[i]),origin:n}}var a=t&&"end"!=t&&function(e,t,n){for(var r=[],o=ae(e.first,0),i=o,s=0;s<t.length;s++){var a=t[s],l=sn(a.from,o,i),c=sn(nn(a),o,i);if(o=a.to,i=c,"around"==n){var u=e.sel.ranges[s],d=le(u.head,u.anchor)<0;r[s]=new pe(d?c:l,d?l:c)}else r[s]=new pe(l,l)}return new he(r,e.sel.primIndex)}(this,r,t);for(i=r.length-1;i>=0;i--)ln(this,r[i]);a?Ie(this,a):this.cm&&mn(this.cm)},undo:mt((function(){un(this,"undo")})),redo:mt((function(){un(this,"redo")})),undoSelection:mt((function(){un(this,"undo",!0)})),redoSelection:mt((function(){un(this,"redo",!0)})),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,n=0,r=0;r<e.done.length;r++)e.done[r].ranges||++t;for(r=0;r<e.undone.length;r++)e.undone[r].ranges||++n;return{undo:t,redo:n}},clearHistory:function(){this.history=new Xr(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:to(this.history.done),undone:to(this.history.undone)}},setHistory:function(e){var t=this.history=new Xr(this.history.maxGeneration);t.done=to(e.done.slice(0),null,!0),t.undone=to(e.undone.slice(0),null,!0)},markText:function(e,t,n){return Gn(this,ve(this,e),ve(this,t),n,"range")},setBookmark:function(e,t){var n={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared};return Gn(this,e=ve(this,e),e,n,"bookmark")},findMarksAt:function(e){var t=[],n=zr(this,(e=ve(this,e)).line).markedSpans;if(n)for(var r=0;r<n.length;++r){var o=n[r];(null==o.from||o.from<=e.ch)&&(null==o.to||o.to>=e.ch)&&t.push(o.marker.parent||o.marker)}return t},findMarks:function(e,t){e=ve(this,e),t=ve(this,t);var n=[],r=e.line;return this.iter(e.line,t.line+1,(function(o){var i=o.markedSpans;if(i)for(var s=0;s<i.length;s++){var a=i[s];r==e.line&&e.ch>a.to||null==a.from&&r!=e.line||r==t.line&&a.from>t.ch||n.push(a.marker.parent||a.marker)}++r})),n},getAllMarks:function(){var e=[];return this.iter((function(t){var n=t.markedSpans;if(n)for(var r=0;r<n.length;++r)null!=n[r].from&&e.push(n[r].marker)})),e},posFromIndex:function(e){var t,n=this.first;return this.iter((function(r){var o=r.text.length+1;if(o>e)return t=e,!0;e-=o,++n})),ve(this,ae(n,t))},indexFromPos:function(e){var t=(e=ve(this,e)).ch;return e.line<this.first||e.ch<0?0:(this.iter(this.first,e.line,(function(e){t+=e.text.length+1})),t)},copy:function(e){var t=new Dr(Ur(this,this.first,this.first+this.size),this.modeOption,this.first);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,n=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<n&&(n=e.to);var r=new Dr(Ur(this,t,n),e.mode||this.modeOption,t);return e.sharedHist&&(r.history=this.history),(this.linked||(this.linked=[])).push({doc:r,sharedHist:e.sharedHist}),r.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],r},unlinkDoc:function(e){if(e instanceof x&&(e=e.doc),this.linked)for(var t=0;t<this.linked.length;++t){if(this.linked[t].doc==e){this.linked.splice(t,1),e.unlinkDoc(this);break}}if(e.history==this.history){var n=[e.id];Br(e,(function(e){n.push(e.id)}),!0),e.history=new Xr(null),e.history.done=to(this.history.done,n),e.history.undone=to(this.history.undone,n)}},iterLinkedDocs:function(e){Br(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),Dr.prototype.eachLine=Dr.prototype.iter;var Pr="iter insert remove copy getEditor".split(" ");for(var Fr in Dr.prototype)Dr.prototype.hasOwnProperty(Fr)&&Ro(Pr,Fr)<0&&(x.prototype[Fr]=function(e){return function(){return e.apply(this.doc,arguments)}}(Dr.prototype[Fr]));function Br(e,t,n){!function e(r,o,i){if(r.linked)for(var s=0;s<r.linked.length;++s){var a=r.linked[s];if(a.doc!=o){var l=i&&a.sharedHist;n&&!l||(t(a.doc,l),e(a.doc,r,l))}}}(e,null,!0)}function jr(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,N(e),M(e),e.options.lineWrapping||P(e),e.options.mode=t.modeOption,_t(e)}function zr(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var n=e;!n.lines;)for(var r=0;;++r){var o=n.children[r],i=o.chunkSize();if(t<i){n=o;break}t-=i}return n.lines[t]}function Vr(e,t,n){var r=[],o=t.line;return e.iter(t.line,n.line+1,(function(e){var i=e.text;o==n.line&&(i=i.slice(0,n.ch)),o==t.line&&(i=i.slice(t.ch)),r.push(i),++o})),r}function Ur(e,t,n){var r=[];return e.iter(t,n,(function(e){r.push(e.text)})),r}function Hr(e,t){var n=t-e.height;if(n)for(var r=e;r;r=r.parent)r.height+=n}function Gr(e){if(null==e.parent)return null;for(var t=e.parent,n=Ro(t.lines,e),r=t.parent;r;t=r,r=r.parent)for(var o=0;r.children[o]!=t;++o)n+=r.children[o].chunkSize();return n+t.first}function qr(e,t){var n=e.first;e:do{for(var r=0;r<e.children.length;++r){var o=e.children[r],i=o.height;if(t<i){e=o;continue e}t-=i,n+=o.chunkSize()}return n}while(!e.lines);for(r=0;r<e.lines.length;++r){var s=e.lines[r].height;if(t<s)break;t-=s}return n+r}function Wr(e){for(var t=0,n=(e=ar(e)).parent,r=0;r<n.lines.length;++r){var o=n.lines[r];if(o==e)break;t+=o.height}for(var i=n.parent;i;i=(n=i).parent)for(r=0;r<i.children.length;++r){var s=i.children[r];if(s==n)break;t+=s.height}return t}function Kr(e){var t=e.order;return null==t&&(t=e.order=wi(e.text)),t}function Xr(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function Yr(e,t){var n={from:ce(t.from),to:nn(t),text:Vr(e,t.from,t.to)};return $r(e,n,t.from.line,t.to.line+1),Br(e,(function(e){$r(e,n,t.from.line,t.to.line+1)}),!0),n}function Jr(e){for(;e.length;){if(!Lo(e).ranges)break;e.pop()}}function Qr(e,t,n,r){var o=e.history;o.undone.length=0;var i,s=+new Date;if((o.lastOp==r||o.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&o.lastModTime>s-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))&&(i=function(e,t){return t?(Jr(e.done),Lo(e.done)):e.done.length&&!Lo(e.done).ranges?Lo(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),Lo(e.done)):void 0}(o,o.lastOp==r))){var a=Lo(i.changes);0==le(t.from,t.to)&&0==le(t.from,a.to)?a.to=nn(t):i.changes.push(Yr(e,t))}else{var l=Lo(o.done);for(l&&l.ranges||Zr(e.sel,o.done),i={changes:[Yr(e,t)],generation:o.generation},o.done.push(i);o.done.length>o.undoDepth;)o.done.shift(),o.done[0].ranges||o.done.shift()}o.done.push(n),o.generation=++o.maxGeneration,o.lastModTime=o.lastSelTime=s,o.lastOp=r,o.lastOrigin=o.lastSelOrigin=t.origin,a||go(e,"historyAdded")}function Zr(e,t){var n=Lo(t);n&&n.ranges&&n.equals(e)||t.push(e)}function $r(e,t,n,r){var o=t["spans_"+e.id],i=0;e.iter(Math.max(e.first,n),Math.min(e.first+e.size,r),(function(n){n.markedSpans&&((o||(o=t["spans_"+e.id]={}))[i]=n.markedSpans),++i}))}function eo(e){if(!e)return null;for(var t,n=0;n<e.length;++n)e[n].marker.explicitlyCleared?t||(t=e.slice(0,n)):t&&t.push(e[n]);return t?t.length?t:null:e}function to(e,t,n){for(var r=0,o=[];r<e.length;++r){var i=e[r];if(i.ranges)o.push(n?he.prototype.deepCopy.call(i):i);else{var s=i.changes,a=[];o.push({changes:a});for(var l=0;l<s.length;++l){var c,u=s[l];if(a.push({from:u.from,to:u.to,text:u.text}),t)for(var d in u)(c=d.match(/^spans_(\d+)$/))&&Ro(t,Number(c[1]))>-1&&(Lo(a)[d]=u[d],delete u[d])}}}return o}function no(e,t,n,r){n<e.line?e.line+=r:t<e.line&&(e.line=t,e.ch=0)}function ro(e,t,n,r){for(var o=0;o<e.length;++o){var i=e[o],s=!0;if(i.ranges){i.copied||((i=e[o]=i.deepCopy()).copied=!0);for(var a=0;a<i.ranges.length;a++)no(i.ranges[a].anchor,t,n,r),no(i.ranges[a].head,t,n,r)}else{for(a=0;a<i.changes.length;++a){var l=i.changes[a];if(n<l.from.line)l.from=ae(l.from.line+r,l.from.ch),l.to=ae(l.to.line+r,l.to.ch);else if(t<=l.to.line){s=!1;break}}s||(e.splice(0,o+1),o=0)}}}function oo(e,t){var n=t.from.line,r=t.to.line,o=t.text.length-(r-n)-1;ro(e.done,n,r,o),ro(e.undone,n,r,o)}wo(Dr);var io=x.e_preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},so=x.e_stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0};function ao(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}var lo=x.e_stop=function(e){io(e),so(e)};function co(e){return e.target||e.srcElement}function uo(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),y&&e.ctrlKey&&1==t&&(t=3),t}var ho,po=x.on=function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else if(e.attachEvent)e.attachEvent("on"+t,n);else{var r=e._handlers||(e._handlers={});(r[t]||(r[t]=[])).push(n)}},fo=x.off=function(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else if(e.detachEvent)e.detachEvent("on"+t,n);else{var r=e._handlers&&e._handlers[t];if(!r)return;for(var o=0;o<r.length;++o)if(r[o]==n){r.splice(o,1);break}}},go=x.signal=function(e,t){var n=e._handlers&&e._handlers[t];if(n)for(var r=Array.prototype.slice.call(arguments,2),o=0;o<n.length;++o)n[o].apply(null,r)},mo=0;function vo(e,t){var n=e._handlers&&e._handlers[t];if(n){var r=Array.prototype.slice.call(arguments,2);ho||(++mo,ho=[],setTimeout(yo,0));for(var o=0;o<n.length;++o)ho.push(i(n[o]))}function i(e){return function(){e.apply(null,r)}}}function yo(){--mo;var e=ho;ho=null;for(var t=0;t<e.length;++t)e[t]()}function _o(e,t,n){return go(e,n||t.type,e,t),ao(t)||t.codemirrorIgnore}function bo(e,t){var n=e._handlers&&e._handlers[t];return n&&n.length>0}function wo(e){e.prototype.on=function(e,t){po(this,e,t)},e.prototype.off=function(e,t){fo(this,e,t)}}var So=30,Co=x.Pass={toString:function(){return"CodeMirror.Pass"}},Io={scroll:!1},xo={origin:"*mouse"},Oo={origin:"+move"};function Mo(){this.id=null}Mo.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var ko=x.countColumn=function(e,t,n,r,o){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var i=r||0,s=o||0;;){var a=e.indexOf("\t",i);if(a<0||a>=t)return s+(t-i);s+=a-i,s+=n-s%n,i=a+1}};function Eo(e,t,n){for(var r=0,o=0;;){var i=e.indexOf("\t",r);-1==i&&(i=e.length);var s=i-r;if(i==e.length||o+s>=t)return r+Math.min(s,t-o);if(o+=i-r,r=i+1,(o+=n-o%n)>=t)return r}}var No=[""];function To(e){for(;No.length<=e;)No.push(Lo(No)+" ");return No[e]}function Lo(e){return e[e.length-1]}var Ao=function(e){e.select()};function Ro(e,t){for(var n=0;n<e.length;++n)if(e[n]==t)return n;return-1}function Do(e,t){for(var n=[],r=0;r<e.length;r++)n[r]=t(e[r],r);return n}function Po(e,t){var n;if(Object.create)n=Object.create(e);else{var r=function(){};r.prototype=e,n=new r}return t&&Fo(t,n),n}function Fo(e,t){for(var n in t||(t={}),e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function Bo(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}m?Ao=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:s&&(Ao=function(e){try{e.select()}catch(e){}}),[].indexOf&&(Ro=function(e,t){return e.indexOf(t)}),[].map&&(Do=function(e,t){return e.map(t)});var jo=/[\u00df\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,zo=x.isWordChar=function(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||jo.test(e))};function Vo(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}var Uo=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function Ho(e){return e.charCodeAt(0)>=768&&Uo.test(e)}var Go,qo={};function Wo(e){function t(e){return(e=e.trim()).length<4?null:e.length<7?[17*parseInt(e.charAt(1),16),17*parseInt(e.charAt(2),16),17*parseInt(e.charAt(3),16)]:[parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16)]}function n(e){var t=[e[0],e[1],e[2]].map((function(e){return(e/=255)<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}));return.2126*t[0]+.7152*t[1]+.0722*t[2]}var r=n(t("#0F192A"));function o(e){return(n(e)+.05)/(r+.05)}function i(e){var t,n,r,o=e[0],i=e[1],s=e[2];if(0==i)t=n=r=s;else{function c(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var a=s<.5?s*(1+i):s+i-s*i,l=2*s-a;t=c(l,a,o+1/3),n=c(l,a,o),r=c(l,a,o-1/3)}return[255*t,255*n,255*r]}var s,a=e;if(qo[a])s=qo[a];else{var l=t(a);if(l){var c=o(l);if(c<2.361){var u=function(e){var t=e[0],n=e[1],r=e[2];t/=255,n/=255,r/=255;var o,i,s=Math.max(t,n,r),a=Math.min(t,n,r),l=(s+a)/2;if(s==a)o=i=0;else{var c=s-a;switch(i=l>.5?c/(2-s-a):c/(s+a),s){case t:o=(n-r)/c+(n<r?6:0);break;case n:o=(r-t)/c+2;break;case r:o=(t-n)/c+4}o/=6}return[o,i,l]}(l);do{u[2]+=.01,c=o(i(u))}while(c<2.361);s="color: hsl("+~~(360*u[0])+","+~~(100*u[1])+"%,"+~~(100*u[2])+"%)"}else s="color:"+a}qo[a]=s}return s}function Ko(e,t,n,r){var o=document.createElement(e);if(n){if(0===n.indexOf("cm-MULTICOLOR"))r=Wo(n.substr(13)),n="cm-COLOR";else if(-1!==n.indexOf("cm-COLOR-#")){r=Wo(n.match(/cm-COLOR-(#[0-9a-fA-F]+)/)[1])}o.className=n}if(r&&(o.style.cssText=r),"string"==typeof t)o.appendChild(document.createTextNode(t));else if(t)for(var i=0;i<t.length;++i)o.appendChild(t[i]);return o}function Xo(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function Yo(e,t){return Xo(e).appendChild(t)}function Jo(e,t){if(e.contains)return e.contains(t);for(;t=t.parentNode;)if(t==e)return!0}function Qo(){return document.activeElement}Go=document.createRange?function(e,t,n){var r=document.createRange();return r.setEnd(e,n),r.setStart(e,t),r}:function(e,t,n){var r=document.body.createTextRange();return r.moveToElementText(e.parentNode),r.collapse(!0),r.moveEnd("character",n),r.moveStart("character",t),r},t&&(Qo=function(){try{return document.activeElement}catch(e){return document.body}});var Zo,$o,ei,ti=function(){if(r)return!1;var e=Ko("div");return"draggable"in e||"dragDrop"in e}();function ni(e){if(null!=Zo)return Zo;var t=Ko("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return Yo(e,t),t.offsetWidth&&(Zo=t.offsetHeight-t.clientHeight),Zo||0}function ri(e){if(null==$o){var t=Ko("span","​");Yo(e,Ko("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&($o=t.offsetWidth<=1&&t.offsetHeight>2&&!n)}return $o?Ko("span","​"):Ko("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px")}function oi(e){if(null!=ei)return ei;var t=Yo(e,document.createTextNode("AخA")),n=Go(t,0,1).getBoundingClientRect();if(n.left==n.right)return!1;var r=Go(t,1,2).getBoundingClientRect();return ei=r.right-n.right<3}var ii,si,ai=x.splitLines=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,n=[],r=e.length;t<=r;){var o=e.indexOf("\n",t);-1==o&&(o=e.length);var i=e.slice(t,"\r"==e.charAt(o-1)?o-1:o),s=i.indexOf("\r");-1!=s?(n.push(i.slice(0,s)),t+=s+1):(n.push(i),t=o+1)}return n}:function(e){return e.split(/\r\n?|\n/)},li=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},ci="oncopy"in(ii=Ko("div"))||(ii.setAttribute("oncopy","return;"),"function"==typeof ii.oncopy),ui={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};function di(e){return e.level%2?e.to:e.from}function hi(e){return e.level%2?e.from:e.to}function pi(e){var t=Kr(e);return t?di(t[0]):0}function fi(e){var t=Kr(e);return t?hi(Lo(t)):e.text.length}function gi(e,t){var n=zr(e.doc,t),r=ar(n);r!=n&&(t=Gr(r));var o=Kr(r),i=o?o[0].level%2?fi(r):pi(r):0;return ae(t,i)}function mi(e,t,n){var r=e[0].level;return t==r||n!=r&&t<n}function vi(e,t){si=null;for(var n,r=0;r<e.length;++r){var o=e[r];if(o.from<t&&o.to>t)return r;if(o.from==t||o.to==t){if(null!=n)return mi(e,o.level,e[n].level)?(o.from!=o.to&&(si=n),r):(o.from!=o.to&&(si=r),n);n=r}}return n}function yi(e,t,n,r){if(!r)return t+n;do{t+=n}while(t>0&&Ho(e.text.charAt(t)));return t}function _i(e,t,n,r){var o=Kr(e);if(!o)return bi(e,t,n,r);for(var i=vi(o,t),s=o[i],a=yi(e,t,s.level%2?-n:n,r);;){if(a>s.from&&a<s.to)return a;if(a==s.from||a==s.to)return vi(o,a)==i?a:n>0==(s=o[i+=n]).level%2?s.to:s.from;if(!(s=o[i+=n]))return null;a=n>0==s.level%2?yi(e,s.to,-1,r):yi(e,s.from,1,r)}}function bi(e,t,n,r){var o=t+n;if(r)for(;o>0&&Ho(e.text.charAt(o));)o+=n;return o<0||o>e.text.length?null:o}x.keyNames=ui,function(){for(var e=0;e<10;e++)ui[e+48]=ui[e+96]=String(e);for(e=65;e<=90;e++)ui[e]=String.fromCharCode(e);for(e=1;e<=12;e++)ui[e+111]=ui[e+63235]="F"+e}();var wi=function(){function e(e){return e<=247?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(e):1424<=e&&e<=1524?"R":1536<=e&&e<=1773?"rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm".charAt(e-1536):1774<=e&&e<=2220?"r":8192<=e&&e<=8203?"w":8204==e?"b":"L"}var t=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,n=/[stwN]/,r=/[LRr]/,o=/[Lb1n]/,i=/[1n]/,s="L";function a(e,t,n){this.level=e,this.from=t,this.to=n}return function(l){if(!t.test(l))return!1;for(var c=l.length,u=[],d=0;d<c;++d)u.push(v=e(l.charCodeAt(d)));d=0;for(var h=s;d<c;++d){"m"==(v=u[d])?u[d]=h:h=v}d=0;for(var p=s;d<c;++d){"1"==(v=u[d])&&"r"==p?u[d]="n":r.test(v)&&(p=v,"r"==v&&(u[d]="R"))}for(d=1,h=u[0];d<c-1;++d){"+"==(v=u[d])&&"1"==h&&"1"==u[d+1]?u[d]="1":","!=v||h!=u[d+1]||"1"!=h&&"n"!=h||(u[d]=h),h=v}for(d=0;d<c;++d){if(","==(v=u[d]))u[d]="N";else if("%"==v){for(var f=d+1;f<c&&"%"==u[f];++f);for(var g=d&&"!"==u[d-1]||f<c&&"1"==u[f]?"1":"N",m=d;m<f;++m)u[m]=g;d=f-1}}for(d=0,p=s;d<c;++d){var v=u[d];"L"==p&&"1"==v?u[d]="L":r.test(v)&&(p=v)}for(d=0;d<c;++d)if(n.test(u[d])){for(f=d+1;f<c&&n.test(u[f]);++f);var y="L"==(d?u[d-1]:s),_="L"==(f<c?u[f]:s);for(g=y||_?"L":"R",m=d;m<f;++m)u[m]=g;d=f-1}var b,w=[];for(d=0;d<c;)if(o.test(u[d])){var S=d;for(++d;d<c&&o.test(u[d]);++d);w.push(new a(0,S,d))}else{var C=d,I=w.length;for(++d;d<c&&"L"!=u[d];++d);for(m=C;m<d;)if(i.test(u[m])){C<m&&w.splice(I,0,new a(1,C,m));var x=m;for(++m;m<d&&i.test(u[m]);++m);w.splice(I,0,new a(2,x,m)),C=m}else++m;C<d&&w.splice(I,0,new a(1,C,d))}return 1==w[0].level&&(b=l.match(/^\s+/))&&(w[0].from=b[0].length,w.unshift(new a(0,0,b[0].length))),1==Lo(w).level&&(b=l.match(/\s+$/))&&(Lo(w).to-=b[0].length,w.push(new a(0,c-b[0].length,c))),w[0].level!=Lo(w).level&&w.push(new a(w[0].level,c,c)),w}}();return x.version="4.0.3",x})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";var t="CodeMirror-activeline",n="CodeMirror-activeline-background";function r(e){for(var r=0;r<e.state.activeLines.length;r++)e.removeLineClass(e.state.activeLines[r],"wrap",t),e.removeLineClass(e.state.activeLines[r],"background",n)}function o(e,o){for(var i=[],s=0;s<o.length;s++){var a=e.getLineHandleVisualStart(o[s].head.line);i[i.length-1]!=a&&i.push(a)}(function(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0})(e.state.activeLines,i)||e.operation((function(){r(e);for(var o=0;o<i.length;o++)e.addLineClass(i[o],"wrap",t),e.addLineClass(i[o],"background",n);e.state.activeLines=i}))}function i(e,t){o(e,t.ranges)}e.defineOption("styleActiveLine",!1,(function(t,n,s){var a=s&&s!=e.Init;n&&!a?(t.state.activeLines=[],o(t,t.listSelections()),t.on("beforeSelectionChange",i)):!n&&a&&(t.off("beforeSelectionChange",i),r(t),delete t.state.activeLines)}))})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){function t(e,t,n){var r;return(r=e.getWrapperElement().appendChild(document.createElement("div"))).className=n?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof t?r.innerHTML=t:r.appendChild(t),r}function n(e,t){e.state.currentNotificationClose&&e.state.currentNotificationClose(),e.state.currentNotificationClose=t}e.defineExtension("openDialog",(function(r,o,i){n(this,null);var s=t(this,r,i&&i.bottom),a=!1,l=this;function c(){a||(a=!0,s.parentNode.removeChild(s))}var u,d=s.getElementsByTagName("input")[0];return d?(i&&i.value&&(d.value=i.value),e.on(d,"keydown",(function(t){i&&i.onKeyDown&&i.onKeyDown(t,d.value,c)||13!=t.keyCode&&27!=t.keyCode||(d.blur(),e.e_stop(t),c(),l.focus(),13==t.keyCode&&o(d.value))})),i&&i.onKeyUp&&e.on(d,"keyup",(function(e){i.onKeyUp(e,d.value,c)})),i&&i.value&&(d.value=i.value),d.focus(),e.on(d,"blur",c)):(u=s.getElementsByTagName("button")[0])&&(e.on(u,"click",(function(){c(),l.focus()})),u.focus(),e.on(u,"blur",c)),c})),e.defineExtension("openConfirm",(function(r,o,i){n(this,null);var s=t(this,r,i&&i.bottom),a=s.getElementsByTagName("button"),l=!1,c=this,u=1;function d(){l||(l=!0,s.parentNode.removeChild(s),c.focus())}a[0].focus();for(var h=0;h<a.length;++h){var p=a[h];!function(t){e.on(p,"click",(function(n){e.e_preventDefault(n),d(),t&&t(c)}))}(o[h]),e.on(p,"blur",(function(){--u,setTimeout((function(){u<=0&&d()}),200)})),e.on(p,"focus",(function(){++u}))}})),e.defineExtension("openNotification",(function(r,o){n(this,c);var i,s=t(this,r,o&&o.bottom),a=o&&(void 0===o.duration?5e3:o.duration),l=!1;function c(){l||(l=!0,clearTimeout(i),s.parentNode.removeChild(s))}e.on(s,"click",(function(t){e.e_preventDefault(t),c()})),a&&(i=setTimeout(c,o.duration))}))})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],e):e(CodeMirror)}((function(e){"use strict";function t(){this.posFrom=this.posTo=this.query=null,this.overlay=null}function n(e){return e.state.search||(e.state.search=new t)}function r(e){return"string"==typeof e&&e==e.toLowerCase()}function o(e,t,n){return e.getSearchCursor(t,n,r(t))}function i(e,t,n,r,o){e.openDialog?e.openDialog(t,o,{value:r}):o(prompt(n,r))}function s(e){var t=e.match(/^\/(.*)\/([a-z]*)$/);return t?(e=new RegExp(t[1],-1==t[2].indexOf("i")?"":"i")).test("")&&(e=/x^/):""==e&&(e=/x^/),e}function a(e,t){var o=n(e);if(o.query)return l(e,t);i(e,'Search: <input type="text" style="width: 10em"/>',"Search for:",e.getSelection(),(function(n){e.operation((function(){n&&!o.query&&(o.query=s(n),e.removeOverlay(o.overlay,r(o.query)),o.overlay=function(e,t){var n;return"string"==typeof e?(n=e.charAt(0),e=new RegExp("^"+e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),t?"i":"")):e=new RegExp("^(?:"+e.source+")",e.ignoreCase?"i":""),{token:function(r){if(r.match(e))return"searching";for(;!r.eol()&&(r.next(),n&&!t&&(r.skipTo(n)||r.skipToEnd()),!r.match(e,!1)););}}}(o.query,r(o.query)),e.addOverlay(o.overlay),o.posFrom=o.posTo=e.getCursor(),l(e,t))}))}))}function l(t,r){t.operation((function(){var i=n(t),s=o(t,i.query,r?i.posFrom:i.posTo);(s.find(r)||(s=o(t,i.query,r?e.Pos(t.lastLine()):e.Pos(t.firstLine(),0))).find(r))&&(t.setSelection(s.from(),s.to()),t.scrollIntoView({from:s.from(),to:s.to()}),i.posFrom=s.from(),i.posTo=s.to())}))}function c(e){e.operation((function(){var t=n(e);t.query&&(t.query=null,e.removeOverlay(t.overlay))}))}function u(e,t){i(e,'Replace: <input type="text" style="width: 10em"/> ',"Replace:",e.getSelection(),(function(n){n&&(n=s(n),i(e,'With: <input type="text" style="width: 10em"/>',"Replace with:","",(function(r){if(t)e.operation((function(){for(var t=o(e,n);t.findNext();)if("string"!=typeof n){var i=e.getRange(t.from(),t.to()).match(n);t.replace(r.replace(/\$(\d)/g,(function(e,t){return i[t]})))}else t.replace(r)}));else{c(e);var i=o(e,n,e.getCursor()),s=function(){var t,r=i.from();!(t=i.findNext())&&(i=o(e,n),!(t=i.findNext())||r&&i.from().line==r.line&&i.from().ch==r.ch)||(e.setSelection(i.from(),i.to()),e.scrollIntoView({from:i.from(),to:i.to()}),function(e,t,n,r){e.openConfirm?e.openConfirm(t,r):confirm(n)&&r[0]()}(e,"Replace? <button>Yes</button> <button>No</button> <button>Stop</button>","Replace?",[function(){a(t)},s]))},a=function(e){i.replace("string"==typeof n?r:r.replace(/\$(\d)/g,(function(t,n){return e[n]}))),s()};s()}})))}))}e.commands.find=function(e){c(e),a(e)},e.commands.findNext=a,e.commands.findPrev=function(e){a(e,!0)},e.commands.clearSearch=c,e.commands.replace=u,e.commands.replaceAll=function(e){u(e,!0)}})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";var t=e.Pos;function n(e,n,o,i){if(i=!0,this.atOccurrence=!1,this.doc=e,null==i&&"string"==typeof n&&(i=!1),o=o?e.clipPos(o):t(0,0),this.pos={from:o,to:o},"string"!=typeof n)n.global||(n=new RegExp(n.source,n.ignoreCase?"ig":"g")),this.matches=function(r,o){if(r){n.lastIndex=0;for(var i=e.getLine(o.line).slice(0,o.ch),s=0;;){n.lastIndex=s;var a=n.exec(i);if(!a)break;if(c=(l=a).index,(s=l.index+(l[0].length||1))==i.length)break}(u=l&&l[0].length||0)||(0==c&&0==i.length?l=void 0:c!=e.getLine(o.line).length&&u++)}else{n.lastIndex=o.ch;i=e.getLine(o.line);var l,c,u=(l=n.exec(i))&&l[0].length||0;(c=l&&l.index)+u==i.length||u||(u=1)}if(l&&u)return{from:t(o.line,c),to:t(o.line,c+u),match:l}};else{var s=n;i&&(n=n.toLowerCase());var a=i?function(e){return e.toLowerCase()}:function(e){return e},l=n.split("\n");if(1==l.length)n.length?this.matches=function(o,i){if(o){var l=e.getLine(i.line).slice(0,i.ch);if((u=(c=a(l)).lastIndexOf(n))>-1)return u=r(l,c,u),{from:t(i.line,u),to:t(i.line,u+s.length)}}else{var c,u;l=e.getLine(i.line).slice(i.ch);if((u=(c=a(l)).indexOf(n))>-1)return u=r(l,c,u)+i.ch,{from:t(i.line,u),to:t(i.line,u+s.length)}}}:this.matches=function(){};else{var c=s.split("\n");this.matches=function(n,r){var o=l.length-1;if(n){if(r.line-(l.length-1)<e.firstLine())return;if(a(e.getLine(r.line).slice(0,c[o].length))!=l[l.length-1])return;for(var i=t(r.line,c[o].length),s=r.line-1,u=o-1;u>=1;--u,--s)if(l[u]!=a(e.getLine(s)))return;var d=(h=e.getLine(s)).length-c[0].length;if(a(h.slice(d))!=l[0])return;return{from:t(s,d),to:i}}if(!(r.line+(l.length-1)>e.lastLine())){var h;d=(h=e.getLine(r.line)).length-c[0].length;if(a(h.slice(d))==l[0]){var p=t(r.line,d);for(s=r.line+1,u=1;u<o;++u,++s)if(l[u]!=a(e.getLine(s)))return;if(e.getLine(s).slice(0,c[o].length)==l[o])return{from:p,to:t(s,c[o].length)}}}}}}}function r(e,t,n){if(e.length==t.length)return n;for(var r=Math.min(n,e.length);;){var o=e.slice(0,r).toLowerCase().length;if(o<n)++r;else{if(!(o>n))return r;--r}}}n.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){var n=this,r=this.doc.clipPos(e?this.pos.from:this.pos.to);function o(e){var r=t(e,0);return n.pos={from:r,to:r},n.atOccurrence=!1,!1}for(;;){if(this.pos=this.matches(e,r))return this.atOccurrence=!0,this.pos.match||!0;if(e){if(!r.line)return o(0);r=t(r.line-1,this.doc.getLine(r.line-1).length)}else{var i=this.doc.lineCount();if(r.line==i-1)return o(i);r=t(r.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(n){if(this.atOccurrence){var r=e.splitLines(n);this.doc.replaceRange(r,this.pos.from,this.pos.to),this.pos.to=t(this.pos.from.line+r.length-1,r[r.length-1].length+(1==r.length?this.pos.from.ch:0))}}},e.defineExtension("getSearchCursor",(function(e,t,r){return!0,new n(this.doc,e,t,true)})),e.defineDocExtension("getSearchCursor",(function(e,t,r){return!0,new n(this,e,t,true)})),e.defineExtension("selectMatches",(function(t,n){for(var r=[],o=this.getSearchCursor(t,this.getCursor("from"),true);o.findNext()&&!(e.cmpPos(o.to(),this.getCursor("to"))>0);)r.push({anchor:o.from(),head:o.to()});r.length&&this.setSelections(r,0)}))})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";function t(e){"object"==typeof e&&(this.minChars=e.minChars,this.style=e.style,this.showToken=e.showToken,this.delay=e.delay),null==this.style&&(this.style="matchhighlight"),null==this.minChars&&(this.minChars=2),null==this.delay&&(this.delay=100),this.overlay=this.timeout=null}function n(e){var t=e.state.matchHighlighter;clearTimeout(t.timeout),t.timeout=setTimeout((function(){r(e)}),t.delay)}function r(e){e.operation((function(){var t=e.state.matchHighlighter;if(t.overlay&&(e.removeOverlay(t.overlay),t.overlay=null),e.somethingSelected()||!t.showToken){if(e.getCursor("head").line==e.getCursor("anchor").line){var n=e.getSelections()[0].replace(/^\s+|\s+$/g,"");n.length>=t.minChars&&e.addOverlay(t.overlay=o(n,!1,t.style))}}else{for(var r=!0===t.showToken?/[\w$]/:t.showToken,i=e.getCursor(),s=e.getLine(i.line),a=i.ch,l=a;a&&r.test(s.charAt(a-1));)--a;for(;l<s.length&&r.test(s.charAt(l));)++l;a<l&&e.addOverlay(t.overlay=o(s.slice(a,l),r,t.style))}}))}function o(e,t,n){return{token:function(r){if(r.match(e)&&(!t||function(e,t){return!(e.start&&t.test(e.string.charAt(e.start-1))||e.pos!=e.string.length&&t.test(e.string.charAt(e.pos)))}(r,t)))return n;r.next(),r.skipTo(e.charAt(0))||r.skipToEnd()}}}e.defineOption("highlightSelectionMatches",!1,(function(o,i,s){if(s&&s!=e.Init){var a=o.state.matchHighlighter.overlay;a&&o.removeOverlay(a),clearTimeout(o.state.matchHighlighter.timeout),o.state.matchHighlighter=null,o.off("cursorActivity",n)}i&&(o.state.matchHighlighter=new t(i),r(o),o.on("cursorActivity",n))}))})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";function t(e,t){this.cm=e,this.options=t,this.widget=null,this.debounce=0,this.tick=0,this.startPos=this.cm.getCursor("start"),this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var n=this;e.on("cursorActivity",this.activityFunc=function(){n.cursorActivity()})}e.showHint=function(e,t,n){if(!t)return e.showHint(n);n&&n.async&&(t.async=!0);var r={hint:t};if(n)for(var o in n)r[o]=n[o];return e.showHint(r)},e.defineExtension("showHint",(function(n){n=function(e,t,n){var r=e.options.hintOptions,o={};for(var i in l)o[i]=l[i];if(r)for(var i in r)void 0!==r[i]&&(o[i]=r[i]);if(n)for(var i in n)void 0!==n[i]&&(o[i]=n[i]);o.hint.resolve&&(o.hint=o.hint.resolve(e,t));return o}(this,this.getCursor("start"),n);var r=this.listSelections();if(!(r.length>1)){if(this.somethingSelected()){if(!n.hint.supportsSelection)return;for(var o=0;o<r.length;o++)if(r[o].head.line!=r[o].anchor.line)return}this.state.completionActive&&this.state.completionActive.close();var i=this.state.completionActive=new t(this,n);i.options.hint&&(e.signal(this,"startCompletion",this),i.update(!0))}}));var n=window.requestAnimationFrame||function(e){return setTimeout(e,1e3/60)},r=window.cancelAnimationFrame||clearTimeout;function o(e){return"string"==typeof e?e:e.text}function i(e,t){for(;t&&t!=e;){if("LI"===t.nodeName.toUpperCase()&&t.parentNode==e)return t;t=t.parentNode}}function s(t,n){this.completion=t,this.data=n,this.picked=!1;var r=this,s=t.cm,a=this.hints=document.createElement("ul");a.className="CodeMirror-hints",this.selectedHint=n.selectedHint||0;for(var l=n.list,c=0;c<l.length;++c){var u=a.appendChild(document.createElement("li")),d=l[c],h="CodeMirror-hint"+(c!=this.selectedHint?"":" CodeMirror-hint-active");null!=d.className&&(h=d.className+" "+h),u.className=h,d.render?d.render(u,n,d):u.appendChild(document.createTextNode(d.displayText||o(d))),u.hintId=c}var p=s.cursorCoords(t.options.alignWithWord?n.from:null),f=p.left,g=p.bottom,m=!0;a.style.left=f+"px",a.style.top=g+"px";var v=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),y=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(t.options.container||document.body).appendChild(a);var _=a.getBoundingClientRect(),b=_.bottom-y,w=a.scrollHeight>a.clientHeight+1,S=s.getScrollInfo();if(b>0){var C=_.bottom-_.top;if(p.top-(p.bottom-_.top)-C>0)a.style.top=(g=p.top-C)+"px",m=!1;else if(C>y){a.style.height=y-5+"px",a.style.top=(g=p.bottom-_.top)+"px";var I=s.getCursor();n.from.ch!=I.ch&&(p=s.cursorCoords(I),a.style.left=(f=p.left)+"px",_=a.getBoundingClientRect())}}var x,O=_.right-v;if(O>0&&(_.right-_.left>v&&(a.style.width=v-5+"px",O-=_.right-_.left-v),a.style.left=(f=p.left-O)+"px"),w)for(var M=a.firstChild;M;M=M.nextSibling)M.style.paddingRight=s.display.nativeBarWidth+"px";(s.addKeyMap(this.keyMap=function(e,t){var n={Up:function(){t.moveFocus(-1)},Down:function(){t.moveFocus(1)},PageUp:function(){t.moveFocus(1-t.menuSize(),!0)},PageDown:function(){t.moveFocus(t.menuSize()-1,!0)},Enter:t.pick,Tab:t.pick,Esc:t.close},r=e.options.customKeys,o=r?{}:n;function i(e,r){var i;i="string"!=typeof r?function(e){return r(e,t)}:n.hasOwnProperty(r)?n[r]:r,o[e]=i}if(r)for(var s in r)r.hasOwnProperty(s)&&i(s,r[s]);var a=e.options.extraKeys;if(a)for(var s in a)a.hasOwnProperty(s)&&i(s,a[s]);return o}(t,{moveFocus:function(e,t){r.changeActive(r.selectedHint+e,t)},setFocus:function(e){r.changeActive(e)},menuSize:function(){return r.screenAmount()},length:l.length,close:function(){t.close()},pick:function(){r.pick()},data:n})),t.options.closeOnUnfocus)&&(s.on("blur",this.onBlur=function(){x=setTimeout((function(){t.close()}),100)}),s.on("focus",this.onFocus=function(){clearTimeout(x)}));return s.on("scroll",this.onScroll=function(){var e=s.getScrollInfo(),n=s.getWrapperElement().getBoundingClientRect(),r=g+S.top-e.top,o=r-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(m||(o+=a.offsetHeight),o<=n.top||o>=n.bottom)return t.close();a.style.top=r+"px",a.style.left=f+S.left-e.left+"px"}),e.on(a,"dblclick",(function(e){var t=i(a,e.target||e.srcElement);t&&null!=t.hintId&&(r.changeActive(t.hintId),r.pick())})),e.on(a,"click",(function(e){var n=i(a,e.target||e.srcElement);n&&null!=n.hintId&&(r.changeActive(n.hintId),t.options.completeOnSingleClick&&r.pick())})),e.on(a,"mousedown",(function(){setTimeout((function(){s.focus()}),20)})),e.signal(n,"select",l[this.selectedHint],a.childNodes[this.selectedHint]),!0}function a(e,t,n,r){if(e.async)e(t,r,n);else{var o=e(t,n);o&&o.then?o.then(r):r(o)}}t.prototype={close:function(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&e.signal(this.data,"close"),this.widget&&this.widget.close(),e.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(t,n){var r=t.list[n];r.hint?r.hint(this.cm,t,r):this.cm.replaceRange(o(r),r.from||t.from,r.to||t.to,"complete"),e.signal(t,"pick",r),this.close()},cursorActivity:function(){this.debounce&&(r(this.debounce),this.debounce=0);var e=this.cm.getCursor(),t=this.cm.getLine(e.line);if(e.line!=this.startPos.line||t.length-e.ch!=this.startLen-this.startPos.ch||e.ch<this.startPos.ch||this.cm.somethingSelected()||e.ch&&this.options.closeCharacters.test(t.charAt(e.ch-1)))this.close();else{var o=this;this.debounce=n((function(){o.update()})),this.widget&&this.widget.disable()}},update:function(e){if(null!=this.tick){var t=this,n=++this.tick;a(this.options.hint,this.cm,this.options,(function(r){t.tick==n&&t.finishUpdate(r,e)}))}},finishUpdate:function(t,n){this.data&&e.signal(this.data,"update");var r=this.widget&&this.widget.picked||n&&this.options.completeSingle;this.widget&&this.widget.close(),this.data=t,t&&t.list.length&&(r&&1==t.list.length?this.pick(t,0):(this.widget=new s(this,t),e.signal(t,"shown")))}},s.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null,this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var e=this.completion.cm;this.completion.options.closeOnUnfocus&&(e.off("blur",this.onBlur),e.off("focus",this.onFocus)),e.off("scroll",this.onScroll)}},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var e=this;this.keyMap={Enter:function(){e.picked=!0}},this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(t,n){if(t>=this.data.list.length?t=n?this.data.list.length-1:0:t<0&&(t=n?0:this.data.list.length-1),this.selectedHint!=t){var r=this.hints.childNodes[this.selectedHint];r&&(r.className=r.className.replace(" CodeMirror-hint-active","")),(r=this.hints.childNodes[this.selectedHint=t]).className+=" CodeMirror-hint-active",r.offsetTop<this.hints.scrollTop?this.hints.scrollTop=r.offsetTop-3:r.offsetTop+r.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=r.offsetTop+r.offsetHeight-this.hints.clientHeight+3),e.signal(this.data,"select",this.data.list[this.selectedHint],r)}},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},e.registerHelper("hint","auto",{resolve:function(t,n){var r,o=t.getHelpers(n,"hint");if(o.length){var i=function(e,t,n){var r=function(e,t){if(!e.somethingSelected())return t;for(var n=[],r=0;r<t.length;r++)t[r].supportsSelection&&n.push(t[r]);return n}(e,o);!function o(i){if(i==r.length)return t(null);a(r[i],e,n,(function(e){e&&e.list.length>0?t(e):o(i+1)}))}(0)};return i.async=!0,i.supportsSelection=!0,i}return(r=t.getHelper(t.getCursor(),"hintWords"))?function(t){return e.hint.fromList(t,{words:r})}:e.hint.anyword?function(t,n){return e.hint.anyword(t,n)}:function(){}}}),e.registerHelper("hint","fromList",(function(t,n){var r,o=t.getCursor(),i=t.getTokenAt(o),s=e.Pos(o.line,i.start),a=o;i.start<o.ch&&/\w/.test(i.string.charAt(o.ch-i.start-1))?r=i.string.substr(0,o.ch-i.start):(r="",s=o);for(var l=[],c=0;c<n.words.length;c++){var u=n.words[c];u.slice(0,r.length)==r&&l.push(u)}if(l.length)return{list:l,from:s,to:a}})),e.commands.autocomplete=e.showHint;var l={hint:e.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null};e.defineOption("hintOptions",null)})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";var t=/[\w$#]+/,n=["METADATA",["author","Gill Bloggs","Your name goes here. This will appear in the title screen of the game."],["color_palette","arne","By default, when you use colour names, they are pulled from a variation of <a href='http://androidarts.com/palette/16pal.htm'>Arne</a>'s 16-Colour palette. However, there are other palettes to choose from: <p> <ul> <li>1 - mastersystem </li> <li>2 - gameboycolour </li> <li>3 - amiga </li> <li>4 - arnecolors </li> <li>5 - famicom </li> <li>6 - atari </li> <li>7 - pastel </li> <li>8 - ega </li> <li>9 - amstrad </li> <li>10 - proteus_mellow </li> <li>11 - proteus_rich </li> <li>12 - proteus_night </li> <li>13 - c64 </li> <li>14 - whitingjp </li> </ul> <p> (you can also refer to them by their numerical index)"],["again_interval","0.1","The amount of time it takes an 'again' event to trigger."],["background_color","blue","Can accept a color name or hex code (in the form #412bbc). Controls the background color of title/message screens, as well as the background color of the website. Text_color is its sibling."],["debug","","This outputs the compiled instructions whenever you build your file."],["flickscreen","8x5","Setting flickscreen divides each level into WxH grids, and zooms the camera in so that the player can only see one at a time"],["homepage","www.puzzlescript.net","A link to your homepage!"],["key_repeat_interval","0.1","When you hold down a key, how long is the delay between repeated presses getting sent to the game (in seconds)?"],["noaction","","Hides the action key (X) instruction from the title screen, and does not respond when the player pressed it (outside of menus and cutscenes and the like)."],["norepeat_action","","The action button will only respond to individual presses, and not auto-trigger when held down."],["noundo","","Disables the undo key (Z)"],["norestart","","Disables the restart key (R)"],["realtime_interval","","The number indicates how long each realtime frame should be."],["require_player_movement","","If the player doesn't move, cancel the whole move."],["run_rules_on_level_start","","Applies the rules once on level-load, before the player has moved"],["scanline","","Applies a scanline visual effect"],["text_color","orange","Can accept a color name or hex code (in the form #412bbc). Controls the font color of title/message screens, as well as the font color in the website. Background_color is its sibling."],["title","My Amazing Puzzle Game","The name of your game. Appears on the title screen."],["throttle_movement","","For use in conjunction with realtime_interval - this stops you from moving crazy fast - repeated keypresses of the same movement direction will not increase your speed. This doesn't apply to the action button."],["verbose_logging","","As you play the game, spits out information about all rules applied as you play, and also allows visual inspection of what exactly the rules do by hovering over them with your mouse (or tapping them on touchscreen)."],["zoomscreen","WxH","Zooms the camera in to a WxH section of the map around the player, centered on the player."],["mouse_left","lmb","Sets the object to place when pressing left mouse button."],["mouse_drag","drag","Sets the object to place when moving the mouse while left mouse button is held."],["mouse_up","lmbup","Sets the object to place when left mouse button is released."],["mouse_right","rmb","Sets the object to place when pressing right mouse button."],["mouse_rdrag","rdrag","Sets the object to place when moving the mouse while right mouse button is held."],["mouse_rup","rmbup","Sets the object to place when right mouse button is released."],["nokeyboard","","Allows the game to run without a Player object and movement."],["smoothscreen","[flick] WxH [IxJ] [S]","Zooms the camera in to a WxH section of the map around the player and smoothly scrolls to follow the player. The optional argument IxJ (default: 1x1) specifies a boundary in which the player can move without moving the camera. The optional speed argument (default: 0.125) specifies how far the camera will move towards the player each frame as a fraction of the distance to the player. The optional flick keyword makes the camera move like flickscreen."],["smoothscreen_debug","","Draw smoothscreen debug information."],["sprite_size","5","Size of sprites."],["case_sensitive","","Makes object names and legend case sensitive."],["level_select","","Show level selection option on main screen (use with sections in levels)."],["credits","","Show credits option on main screen"],["manual","","Show manual option on main screen"],["continue_is_level_select","","Don't show separate option on main menu for level selection."],["level_select_lock","","Level selection will have unsolved levels locked."],["level_select_unlocked_ahead","1","Level selection will have N number of unsolved levels unlocked after last solved level."],["level_select_solve_symbol","x","Symbol that will be used for solved levels in level select menu"],["custom_font","","Custom font to use for text rendering."],["font_size","","Controls the size of the custom_font"],["local_radius","X","Radius around the player to execute rules in"],["runtime_metadata_twiddling","","Allows you to change some prelude flags during runtime using rules"],["runtime_metadata_twiddling_debug","","Prints in the console each time the metadata is twiddled"],["skip_title_screen","","Will skip the title screen when the game initializes, booting straight into the level or level select"],["tween_length","0.05","Will animate objects that are moving using LEFT, RIGHT, UP, and DOWN. Duration in seconds."],["tween_easing","linear","How movement animations should lerp when using TWEEN_LENGTH, e.g. 'easeInQuad', 'easeOutCubic', etc."],["tween_snap","5","With how much granularity to snap to the underlying sprite grid. Uses the SPRITE_SIZE by default."],["message_text_align","center","Towards which side message text should align. left, center (default), or right."],["text_controls","arrow keys to move /nX to action","Overwrite keyboard/mouse control description on the title screen."],["text_message_continue","[x] or [space] to continue!","Overwrite the text below messages that normally says 'X to continue'."],["level_select_unlocked_rollover","3","An alternative to LEVEL_SELECT_UNLOCKED_AHEAD, which applies a strict maximum number of unsolved levels."],["sitelock_origin_whitelist","https://auroriax.github.io:1234","Exported versions of the game will only run on sites with this origin."],["sitelock_hostname_whitelist","auroriax.github.io","Exported versions of the game will only run on sites with this hostname."]],r=["COLOR","black","white","darkgray","lightgray","gray","red","darkred","lightred","brown","darkbrown","lightbrown","orange","yellow","green","darkgreen","lightgreen","blue","lightblue","darkblue","purple","pink","transparent"],o=["COMMAND","sfx0","sfx1","sfx2","sfx3","sfx4","sfx5","sfx6","sfx7","sfx8","sfx9","sfx10","sfx11","sfx12","sfx13","cancel","checkpoint","restart","win","message","again","nosave","quit","global","zoomscreen","flickscreen","smoothscreen","key_repeat_interval","again_interval","realtime_interval","background_color","text_color","noundo","norestart","goto","undo","message_text_align","achieve1","achieve2","achieve3","achieve4","achieve5"],i=["DIRECTION","up","down","left","right","horizontal","vertical"],s=["DIRECTION","up","down","left","right","random","horizontal","vertical","late","rigid"],a=["BRACKET","startloop","endloop"],l=["DIRECTION","up","down","left","right","moving","stationary","no","randomdir","random","horizontal","vertical","orthogonal","perpendicular","parallel","action"],c=["SOUNDVERB","titlescreen","startgame","cancel","endgame","startlevel","undo","restart","endlevel","enterlevelselect","showmessage","closemessage","sfx0","sfx1","sfx2","sfx3","sfx4","sfx5","sfx6","sfx7","sfx8","sfx9","sfx10","sfx11","sfx12","sfx13","create","destroy","move","cantmove","action"],u=["LOGICWORD","some","on","no","all"],d=["LOGICWORD","and","or"],h=["mastersystem","gameboycolour","amiga","arnecolors","famicom","atari","pastel","ega","amstrad","proteus_mellow","proteus_rich","proteus_night","c64","whitingjp"];function p(e,t,n){var r=n.text,o=n.extra,i=n.tag;0==r.length&&(r=n.extra,o=n.text);var s=document.createElement("span");s.className+=" cm-s-midnight ";var a=document.createElement("span"),l=document.createTextNode(r);if(a.appendChild(l),s.appendChild(a),null!=i&&(a.className+="cm-"+i),e.appendChild(s),o.length>0){var c=document.createElement("span");c.style.color="orange";o=document.createTextNode(" "+o);c.appendChild(o),c.style.color="orange",e.appendChild(o)}}e.registerHelper("hint","anyword",(function(f,g){for(var m=g&&g.word||t,v=(g&&g.range,f.getCursor()),y=f.getLine(v.line),_=v.ch,b=_,w=y.substr(0,_);b&&m.test(y.charAt(b-1));)--b;var S=b!=_&&y.slice(b,_),C=f.getTokenAt(v),I=C.state;if(!S||I.commentLevel>0)return{list:[]};var x=!1,O=!1,M=[],k=[];switch(I.section){case"objects":2==I.objects_section&&M.push(r);break;case"legend":k=E=w.toLowerCase().split(/[\p{Z}\s]/u).filter((function(e){return""!==e})),w.indexOf("=")>=0&&(w.trim().split(/\s+/).length%2==1?x=!0:M.push(d));break;case"sounds":M.push(i),M.push(c),x=!0,O=!0;break;case"collisionlayers":var E;k=E=w.toLowerCase().split(/[,\p{Z}\s]/u).filter((function(e){return""!==e})),x=!0,O=!0;break;case"rules":-1==w.indexOf("[")?(M.push(s),M.push(a)):M.push(l),w.indexOf("->")>=0&&M.push(o),x=!0;break;case"winconditions":w.trim().split(/\s+/).length%2==0&&(x=!0),M.push(u);break;case"levels":0==="message".indexOf(w.trim())&&(M.push(["MESSAGE_VERB","message"]),M.push(["SECTION_VERB","section"]),M.push(["GOTO_VERB","goto"]));break;default:if((K=w.toLowerCase()).indexOf("background_color")>=0||K.indexOf("text_color")>=0)M.push(r);else{var N=w.trim().split(/\s+/);N.length<2?M.push(n):2==N.length&&"color_palette"==N[0].toLowerCase()&&M.push(h)}}S=S.toLowerCase();var T=g&&g.list||[],L={};if(x){var A=I.objects;for(var R in A)if(A.hasOwnProperty(R)){var D=(V=R).toLowerCase();if(!(S&&0!=D.lastIndexOf(S,0)||Object.prototype.hasOwnProperty.call(L,D))){L[D]=!0;var P=I.original_case_names[V];T.push({text:P,extra:"",tag:"NAME",render:p})}}var F=[I.legend_synonyms];F.push(I.legend_properties),O||F.push(I.legend_aggregates);for(var B=0;B<F.length;B++)for(var j=F[B],z=0;z<j.length;z++){var V;D=(V=j[z][0]).toLowerCase();if(!(S&&0!=D.lastIndexOf(S,0)||Object.prototype.hasOwnProperty.call(L,D))){L[D]=!0;P=I.original_case_names[V];T.push({text:P,extra:"",tag:"NAME",render:p})}}}for(B=0;B<M.length;B++){var U=M[B],H=U[0];for(z=1;z<U.length;z++){var G=U[z],q="";"string"!=typeof G&&(G.length>1&&(q=G[1]),G=G[0]);D=(D=G).toLowerCase();if(!(S&&0!=D.lastIndexOf(S,0)||Object.prototype.hasOwnProperty.call(L,D))){L[D]=!0;var W=H;"COLOR"===W&&(W="COLOR-"+G.toUpperCase()),T.push({text:G,extra:q,tag:W,render:p})}}}if(k.length>0){k[k.length-1]===S&&E.pop();for(B=0;B<T.length;B++){var K=T[B].text.toLowerCase();k.indexOf(K)>=0&&(T.splice(B,1),B--)}}1===T.length&&T[0].text.toLowerCase()===S&&(T=[]);for(B=1;B<T.length;B++)if(T[B].text.toLowerCase()===S){var X=T[B];T.splice(B,1),T.unshift(X);break}return C.string.trim().length>S.length&&(T=[]),{list:T,from:e.Pos(v.line,b),to:e.Pos(v.line,_)}})),e.ExcludedIntelliSenseTriggerKeys={9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",91:"left window key",92:"right window key",93:"select",107:"add",109:"subtract",110:"decimal point",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equalsign",188:"comma",190:"period",191:"slash",192:"graveaccent",220:"backslash",222:"quote"}})),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}((function(e){"use strict";var t={lineComment:"//"},n=/[^\s\u00a0]/,r=e.Pos;e.cmpPos;function o(e,t){var n=e.getMode();return!1!==n.useInnerComments&&n.innerMode?e.getModeAt(t):n}e.commands.toggleComment=function(e){e.toggleComment()},e.defineExtension("toggleComment",(function(e){e||(e=t);for(var n=this,o=1/0,i=this.listSelections(),s=null,a=i.length-1;a>=0;a--){var l=i[a].from(),c=i[a].to();l.line>=o||(c.line>=o&&(c=r(o,0)),o=l.line,null==s?n.uncomment(l,c,e)?s="un":(n.lineComment(l,c,e),s="line"):"un"==s?n.uncomment(l,c,e):n.lineComment(l,c,e))}})),e.defineExtension("lineComment",(function(e,i,s){s||(s=t);var a=this,l=(o(a,e),a.getLine(e.line));if(null!=l&&(c=e,u=l,!/\bstring\b/.test(a.getTokenTypeAt(r(c.line,0)))||/^[\'\"\`]/.test(u))){var c,u,d=Math.min(0!=i.ch||i.line==e.line?i.line+1:i.line,a.lastLine()+1),h=null==s.padding?" ":s.padding,p=s.commentBlankLines||e.line==i.line;a.operation((function(){for(var t=e.line;t<d;++t){var o=a.getLine(t);(p||n.test(o))&&(a.replaceRange("("+h,r(t,0)),o=a.getLine(t),a.replaceRange(h+")",r(t,o.length)))}}))}})),e.defineExtension("uncomment",(function(e,i,s){s||(s=t);var a,l=this,c=(o(l,e),Math.min(0!=i.ch||i.line==e.line?i.line:i.line-1,l.lastLine())),u=Math.min(e.line,c),d=[],h=null==s.padding?" ":s.padding;e:{for(var p=u;p<=c;++p){var f=l.getLine(p),g=f.indexOf("("),m=f.lastIndexOf(")");if(g>-1&&!/comment/.test(l.getTokenTypeAt(r(p,g+1)))&&(g=-1),-1==g&&n.test(f))break e;if(g>-1&&n.test(f.slice(0,g)))break e;if(m>-1&&!/comment/.test(l.getTokenTypeAt(r(p,m)))&&(m=-1),-1==m&&n.test(f))break e;if(m>-1&&n.test(f.slice(m+1)))break e;d.push(f)}if(l.operation((function(){for(var e=u;e<=c;++e){var t=d[e-u],n=t.indexOf("("),o=n+"(".length,i=t.indexOf(")"),s=i+")".length;n<0||i<0||(t.slice(s-1-h.length,s-1)==h&&(i-=h.length),t.slice(o,o+h.length)==h&&(o+=h.length),a=!0,l.replaceRange("",r(e,i),r(e,s)),l.replaceRange("",r(e,n),r(e,o)))}})),a)return!0}return!1}))})),colorPalettesAliases={1:"mastersystem",2:"gameboycolour",3:"amiga",4:"arnecolors",5:"famicom",6:"atari",7:"pastel",8:"ega",9:"amstrad",10:"proteus_mellow",11:"proteus_rich",12:"proteus_night",13:"c64",14:"whitingjp"},colorPalettes={mastersystem:{black:"#000000",white:"#FFFFFF",grey:"#555555",darkgrey:"#555500",lightgrey:"#AAAAAA",gray:"#555555",darkgray:"#555500",lightgray:"#AAAAAA",red:"#FF0000",darkred:"#AA0000",lightred:"#FF5555",brown:"#AA5500",darkbrown:"#550000",lightbrown:"#FFAA00",orange:"#FF5500",yellow:"#FFFF55",green:"#55AA00",darkgreen:"#005500",lightgreen:"#AAFF00",blue:"#5555AA",lightblue:"#AAFFFF",darkblue:"#000055",purple:"#550055",pink:"#FFAAFF"},gameboycolour:{black:"#000000",white:"#FFFFFF",grey:"#7F7F7C",darkgrey:"#3E3E44",lightgrey:"#BAA7A7",gray:"#7F7F7C",darkgray:"#3E3E44",lightgray:"#BAA7A7",red:"#A7120C",darkred:"#880606",lightred:"#BA381F",brown:"#57381F",darkbrown:"#3E2519",lightbrown:"#8E634B",orange:"#BA4B32",yellow:"#C0BA6F",green:"#517525",darkgreen:"#385D12",lightgreen:"#6F8E44",blue:"#5D6FA7",lightblue:"#8EA7A7",darkblue:"#4B575D",purple:"#3E3E44",pink:"#BA381F"},amiga:{black:"#000000",white:"#FFFFFF",grey:"#BBBBBB",darkgrey:"#333333",lightgrey:"#FFEEDD",gray:"#BBBBBB",darkgray:"#333333",lightgray:"#FFEEDD",red:"#DD1111",darkred:"#990000",lightred:"#FF4422",brown:"#663311",darkbrown:"#331100",lightbrown:"#AA6644",orange:"#FF6644",yellow:"#FFDD66",green:"#448811",darkgreen:"#335500",lightgreen:"#88BB77",blue:"#8899DD",lightblue:"#BBDDEE",darkblue:"#666688",purple:"#665555",pink:"#997788"},arnecolors:{black:"#000000",white:"#FFFFFF",grey:"#9d9d9d",darkgrey:"#697175",lightgrey:"#cccccc",gray:"#9d9d9d",darkgray:"#697175",lightgray:"#cccccc",red:"#be2633",darkred:"#732930",lightred:"#e06f8b",brown:"#a46422",darkbrown:"#493c2b",lightbrown:"#eeb62f",orange:"#eb8931",yellow:"#f7e26b",green:"#44891a",darkgreen:"#2f484e",lightgreen:"#a3ce27",blue:"#1d57f7",lightblue:"#B2DCEF",darkblue:"#1B2632",purple:"#342a97",pink:"#de65e2"},famicom:{black:"#000000",white:"#ffffff",grey:"#7c7c7c",darkgrey:"#080808",lightgrey:"#bcbcbc",gray:"#7c7c7c",darkgray:"#080808",lightgray:"#bcbcbc",red:"#f83800",darkred:"#881400",lightred:"#f87858",brown:"#AC7C00",darkbrown:"#503000",lightbrown:"#FCE0A8",orange:"#FCA044",yellow:"#F8B800",green:"#00B800",darkgreen:"#005800",lightgreen:"#B8F8B8",blue:"#0058F8",lightblue:"#3CBCFC",darkblue:"#0000BC",purple:"#6644FC",pink:"#F878F8"},atari:{black:"#000000",white:"#FFFFFF",grey:"#909090",darkgrey:"#404040",lightgrey:"#b0b0b0",gray:"#909090",darkgray:"#404040",lightgray:"#b0b0b0",red:"#A03C50",darkred:"#700014",lightred:"#DC849C",brown:"#805020",darkbrown:"#703400",lightbrown:"#CB9870",orange:"#CCAC70",yellow:"#ECD09C",green:"#58B06C",darkgreen:"#006414",lightgreen:"#70C484",blue:"#1C3C88",lightblue:"#6888C8",darkblue:"#000088",purple:"#3C0080",pink:"#B484DC"},pastel:{black:"#000000",white:"#FFFFFF",grey:"#3e3e3e",darkgrey:"#313131",lightgrey:"#9cbcbc",gray:"#3e3e3e",darkgray:"#313131",lightgray:"#9cbcbc",red:"#f56ca2",darkred:"#a63577",lightred:"#ffa9cf",brown:"#b58c53",darkbrown:"#787562",lightbrown:"#B58C53",orange:"#EB792D",yellow:"#FFe15F",green:"#00FF4F",darkgreen:"#2b732c",lightgreen:"#97c04f",blue:"#0f88d3",lightblue:"#00fffe",darkblue:"#293a7b",purple:"#ff6554",pink:"#eb792d"},ega:{black:"#000000",white:"#ffffff",grey:"#555555",darkgrey:"#555555",lightgrey:"#aaaaaa",gray:"#555555",darkgray:"#555555",lightgray:"#aaaaaa",red:"#ff5555",darkred:"#aa0000",lightred:"#ff55ff",brown:"#aa5500",darkbrown:"#aa5500",lightbrown:"#ffff55",orange:"#ff5555",yellow:"#ffff55",green:"#00aa00",darkgreen:"#00aaaa",lightgreen:"#55ff55",blue:"#5555ff",lightblue:"#55ffff",darkblue:"#0000aa",purple:"#aa00aa",pink:"#ff55ff"},proteus_mellow:{black:"#3d2d2e",white:"#ddf1fc",grey:"#9fb2d4",darkgrey:"#7b8272",lightgrey:"#a4bfda",gray:"#9fb2d4",darkgray:"#7b8272",lightgray:"#a4bfda",red:"#9d5443",darkred:"#8c5b4a",lightred:"#94614c",brown:"#89a78d",darkbrown:"#829e88",lightbrown:"#aaae97",orange:"#d1ba86",yellow:"#d6cda2",green:"#75ac8d",darkgreen:"#8fa67f",lightgreen:"#8eb682",blue:"#88a3ce",lightblue:"#a5adb0",darkblue:"#5c6b8c",purple:"#d39fac",pink:"#c8ac9e"},proteus_night:{black:"#010912",white:"#fdeeec",grey:"#051d40",darkgrey:"#091842",lightgrey:"#062151",gray:"#051d40",darkgray:"#091842",lightgray:"#062151",red:"#ad4576",darkred:"#934765",lightred:"#ab6290",brown:"#61646b",darkbrown:"#3d2d2d",lightbrown:"#8393a0",orange:"#0a2227",yellow:"#0a2541",green:"#75ac8d",darkgreen:"#0a2434",lightgreen:"#061f2e",blue:"#0b2c79",lightblue:"#809ccb",darkblue:"#08153b",purple:"#666a87",pink:"#754b4d"},proteus_rich:{black:"#6f686f",white:"#d1b1e2",grey:"#b9aac1",darkgrey:"#8e8b84",lightgrey:"#c7b5cd",gray:"#b9aac1",darkgray:"#8e8b84",lightgray:"#c7b5cd",red:"#a11f4f",darkred:"#934765",lightred:"#c998ad",brown:"#89867d",darkbrown:"#797f75",lightbrown:"#ab9997",orange:"#ce8c5c",yellow:"#f0d959",green:"#75bc54",darkgreen:"#599d79",lightgreen:"#90cf5c",blue:"#8fd0ec",lightblue:"#bcdce7",darkblue:"#0b2c70",purple:"#9b377f",pink:"#cd88e5"},amstrad:{black:"#000000",white:"#ffffff",grey:"#7f7f7f",darkgrey:"#636363",lightgrey:"#afafaf",gray:"#7f7f7f",darkgray:"#636363",lightgray:"#afafaf",red:"#ff0000",darkred:"#7f0000",lightred:"#ff7f7f",brown:"#ff7f00",darkbrown:"#7f7f00",lightbrown:"#ffff00",orange:"#ff007f",yellow:"#ffff7f",green:"#01ff00",darkgreen:"#007f00",lightgreen:"#7fff7f",blue:"#0000ff",lightblue:"#7f7fff",darkblue:"#00007f",purple:"#7f007f",pink:"#ff7fff"},c64:{black:"#000000",white:"#ffffff",grey:"#6C6C6C",darkgrey:"#444444",lightgrey:"#959595",gray:"#6C6C6C",darkgray:"#444444",lightgray:"#959595",red:"#68372B",darkred:"#3f1e17",lightred:"#9A6759",brown:"#433900",darkbrown:"#221c02",lightbrown:"#6d5c0d",orange:"#6F4F25",yellow:"#B8C76F",green:"#588D43",darkgreen:"#345129",lightgreen:"#9AD284",blue:"#6C5EB5",lightblue:"#70A4B2",darkblue:"#352879",purple:"#6F3D86",pink:"#b044ac"},whitingjp:{black:"#202527",white:"#eff8fd",grey:"#7b7680",darkgrey:"#3c3b44",lightgrey:"#bed0d7",gray:"#7b7680",darkgray:"#3c3b44",lightgray:"#bed0d7",red:"#bd194b",darkred:"#6b1334",lightred:"#ef2358",brown:"#b52e1c",darkbrown:"#681c12",lightbrown:"#e87b45",orange:"#ff8c10",yellow:"#fbd524",green:"#36bc3c",darkgreen:"#317610",lightgreen:"#8ce062",blue:"#3f62c6",lightblue:"#57bbe0",darkblue:"#2c2fa0",purple:"#7037d9",pink:"#ec2b8f"}};var reg_color_names=/(black|white|darkgray|lightgray|gray|grey|darkgrey|lightgrey|red|darkred|lightred|brown|darkbrown|lightbrown|orange|yellow|green|darkgreen|lightgreen|blue|lightblue|darkblue|purple|pink|transparent)\s*/,reg_color=/(black|white|gray|darkgray|lightgray|grey|darkgrey|lightgrey|red|darkred|lightred|brown|darkbrown|lightbrown|orange|yellow|green|darkgreen|lightgreen|blue|lightblue|darkblue|purple|pink|transparent|#(?:[0-9a-f]{2}){3,4}|#(?:[0-9a-f]{3}))\s*/;function createSprite(e,t,n,r){void 0===n&&(n=[state.bgcolor,state.fgcolor]);var o=makeSpriteCanvas(e);return renderSprite(o.getContext("2d"),t,n,r,0,0),o}function renderSprite(e,t,n,r,o,i){void 0===n&&(n=["#00000000",state.fgcolor]);var s=o*cellwidth,a=i*cellheight;e.clearRect(s,a,cellwidth,cellheight);var l=t[0].length,c=t.length,u=~~(cellwidth/(l+(0|r))),d=~~(cellheight/(c+(0|r))),h=d;"scanline"in state.metadata&&(h=Math.ceil(d/2)),e.fillStyle=state.fgcolor;for(var p=0;p<c;p++)for(var f=0;f<l;f++){var g=t[p][f];if(g>=0){var m=p*d|0,v=f*u|0;e.fillStyle=n[g],e.fillRect(s+v,a+m,u,h)}}}function drawTextWithCustomFont(e,t,n,r){t.fillStyle=state.fgcolor,t.textBaseline="middle",t.textAlign="center";var o=1;void 0!==state.metadata.font_size&&(o=Math.max(parseFloat(state.metadata.font_size),0)),t.font=cellheight*o+"px PuzzleCustomFont",t.fillText(e,n,r)}var textsheetCanvas=null;function regenText(e,t){null==textsheetCanvas&&(textsheetCanvas=document.createElement("canvas"));var n=Math.ceil(Math.sqrt(fontKeys.length));textsheetCanvas.width=n*cellwidth,textsheetCanvas.height=n*cellheight*2;for(var r=textsheetCanvas.getContext("2d"),o=0;o<fontKeys.length;o++){var i=fontKeys[o];if("†"==i){console.log("making custom red character"),fontstr="11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111\n                       11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();var s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#FF0000","#FF0000"],1,s,a),renderSprite(r,fontstr,["#FF0000","#FF0000"],1,s,a+n)}else if("ª"==i){console.log("making blue character"),fontstr="11111\n                11111\n                11111\n                11111\n                11111\n                11111\n                11111\n                11111\n                11111\n                11111\n                11111\n                11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#0000FF"],1,s,a),renderSprite(r,fontstr,["#000000","#0000FF"],1,s,a+n)}else if("ŋ"==i){console.log("making blue siren character"),fontstr="00000\n            00000\n            00000\n            00000\n            00000\n            00000\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#0000FF"],1,s,a),renderSprite(r,fontstr,["#000000","#0000FF"],1,s,a+n)}else if("ŉ"==i){console.log("making red siren character"),fontstr="00000\n            00000\n            00000\n            00000\n            00000\n            00000\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FF0000"],1,s,a),renderSprite(r,fontstr,["#000000","#FF0000"],1,s,a+n)}else if("Æ"==i){console.log("making custom white character"),fontstr="11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#FFFFFF","#FFFFFF"],1,s,a+n)}else if("Ĳ"==i){console.log("making custom half-black half-green character"),fontstr="00000\n            00000\n            00000\n            00000\n            00000\n            00000\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#016b16","#000000"],1,s,a),renderSprite(r,fontstr,["#016b16","#000000"],1,s,a+n)}else if("ş"==i){console.log("making custom half-black half-blue character"),fontstr="00000\n            00000\n            00000\n            00000\n            00000\n            00000\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#0000FF","#000000"],1,s,a),renderSprite(r,fontstr,["#0000FF","#000000"],1,s,a+n)}else if("ĳ"==i){console.log("making custom green character"),fontstr="11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#016b16","#016b16"],1,s,a),renderSprite(r,fontstr,["#016b16","#016b16"],1,s,a+n)}else if("š"==i){console.log("making custom orange character"),fontstr="11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#FFA500","#FFA500"],1,s,a),renderSprite(r,fontstr,["#FFA500","#FFA500"],1,s,a+n)}else if("æ"==i){console.log("making custom left wheel character"),fontstr="11111\n            11111\n            11111\n            11100\n            11100\n            11100\n            11100\n            11100\n            11100\n            11100\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#3A3B3C"],1,s,a),renderSprite(r,fontstr,["#FFFFFF","#3A3B3C"],1,s,a+n)}else if("ł"==i){console.log("making custom right wheel character"),fontstr="11111\n            11111\n            11111\n            00111\n            00111\n            00111\n            00111\n            00111\n            00111\n            00111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#3A3B3C"],1,s,a),renderSprite(r,fontstr,["#FFFFFF","#3A3B3C"],1,s,a+n)}else if("®"==i){console.log("making custom light gray character"),fontstr="11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#D3D3D3","#D3D3D3"],1,s,a),renderSprite(r,fontstr,["#D3D3D3","#D3D3D3"],1,s,a+n)}else if("€"==i){console.log("making custom light blue character"),fontstr="11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#ADD8E6","#ADD8E6"],1,s,a),renderSprite(r,fontstr,["#ADD8E6","#ADD8E6"],1,s,a+n)}else if("ĸ"==i){console.log("making custom black character"),fontstr="11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#000000"],1,s,a),renderSprite(r,fontstr,["#000000","#000000"],1,s,a+n)}else if("Ł"==i){console.log("making custom noise line character"),fontstr="11111\n            11111\n            11111\n            11111\n            01111\n            10111\n            11011\n            00001\n            01111\n            10111\n            11011\n            11101",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#000000"],1,s,a),renderSprite(r,fontstr,["#FFFFFF","#000000"],1,s,a+n)}else if("ŀ"==i){console.log("making custom noise line 2 character"),fontstr="11111\n            11111\n            11101\n            11101\n            11101\n            11101\n            10101\n            10001\n            10101\n            10111\n            10111\n            10111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#000000"],1,s,a),renderSprite(r,fontstr,["#FFFFFF","#000000"],1,s,a+n)}else if("Ŀ"==i){console.log("making custom noise line 3 character"),fontstr="11111\n            11111\n            11111\n            11111\n            00111\n            01111\n            11111\n            00000\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#000000"],1,s,a),renderSprite(r,fontstr,["#FFFFFF","#000000"],1,s,a+n)}else if("ļ"==i){console.log("making custom noise line 4 character"),fontstr="11111\n            11111\n            11111\n            11111\n            10000\n            11111\n            11110\n            11100\n            11111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#FFFFFF","#000000"],1,s,a),renderSprite(r,fontstr,["#FFFFFF","#000000"],1,s,a+n)}else if("¥"==i){console.log("making custom title 1 character"),fontstr="11111\n            11111\n            11111\n            11100\n            11110\n            11110\n            11110\n            11110\n            11110\n            11110\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("§"==i){console.log("making custom title 2 character"),fontstr="11111\n            11111\n            11111\n            01010\n            11010\n            11010\n            11000\n            11010\n            11010\n            11010\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("¤"==i){console.log("making custom title 3 character"),fontstr="11111\n            11111\n            11111\n            10001\n            10111\n            10111\n            10001\n            10111\n            10111\n            10001\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("¢"==i){console.log("making custom title 4 character"),fontstr="11111\n            11111\n            11111\n            10001\n            10111\n            10111\n            10001\n            11101\n            11101\n            10001\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("Ÿ"==i){console.log("making custom title 5 character"),fontstr="11111\n            11111\n            11111\n            00010\n            01010\n            01010\n            01010\n            01010\n            01010\n            00010\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("ŷ"==i){console.log("making custom title 6 character"),fontstr="11111\n            11111\n            11111\n            10101\n            10100\n            10100\n            10100\n            10101\n            10101\n            00101\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("ų"==i){console.log("making custom title 7 character"),fontstr="11111\n            11111\n            11111\n            10100\n            10101\n            10101\n            00101\n            00101\n            00101\n            10100\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("ø"==i){console.log("making custom title 7.1 character"),fontstr="11111\n            11111\n            11111\n            11111\n            01111\n            01111\n            01111\n            01111\n            01111\n            11111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("Ų"==i){console.log("making custom title 8 character"),fontstr="11111\n            11111\n            11111\n            11000\n            11010\n            11010\n            11010\n            11010\n            11010\n            11000\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("ű"==i){console.log("making custom title 9 character"),fontstr="11111\n            11111\n            11111\n            10001\n            10111\n            10001\n            10111\n            10111\n            10111\n            10111\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("ŧ"==i){console.log("making custom title 10 character"),fontstr="11111\n            11111\n            11111\n            10001\n            10111\n            10111\n            10001\n            11101\n            11101\n            10001\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("Ŧ"==i){console.log("making custom title 11 character"),fontstr="11111\n            11111\n            11111\n            00010\n            10110\n            10110\n            10110\n            10110\n            10110\n            00010\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("Ţ"==i){console.log("making custom title 12 character"),fontstr="11111\n            11111\n            11111\n            00100\n            10101\n            10101\n            01100\n            10101\n            10101\n            10100\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("Œ"==i){console.log("making custom title 13 character"),fontstr="11111\n            11111\n            11111\n            01011\n            11001\n            11001\n            01000\n            11010\n            11010\n            01011\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if("œ"==i){console.log("making custom title 14 character"),fontstr="11111\n            11111\n            11111\n            01000\n            01011\n            01011\n            01000\n            01110\n            01110\n            01000\n            11111\n            11111",fontstr=fontstr.split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFFFF"],1,s,a+n)}else if(font.hasOwnProperty(i)){fontstr=font[i].split("\n").map((e=>e.trim().split("").map((e=>parseInt(e))))),fontstr.shift();s=o%n|0,a=o/n|0;"✓"==i?(renderSprite(r,fontstr,["#000000","#00FF00"],1,s,a),renderSprite(r,fontstr,["#000000","#00FF00"],0,s,a+n)):">"==i||"<"==i||"#"==i||"["==i||"]"==i||"Ć"==i||"ć"==i||"ľ"==i||"į"==i||"ķ"==i||"ť"==i||"ŏ"==i||"ń"==i||"ū"==i||"ě"==i||"Ĺ"==i||"Ġ"==i||"Ń"==i||"Ý"==i||"Ś"==i||"ś"==i||"ā"==i||"ď"==i||"ř"==i||"ñ"==i||"ŵ"==i||"Ě"==i||"Đ"==i||"ğ"==i||"ħ"==i?(renderSprite(r,fontstr,["#000000","#FFFF00"],1,s,a),renderSprite(r,fontstr,["#000000","#FFFF00"],0,s,a+n)):"*"==i?(renderSprite(r,fontstr,["#000000","#FF0000"],1,s,a),renderSprite(r,fontstr,["#000000","#FF0000"],0,s,a+n)):(renderSprite(r,fontstr,void 0,1,s,a),renderSprite(r,fontstr,["#00000000","#000000"],0,s,a+n))}}}var spriteimages,glyphImagesCorrespondance,glyphImages,glyphHighlight,glyphHighlightDiff,glyphHighlightResize,glyphPrintButton,glyphMouseOver,editor_s_grille=[[0,1,1,1,0],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,1],[0,1,1,1,0]],spritesheetCanvas=null;function regenSpriteImages(){if(console.log("sprites length: "+sprites.length),textMode)return spriteimages=[],void regenText();if(!0===IDE&&(textImages.editor_s=createSprite("chars",editor_s_grille,void 0)),0!==state.levels.length){spriteimages=[];var e=Math.ceil(Math.sqrt(sprites.length));null==spritesheetCanvas&&(spritesheetCanvas=document.createElement("canvas")),spritesheetCanvas.width=e*cellwidth,spritesheetCanvas.height=e*cellheight;for(var t=spritesheetCanvas.getContext("2d"),n=0;n<sprites.length;n++)if(null!=sprites[n]){canOpenEditor&&(spriteimages[n]=createSprite(n.toString(),sprites[n].dat,sprites[n].colors));var r=n%e|0,o=n/e|0;renderSprite(t,sprites[n].dat,sprites[n].colors,0,r,o)}canOpenEditor&&generateGlyphImages()}}var canvas,ctx,x,y,cellwidth,cellheight,xoffset,yoffset,lastDownTarget,glyphSelectedIndex=0,editorRowCount=1,editorGlyphMovements=[],canvasdict={};function makeSpriteCanvas(e){var t;return e in canvasdict?t=canvasdict[e]:(t=document.createElement("canvas"),canvasdict[e]=t),t.width=cellwidth,t.height=cellheight,t}function generateGlyphImages(){if(0!==cellwidth&&0!==cellheight){for(var e in glyphImagesCorrespondance=[],glyphImages=[],seenobjects={},state.glyphDict)if(1==e.length&&state.glyphDict.hasOwnProperty(e)){var t=state.glyphDict[e],n=t.join(",");if(seenobjects.hasOwnProperty(n))continue;var r=makeSpriteCanvas("C"+e),o=r.getContext("2d");glyphImagesCorrespondance.push(e),seenobjects[n]=!0;for(var i=0;i<t.length;i++){var s=t[i];-1!==s&&o.drawImage(spriteimages[s],0,0)}glyphImages.push(r)}if(IDE){(o=(glyphHighlight=makeSpriteCanvas("highlight")).getContext("2d")).fillStyle="#FFFFFF",o.fillRect(0,0,cellwidth,1),o.fillRect(0,0,1,cellheight),o.fillRect(0,cellheight-1,cellwidth,1),o.fillRect(cellwidth-1,0,1,cellheight),glyphPrintButton=textImages.editor_s,(o=(glyphHighlightDiff=makeSpriteCanvas("glyphHighlightDiff")).getContext("2d")).fillStyle=state.bgcolor,o.fillRect(0,0,cellwidth,2),o.fillRect(0,0,2,cellheight),o.fillRect(0,cellheight-2,cellwidth,2),o.fillRect(cellwidth-2,0,2,cellheight),o.fillStyle=state.fgcolor,o.fillRect(0,0,cellwidth,1),o.fillRect(0,0,1,cellheight),o.fillRect(0,cellheight-1,cellwidth,1),o.fillRect(cellwidth-1,0,1,cellheight),glyphPrintButton=textImages.editor_s,(o=(glyphHighlightResize=makeSpriteCanvas("highlightresize")).getContext("2d")).fillStyle="#FFFFFF";var a=cellwidth/2-1|0,l=cellwidth-a-1-a,c=cellheight/2-1|0,u=cellheight-c-1-a;o.fillRect(a,0,l,cellheight),o.fillRect(0,c,cellwidth,u),(o=(glyphMouseOver=makeSpriteCanvas("glyphMouseOver")).getContext("2d")).fillStyle="yellow",o.fillRect(0,0,cellwidth,2),o.fillRect(0,0,2,cellheight),o.fillRect(0,cellheight-2,cellwidth,2),o.fillRect(cellwidth-2,0,2,cellheight);const e=[[[3,2],[5,0],[7,2]],[[3,8],[5,10],[7,8]],[[2,3],[0,5],[2,7]],[[7,3],[10,5],[7,7]],[[3,5],[5,7],[7,5],[5,3]]];for(i=0;i<e.length;i++){editorGlyphMovements[i]=makeSpriteCanvas("editorGlyphMovements"+i);var d=e[i];(o=editorGlyphMovements[i].getContext("2d")).lineWidth=1,o.fillStyle=state.bgcolor,o.strokeStyle=state.fgcolor,o.beginPath(),o.moveTo(d[0][0]*cellwidth/10,d[0][1]*cellheight/10);for(var h=1;h<d.length;h++)o.lineTo(d[h][0]*cellwidth/10,d[h][1]*cellheight/10);o.closePath(),o.fill(),o.stroke()}}}}function glyphCount(){var e=0;for(var t in state.glyphDict)1==t.length&&state.glyphDict.hasOwnProperty(t)&&e++;return e}function redraw(){if(0!==cellwidth&&0!==cellheight){var e=Math.ceil(Math.sqrt(fontKeys.length));if(textMode)if(console.log("redrawing in text mode"),ctx.fillStyle=state.bgcolor,ctx.fillRect(0,0,canvas.width,canvas.height),void 0!==state.metadata.custom_font&&loadedCustomFont){null===spritesheetCanvas&&regenSpriteImages();for(t=0;t<titleHeight;t++){drawTextWithCustomFont(titleImage[t],ctx,xoffset+titleWidth*cellwidth/2,yoffset+t*cellheight+cellheight/2)}}else for(var t=0;t<titleWidth;t++)for(var n=0;n<titleHeight;n++){var r=titleImage[n].charAt(t);if(r in font){var o=fontIndex[r],i=o%e|0,s=o/e|0;ctx.imageSmoothingEnabled=!1,"†"==r||"Æ"==r||"æ"==r||"®"==r||"€"==r||"¥"==r||"§"==r||"¤"==r||"¢"==r||"Ÿ"==r||"ŷ"==r||"ų"==r||"Ų"==r||"ű"==r||"ŧ"==r||"Ŧ"==r||"Ţ"==r||"Œ"==r||"œ"==r||"ŋ"==r||"ŉ"==r||"ł"==r||"Ł"==r||"ŀ"==r||"Ŀ"==r||"ļ"==r||"ĸ"==r||"ĳ"==r||"Ĳ"==r||"ø"==r||"ª"==r||"š"==r||"ş"==r?ctx.drawImage(textsheetCanvas,i*textcellwidth,s*textcellheight,textcellwidth,textcellheight,xoffset+t*cellwidth,yoffset+n*cellheight,1.25*cellwidth,1.2*cellheight):ctx.drawImage(textsheetCanvas,i*textcellwidth,s*textcellheight,textcellwidth,textcellheight,xoffset+t*cellwidth,yoffset+n*cellheight,cellwidth,cellheight)}}else{console.log("redrawing in normal mode");var a=level;null!==diffToVisualize&&((a=new Level(-1,diffToVisualize.width,diffToVisualize.height,diffToVisualize.layerCount,diffToVisualize.objects)).movements=diffToVisualize.movements),ctx.fillStyle=state.bgcolor,ctx.fillRect(0,0,canvas.width,canvas.height);var l=0,c=screenwidth,u=0,d=screenheight,h={x:0,y:0};if(levelEditorOpened){var p=glyphCount();c-=2,d-=2+(editorRowCount=Math.ceil(p/(screenwidth-1)))}else if(flickscreen){if((m=getPlayerPositions()).length>0){var f=(v=m[0])/a.height|0,g=v%a.height|0;l=(f/screenwidth|0)*screenwidth,u=(g/screenheight|0)*screenheight,c=Math.min(l+screenwidth,a.width),d=Math.min(u+screenheight,a.height),oldflickscreendat=[l,u,c,d]}else oldflickscreendat.length>0&&(l=oldflickscreendat[0],u=oldflickscreendat[1],c=oldflickscreendat[2],d=oldflickscreendat[3])}else if(zoomscreen){var m;if((m=getPlayerPositions()).length>0){var v;f=(v=m[0])/a.height|0,g=v%a.height|0;l=Math.max(Math.min(f-(screenwidth/2|0),a.width-screenwidth),0),u=Math.max(Math.min(g-(screenheight/2|0),a.height-screenheight),0),c=Math.min(l+screenwidth,a.width),d=Math.min(u+screenheight,a.height),oldflickscreendat=[l,u,c,d]}else oldflickscreendat.length>0&&(l=oldflickscreendat[0],u=oldflickscreendat[1],c=oldflickscreendat[2],d=oldflickscreendat[3])}else smoothscreen&&(null!==cameraPositionTarget?(["x","y"].forEach((function(e){var t=cameraPositionTarget[e]-cameraPosition[e];0!==t&&(Math.abs(t)<.5/cellwidth?cameraPosition[e]=cameraPositionTarget[e]:(cameraPosition[e]+=t*state.metadata.smoothscreen.cameraSpeed,h[e]=cameraPosition[e]%1))})),l=Math.max(Math.min(Math.floor(cameraPosition.x)-Math.floor(screenwidth/2),level.width-screenwidth),0),u=Math.max(Math.min(Math.floor(cameraPosition.y)-Math.floor(screenheight/2),level.height-screenheight),0),c=Math.min(l+screenwidth,level.width),d=Math.min(u+screenheight,level.height),oldflickscreendat=[l,u,c,d]):oldflickscreendat.length>0&&(l=oldflickscreendat[0],u=oldflickscreendat[1],c=oldflickscreendat[2],d=oldflickscreendat[3]),ctx.save(),ctx.beginPath(),ctx.moveTo(xoffset,yoffset),ctx.lineTo(xoffset+(c-l)*cellwidth,yoffset),ctx.lineTo(xoffset+(c-l)*cellwidth,yoffset+(d-u)*cellwidth),ctx.lineTo(xoffset,yoffset+(d-u)*cellwidth),ctx.clip());screenOffsetX=l,screenOffsetY=u;var y=smoothscreen?1:0,_=Math.ceil(Math.sqrt(sprites.length));if(state.metadata.tween_length&&currentMovedEntities){var b=1-clamp(tweentimer/tweeninterval,0,1),w="linear",S=state.sprite_size;void 0!==state.metadata.tween_easing&&(w=state.metadata.tween_easing,NaN!=parseInt(w)&&easingAliases[parseInt(w)]&&(w=easingAliases[parseInt(w)]),w=w.toLowerCase()),void 0!==state.metadata.tween_snap&&(S=Math.max(parseInt(state.metadata.tween_snap),1)),null!=EasingFunctions[w]&&(b=EasingFunctions[w](b)),b=Math.floor(b*S)/S;for(k=0;k<state.idDict.length;k++){var C=state.objects[state.idDict[k]].layer;for(t=Math.max(l-y,0);t<Math.min(c+y,a.width);t++)for(n=Math.max(u-y,0);n<Math.min(d+y,a.height);n++){O=n+t*a.height;if(0!=(M=a.getCellInto(O,_o12)).get(k)){E=k%_|0,N=k/_|0,T=xoffset+(t-l-h.x)*cellwidth,L=yoffset+(n-u-h.y)*cellheight;if(currentMovedEntities&&currentMovedEntities["p"+O+"-l"+C]){var I=currentMovedEntities["p"+O+"-l"+C];if(16!=I){var x=dirMasksDelta[I];T-=cellwidth*x[0]*b,L-=cellheight*x[1]*b}else 16==I&&(ctx.globalAlpha=1-b)}ctx.drawImage(spritesheetCanvas,E*cellwidth,N*cellheight,cellwidth,cellheight,Math.floor(T),Math.floor(L),cellwidth,cellheight),ctx.globalAlpha=1}}}}else for(var t=Math.max(l-y,0);t<Math.min(c+y,a.width);t++)for(var n=Math.max(u-y,0);n<Math.min(d+y,a.height);n++)for(var O=n+t*a.height,M=a.getCellInto(O,_o12),k=0;k<state.objectCount;k++)if(0!=M.get(k)){var E=k%_|0,N=k/_|0,T=xoffset+(t-l-h.x)*cellwidth,L=yoffset+(n-u-h.y)*cellheight;ctx.drawImage(spritesheetCanvas,E*cellwidth,N*cellheight,cellwidth,cellheight,Math.floor(T),Math.floor(L),cellwidth,cellheight)}if(null!==diffToVisualize){for(var A=diffToVisualize.lineNumber-1;A>=-1&&!debug_visualisation_array[diffToVisualize.turnIndex].hasOwnProperty(A);A--);var R=debug_visualisation_array[diffToVisualize.turnIndex][A],D=new Level(-1,R.width,R.height,R.layerCount,R.objects);D.movements=R.movements;for(t=l;t<c;t++)for(n=u;n<d;n++){O=n+t*a.height;var P=D.getMovements(O),F=a.getMovements(O),B=D.getCellInto(O,_o11);M=a.getCellInto(O,_o12);F.equals(P)&&M.equals(B)||ctx.drawImage(glyphHighlightDiff,xoffset+(t-l)*cellwidth,yoffset+(n-u)*cellheight)}for(t=l;t<c;t++)for(n=u;n<d;n++){O=n+t*a.height,F=a.getMovements(O);for(var j=0;j<a.layerCount;j++){var z=F.getshiftor(31,5*j);for(k=0;k<5;k++)0!=(z&Math.pow(2,k))&&ctx.drawImage(editorGlyphMovements[k],xoffset+(t-l)*cellwidth,yoffset+(n-u)*cellheight)}}}smoothscreen&&(state.metadata.smoothscreen.debug&&drawSmoothScreenDebug(ctx),ctx.restore()),levelEditorOpened&&drawEditorIcons(l,u)}}}function drawSmoothScreenDebug(e){e.save();var t=state.metadata.smoothscreen.boundarySize,n=getPlayerPositions();if(n.length>0){var r={x:n[0]/level.height|0,y:n[0]%level.height|0},o=r.x-cameraPosition.x,i=r.y-cameraPosition.y;e.fillStyle="#00ff00",e.beginPath(),e.arc(xoffset+(Math.floor(screenwidth/2)+o+.5)*cellwidth,yoffset+(Math.floor(screenheight/2)+i+.5)*cellheight,cellwidth/4,0,2*Math.PI),e.fill()}var s=cameraPositionTarget.x-cameraPosition.x,a=cameraPositionTarget.y-cameraPosition.y;e.fillStyle="#0000ff",e.beginPath(),e.arc(xoffset+(Math.floor(screenwidth/2)+s)*cellwidth,yoffset+(Math.floor(screenheight/2)+a)*cellheight,cellwidth/8,0,2*Math.PI),e.fill(),e.strokeStyle="#0000ff",e.lineWidth=cellwidth/16,e.strokeRect(xoffset+(Math.floor(screenwidth/2)+s-Math.floor(t.width/2))*cellwidth,yoffset+(Math.floor(screenheight/2)+a-Math.floor(t.height/2))*cellheight,t.width*cellwidth,t.height*cellheight),e.fillStyle="#ff0000",e.beginPath(),e.arc(xoffset+Math.floor(screenwidth/2)*cellwidth,yoffset+Math.floor(screenheight/2)*cellheight,cellwidth/4,0,2*Math.PI),e.fill(),e.strokeStyle="#ff0000",e.lineWidth=cellwidth/8,e.strokeRect(xoffset+(Math.floor(screenwidth/2)-Math.floor(t.width/2))*cellwidth,yoffset+(Math.floor(screenheight/2)-Math.floor(t.height/2))*cellheight,t.width*cellwidth,t.height*cellheight),e.restore()}function drawEditorIcons(e,t){glyphImages.length;var n=glyphImages.length-0;ctx.drawImage(glyphPrintButton,xoffset-cellwidth,yoffset-cellheight*(1+editorRowCount)),mouseCoordY===-1-editorRowCount&&-1===mouseCoordX&&ctx.drawImage(glyphMouseOver,xoffset-cellwidth,yoffset-cellheight*(1+editorRowCount));for(var r=mouseCoordX+(screenwidth-1)*(a=editorRowCount-(-mouseCoordY-2)-1),o=0;o<n;o++){var i=glyphImages[0+o],s=o%(screenwidth-1),a=o/(screenwidth-1)|0;ctx.drawImage(i,xoffset+s*cellwidth,yoffset+a*cellheight-cellheight*(1+editorRowCount)),mouseCoordX>=0&&mouseCoordX<screenwidth-1&&r===o&&ctx.drawImage(glyphMouseOver,xoffset+s*cellwidth,yoffset+a*cellheight-cellheight*(1+editorRowCount)),o===glyphSelectedIndex&&ctx.drawImage(glyphHighlight,xoffset+s*cellwidth,yoffset+a*cellheight-cellheight*(1+editorRowCount))}var l="",c=null;if(mouseCoordX>=0&&mouseCoordX<screenwidth&&r>=0&&r<n){const e=glyphImagesCorrespondance[0+r];l=e,e in state.synonymsDict?l+=" = "+state.synonymsDict[e]:e in state.aggregatesDict&&(l+=" = "+state.aggregatesDict[e].join(" and "))}else if(mouseCoordX>=0&&mouseCoordY>=0&&mouseCoordX<screenwidth&&mouseCoordY<screenheight-editorRowCount){const n=level.getCellInto(mouseCoordY+t+(mouseCoordX+e)*level.height,_o12);null!==(c=state.idDict.filter(((e,t)=>0!=n.get(t))))&&(l=c.join(", "))}l.length>0&&(ctx.fillStyle=state.fgcolor,ctx.font='16px "Source Sans Pro", Helvetica, Arial, sans-serif',ctx.fillText(l,xoffset,yoffset-.4*cellheight)),mouseCoordX>=-1&&mouseCoordY>=-1&&mouseCoordX<screenwidth-1&&mouseCoordY<screenheight-1-editorRowCount&&(-1==mouseCoordX||-1==mouseCoordY||mouseCoordX==screenwidth-2||mouseCoordY===screenheight-2-editorRowCount?ctx.drawImage(glyphHighlightResize,xoffset+mouseCoordX*cellwidth,yoffset+mouseCoordY*cellheight):ctx.drawImage(glyphHighlight,xoffset+mouseCoordX*cellwidth,yoffset+mouseCoordY*cellheight))}window.addEventListener("resize",canvasResize,!1),canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d"),x=0,y=0;var oldcellwidth=0,oldcellheight=0,oldtextmode=-1,oldfgcolor=-1,forceRegenImages=!1,textcellwidth=0,textcellheight=0;function canvasResize(){if(parentWidth=canvas.parentNode.clientWidth,parentHeight=canvas.parentNode.clientHeight,screenwidth=level.width,screenheight=level.height,void 0!==state)if(flickscreen=void 0!==state.metadata.flickscreen,zoomscreen=void 0!==state.metadata.zoomscreen,smoothscreen=void 0!==state.metadata.smoothscreen,levelEditorOpened){screenwidth+=2;var e=glyphCount();editorRowCount=Math.ceil(e/(screenwidth-1)),screenheight+=2+editorRowCount}else flickscreen?(screenwidth=state.metadata.flickscreen[0],screenheight=state.metadata.flickscreen[1]):zoomscreen?(screenwidth=state.metadata.zoomscreen[0],screenheight=state.metadata.zoomscreen[1]):smoothscreen&&(screenwidth=state.metadata.smoothscreen.screenSize.width,screenheight=state.metadata.smoothscreen.screenSize.height);textMode&&(screenwidth=titleWidth,screenheight=titleHeight),cellwidth=parentWidth/screenwidth,cellheight=parentHeight/screenheight;var t=5,n=5;if(sprites.length>=2)t=sprites[1].dat.length,n=sprites[1].dat.length;textMode&&(t=6,n=font.X.length/t+1),cellwidth=t*Math.max(~~(cellwidth/t),1),cellheight=n*Math.max(~~(cellheight/n),1),0!=cellwidth&&0!=cellheight||textMode||(cellwidth=t,cellheight=n,console.log("Resized below 1")),xoffset=0,yoffset=0,cellwidth/t>cellheight/n||textMode&&void 0!==state.metadata.custom_font&&loadedCustomFont?(cellwidth=cellheight*t/n,xoffset=(parentWidth-cellwidth*screenwidth)/2,yoffset=(parentHeight-cellheight*screenheight)/2):(cellheight=cellwidth*n/t,yoffset=(parentHeight-cellheight*screenheight)/2,xoffset=(parentWidth-cellwidth*screenwidth)/2),yoffset<0&&(yoffset=0),xoffset<0&&(xoffset=0),levelEditorOpened&&!textMode&&(xoffset+=cellwidth,yoffset+=cellheight*(1+editorRowCount)),cellwidth|=0,cellheight|=0,xoffset|=0,yoffset|=0,textMode&&(textcellwidth=cellwidth,textcellheight=cellheight),(oldcellwidth!=cellwidth||oldcellheight!=cellheight||oldtextmode!=textMode||textMode||oldfgcolor!=state.fgcolor||forceRegenImages)&&(forceRegenImages=!1,regenSpriteImages()),oldcellheight=cellheight,oldcellwidth=cellwidth,oldtextmode=textMode,oldfgcolor=state.fgcolor,canvas.width=xoffset+cellwidth*screenwidth,canvas.height=yoffset+cellheight*screenheight,redraw()}EasingFunctions={linear:e=>e,easeinquad:e=>e*e,easeoutquad:e=>e*(2-e),easeinoutquad:e=>e<.5?2*e*e:(4-2*e)*e-1,easeincubic:e=>e*e*e,easeoutcubic:e=>--e*e*e+1,easeinoutcubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeinquart:e=>e*e*e*e,easeoutquart:e=>1- --e*e*e*e,easeinoutquart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,easeinquint:e=>e*e*e*e*e,easeoutquint:e=>1+--e*e*e*e*e,easeinoutquint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},easingAliases={1:"linear",2:"easeInQuad",3:"easeOutQuad",4:"easeInOutQuad",5:"easeInCubic",6:"easeOutCubic",7:"easeInOutCubic",8:"easeInQuart",9:"easeOutQuart",10:"easeInOutQuart",11:"easeInQuint",12:"easeOutQuint",13:"easeInOutQuint"};var keyRepeatTimer=0,keyRepeatIndex=0,input_throttle_timer=0,lastinput=-100,dragging=!1,rightdragging=!1,columnAdded=!1;function selectText(e,t){t=t||window.event;var n=document.getElementById(e);if(t&&(t.ctrlKey||t.metaKey)){if(solving)return;var r=["console"].concat(n.innerHTML.split("<br>")),o=levelFromString(state,r);loadLevelFromLevelDat(state,o,null),canvasResize()}else{if(document.selection)(i=document.body.createTextRange()).moveToElementText(n),i.select();else if(window.getSelection){var i;(i=document.createRange()).selectNode(n);var s=window.getSelection();s.removeAllRanges(),s.addRange(i)}}}function recalcLevelBounds(){}function arrCopy(e,t,n,r,o){for(;o--;)n[r++]=e[t]++}function adjustLevel(e,t,n){backups.push(backupLevel());var r=e.clone();e.width+=t,e.height+=n,e.n_tiles=e.width*e.height,e.objects=new Int32Array(e.n_tiles*STRIDE_OBJ);var o=new BitVec(STRIDE_OBJ);o.ibitset(state.backgroundid);for(var i=0;i<e.n_tiles;++i)e.setCell(i,o);return e.movements=new Int32Array(e.objects.length),columnAdded=!0,RebuildLevelArrays(),r}function addLeftColumn(){for(var e=adjustLevel(level,1,0),t=1;t<level.width;++t)for(var n=0;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r-level.height))}}function addRightColumn(){for(var e=adjustLevel(level,1,0),t=0;t<level.width-1;++t)for(var n=0;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r))}}function addTopRow(){for(var e=adjustLevel(level,0,1),t=0;t<level.width;++t)for(var n=1;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r-t-1))}}function addBottomRow(){for(var e=adjustLevel(level,0,1),t=0;t<level.width;++t)for(var n=0;n<level.height-1;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r-t))}}function removeLeftColumn(){if(!(level.width<=1))for(var e=adjustLevel(level,-1,0),t=0;t<level.width;++t)for(var n=0;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r+level.height))}}function removeRightColumn(){if(!(level.width<=1))for(var e=adjustLevel(level,-1,0),t=0;t<level.width;++t)for(var n=0;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r))}}function removeTopRow(){if(!(level.height<=1))for(var e=adjustLevel(level,0,-1),t=0;t<level.width;++t)for(var n=0;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r+t+1))}}function removeBottomRow(){if(!(level.height<=1))for(var e=adjustLevel(level,0,-1),t=0;t<level.width;++t)for(var n=0;n<level.height;++n){var r=t*level.height+n;level.setCell(r,e.getCell(r+t))}}function matchGlyph(e,t){for(var n,r=-1,o=0;o<t.length;++o){var i=t[o][0],s=t[o][1],a=t[o][2];if(s.bitsSetInArray(e.data)){for(var l=0,c=0;c<32*STRIDE_OBJ;++c)a.get(c)&&e.get(c)&&l++,s.get(c)&&e.get(c)&&l++;l>r&&(r=l,n=i)}}return r>0?n:(logErrorNoLine("Wasn't able to approximate a glyph value for some tiles, using '.' as a placeholder.",!0),".")}var lastCoord,htmlEntityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},selectableint=0;function printLevel(){var e=[];for(var t in state.glyphDict)if(state.glyphDict.hasOwnProperty(t)&&1===t.length){for(var n=state.glyphDict[t],r=new BitVec(STRIDE_OBJ),o=0;o<n.length;o++){var i=n[o];i>=0&&r.ibitset(i)}var s=r.clone(),a=state.layerMasks[state.backgroundlayer];r.iclear(a),e.push([t,r,s])}var l="selectable"+ ++selectableint,c='Printing level contents:<br><br><span id="'+l+'" onclick="selectText(\''+l+"',event)\"><br>";cache_console_messages=!1;for(var u=0;u<level.height;u++){for(o=0;o<level.width;o++){var d=u+o*level.height;(n=matchGlyph(level.getCell(d),e))in htmlEntityMap&&(n=htmlEntityMap[n]),c+=n}u<level.height-1&&(c+="<br>")}consolePrint(c+="</span><br><br>",!0)}function levelEditorClick(e,t){if(mouseCoordY<=-2){var n=mouseCoordX+(screenwidth-1)*(editorRowCount-(-mouseCoordY-2)-1);-1===mouseCoordX?printLevel():mouseCoordX>=0&&n<glyphImages.length&&(glyphSelectedIndex=n,redraw())}else if(mouseCoordX>-1&&mouseCoordY>-1&&mouseCoordX<screenwidth-2&&mouseCoordY<screenheight-2-editorRowCount){for(var r=glyphImagesCorrespondance[glyphSelectedIndex],o=state.glyphDict[r],i=new BitVec(STRIDE_OBJ),s=0;s<o.length;s++){var a=o[s];a>=0&&i.ibitset(a)}var l=state.layerMasks[state.backgroundlayer];i.bitsClearInArray(l.data)&&i.ibitset(state.backgroundid);var c=mouseCoordY+mouseCoordX*level.height;if(level.getCell(c).equals(i))return;!1===anyEditsSinceMouseDown&&(anyEditsSinceMouseDown=!0,backups.push(backupLevel())),level.setCell(c,i),redraw()}else t&&(-1===mouseCoordX?(addLeftColumn(),canvasResize()):mouseCoordX===screenwidth-2&&(addRightColumn(),canvasResize()),-1===mouseCoordY?(addTopRow(),canvasResize()):mouseCoordY===screenheight-2-editorRowCount&&(addBottomRow(),canvasResize()))}function levelEditorRightClick(e,t){if(-2===mouseCoordY)mouseCoordX<=glyphImages.length&&(glyphSelectedIndex=mouseCoordX,redraw());else if(mouseCoordX>-1&&mouseCoordY>-1&&mouseCoordX<screenwidth-2&&mouseCoordY<screenheight-2-editorRowCount){var n=mouseCoordY+mouseCoordX*level.height,r=new BitVec(STRIDE_OBJ);r.ibitset(state.backgroundid),level.setCell(n,r),redraw()}else t&&(-1===mouseCoordX?(removeLeftColumn(),canvasResize()):mouseCoordX===screenwidth-2&&(removeRightColumn(),canvasResize()),-1===mouseCoordY?(removeTopRow(),canvasResize()):mouseCoordY===screenheight-2-editorRowCount&&(removeBottomRow(),canvasResize()))}function getTilesTraversingPoints(e,t,n,r){if(cellwidth!==cellheight)throw"Error: Cell is not square.";var o=n-e,i=r-t,s=e*i-t*o,a=cellwidth*(Math.abs(o)+Math.abs(i)),l=2*s-a,c=2*s+a;for(var u=Math.floor(e/cellwidth),d=Math.floor(t/cellheight),h=Math.floor(n/cellwidth),p=Math.floor(r/cellheight),f=cellwidth-1,g=h-u>=0?1:-1,m=p-d>=0?1:-1,v=d,y=[],_=[],b=u;b!=h+g;b+=g)for(var w=!1,S=v;S!=p+m;S+=m){if(S>=level.height||S<0||b>=level.width||b<0)throw error="Mouse input loop failed; it:"+b+" "+S+" cell1:"+u+" "+d+" cell2:"+h+" "+p,console.log(error),error;if(fOfPointTimesTwo=i*(2*b*cellwidth+f)-o*(2*S*cellwidth+f),l<fOfPointTimesTwo==fOfPointTimesTwo<=c)y.push(b),_.push(S),w=!0,v=S;else if(w)break}for(var C=("mouse_obstacle"in state.metadata),I=[u],x=[d];u!==h||d!==p;){if(d>=level.height||d<0||u>=level.width||u<0)throw error="Mouse input loop failed; cell1:"+u+" "+d+" cell2:"+h+" "+p,console.log(error),error;if(hitObstacle=function(){var e=screenOffsetY+d+(screenOffsetX+u)*level.height,t=level.getCell(e);return!!state.obstacleMask.anyBitsInCommon(t)},cellCornerXTimesTwo=2*u*cellwidth+f+g*cellwidth,cellCornerYTimesTwo=2*d*cellwidth+f+m*cellwidth,fOfPointTimesTwo=i*cellCornerXTimesTwo-o*cellCornerYTimesTwo,fOfPointTimesTwo>2*s==m>0!=g>0?(u+=g,C&&hitObstacle()&&(u-=g,d+=m)):(d+=m,C&&hitObstacle()&&(d-=m,u+=g)),C&&hitObstacle())break;I.push(u),x.push(d)}if(C)y=I,_=x;else for(b=0;b<y.length;b++)if(y[b]!==I[b]||_[b]!==x[b]){try{displayError("line tile placement algorithm discrepancies detected")}catch(e){}throw consolePrint("line tile placement algorithm discrepancies detected",!0),"line tile placement algorithm discrepancies detected"}return{tileListX:y,tileListY:_}}var x1=5,y1=5,x2=5,y2=5;function ValidatePassword(){passwordEntry.length<=0||(checkPassword()?(tryPlayEndLevelSound(),autocompleteDemo(),earnAchievement("Ambulance Amateur"),earnAchievement("Hospital Helper"),gotoLevel(32)):(tryPlaySimpleSound("sfx5"),passwordEntry=""))}function mouseAction(e,t,n){if(textMode){if(n==state.lmbupID)return;if(!t){if(quittingTitleScreen)return;return void(hoverSelection=!mouseInCanvas||mouseCoordY<0||mouseCoordY>15?-1:mouseCoordY)}if(titleScreen){if(quittingTitleScreen||titleSelected)return void console.error("skipping function");if(1===titleMode||0===titleMode)6==titleSelectOptions?7===mouseCoordY?(titleSelection=0,titleButtonSelected()):8===mouseCoordY?(titleSelection=1,titleButtonSelected()):9===mouseCoordY?(titleSelection=2,titleButtonSelected()):10===mouseCoordY?(titleSelection=3,titleButtonSelected()):11===mouseCoordY?(titleSelection=4,titleButtonSelected()):12===mouseCoordY&&(titleSelection=5,titleButtonSelected()):8===mouseCoordY&&titleSelectOptions>=1?(titleSelection=0,titleButtonSelected()):9===mouseCoordY&&titleSelectOptions>=3?(titleSelection=1,titleButtonSelected()):10===mouseCoordY&&titleSelectOptions>=2?(titleSelection=2===titleSelectOptions?1:2,titleButtonSelected()):11===mouseCoordY&&titleSelectOptions>=4?(titleSelection=3,titleButtonSelected()):12===mouseCoordY&&titleSelectOptions>=5&&(titleSelection=4,titleButtonSelected());else if(2===titleMode){if(quittingTitleScreen||titleSelected)return;if(0===mouseCoordY)titleSelection=0,tryPlayEndGameSound(),goToTitleScreen(),tryPlayTitleSound(),canvasResize();else if(2===mouseCoordY)0!=levelSelectScrollPos&&(tryPlaySimpleSound("sfx9"),levelSelectScroll(-3));else if(12===mouseCoordY)titleSelectOptions-amountOfLevelsOnScreen>levelSelectScrollPos&&(tryPlaySimpleSound("sfx9"),levelSelectScroll(3));else{var r=-1;switch(mouseCoordY){case 3:r=0;break;case 4:r=1;break;case 5:r=2;break;case 6:r=3;break;case 7:r=4;break;case 8:r=5;break;case 9:r=6;break;case 10:r=7;break;case 11:r=8}-1!=r&&(r+=levelSelectScrollPos)<titleSelectOptions&&(titleSelection=r,titleSelected=!0,messageselected=!1,timer=0,quittingTitleScreen=!0,generateLevelSelectScreen())}}else if(3===titleMode){if(quittingTitleScreen||titleSelected)return;0===mouseCoordY?(titleSelection=0,tryPlayEndGameSound(),goToTitleScreen(),tryPlayTitleSound(),canvasResize()):11===mouseCoordY&&(1===creditsPage?creditsPage=2:2===creditsPage&&(creditsPage=1),generateCreditsScreen(),tryPlaySimpleSound("sfx9"))}else if(4===titleMode)musicPlaying||(musicPlaying=!0,startMenuMusic()),generateTitleScreen();else if(5===titleMode){if(quittingTitleScreen||titleSelected)return;if(0===mouseCoordY)titleSelection=0,tryPlayEndGameSound(),goToTitleScreen(),tryPlayTitleSound(),canvasResize();else{var o=-1;switch(mouseCoordY){case 3:o=0;break;case 4:o=1;break;case 5:o=2;break;case 6:o=3;break;case 7:o=4;break;case 8:o=5;break;case 9:o=6;break;case 10:o=7;break;case 11:o=8;break;case 12:o=9}-1!=o&&(titleSelection=o,titleSelected=!0,messageselected=!1,timer=0,instructions_index=o,generateManualScreen())}}else if(6===titleMode){if(quittingTitleScreen||titleSelected)return;0===mouseCoordY&&(titleSelection=0,tryPlayEndGameSound(),gotoManualScreen(),tryPlayTitleSound(),canvasResize())}else if(7===titleMode)titleMode=4,playIntro10();else if(8===titleMode){if(quittingTitleScreen||titleSelected)return;0===mouseCoordY?(titleSelection=0,tryPlayEndGameSound(),gotoSettingsScreen(),tryPlayTitleSound(),canvasResize()):12===mouseCoordY&&ValidatePassword()}else if(9===titleMode){if(quittingTitleScreen||titleSelected)return;12==mouseCoordY?verifying?(tryPlaySimpleSound("sfx5"),clearLocalStorage(),goToTitleScreen()):(verifying=!0,tryPlaySimpleSound("sfx7"),generateSettingsScreen()):0===mouseCoordY?(titleSelection=0,tryPlayEndGameSound(),goToTitleScreen(),tryPlayTitleSound(),canvasResize()):5===mouseCoordY?mouseCoordX>=11&&mouseCoordX<=15?decreaseSFXVolume():mouseCoordX>=28&&mouseCoordX<=32&&increaseSFXVolume():6===mouseCoordY?mouseCoordX>=11&&mouseCoordX<=15?decreaseMusicVolume():mouseCoordX>=28&&mouseCoordX<=32&&increaseMusicVolume():8===mouseCoordY?(tryPlayStartGameSound(),isInFullscreen()?exitFullScreen():enterFullScreen(),generateSettingsScreen()):10===mouseCoordY&&(tryPlayStartGameSound(),gotoSkipDemoScreen())}else if(10===titleMode)12===mouseCoordY&&(tryPlaySimpleSound("sfx0"),gotoLevel(state.sections.length-2));else if(11===titleMode){if(quittingTitleScreen||titleSelected)return;if(0===mouseCoordY)titleSelection=0,tryPlayEndGameSound(),goToTitleScreen(),tryPlayTitleSound(),canvasResize();else if(2===mouseCoordY)0!=achieveScrollPos&&(tryPlaySimpleSound("sfx9"),achievementScroll(-3));else if(12===mouseCoordY)titleSelectOptions-amountOfAchievesOnScreen>achieveScrollPos&&(tryPlaySimpleSound("sfx9"),achievementScroll(3));else{var i=-1;switch(mouseCoordY){case 3:i=0;break;case 4:i=1;break;case 5:i=2;break;case 6:i=3;break;case 7:i=4;break;case 8:i=5;break;case 9:i=6;break;case 10:i=7;break;case 11:i=8}-1!=i&&(i+=achieveScrollPos)<titleSelectOptions&&(achievementIndex=i,titleSelected=!0,messageselected=!1,timer=0,tryPlayStartGameSound(),gotoAchievementDescription())}}else if(12===titleMode){if(quittingTitleScreen||titleSelected)return;0===mouseCoordY&&(titleSelection=0,tryPlayEndGameSound(),gotoAchievementsScreen(),tryPlayTitleSound(),canvasResize())}}else!1===messageselected&&state.levels[curlevel].message&&(messageselected=!0,timer=0,quittingMessageScreen=!0,tryPlayCloseMessageSound(),titleScreen=!1,drawMessageScreen())}else{if(winning)return;if(x1=x2,y1=y2,x2=mousePixelX,y2=mousePixelY,x2=Math.max(0,Math.min(cellwidth*screenwidth-1,mousePixelX)),y2=Math.max(0,Math.min(cellheight*screenheight-1,mousePixelY)),t){if(mouseCoordX>=0&&mouseCoordY>=0&&mouseCoordX<screenwidth&&mouseCoordY<screenheight){u=screenOffsetY+mouseCoordY+(screenOffsetX+mouseCoordX)*level.height;if(lastCoord=u,againing);else try{p=backupLevel();(d=level.getCell(u)).ibitset(n),level.setCell(u,d),pushInput(h=5),processInput(h,!1,!1,p)&&redraw()}catch(e){console.log(e),consolePrint(e,!0)}}}else for(var s=getTilesTraversingPoints(x1,y1,x2,y2),a=s.tileListX,l=s.tileListY,c=0;c<a.length;c++){var u=screenOffsetY+l[c]+(screenOffsetX+a[c])*level.height;if(lastCoord!==u)if(lastCoord=u,againing);else try{var d,h,p=backupLevel();d=level.getCell(u);d.ibitset(n),level.setCell(u,d),pushInput(h=5),processInput(h,!1,!1,p)&&redraw()}catch(e){console.log(e),consolePrint(e,!0)}}}}var anyEditsSinceMouseDown=!1;function onMouseDown(e,t=!1){if(!e.handled){ULBS();var n=0===e.button;e.button;if("touchstart"==e.type&&(n=!0),n&&(e.ctrlKey||e.metaKey)&&(n=!1,!0),n){if(lastDownTarget=e.target,keybuffer=[],e.target===canvas||"tapFocusIndicator"===e.target.className){if(setMouseCoord(e),dragging=!0,rightdragging=!1,anyEditsSinceMouseDown=!1,levelEditorOpened&&!textMode)return levelEditorClick(e,!0);if("mouse_left"in state.metadata)return t&&prevent(e),mouseAction(e,!0,state.lmbID)}dragging=!1,rightdragging=!1}else if(2===e.button||0===e.button&&(e.ctrlKey||e.metaKey))if("gameCanvas"===e.target.id){if(setMouseCoord(e),dragging=!1,rightdragging=!0,levelEditorOpened)return levelEditorRightClick(e,!0);if("mouse_right"in state.metadata)return mouseAction(e,!0,state.rmbID)}else dragging=!1,rightdragging=!1;else 1===e.button&&!1===textMode&&levelEditorOpened&&(pushInput("undo"),DoUndo(!1,!0),canvasResize());e.handled=!0}}function rightClickCanvas(e){return"mouse_right"in state.metadata||levelEditorOpened?prevent(e):void 0}function onMouseUp(e,t=!1){if(!e.handled){if(dragging=!1,rightdragging=!1,0===e.button){if(e.target===canvas&&(setMouseCoord(e),"mouse_up"in state.metadata))return t&&prevent(e),mouseAction(e,!0,state.lmbupID)}else if(2===e.button&&"gameCanvas"===e.target.id&&(setMouseCoord(e),"mouse_rup"in state.metadata))return mouseAction(e,!0,state.rmbupID);e.handled=!0}}function onKeyDown(e){ULBS(),e=e||window.event,!IDE&&[32,37,38,39,40].indexOf(e.keyCode)>-1&&(e&&(e.ctrlKey||e.metaKey)||prevent(e)),IDE||77!==e.keyCode||toggleMute(),keybuffer.indexOf(e.keyCode)>=0||((lastDownTarget===canvas||window.Mobile&&lastDownTarget===window.Mobile.focusIndicator)&&-1===keybuffer.indexOf(e.keyCode)&&(e&&(e.ctrlKey||e.metaKey)||(keybuffer.splice(keyRepeatIndex,0,e.keyCode),keyRepeatTimer=0,checkKey(e,!e.repeat))),!0===canDump&&(74===e.keyCode&&(e.ctrlKey||e.metaKey)?(dumpTestCase(),prevent(e)):75===e.keyCode&&(e.ctrlKey||e.metaKey)?(makeGIF(),prevent(e)):83===e.keyCode&&(e.ctrlKey||e.metaKey)?(saveClick(),prevent(e)):66===e.keyCode&&(e.ctrlKey||e.metaKey)?(rebuildClick(),prevent(e),e.target.blur(),canvas.focus()):82===e.keyCode&&(e.ctrlKey||e.metaKey)?(runClick(),prevent(e),e.target.blur(),canvas.focus()):120===e.keyCode?(prevent(e),solve()):119===e.keyCode?(prevent(e),stopSolving()):13===e.keyCode&&(e.ctrlKey||e.metaKey)&&(canvas.focus(),editor.display.input.blur(),e.shiftKey?runClick():rebuildClick(),prevent(e))),8===titleMode&&(e.keyCode>=65&&e.keyCode<=90?passwordEntry.length<=14&&(passwordEntry+=e.key.toUpperCase(),tryPlaySimpleSound("sfx9")):8===e.keyCode||46===e.keyCode?passwordEntry.length>0&&(passwordEntry=passwordEntry.slice(0,-1),tryPlaySimpleSound("sfx8")):13===e.keyCode&&ValidatePassword()))}function relMouseCoords(e){var t=0,n=0,r=0,o=0,i=this;do{t+=i.offsetLeft-i.scrollLeft,n+=i.offsetTop-i.scrollTop}while(i=i.offsetParent);return null==e.touches?(r=e.pageX-t,o=e.pageY-n):(r=e.touches[0].pageX-t,o=e.touches[0].pageY-n),{x:r,y:o}}function onKeyUp(e){e=e||window.event;var t=keybuffer.indexOf(e.keyCode);t>=0&&(keybuffer.splice(t,1),keyRepeatIndex>=t&&keyRepeatIndex--)}function onMyFocus(e){keybuffer=[],keyRepeatIndex=0,keyRepeatTimer=0}function onMyBlur(e){keybuffer=[],keyRepeatIndex=0,keyRepeatTimer=0}HTMLCanvasElement.prototype.relMouseCoords=relMouseCoords;var mouseCoordX=0,mouseCoordY=0,mousePixelX=0,mousePixelY=0;function setMouseCoord(e){var t=canvas.relMouseCoords(e);(isNaN(t.x)||isNaN(t.y))&&console.warn("[SetMouseCoord] Did not recieve valid mouse coords from event. Ignoring it (since I'm assuming this is a faked keypress that was generated on mobile)."),mousePixelX=t.x-xoffset,mousePixelY=t.y-yoffset,mouseCoordX=Math.floor(mousePixelX/cellwidth),mouseCoordY=Math.floor(mousePixelY/cellheight)}function mouseMove(e){if(!e.handled){if(levelEditorOpened)setMouseCoord(e),dragging?levelEditorClick(e,!1):rightdragging&&levelEditorRightClick(e,!1),redraw();else if(titleScreen&&IsMouseGameInputEnabled()){var t=hoverSelection,n=mouseCoordX;setMouseCoord(e),mouseAction(e,!1,null),9==titleMode&&(t==hoverSelection&&n==mouseCoordX||(generateSettingsScreen(),redraw())),t!=hoverSelection&&(1==titleMode||0==titleMode?(generateTitleScreen(),redraw()):2==titleMode?(generateLevelSelectScreen(),redraw()):3==titleMode?(generateCreditsScreen(),redraw()):5==titleMode?(generateManualScreen(),redraw()):6==titleMode?(generateManualPageScreen(),redraw()):10==titleMode?(playingOutro(),redraw()):11==titleMode?(generateAchievementsScreen(),redraw()):12==titleMode&&(generateAchievementDescription(),redraw()))}else dragging&&"mouse_drag"in state.metadata?(setMouseCoord(e),mouseAction(e,!1,state.dragID),redraw()):rightdragging&&"mouse_rdrag"in state.metadata&&(setMouseCoord(e),mouseAction(e,!1,state.rdragID),redraw());e.handled=!0}}function onMouseIn(){mouseInCanvas=!0}function onMouseOut(){mouseInCanvas=!1}function onTouchDown(e){onMouseDown(e,!0)}function onTouchUp(e){onMouseUp(e,!0)}function onMouseWheel(e){mouseInCanvas&&!e.ctrlKey&&(normalizedDelta=Math.sign(e.deltaY),titleScreen&&2==titleMode&&IsMouseGameInputEnabled()&&(levelSelectScroll(normalizedDelta),redraw(),prevent(e)),titleScreen&&11==titleMode&&IsMouseGameInputEnabled()&&(achievementScroll(normalizedDelta),redraw(),prevent(e)),levelEditorOpened&&(glyphSelectedIndex=clamp(glyphSelectedIndex+normalizedDelta,0,glyphCount()-1),redraw(),prevent(e)))}function levelSelectScroll(e){levelSelectScrollPos=clamp(levelSelectScrollPos+e,0,Math.max(state.sections.length-amountOfLevelsOnScreen,0)),titleSelection=clamp(titleSelection+e,0,state.sections.length-1),generateLevelSelectScreen()}function achievementScroll(e){achieveScrollPos=clamp(achieveScrollPos+e,0,Math.max(achievementList.length-amountOfAchievesOnScreen,0)),titleSelection=clamp(titleSelection+e,0,achievementList.length-1),generateAchievementsScreen()}function clamp(e,t,n){return Math.min(Math.max(e,t),n)}function prevent(e){return e.preventDefault&&e.preventDefault(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.stopPropagation&&e.stopPropagation(),e.returnValue=!1,!1}function titleButtonSelected(){!1===titleSelected&&(tryPlayStartGameSound(),titleSelected=!0,messageselected=!1,timer=0,quittingTitleScreen=!0,generateTitleScreen(),canvasResize(),document.dispatchEvent(new Event("psplusGameStarted")))}mouseInCanvas=!1,document.addEventListener("touchstart",onTouchDown,{passive:!1}),document.addEventListener("touchmove",mouseMove,!1),document.addEventListener("touchend",onTouchUp,{passive:!1}),document.addEventListener("mousedown",onMouseDown,!1),document.addEventListener("mouseup",onMouseUp,!1),document.addEventListener("mousemove",mouseMove,!1),document.addEventListener("contextmenu",rightClickCanvas,!1),document.addEventListener("keydown",onKeyDown,!1),document.addEventListener("keyup",onKeyUp,!1),document.addEventListener("wheel",onMouseWheel,{passive:!1}),window.addEventListener("focus",onMyFocus,!1),window.addEventListener("blur",onMyBlur,!1),canvas.addEventListener("mouseenter",onMouseIn,!1),canvas.addEventListener("mouseleave",onMouseOut,!1);var gamepadKeys=[];function pollGamepads(){function e(e,t){return!(e.length<t)&&("object"==typeof e[t]?e[t].pressed:1==e[t])}function t(e,t,n){return!(e.length<t)&&e[t]*n>.5}var n=[];function r(e){-1===keybuffer.indexOf(e)&&(keybuffer.splice(keyRepeatIndex,0,e),keyRepeatTimer=0,checkKey({keyCode:e},!0)),n.splice(0,0,e)}function o(){for(var e=0;e<gamepadKeys.length;e++)if(!(n.indexOf(gamepadKeys[e])>=0)){var t=keybuffer.indexOf(gamepadKeys[e]);t>=0&&(keybuffer.splice(t,1),keyRepeatIndex>=t&&keyRepeatIndex--)}gamepadKeys=n}var i=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];if(null!=i&&0!=i.length){for(var s=0;s<i.length;s++){var a=i[s];null!=a&&a.connected&&((e(a.buttons,3)||e(a.buttons,4))&&r(82),(e(a.buttons,1)||t(a.axes,2,1))&&r(90),(e(a.buttons,2)||e(a.buttons,0)||e(a.buttons,5)||t(a.axes,1,1))&&r(88),e(a.buttons,7)&&r(27),e(a.buttons,6)&&r(69),(t(a.axes,0,1)||t(a.axes,6,1))&&r(39),(t(a.axes,0,-1)||t(a.axes,6,-1))&&r(37),(t(a.axes,1,-1)||t(a.axes,7,-1))&&r(38),(t(a.axes,1,1)||t(a.axes,7,1))&&r(40))}o()}else o()}function checkKey(e,t){if(ULBS(),!(winning||e&&(e.ctrlKey||e.metaKey||e.altKey))){var n=-1;switch(e.keyCode){case 65:case 37:n=1;break;case 38:case 87:n=0;break;case 68:case 39:n=3;break;case 83:case 40:n=2;break;case 80:printLevel();break;case 13:case 32:case 67:case 88:if(t&&ignoreNotJustPressedAction&&(ignoreNotJustPressedAction=!1),!1===t&&ignoreNotJustPressedAction)return;if(!1!==norepeat_action&&!t)return;n=4;break;case 85:case 90:if(!1===textMode)return pushInput("undo"),DoUndo(!1,!0),canvasResize(),prevent(e);break;case 82:if(!1===textMode&&t)return pushInput("restart"),DoRestart(),canvasResize(),prevent(e);break;case 27:if(solving){stopSolving();break}if(!1===titleScreen||titleMode>1)return(timer/1e3>.5||titleMode>1)&&!quittingTitleScreen&&(titleSelection=0,timer=0,tryPlayEndGameSound(),!1===titleScreen&&void 0!==state.metadata.level_select?gotoLevelSelectScreen():6===titleMode?gotoManualScreen():8===titleMode?gotoSettingsScreen():12===titleMode?gotoAchievementsScreen():goToTitleScreen(),tryPlayTitleSound(),canvasResize()),prevent(e);break;case 69:if(!solving&&canOpenEditor)return t&&(titleScreen&&("EMPTY GAME"===state.title?compile(["loadFirstNonMessageLevel"]):nextLevel()),!1===(levelEditorOpened=!levelEditorOpened)&&printLevel(),restartTarget=backupLevel(),canvasResize()),prevent(e);break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:if(levelEditorOpened&&t){var r=9;return e.keyCode>=49&&(r=e.keyCode-49),r<glyphImages.length?glyphSelectedIndex=r:consolePrint("Trying to select tile outside of range in level editor.",!0),canvasResize(),prevent(e)}break;case 189:if(levelEditorOpened&&t&&glyphSelectedIndex>0)return glyphSelectedIndex--,canvasResize(),prevent(e);break;case 187:if(levelEditorOpened&&t&&glyphSelectedIndex+1<glyphImages.length)return glyphSelectedIndex++,canvasResize(),prevent(e)}if(throttle_movement&&n>=0&&n<=3){if(lastinput==n&&input_throttle_timer<repeatinterval)return;lastinput=n,input_throttle_timer=0}if(textMode);else if(!againing&&n>=0)return 4===n&&"noaction"in state.metadata||(pushInput(n),processInput(n)&&redraw()),prevent(e)}}function update(){var e=!1;if(timer+=deltatime,tweentimer+=deltatime,input_throttle_timer+=deltatime,quittingTitleScreen&&(2==titleMode?(quittingTitleScreen=!1,gotoLevel(titleSelection)):timer/1e3>.3&&(quittingTitleScreen=!1,titleMode<=1&&nextLevel())),againing&&timer>againinterval&&0==messagetext.length&&processInput(-1)&&(e=!0,keyRepeatTimer=0,autotick=0),quittingMessageScreen&&timer/1e3>.15&&(quittingMessageScreen=!1,""===messagetext?nextLevel():(messagetext="",textMode=!1,titleScreen=!1,titleMode=curlevel>0||null!==curlevelTarget?1:0,titleSelected=!1,ignoreNotJustPressedAction=!0,titleSelection=0,canvasResize(),checkWin())),winning&&timer/1e3>.5&&(winning=!1,nextLevel()),pollGamepads(),keybuffer.length>0){keyRepeatTimer+=deltatime;var t=throttle_movement?repeatinterval:repeatinterval/Math.sqrt(keybuffer.length);if(keyRepeatTimer>t)keyRepeatTimer=0,keyRepeatIndex=(keyRepeatIndex+1)%keybuffer.length,checkKey({keyCode:keybuffer[keyRepeatIndex]},!1)}!(autotickinterval>0)||textMode||levelEditorOpened||againing||winning||(autotick+=deltatime)>autotickinterval&&(autotick=0,pushInput("tick"),processInput(-1)&&(e=!0)),(e||void 0!==state&&(void 0!==state.metadata.smoothscreen||void 0!==state.metadata.tween_length))&&redraw()}var looping=!1,loop=function(){looping=!0;try{update()}catch(e){console.error(e)}"hidden"!==document.visibilityState?setTimeout(loop,deltatime):looping=!1};function Animatable(e,t,n){var r;function o(){var e;return(r+=t)>=1&&(e=!0,r=1),n(r),e}function i(){var e;return(r-=t)<=0&&(e=!0,r=0),n(r),e}return r=0,{animateUp:function(){Animator.getInstance().animate(e,o)},animateDown:function(){Animator.getInstance().animate(e,i)}}}document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&!1===looping&&loop()})),loop(),window.Mobile={},Mobile.hasTouch=function(){var e;return("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)&&(e=!0),e},Mobile.enable=function(e){return(e||Mobile.hasTouch()&&!Mobile._instance)&&(Mobile._instance=new Mobile.GestureHandler,Mobile._instance.bindEvents(),Mobile._instance.bootstrap()),Mobile._instance},window.Mobile.GestureHandler=function(){this.initialize.apply(this,arguments)},Mobile.log=function(e){document.getElementsByTagName("h1")[0].innerHTML=Math.random().toString().substring(4,1)+"-"+e},Mobile.debugDot=function(e){var t,n;n="border-radius: 50px;width: 5px;height: 5px;background: red;position: absolute;left: "+e.touches[0].clientX+"px;top: "+e.touches[0].clientY+"px;",(t=document.createElement("div")).setAttribute("style",n),document.getElementsByTagName("body")[0].appendChild(t)},function(e){"use strict";var t={action:88,left:37,right:39,up:38,down:40,undo:85,restart:82,quit:27},n=['<div class="tab">','  <div class="tab-affordance"></div>','  <div class="tab-icon">','    <div class="slice"></div>','    <div class="slice"></div>',"  </div>","</div>"].join("\n");e.initialize=function(){this.firstPos={x:0,y:0},this.setTabAnimationRatio=this.setTabAnimationRatio.bind(this),this.setMenuAnimationRatio=this.setMenuAnimationRatio.bind(this),this.repeatTick=this.repeatTick.bind(this),this.isFocused=!0},e.setFocusElement=function(e){this.focusElement=e,this.isFocused=!1,this.buildFocusIndicator()},e.bindEvents=function(){window.addEventListener("touchstart",this.onTouchStart.bind(this)),window.addEventListener("touchend",this.onTouchEnd.bind(this)),window.addEventListener("touchmove",this.onTouchMove.bind(this))},e.bootstrap=function(){this.showTab(),this.disableScrolling(),this.isAudioSupported()||this.disableAudio(),this.disableSelection()},e.onTouchStart=function(e){this.isTouching||(this.handleFocusChange(e),this.isFocused&&"A"!==e.target.tagName.toUpperCase()&&(this.isTouching=!0,this.mayBeSwiping=!0,this.gestured=!1,this.swipeDirection=void 0,this.swipeDistance=0,this.startTime=(new Date).getTime(),this.firstPos.x=e.touches[0].clientX,this.firstPos.y=e.touches[0].clientY))},e.onTouchEnd=function(e){this.isFocused&&this.isTouching&&(this.gestured||0===e.touches.length&&"unMuteButton"!==e.target.id&&"muteButton"!==e.target.id&&this.handleTap(),0===e.touches.length&&(this.isTouching=!1,this.endRepeatWatcher()))},e.onTouchMove=function(e){if(this.isFocused&&!levelEditorOpened)return this.isSuccessfulSwipe()?(this.handleSwipe(this.swipeDirection,this.touchCount),this.gestured=!0,this.mayBeSwiping=!1,this.beginRepeatWatcher(e)):this.mayBeSwiping?this.swipeStep(e):this.isRepeating&&this.repeatStep(e),prevent(e),!1},e.handleFocusChange=function(e){this.focusElement&&(this.isFocused=this.isTouchInsideFocusElement(e),this.setFocusIndicatorVisibility(this.isFocused),canvas.focus(),editor.display.input.blur())},e.isTouchInsideFocusElement=function(e){var t;return!(!e.touches||!e.touches[0])&&(t=this.absoluteElementPosition(this.focusElement),!(e.touches[0].clientX<t.left||e.touches[0].clientY<t.top)&&!(e.touches[0].clientX>t.left+this.focusElement.clientWidth||e.touches[0].clientY>t.top+this.focusElement.clientHeight))},e.setFocusIndicatorVisibility=function(e){},e.absoluteElementPosition=function(e){var t,n;for(t={top:e.offsetTop||0,left:e.offsetLeft||0},n=document.getElementsByTagName("body")[0],t.top-=n.scrollTop||0;e=e.offsetParent;)t.top+=e.offsetTop||0,t.left+=e.offsetLeft||0;return t},e.beginRepeatWatcher=function(e){var t;this.repeatInterval||(this.isRepeating=!0,t=1e3*state.metadata.key_repeat_interval,!isNaN(t)&&t||(t=150),this.repeatInterval=setInterval(this.repeatTick,t),this.recenter(e))},e.endRepeatWatcher=function(){this.repeatInterval&&(clearInterval(this.repeatInterval),delete this.repeatInterval,this.isRepeating=!1)},e.repeatTick=function(){this.isTouching&&this.handleSwipe(this.direction,this.touchCount)},e.recenter=function(e){this.firstPos.x=e.touches[0].clientX,this.firstPos.y=e.touches[0].clientY},e.isSuccessfulSwipe=function(){var e;return this.mayBeSwiping&&void 0!==this.swipeDirection&&this.swipeDistance>=50&&(e=!0),e},e.swipeStep=function(e){var t,n,r;this.mayBeSwiping&&(t={x:e.touches[0].clientX,y:e.touches[0].clientY},n=(new Date).getTime(),r=e.touches.length,this.swipeDistance=this.cardinalDistance(this.firstPos,t),this.swipeDirection?n-this.startTime>1e3&&(this.mayBeSwiping=!1):this.swipeDistance>10&&(this.swipeDirection=this.dominantDirection(this.firstPos,t),this.touchCount=r))},e.repeatStep=function(e){var t;t={x:e.touches[0].clientX,y:e.touches[0].clientY},this.cardinalDistance(this.firstPos,t)>=50&&(this.swipeDirection=this.dominantDirection(this.firstPos,t),this.recenter(e))},e.cardinalDistance=function(e,t){var n,r;return n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y),Math.max(n,r)},e.dominantDirection=function(e,t){var n,r,o;return n=t.x-e.x,r=t.y-e.y,o="x",Math.abs(r)>Math.abs(n)&&(o="y"),"x"===o?n>0?"right":"left":r>0?"down":"up"},e.handleSwipe=function(e,t){IsMouseGameInputEnabled()||(1===t?this.emitKeydown(this.swipeDirection):t>1&&this.toggleMenu())},e.handleTap=function(){IsMouseGameInputEnabled()||this.emitKeydown("action")},e.emitKeydown=function(e){var n;(this.isMenuVisible||"undo"!=e&&"restart"!=e&&"quit"!=e)&&(n={keyCode:t[e]},this.fakeCanvasFocus(),onKeyDown(n),onKeyUp(n))},e.fakeCanvasFocus=function(){onMouseDown({button:0,target:document.getElementById("gameCanvas")})},e.toggleMenu=function(){this.isMenuVisible?this.hideMenu():this.showMenu()},e.showMenu=function(){this.menuElem||this.buildMenu(),this.getAnimatables().menu.animateUp(),this.isMenuVisible=!0,this.hideTab()},e.hideMenu=function(){this.menuElem&&this.getAnimatables().menu.animateDown(),this.isMenuVisible=!1,this.showTab()},e.getAnimatables=function(){return this._animatables||(this._animatables={tab:Animatable("tab",.1,this.setTabAnimationRatio),menu:Animatable("menu",.1,this.setMenuAnimationRatio)}),this._animatables},e.showTab=function(){this.tabElem||this.buildTab(),this.getAnimatables().tab.animateDown()},e.hideTab=function(){this.tabElem&&this.tabElem.setAttribute("style","display: none;"),this.getAnimatables().tab.animateUp()},e.buildTab=function(){var e,t,r,o=this;(e=document.createElement("div")).innerHTML=n,r=e.children[0],t=function(e){e.stopPropagation(),o.showMenu()},this.tabAffordance=r.getElementsByClassName("tab-affordance")[0],this.tabElem=r.getElementsByClassName("tab-icon")[0],this.tabAffordance.addEventListener("touchstart",t),this.tabAffordance.addEventListener("click",(e=>{})),this.tabElem.addEventListener("touchstart",t),this.tabElem.addEventListener("click",(e=>{})),document.getElementsByTagName("body")[0].appendChild(r)},e.buildMenu=function(){var e,t,n,r,o,i,s=this;(e=document.createElement("div")).innerHTML=this.buildMenuString(state),this.menuElem=e.children[0],this.closeElem=this.menuElem.getElementsByClassName("close")[0],i=function(e){e.stopPropagation(),s.hideMenu()},this.closeAffordance=this.menuElem.getElementsByClassName("close-affordance")[0],o=this.menuElem.getElementsByClassName("close")[0],this.closeAffordance.addEventListener("touchstart",i),this.closeAffordance.addEventListener("click",(e=>{})),o.addEventListener("touchstart",i),o.addEventListener("click",(e=>{})),(t=this.menuElem.getElementsByClassName("undo")[0])&&(t.addEventListener("touchstart",(function(e){e.stopPropagation(),s.emitKeydown("undo")})),t.addEventListener("click",(e=>{}))),(n=this.menuElem.getElementsByClassName("restart")[0])&&(n.addEventListener("touchstart",(function(e){e.stopPropagation(),s.emitKeydown("restart")})),n.addEventListener("click",(e=>{}))),(r=this.menuElem.getElementsByClassName("quit")[0]).addEventListener("touchstart",(function(e){e.stopPropagation(),s.emitKeydown("quit")})),r.addEventListener("click",(e=>{})),document.getElementsByTagName("body")[0].appendChild(this.menuElem)},e.buildMenuString=function(e){var t,n,r,o;return t=3,(r=e.metadata.noundo)&&(t-=1),(o=e.metadata.norestart)&&(t-=1),n=['<div class="mobile-menu item-count-'+t+'">','  <div class="close-affordance"></div>','  <div class="close">','    <div class="slice"></div>','    <div class="slice"></div>',"  </div>"],r||n.push('  <div class="undo button">Undo</div>'),o||n.push('  <div class="restart button">Restart</div>'),(n=n.concat(['  <div class="quit button">Quit to Menu</div>','  <div class="clear"></div>',"</div>"])).join("\n")},e.buildFocusIndicator=function(){this.focusIndicator=document.createElement("DIV"),this.focusIndicator.setAttribute("class","tapFocusIndicator"),this.focusIndicator.setAttribute("style","visibility: hidden;"),this.focusElement.parentNode.appendChild(this.focusIndicator)},e.setTabAnimationRatio=function(e){var t;(e=Math.round(1e3*e)/1e3)>=.999?this.tabAffordance.setAttribute("style","display: none;"):this.tabAffordance.setAttribute("style","display: block;"),t="opacity: "+(1-e)+";"+" width: "+(66*e+18*(1-e))+"px;",this.tabElem.setAttribute("style",t)},e.setMenuAnimationRatio=function(e){var t,n,r;r="left: "+((t=-18*(e=Math.round(1e3*e)/1e3)+-66*(1-e))-4)+"px; "+(n="opacity: "+e+";")+" width: "+-t+"px;",(e=Math.round(1e3*e)/1e3)<=.001?(this.closeAffordance.setAttribute("style","display: none;"),n="display:none;"):this.closeAffordance.setAttribute("style","display: block;"),this.closeElem.setAttribute("style",r),this.menuElem.setAttribute("style",n)},e.disableScrolling=function(){var e={height:"100%",overflow:"hidden",position:"fixed",width:"100%"},t="";for(var n in e)t+=n+": "+e[n]+"; ";document.body.setAttribute("style",t)},e.disableAudio=function(){window.playSeed=function(){}},e.isAudioSupported=function(){var e=!0;return"undefined"!=typeof webkitAudioContext&&(e=!1),e},e.disableSelection=function(){var e;(e=document.getElementsByTagName("body")[0]).setAttribute("class",e.getAttribute("class")+" disable-select")}}(window.Mobile.GestureHandler.prototype),window.Animator=function(){this.initialize.apply(this,arguments)},function(e){e.initialize=function(){this._animations={},this.tick=this.tick.bind(this)},e.animate=function(e,t){this._animations[e]=t,this.wakeup()},e.wakeup=function(){this._isAnimating||(this._isAnimating=!0,this.tick())},e.tick=function(){var e,t,n;for(e in n=[],t=!0,this._animations){if(!this._animations.hasOwnProperty(e))return;this._animations[e]()?n.push(e):t=!1}if(t){for(0;0<n.length;n++)delete this._isAnimating[n[0]];this._isAnimating=!1}else requestAnimationFrame(this.tick)}}(window.Animator.prototype),window.Animator.getInstance=function(){return window.Animator._instance||(window.Animator._instance=new window.Animator),window.Animator._instance},function(){"use strict";var e,t,n=["ms","moz","webkit","o"];for(e=0;e<n.length&&!window.requestAnimationFrame;e++)window.requestAnimationFrame=window[n[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[e]+"CancelAnimationFrame"],window.cancelAnimationFrame||(window.cancelAnimationFrame=window[n[e]+"CancelRequestAnimationFrame"]);window.requestAnimationFrame||(t=0,window.requestAnimationFrame=function(e,n){var r,o,i;return r=(new Date).getTime(),o=Math.max(0,16-(r-t)),i=window.setTimeout((function(){e(r+o)}),o),t=r+o,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),Mobile.enable()}();var get_blob=function(){return self.Blob},standalone_HTML_String="",clientStandaloneRequest=new XMLHttpRequest;function buildStandalone(e){if(0!==standalone_HTML_String.length){var t=standalone_HTML_String.concat(""),n="PuzzleScript Game";void 0!==state.metadata.title&&(n=state.metadata.title);var r="auroriax.github.io/PuzzleScript";void 0!==state.metadata.homepage&&(r=state.metadata.homepage),"background_color"in state.metadata&&(t=t.replace(/black;\/\*Don\'t/g,state.bgcolor+";/*Don't")),"text_color"in state.metadata&&(t=t.replace(/lightblue;\/\*Don\'t/g,state.fgcolor+";/*Don't")),t=(t=t.replace(/__GAMETITLE__/g,n)).replace(/__HOMEPAGE__/g,r),e=e.replace(/\$/g,"$$$$"),t=t.replace(/__GAMEDAT__/g,e);var o=new(get_blob())([t],{type:"text/plain;charset=utf-8"});saveAs(o,n+".html")}else consolePrint("Can't export yet - still downloading html template.",!0,null,null)}clientStandaloneRequest.open("GET","standalone_inlined.txt"),clientStandaloneRequest.onreadystatechange=function(){4==clientStandaloneRequest.readyState&&(""===clientStandaloneRequest.responseText&&consolePrint("Couldn't find standalone template. Is there a connection problem to the internet?",!0,null,null),standalone_HTML_String=clientStandaloneRequest.responseText)},clientStandaloneRequest.send();var onLevelRestarted=new Event("levelRestarted"),RandomGen=new RNG,intro_template=["..................................","..................................","..................................","......Puzzle Script Terminal......","..............v 1.7+..............","..................................","..................................","..................................",".........insert cartridge.........","..................................","..................................","..................................",".................................."],sitelock_template=["..................................","..................................","..................................","......Puzzle Script Terminal......","..............v 1.7+..............","..................................","..................................","..................................",".....This game is sitelocked!.....","................................. ","................................  ","...............................   ","..............................    "],messagecontainer_template=["..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..........X to continue...........","..................................",".................................."],messagecontainer_template_mouse=["..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","........Ćľįćķ ťŏ ćŏńťįńūě.........","..................................",".................................."],titletemplate_firstgo=["..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..........>.start game.<..........","..................................",".................................."],titletemplate_firstgo_selected=["..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","+++++++++++.start game.++++++++++++","..................................",".................................."],titletemplate_empty=["..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................","..................................",".................................."],titletemplate_pre_intro=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸClickĸtoĸStartĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro10=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĲĳĳĲĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĸĸĸĸĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro9=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸ?ĸĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĸĳĳĸĳĳĸĸĸĸĸĸĸĸĸĸĸŁĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĸĸĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro8=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĸĳĳĸĳĸĸĸĸĸĸĸĸĸĸĸŁĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸļĿĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĸĸĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro7=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸ!ĸĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĸĳĳĸĳĸĸĸĸĸĸĸĸĸĸĸŁĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸļĿĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĸĸĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĸĸĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro6=["ĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĳĸĳĳĸĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀ","ĸĸĸĸĸĸĸĸĸĳĳĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸĸ","ĸĸĸĸĸĸĸĸĸĳĳĳĸĸĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro5=["ĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĳĸĳĳĸĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸ","ĸĸĸĸĸĳĳĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋ","ĸĸĸĸĸĳĳĳĸĸĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®","ĸĸĸĸĸĸĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®","ĸĸĸĸĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro4=["ĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆ","ĸĳĸĳĳĸĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆÆ¥","ĸĳĳĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆÆÆ","ĸĳĳĳĸĸĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆ","ĸĸĳĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆ","ĸĸĸĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæł","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro3=["ĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆ","ĳĸĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆÆ¥§¤†¢","ĳĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆÆÆÆ†††","ĸĸĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆŲű†ŧ","ĳĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆ","ĳĳĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro2=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆÆÆÆÆ","ĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆÆ¥§¤†¢Ÿŷųø","ĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆÆÆÆ†††ÆÆÆÆ","ĳĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆŲű†ŧŦŢŒœ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆÆÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸĸĸæł","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro1=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆÆ¥§¤†¢ŸŷųøÆĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆÆÆÆ†††ÆÆÆÆÆĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆŲű†ŧŦŢŒœÆĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸĸĸæłĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_intro0=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆÆ¥§¤†¢ŸŷųøÆĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆÆÆÆ†††ÆÆÆÆÆĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆŲű†ŧŦŢŒœÆĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸĸĸæłĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ"],titletemplate_outro0=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸAndĸso,ĸtheĸcityĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸwasĸsaved.ĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outroblank=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outro1=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸAllĸtheĸcitizensĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸhadĸbeenĸhealed,ĸandĸĸĸĸĸĸĸ","ĸĸĸĸtheĸworkĸofĸtheĸambulancesĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸhadĸfinallyĸcomeĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸtoĸanĸend.ĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outro3=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸButĸwithĸtheĸhealthcareĸcrisisĸĸ","ĸĸĸĸĸĸĸĸĸavertedĸatĸlast,ĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸwhatĸwillĸbecomeĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸofĸourĸbraveĸheroes?ĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outro4=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸª","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸª","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸª","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸNoĸlongerĸplaguedĸbyĸgreen-ness,ĸ","ĸmanyĸcitizensĸhaveĸnowĸchosenĸtoĸ","ĸformĸaĸband.ĸTheirĸcurrentĸtitleĸ","ĸĸisĸtheĸ'CeruleanĸPersonĸGang'.ĸĸ","                       [ SKIP ]   "],titletemplate_outro5=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªª","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªª","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸªª","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªª","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªª","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸNoĸlongerĸplaguedĸbyĸgreen-ness,ĸ","ĸmanyĸcitizensĸhaveĸnowĸchosenĸtoĸ","ĸformĸaĸband.ĸTheirĸcurrentĸtitleĸ","ĸĸisĸtheĸ'CeruleanĸPersonĸGang'.ĸĸ","                       [ SKIP ]   "],titletemplate_outro6=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªªªĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸªªĸªªĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªªªªªĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸĸĸĸªªĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸĸªªĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸNoĸlongerĸplaguedĸbyĸgreen-ness,ĸ","ĸmanyĸcitizensĸhaveĸnowĸchosenĸtoĸ","ĸformĸaĸband.ĸTheirĸcurrentĸtitleĸ","ĸĸisĸtheĸ'CeruleanĸPersonĸGang'.ĸĸ","                       [ SKIP ]   "],titletemplate_outro7=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªªªĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸªªĸªªĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªªªªªĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸĸĸĸªªĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸĸªªĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸNoĸlongerĸplaguedĸbyĸgreen-ness,ĸ","ĸmanyĸcitizensĸhaveĸnowĸchosenĸtoĸ","ĸformĸaĸband.ĸTheirĸcurrentĸtitleĸ","ĸĸisĸtheĸ'CeruleanĸPersonĸGang'.ĸĸ","                       [ SKIP ]   "],titletemplate_outro8=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªªªĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸªªĸªªĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªªªªªĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸĸĸĸªªĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸĸªªĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸNoĸlongerĸplaguedĸbyĸgreen-ness,ĸ","ĸmanyĸcitizensĸhaveĸnowĸchosenĸtoĸ","ĸformĸaĸband.ĸTheirĸcurrentĸtitleĸ","ĸĸisĸtheĸ'CeruleanĸPersonĸGang'.ĸĸ","                       [ SKIP ]   "],titletemplate_outro9=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸªªĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸĸĸĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªĸĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸNoĸlongerĸplaguedĸbyĸgreen-ness,ĸ","ĸmanyĸcitizensĸhaveĸnowĸchosenĸtoĸ","ĸformĸaĸband.ĸTheirĸcurrentĸtitleĸ","ĸĸisĸtheĸ'CeruleanĸPersonĸGang'.ĸĸ","                       [ SKIP ]   "],titletemplate_outro10=["ĸĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸªªªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸªªĸªªĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸªªªªªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸªªĸĸĸĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸªªĸĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸNoĸlongerĸplaguedĸbyĸgreen-ness,ĸ","ĸmanyĸcitizensĸhaveĸnowĸchosenĸtoĸ","ĸformĸaĸband.ĸTheirĸcurrentĸtitleĸ","ĸĸisĸtheĸ'CeruleanĸPersonĸGang'.ĸĸ","                       [ SKIP ]   "],titletemplate_outro11=["ĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸªªªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸªªĸªªĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸªªªªªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸªªĸĸĸĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸªªĸĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸNoĸlongerĸplaguedĸbyĸgreen-ness,ĸ","ĸmanyĸcitizensĸhaveĸnowĸchosenĸtoĸ","ĸformĸaĸband.ĸTheirĸcurrentĸtitleĸ","ĸĸisĸtheĸ'CeruleanĸPersonĸGang'.ĸĸ","                       [ SKIP ]   "],titletemplate_outro12=["ĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸªªªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸªªĸªªĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸªªªªªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸªªĸĸĸĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸªªĸĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸNoĸlongerĸplaguedĸbyĸgreen-ness,ĸ","ĸmanyĸcitizensĸhaveĸnowĸchosenĸtoĸ","ĸformĸaĸband.ĸTheirĸcurrentĸtitleĸ","ĸĸisĸtheĸ'CeruleanĸPersonĸGang'.ĸĸ","                       [ SKIP ]   "],titletemplate_outro13=["ªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ªªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ªªĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ªªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸNoĸlongerĸplaguedĸbyĸgreen-ness,ĸ","ĸmanyĸcitizensĸhaveĸnowĸchosenĸtoĸ","ĸformĸaĸband.ĸTheirĸcurrentĸtitleĸ","ĸĸisĸtheĸ'CeruleanĸPersonĸGang'.ĸĸ","                       [ SKIP ]   "],titletemplate_outro14=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸNoĸlongerĸplaguedĸbyĸgreen-ness,ĸ","ĸmanyĸcitizensĸhaveĸnowĸchosenĸtoĸ","ĸformĸaĸband.ĸTheirĸcurrentĸtitleĸ","ĸĸisĸtheĸ'CeruleanĸPersonĸGang'.ĸĸ","                       [ SKIP ]   "],titletemplate_outro15=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","Havingĸaccomplishedĸtheirĸmission,","ĸĸtheĸcity'sĸambulanceĸteamsĸallĸĸ","ĸreceivedĸaĸreward:ĸunemployment.ĸ","ĸĸInĸrevenge,ĸtheyĸnowĸannoyĸtheĸĸ","ĸĸcityĸwithĸtheĸsoundĸofĸsirens.ĸĸ","                       [ SKIP ]   "],titletemplate_outro16=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæ","Havingĸaccomplishedĸtheirĸmission,","ĸĸtheĸcity'sĸambulanceĸteamsĸallĸĸ","ĸreceivedĸaĸreward:ĸunemployment.ĸ","ĸĸInĸrevenge,ĸtheyĸnowĸannoyĸtheĸĸ","ĸĸcityĸwithĸtheĸsoundĸofĸsirens.ĸĸ","                       [ SKIP ]   "],titletemplate_outro17=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆÆÆÆÆ†Æ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆÆÆÆ†††","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆÆÆ†Æ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸ","Havingĸaccomplishedĸtheirĸmission,","ĸĸtheĸcity'sĸambulanceĸteamsĸallĸĸ","ĸreceivedĸaĸreward:ĸunemployment.ĸ","ĸĸInĸrevenge,ĸtheyĸnowĸannoyĸtheĸĸ","ĸĸcityĸwithĸtheĸsoundĸofĸsirens.ĸĸ","                       [ SKIP ]   "],titletemplate_outro18=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆÆÆÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆÆÆÆÆ†ÆÆÆÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆÆÆÆ†††ÆÆÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆÆÆ†ÆÆÆÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆÆÆÆÆÆ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸĸĸæłĸ","Havingĸaccomplishedĸtheirĸmission,","ĸĸtheĸcity'sĸambulanceĸteamsĸallĸĸ","ĸreceivedĸaĸreward:ĸunemployment.ĸ","ĸĸInĸrevenge,ĸtheyĸnowĸannoyĸtheĸĸ","ĸĸcityĸwithĸtheĸsoundĸofĸsirens.ĸĸ","                       [ SKIP ]   "],titletemplate_outro19=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸŁŀĸÆÆÆÆÆ†ÆÆÆÆÆÆĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸļĿĸŉŋÆÆÆÆ†††ÆÆÆÆÆĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸ€®®ÆÆÆÆÆ†ÆÆÆÆÆÆĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸĸĸæłĸĸĸĸĸĸ","Havingĸaccomplishedĸtheirĸmission,","ĸĸtheĸcity'sĸambulanceĸteamsĸallĸĸ","ĸreceivedĸaĸreward:ĸunemployment.ĸ","ĸĸInĸrevenge,ĸtheyĸnowĸannoyĸtheĸĸ","ĸĸcityĸwithĸtheĸsoundĸofĸsirens.ĸĸ","                       [ SKIP ]   "],titletemplate_outro20=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸŁŀĸÆÆÆÆÆ†ÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸļĿĸŉŋÆÆÆÆ†††ÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸ€®®ÆÆÆÆÆ†ÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸ®®®ÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸæłĸĸĸĸĸĸæłĸĸĸĸĸĸĸĸĸĸĸ","Havingĸaccomplishedĸtheirĸmission,","ĸĸtheĸcity'sĸambulanceĸteamsĸallĸĸ","ĸreceivedĸaĸreward:ĸunemployment.ĸ","ĸĸInĸrevenge,ĸtheyĸnowĸannoyĸtheĸĸ","ĸĸcityĸwithĸtheĸsoundĸofĸsirens.ĸĸ","                       [ SKIP ]   "],titletemplate_outro21=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸŁŀĸÆÆÆÆÆ†ÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸļĿĸŉŋÆÆÆÆ†††ÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸ€®®ÆÆÆÆÆ†ÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸ®®®ÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸæłĸĸĸĸĸĸæłĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","Havingĸaccomplishedĸtheirĸmission,","ĸĸtheĸcity'sĸambulanceĸteamsĸallĸĸ","ĸreceivedĸaĸreward:ĸunemployment.ĸ","ĸĸInĸrevenge,ĸtheyĸnowĸannoyĸtheĸĸ","ĸĸcityĸwithĸtheĸsoundĸofĸsirens.ĸĸ","                       [ SKIP ]   "],titletemplate_outro22=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ŀĸÆÆÆÆÆ†ÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ŉŋÆÆÆÆ†††ÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","®®ÆÆÆÆÆ†ÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","®®ÆÆÆÆÆÆÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸæłĸĸĸĸĸĸæłĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","Havingĸaccomplishedĸtheirĸmission,","ĸĸtheĸcity'sĸambulanceĸteamsĸallĸĸ","ĸreceivedĸaĸreward:ĸunemployment.ĸ","ĸĸInĸrevenge,ĸtheyĸnowĸannoyĸtheĸĸ","ĸĸcityĸwithĸtheĸsoundĸofĸsirens.ĸĸ","                       [ SKIP ]   "],titletemplate_outro23=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ÆÆÆÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ÆÆ†ÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","Æ†††ÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ÆÆ†ÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ÆÆÆÆÆÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸæłĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","Havingĸaccomplishedĸtheirĸmission,","ĸĸtheĸcity'sĸambulanceĸteamsĸallĸĸ","ĸreceivedĸaĸreward:ĸunemployment.ĸ","ĸĸInĸrevenge,ĸtheyĸnowĸannoyĸtheĸĸ","ĸĸcityĸwithĸtheĸsoundĸofĸsirens.ĸĸ","                       [ SKIP ]   "],titletemplate_outro24=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ÆÆÆÆĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸæłĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","Havingĸaccomplishedĸtheirĸmission,","ĸĸtheĸcity'sĸambulanceĸteamsĸallĸĸ","ĸreceivedĸaĸreward:ĸunemployment.ĸ","ĸĸInĸrevenge,ĸtheyĸnowĸannoyĸtheĸĸ","ĸĸcityĸwithĸtheĸsoundĸofĸsirens.ĸĸ","                       [ SKIP ]   "],titletemplate_outro25=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","Havingĸaccomplishedĸtheirĸmission,","ĸĸtheĸcity'sĸambulanceĸteamsĸallĸĸ","ĸreceivedĸaĸreward:ĸunemployment.ĸ","ĸĸInĸrevenge,ĸtheyĸnowĸannoyĸtheĸĸ","ĸĸcityĸwithĸtheĸsoundĸofĸsirens.ĸĸ","                       [ SKIP ]   "],titletemplate_outro26=["ĸĸĸĸššĸĸĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸĸĸššĸĸĸĸ","ĸĸĸĸšššĸĸĸĸĸĸĸªªªªªªĸĸĸĸĸĸĸšššĸĸĸĸ","ĸšššššššĸĸĸĸĸªªşªªşªªĸĸĸĸĸšššššššĸ","ĸšššššššĸĸĸĸĸªªªªªªªªĸĸĸĸĸšššššššĸ","ĸĸĸĸšššĸĸĸĸĸĸªªĸĸĸĸªªĸĸĸĸĸĸšššĸĸĸĸ","ĸĸĸĸššĸĸĸĸĸĸĸĸªªªªªªĸĸĸĸĸĸĸĸššĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","Unfortunately,ĸtheĸambulanceĸteams","ĸĸĸwereĸfiredĸbeforeĸtheyĸcouldĸĸĸ","ĸremoveĸallĸtheĸarrowsĸtheyĸused.ĸ","ĸĸĸItĸisĸnowĸnextĸtoĸimpossibleĸĸĸ","ĸĸĸĸĸĸtoĸgetĸaroundĸtheĸcity.ĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outro27=["ĸĸĸĸššĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸĸššĸĸĸĸ","ĸĸĸĸšššĸĸĸĸĸĸĸĸĸĸĸĸªªªªªªĸĸšššĸĸĸĸ","ĸšššššššĸĸĸĸĸĸĸĸĸĸªªşªªşªªšššššššĸ","ĸšššššššĸĸĸĸĸĸĸĸĸĸªªªªªªªªšššššššĸ","ĸĸĸĸšššĸĸĸĸĸĸĸĸĸĸĸªªĸĸĸĸªªĸšššĸĸĸĸ","ĸĸĸĸššĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªªªĸĸĸššĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸ","Unfortunately,ĸtheĸambulanceĸteams","ĸĸĸwereĸfiredĸbeforeĸtheyĸcouldĸĸĸ","ĸremoveĸallĸtheĸarrowsĸtheyĸused.ĸ","ĸĸĸItĸisĸnowĸnextĸtoĸimpossibleĸĸĸ","ĸĸĸĸĸĸtoĸgetĸaroundĸtheĸcity.ĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outro28=["ĸĸĸĸššĸĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸššĸĸĸĸ","ĸĸĸĸšššĸĸªªªªªªĸĸĸĸĸĸĸĸĸĸĸĸšššĸĸĸĸ","ĸšššššššªªşªªşªªĸĸĸĸĸĸĸĸĸĸšššššššĸ","ĸšššššššªªªªªªªªĸĸĸĸĸĸĸĸĸĸšššššššĸ","ĸĸĸĸšššĸªªĸĸĸĸªªĸĸĸĸĸĸĸĸĸĸĸšššĸĸĸĸ","ĸĸĸĸššĸĸĸªªªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸššĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸªªªªĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","Unfortunately,ĸtheĸambulanceĸteams","ĸĸĸwereĸfiredĸbeforeĸtheyĸcouldĸĸĸ","ĸremoveĸallĸtheĸarrowsĸtheyĸused.ĸ","ĸĸĸItĸisĸnowĸnextĸtoĸimpossibleĸĸĸ","ĸĸĸĸĸĸtoĸgetĸaroundĸtheĸcity.ĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outro29=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸNoĸgreenĸpeopleĸhaveĸbeenĸseenĸĸ","ĸĸĸinĸquiteĸsomeĸtime.ĸTheyĸareĸĸĸ","ĸĸĸĸĸwidelyĸbelievedĸtoĸhaveĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸgoneĸextinct.ĸĸĸĸĸĸĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outro30=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸNoĸgreenĸpeopleĸhaveĸbeenĸseenĸĸ","ĸĸĸinĸquiteĸsomeĸtime.ĸTheyĸareĸĸĸ","ĸĸĸĸĸwidelyĸbelievedĸtoĸhaveĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸgoneĸextinct.ĸĸĸĸĸĸĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outro31=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸNoĸgreenĸpeopleĸhaveĸbeenĸseenĸĸ","ĸĸĸinĸquiteĸsomeĸtime.ĸTheyĸareĸĸĸ","ĸĸĸĸĸwidelyĸbelievedĸtoĸhaveĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸgoneĸextinct..ĸĸĸĸĸĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outro32=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸNoĸgreenĸpeopleĸhaveĸbeenĸseenĸĸ","ĸĸĸinĸquiteĸsomeĸtime.ĸTheyĸareĸĸĸ","ĸĸĸĸĸwidelyĸbelievedĸtoĸhaveĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸgoneĸextinct...ĸĸĸĸĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outro33=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸNoĸgreenĸpeopleĸhaveĸbeenĸseenĸĸ","ĸĸĸinĸquiteĸsomeĸtime.ĸTheyĸareĸĸĸ","ĸĸĸĸĸwidelyĸbelievedĸtoĸhaveĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸgoneĸextinct...?ĸĸĸĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_2outro33=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĸĳĳĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĳĳĳ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸNoĸgreenĸpeopleĸhaveĸbeenĸseenĸĸ","ĸĸĸinĸquiteĸsomeĸtime.ĸTheyĸareĸĸĸ","ĸĸĸĸĸwidelyĸbelievedĸtoĸhaveĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸgoneĸextinct...?ĸĸĸĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outro34=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸAndĸofĸcourse,ĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outro35=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸAndĸofĸcourse,ĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸYOUĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","                       [ SKIP ]   "],titletemplate_outro36=["ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸAndĸofĸcourse,ĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸYOUĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸshouldĸfindĸsomethingĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸbetterĸtoĸdo.ĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","ĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸĸ","                       [ SKIP ]   "],title_options=[[".............Continue.............",".............Continue.............",".............Ćŏńťįńūě.............","...........>.Continue.<..........."],["...........Level Select...........","...........Level Select...........","...........ĹěÝěľ Śěľěćť...........",".........>.Level Select.<.........."],[".............Settings.............",".............Settings.............",".............Śěťťįńğś.............","...........>.Settings.<..........."],[".............New Game.............",".............New Game.............",".............Ńěŵ Ġāñě.............","...........>.New Game.<..........."],[".............Credits..............",".............Credits..............",".............Ćřěďįťś..............","...........>.Credits.<............"],["..............Manual..............","..............Manual..............","..............Ěāńūāľ..............","............>.Manual.<............"],["...........Achievements...........","...........Achievements...........","...........ĐćħįěÝěñěńťś...........",".........>.Achievements.<........."]],instruction_pages=[[" [ BACK ]                    ","        Basics 1: Controls        ","                                  ","Left-click:  place/rotate arrows, ","              use menu buttons    ","                                  ","Right-click: delete arrows        ","                                  ","Hold left-click: delete arrows    ","                                  ","R key:       reset ambulances     ","                                  ","ESC key:     exit level           "],[" [ BACK ]                    ","       Basics 2: Ambulances       ","                                  "," Ambulances appear from hospitals ","  when you press the PLAY button. ","  They will automatically move in ","   a straight line, crashing if   ","     they hit anything solid.     ","                                  "," Any people next to an ambulance  "," will be healed. Once everyone is "," healed, you win! However, if any "," ambulances crash, you will lose. "],[" [ BACK ]                    ","          Basics 3: Arrows        ","                                  ","  Clicking on an empty tile will  ","  place an arrow there. Click the ","   arrow again to rotate it, or   ","   remove it by right-clicking    ","     or by holding left-click.    ","  Each level has a max number of  ","    arrows that can be placed.    ","                                  "," Ambulances that move over arrows ","      will change direction.      ","                                  "],[" [ BACK ]                    ","      Basics 4: Miscellaneous     ","                                  "," Red-outlined arrows are fixed in "," place; you can't remove or rotate","               them.              ","                                  "," If you get stuck, the HINT button","  can highlight a tile where an   "," arrow should be placed. Note that","you may have to remove some arrows"," you've already placed to reach a ","  correct solution with the hint. "],[" [ BACK ]                    ","               Rafts              ","                                  ","  Rafts act like normal tiles at  "," first. If an ambulance moves over"," one though, the raft will break, ","   leaving water in its place.    ","                                  "," Water is an impassible obstacle. ","  Make sure you don't break too   ","   many rafts and get trapped!    "],[" [ BACK ]                    ","          Buttons & Gates         ","                                  ","   Coloured gates will act like   ","  walls for ambulances, blocking  ","  important pathways. To get rid  ","  of them, have an ambulance run  ","over the matching coloured button.","                                  ","    Be careful on levels with     ","  multiple colours of gates and   ","  buttons; each button will only  ","      clear one type of gate!     "],[" [ BACK ]                    ","            Red Tiles             ","                                  ","   Red tiles work exactly like    "," regular tiles, with one important","    difference; you can't place   ","         arrows on them.          ","                                  ","      Other than that though,     "," feel free to drive right through!"],[" [ BACK ]                    ","               Cars               ","                                  "," Just like ambulances appear from ","  hospitals, cars appear from...  ","   car hospitals. They work just  ","   like ambulances do, but they   ","  can't heal people. You'll still ","  fail if a car crashes, though.  ","                                  ","  They're mostly just nuisances,  ","       but do your best to        ","          protect them!           "],[" [ BACK ]                    ","            Temp Arrows           ","                                  "," Yellow arrows are temporary. If  ","  a vehicle moves over one, the   ","  arrow will disappear after the  ","    vehicle changes direction.    ","                                  ","   They work the same as normal   ","        arrows otherwise.         "],[" [ BACK ]                    ","        Placing Temp Arrows       ","                                  ","  In later levels, you can place  "," both normal and temp arrows. Use "," the SWAP button to swap between  ","         the two options.         ","                                  "," Try to keep in mind the benefits ","    of both arrow types, and use  "," whichever seems best at the time! "]],achievementList=[["Ambulance Amateur","         Ambulance Amateur        ","Cleared level 15."],["Hospital Helper","          Hospital Helper         ","Cleared level 32."],["Patient Pacifier","         Patient Pacifier         ","Cleared level 45."],["Vehicle Voyeur","          Vehicle Voyeur          ","Cleared level 57."],["Paramedic Professional","      Paramedic Professional      ","Cleared level 73."],["Siren Savant","           Siren Savant           ","Finished the game."],["Medical Master","          Medical Master          ","Cleared the bonus level."],["Arrow Artist","           Arrow Artist           ","Place a total of 250 arrows."],["Dedicated Driver","         Dedicated Driver         ","Let a level run for over 200 steps."],["Crash Craver","           Crash Craver           ","Cause 30 vehicles to crash."],["Efficient Emergency","        Efficient Emergency       ","Cleared a level with at least one","leftover arrow."]],titleImage=[],titleWidth=titletemplate_empty[0].length,titleHeight=titletemplate_empty.length,textMode=!0,titleScreen=!0,titleMode=0,titleSelection=0,titleSelectOptions=3,titleSelected=!1,hoverSelection=-1,instructions_index=-1,achievementIndex=-1;function earnAchievement(e){1!==earnedAchievements[e]&&(earnedAchievements[e]=1,localStorage.setItem(document.URL+"_achievements",JSON.stringify(earnedAchievements)),tryPlaySimpleSound("sfx3"))}function enterFullScreen(){var e=document.documentElement;null!=e&&(e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen())}function exitFullScreen(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function isInFullscreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}function showContinueOptionOnTitleScreen(){return(curlevel>0||null!==curlevelTarget)&&curlevel in state.levels}function unloadGame(){state=introstate,(level=new Level(0,5,5,2,null,null)).objects=new Int32Array(0),generateTitleScreen(),canvasResize(),redraw(),titleSelected=!0}function isContinueOptionSelected(){return void 0===state.metadata.continue_is_level_select&&(1===titleMode&&0==titleSelection)}function isNewGameOptionSelected(){return 1===titleMode?void 0:0==titleSelection}function isSettingsOptionSelected(){return 1===titleMode?titleSelection==titleSelectOptions-3:0==titleSelection}function isLevelSelectOptionSelected(){return void 0!==state.metadata.level_select&&(void 0!==state.metadata.continue_is_level_select?0==titleSelection:1===titleMode&&1==titleSelection)}function delay(e){return new Promise((t=>setTimeout(t,e)))}function isCreditsOptionSelected(){return void 0!==state.metadata.credits&&titleSelection==titleSelectOptions-2}function isManualOptionSelected(){return void 0!==state.metadata.manual&&(1===titleMode?2==titleSelection:1==titleSelection)}function isAchievementsOptionSelected(){return titleSelection==titleSelectOptions-1}function loadMusic(){var e=new Audio("music/menuMusic.mp3");e.load(),(e=new Audio("music/levelMusic1.mp3")).load(),(e=new Audio("music/levelMusic2.mp3")).load(),(e=new Audio("music/levelMusic3.mp3")).load(),(e=new Audio("music/levelMusic4.mp3")).load(),(e=new Audio("music/levelMusic5.mp3")).load(),(e=new Audio("music/levelMusic6.mp3")).load(),(e=new Audio("music/endingMusic.mp3")).load()}function playPreIntro(){7===titleMode&&(titleImage=deepClone(titletemplate_pre_intro),loadMusic())}function playIntro10(){4===titleMode&&(tryPlaySimpleSound("sfx6"),titleImage=deepClone(titletemplate_intro10),delay(2e3).then((()=>playIntro9())))}function playIntro9(){4===titleMode&&(tryPlaySimpleSound("sfx7"),titleImage=deepClone(titletemplate_intro9),delay(1200).then((()=>playIntro8())))}function playIntro8(){4===titleMode&&(titleImage=deepClone(titletemplate_intro8),delay(1200).then((()=>playIntro7())))}function playIntro7(){4===titleMode&&(tryPlaySimpleSound("sfx2"),titleImage=deepClone(titletemplate_intro7),delay(1200).then((()=>playIntro6())))}function playIntro6(){4===titleMode&&(tryPlaySimpleSound("sfx7"),titleImage=deepClone(titletemplate_intro6),delay(250).then((()=>playIntro5())))}function playIntro5(){4===titleMode&&(titleImage=deepClone(titletemplate_intro5),delay(250).then((()=>playIntro4())))}function playIntro4(){4===titleMode&&(titleImage=deepClone(titletemplate_intro4),delay(250).then((()=>playIntro3())))}function playIntro3(){4===titleMode&&(titleImage=deepClone(titletemplate_intro3),delay(250).then((()=>playIntro2())))}function playIntro2(){4===titleMode&&(titleImage=deepClone(titletemplate_intro2),delay(250).then((()=>playIntro1())))}function playIntro1(){4===titleMode&&(titleImage=deepClone(titletemplate_intro1),delay(250).then((()=>playIntro0())))}function playIntro0(){4===titleMode&&(titleImage=deepClone(titletemplate_intro0),delay(750).then((()=>generateTitleScreen())),delay(750).then((()=>startMenuMusic())))}function playOutro0(){10===titleMode&&(titleImage=deepClone(titletemplate_outro0),playingOutro(),delay(5e3).then((()=>playOutro1())))}function playOutro1(){10===titleMode&&(titleImage=deepClone(titletemplate_outro1),playingOutro(),delay(5e3).then((()=>playOutro3())))}function playOutro3(){10===titleMode&&(titleImage=deepClone(titletemplate_outro3),playingOutro(),delay(5e3).then((()=>playOutro4())))}function playOutro4(){10===titleMode&&(titleImage=deepClone(titletemplate_outro4),playingOutro(),delay(250).then((()=>playOutro5())))}function playOutro5(){10===titleMode&&(titleImage=deepClone(titletemplate_outro5),playingOutro(),delay(250).then((()=>playOutro6())))}function playOutro6(){10===titleMode&&(titleImage=deepClone(titletemplate_outro6),playingOutro(),delay(250).then((()=>playOutro7())))}function playOutro7(){10===titleMode&&(titleImage=deepClone(titletemplate_outro7),playingOutro(),delay(250).then((()=>playOutro8())))}function playOutro8(){10===titleMode&&(titleImage=deepClone(titletemplate_outro8),playingOutro(),delay(250).then((()=>playOutro9())))}function playOutro9(){10===titleMode&&(titleImage=deepClone(titletemplate_outro9),playingOutro(),delay(5e3).then((()=>playOutro10())))}function playOutro10(){10===titleMode&&(titleImage=deepClone(titletemplate_outro10),playingOutro(),delay(250).then((()=>playOutro11())))}function playOutro11(){10===titleMode&&(titleImage=deepClone(titletemplate_outro11),playingOutro(),delay(250).then((()=>playOutro12())))}function playOutro12(){10===titleMode&&(titleImage=deepClone(titletemplate_outro12),playingOutro(),delay(250).then((()=>playOutro13())))}function playOutro13(){10===titleMode&&(titleImage=deepClone(titletemplate_outro13),playingOutro(),delay(250).then((()=>playOutro14())))}function playOutro14(){10===titleMode&&(titleImage=deepClone(titletemplate_outro14),playingOutro(),delay(250).then((()=>playOutro15())))}function playOutro15(){10===titleMode&&(titleImage=deepClone(titletemplate_outro15),playingOutro(),delay(250).then((()=>playOutro16())))}function playOutro16(){10===titleMode&&(titleImage=deepClone(titletemplate_outro16),playingOutro(),delay(250).then((()=>playOutro17())))}function playOutro17(){10===titleMode&&(titleImage=deepClone(titletemplate_outro17),playingOutro(),delay(250).then((()=>playOutro18())))}function playOutro18(){10===titleMode&&(titleImage=deepClone(titletemplate_outro18),playingOutro(),delay(250).then((()=>playOutro19())))}function playOutro19(){10===titleMode&&(titleImage=deepClone(titletemplate_outro19),playingOutro(),delay(250).then((()=>playOutro20())))}function playOutro20(){10===titleMode&&(titleImage=deepClone(titletemplate_outro20),playingOutro(),delay(5e3).then((()=>playOutro21())))}function playOutro21(){10===titleMode&&(titleImage=deepClone(titletemplate_outro21),playingOutro(),delay(250).then((()=>playOutro22())))}function playOutro22(){10===titleMode&&(titleImage=deepClone(titletemplate_outro22),playingOutro(),delay(250).then((()=>playOutro23())))}function playOutro23(){10===titleMode&&(titleImage=deepClone(titletemplate_outro23),playingOutro(),delay(250).then((()=>playOutro24())))}function playOutro24(){10===titleMode&&(titleImage=deepClone(titletemplate_outro24),playingOutro(),delay(250).then((()=>playOutro25())))}function playOutro25(){10===titleMode&&(titleImage=deepClone(titletemplate_outro25),playingOutro(),arrowLoops=0,delay(250).then((()=>playOutro26())))}var arrowLoops=0;function playOutro26(){10===titleMode&&(titleImage=deepClone(titletemplate_outro26),playingOutro(),delay(250).then((()=>playOutro27())))}function playOutro27(){10===titleMode&&(titleImage=deepClone(titletemplate_outro27),playingOutro(),delay(250).then((()=>play2Outro26())))}function play2Outro26(){10===titleMode&&(titleImage=deepClone(titletemplate_outro26),playingOutro(),delay(250).then((()=>playOutro28())))}function playOutro28(){10===titleMode&&(titleImage=deepClone(titletemplate_outro28),playingOutro(),console.error("arrowloops = "+arrowLoops),arrowLoops<5?(arrowLoops+=1,delay(250).then((()=>playOutro26()))):delay(250).then((()=>playOutro29())))}function playOutro29(){10===titleMode&&(titleImage=deepClone(titletemplate_outro29),playingOutro(),delay(3500).then((()=>playOutro30())))}function playOutro30(){10===titleMode&&(titleImage=deepClone(titletemplate_outro30),playingOutro(),delay(600).then((()=>playOutro31())))}function playOutro31(){10===titleMode&&(titleImage=deepClone(titletemplate_outro31),playingOutro(),delay(600).then((()=>playOutro32())))}function playOutro32(){10===titleMode&&(titleImage=deepClone(titletemplate_outro32),playingOutro(),delay(600).then((()=>playOutro33())))}function playOutro33(){10===titleMode&&(titleImage=deepClone(titletemplate_outro33),playingOutro(),delay(600).then((()=>play2Outro33())))}function play2Outro33(){10===titleMode&&(titleImage=deepClone(titletemplate_2outro33),playingOutro(),delay(1200).then((()=>playOutro34())))}function playOutro34(){10===titleMode&&(titleImage=deepClone(titletemplate_outro34),playingOutro(),delay(3e3).then((()=>playOutro35())))}function playOutro35(){10===titleMode&&(titleImage=deepClone(titletemplate_outro35),playingOutro(),delay(3e3).then((()=>playOutro36())))}function playOutro36(){10===titleMode&&(titleImage=deepClone(titletemplate_outro36),playingOutro(),delay(3e3).then((()=>gotoLevel(state.sections.length-2))))}function startMenuMusic(){"menu"!=currentMusicName&&(null!=currentMusic&&currentMusic.pause(),currentMusicName="menu",(currentMusic=new Audio("music/menuMusic.mp3")).volume=musicSetting/10*.5,null==currentMusic||muted||(currentMusic.loop=!0,currentMusic.play()))}function startLevelMusic1(){"level1"!=currentMusicName&&(null!=currentMusic&&currentMusic.pause(),currentMusicName="level1",(currentMusic=new Audio("music/levelMusic1.mp3")).volume=musicSetting/10*.5,null==currentMusic||muted||(currentMusic.loop=!0,currentMusic.play()))}function startLevelMusic2(){"level2"!=currentMusicName&&(null!=currentMusic&&currentMusic.pause(),currentMusicName="level2",(currentMusic=new Audio("music/levelMusic2.mp3")).volume=musicSetting/10*.5,null==currentMusic||muted||(currentMusic.loop=!0,currentMusic.play()))}function startLevelMusic3(){"level3"!=currentMusicName&&(null!=currentMusic&&currentMusic.pause(),currentMusicName="level3",(currentMusic=new Audio("music/levelMusic3.mp3")).volume=musicSetting/10*.5,null==currentMusic||muted||(currentMusic.loop=!0,currentMusic.play()))}function startLevelMusic4(){"level4"!=currentMusicName&&(null!=currentMusic&&currentMusic.pause(),currentMusicName="level4",(currentMusic=new Audio("music/levelMusic4.mp3")).volume=musicSetting/10*.4,null==currentMusic||muted||(currentMusic.loop=!0,currentMusic.play()))}function startLevelMusic5(){"level5"!=currentMusicName&&(null!=currentMusic&&currentMusic.pause(),currentMusicName="level5",(currentMusic=new Audio("music/levelMusic5.mp3")).volume=musicSetting/10*.5,null==currentMusic||muted||(currentMusic.loop=!0,currentMusic.play()))}function startLevelMusic6(){"level6"!=currentMusicName&&(null!=currentMusic&&currentMusic.pause(),currentMusicName="level6",(currentMusic=new Audio("music/levelMusic6.mp3")).volume=musicSetting/10*.4,null==currentMusic||muted||(currentMusic.loop=!0,currentMusic.play()))}function startEndingMusic(){"ending"!=currentMusicName&&(null!=currentMusic&&currentMusic.pause(),currentMusicName="ending",(currentMusic=new Audio("music/endingMusic.mp3")).volume=musicSetting/10*.4,null==currentMusic||muted||(currentMusic.loop=!0,currentMusic.play()))}function testNGIO(){NGIO.init("55847:mx3f5tpU","/8rRdzdXNqnIk/9QYOSTbg==",{version:"1.0.0",preloadMedals:!0}),NGIO.getConnectionStatus((function(e){}));NGIO.getMedal(72616)}function testGetMedal(e){}var musicPlaying=!1,currentMusicName="";function generateTitleScreen(){if(testNGIO(),tryLoadCustomFont(),titleMode=showContinueOptionOnTitleScreen()?1:0,0!==state.levels.length)if(isSitelocked())titleImage=sitelock_template;else{startMenuMusic();var e="\n\tĸĸĸĸĸĸĸĸÆÆÆÆÆÆÆÆÆÆÆÆ\n\tĸĸĸĸĸŁŀĸÆÆ¥§¤†¢ŸŷųøÆ\n    ļĿĸŉŋÆÆÆÆ†††ÆÆÆÆÆ\n\tĸĸĸĸĸ€®®ÆÆÆŲű†ŧŦŢŒœÆ\n\tĸĸĸĸĸ®®®ÆÆÆÆÆÆÆÆÆÆÆÆ\n\tĸĸĸĸĸĸĸĸæłĸĸĸĸĸĸæłĸ";void 0!==state.metadata.title&&(e=state.metadata.title),titleSelectOptions=1;var t=[];0===titleMode?t.push(3):(t.push(0),void 0!==state.metadata.level_select&&void 0===state.metadata.continue_is_level_select&&(titleSelectOptions++,t.push(1))),void 0!==state.metadata.settings&&(titleSelectOptions++,t.push(2)),void 0!==state.metadata.manual&&(titleSelectOptions++,t.push(5)),t.push(2),titleSelectOptions++,void 0!==state.metadata.credits&&(titleSelectOptions++,t.push(4)),t.push(6),titleSelectOptions++,titleImage=deepClone(titletemplate_empty);for(var n=0;n<titleSelectOptions;n++){var r=0,o=0;titleSelection==n&&titleSelected&&(r=2),hoverSelection==(o=6==titleSelectOptions?7+n+0:8+n+0)&&!titleSelected&&hoverSelection>=0&&(r=3),titleImage[o]=deepClone(title_options[t[n]][r])}if(state.metadata.text_controls){for(n=0;n<titleImage.length;n++)titleImage[n]=titleImage[n].replace(/\./g," ");var i=wordwrap(state.metadata.text_controls,35,!0);i[0]&&(titleImage[10]=i[0]),i[1]&&(titleImage[11]=i[1]),i[2]&&(titleImage[12]=i[2])}else for(n=0;n<titleImage.length;n++)titleImage[n]=titleImage[n].replace(/\./g," ");var s=titleImage[0].length,a=wordwrap(e,titleImage[0].length);void 0!==state.metadata.author?a.length>3&&(a.splice(3),logWarning("Game title is too long to fit on screen, truncating to three lines.",void 0,!0)):a.length>6&&(a.splice(6),logWarning("Game title is too long to fit on screen, truncating to six lines.",void 0,!0));for(n=0;n<a.length;n++){var l=a[n],c=l.length,u=(s-c)/2|0,d=titleImage[1+n];titleImage[1+n]=d.slice(0,u)+l+d.slice(u+l.length)}if(void 0!==state.metadata.author){var h=wordwrap("by "+state.metadata.author,titleImage[0].length);h[0].length<titleImage[0].length&&(h[0]=" "+h[0]),h.length>3&&(h.splice(3),logWarning("Author list too long to fit on screen, truncating to three lines.",void 0,!0));for(n=0;n<h.length;n++){var p=h[n]+" ";p.length>s&&(p=p.slice(0,s));d=titleImage[3+n];titleImage[3+n]=d.slice(0,s-p.length)+p}}}else titleImage=intro_template}var levelSelectScrollPos=0;function gotoLevelSelectScreen(){if(void 0!==state.metadata.level_select){if(startMenuMusic(),levelSelectScrollPos=0,titleSelected=!1,timer=0,quittingTitleScreen=!1,quittingMessageScreen=!1,messageselected=!1,titleMode=2,titleScreen=!0,textMode=!0,againing=!1,messagetext="",0==titleSelection)for(var e=0;e<state.sections.length;e++)if(state.sections[e].firstLevel>curlevel){titleSelection=Math.max(0,e-1);break}state.metadata=deepClone(state.default_metadata),twiddleMetadataExtras(),generateLevelSelectScreen(),redraw()}else goToTitleScreen()}function gotoCreditsScreen(){void 0!==state.metadata.credits?(titleSelected=!1,timer=0,quittingTitleScreen=!1,quittingMessageScreen=!1,messageselected=!1,titleMode=3,titleScreen=!0,textMode=!0,againing=!1,messagetext="",creditsPage=1,twiddleMetadataExtras(),generateCreditsScreen(),redraw()):goToTitleScreen()}function gotoManualScreen(){void 0!==state.metadata.manual?(instructions_index=-1,titleSelected=!1,timer=0,quittingTitleScreen=!1,quittingMessageScreen=!1,messageselected=!1,titleMode=5,titleScreen=!0,textMode=!0,againing=!1,messagetext="",twiddleMetadataExtras(),generateManualScreen(),redraw()):goToTitleScreen()}function gotoSettingsScreen(){instructions_index=-1,titleSelected=!1,timer=0,quittingTitleScreen=!1,quittingMessageScreen=!1,messageselected=!1,titleMode=9,titleScreen=!0,textMode=!0,againing=!1,messagetext="",twiddleMetadataExtras(),generateSettingsScreen(),redraw()}function gotoManualPageScreen(){quittingTitleScreen=!1,titleSelected=!1,quittingMessageScreen=!1,messageselected=!1,titleMode=6,titleScreen=!0,textMode=!0,againing=!1,messagetext="",twiddleMetadataExtras(),generateManualPageScreen(),redraw()}function gotoSkipDemoScreen(){titleSelected=!1,timer=0,quittingTitleScreen=!1,quittingMessageScreen=!1,messageselected=!1,titleMode=8,titleScreen=!0,textMode=!0,againing=!1,messagetext="",passwordEntry="",twiddleMetadataExtras(),generateSkipDemoScreen(),redraw()}function gotoAchievementsScreen(){titleSelected=!1,timer=0,quittingTitleScreen=!1,quittingMessageScreen=!1,messageselected=!1,titleMode=11,titleScreen=!0,textMode=!0,againing=!1,messagetext="",achieveScrollPos=0,twiddleMetadataExtras(),generateAchievementsScreen(),redraw()}function gotoAchievementDescription(){titleSelected=!1,timer=0,quittingTitleScreen=!1,quittingMessageScreen=!1,messageselected=!1,titleMode=12,titleScreen=!0,textMode=!0,againing=!1,messagetext="",twiddleMetadataExtras(),generateAchievementDescription(),redraw()}function gotoOutro(){quittingTitleScreen=!1,titleSelected=!1,quittingMessageScreen=!1,messageselected=!1,titleMode=10,titleScreen=!0,textMode=!0,againing=!1,messagetext="",twiddleMetadataExtras(),startEndingMusic(),playOutro0(),redraw()}function playingOutro(){titleImage[12]=12!=hoverSelection?"                       [ SKIP ]   ":"                      [  SKIP  ]  ",redraw()}var underlineVisible=!0,flashTimer=350,passwordEntry="",correctPassword="GARFUNKEL";function checkPassword(){return passwordEntry==correctPassword}function generateSkipDemoScreen(){titleImage=[" [ BACK ]                    ","             Password             ","                                  ","                                  "," If you have a password from the  ","  demo, type it in here to skip   ","  all the levels from the demo!   ","                                  "," They'll still be unlocked in     "," the level select, so don't worry ","about losing out on playing them. ","                                  "],0==hoverSelection&&(titleImage[0]="[  BACK  ]                   ");for(var e=titleImage.length;e<13;e++)titleImage.push("                                  ");var t=passwordEntry;flashTimer-=10,underlineVisible&&passwordEntry.length<=14?(t+="_",flashTimer<=0&&(flashTimer=350,underlineVisible=!1)):(t+=" ",flashTimer<=0&&(flashTimer=350,underlineVisible=!0));for(e=t.length;e<20;e++)t+=" ";t+=12==hoverSelection?"[  SUBMIT  ]":" [ SUBMIT ] ",titleImage[12]=t,redraw(),delay(10).then((()=>redrawSkipDemoScreen()))}function redrawSkipDemoScreen(){8===titleMode&&(generateSkipDemoScreen(),redraw())}function redrawSettingsScreen(){9===titleMode&&(generateSettingsScreen(),redraw())}function isPasswordAvailable(){if(void 0!==state.metadata.level_select_lock){for(var e=0,t=0;t<state.sections.length;t++)solvedSections.indexOf(state.sections[t].name)>=0&&(e=t);if(e<31)return!0}return!1}function autocompleteDemo(){for(var e=0;e<32;e++)setSectionSolved(state.sections[e].name)}var creditsPage=1;function generateCreditsScreen(){1===creditsPage?(titleImage=[" [ BACK ]      Credits            ","                                  ","           Developed by:          ","                Joey Meffen       ","                Nick Birtch       ","                                  ","Special Thanks to our Playtesters:","       Kiran   Ken   Curtis       ","           Tracy   Gary           ","                                  "," Created using PuzzleScript Plus  ","                       [ NEXT ]   "],0==hoverSelection?titleImage[0]="[  BACK  ]     Credits       ":11==hoverSelection&&(titleImage[11]="                      [  NEXT  ]  ")):2===creditsPage&&(titleImage=[" [ BACK ]      Credits            ","       Music by Eric Matyas       ","        www.soundimage.org        ","Menu Theme:    Winter Puzzles     ","Level Theme 1: Peaceful Puzzles   ","Level Theme 2: Mellow Puzzler     ","Level Theme 3: Electric Raindrops ","Level Theme 4: Puzzle Dreams 2    ","Level Theme 5: Build it W/ Pixels ","Level Theme 6: Cryptic Puzzler 2  ","Ending Theme:  Key West Sunset    ","                       [ PREV ]   "],0==hoverSelection?titleImage[0]="[  BACK  ]     Credits         ":11==hoverSelection&&(titleImage[11]="                      [  PREV  ]  "));for(var e=titleImage.length;e<13;e++)titleImage.push("                                  ");redraw()}function generateManualPageScreen(){if(-1!=instructions_index){(titleImage=instruction_pages[instructions_index])[0]=0==hoverSelection?"[  BACK  ]                   ":" [ BACK ]                    ";for(var e=titleImage.length;e<13;e++)titleImage.push("                                  ");redraw()}}function generateAchievementDescription(){if(-1!=achievementIndex){var e=achievementList[achievementIndex][1];titleImage[0]=0==hoverSelection?"[  BACK  ]                   ":" [ BACK ]                    ",titleImage[1]=e,titleImage[2]="                                  ";for(var t=2;t<achievementList[achievementIndex].length;t++)titleImage[t+1]=achievementList[achievementIndex][t];for(;t<12;t++)titleImage[t+1]="                                  ";redraw()}}function generateManualScreen(){titleImage=[" [ BACK ]                    ","              Manual              ","                                  "," 1.  Basics 1: Controls           "," 2.  Basics 2: Ambulances         "," 3.  Basics 3: Arrows             "," 4.  Basics 4: Miscellaneous      "," 5.  Rafts                        "," 6.  Buttons and Gates            "," 7.  Red Tiles                    "," 8.  Cars                         "," 9.  Temp Arrows                  "," 10. Placing Temp Arrows          "],0==hoverSelection&&(titleImage[0]="[  BACK  ]                   "),amountOfOptionsOnScreen=10;var e=-1;if(void 0!==state.metadata.level_select_lock){for(var t=0;t<state.sections.length;t++)solvedSections.indexOf(state.sections[t].name)>=0?e=t:0;lastInstruction=0,lastInstruction=e<15?3:e<20?4:e<37?5:e<45?6:e<54?7:e<60?8:10}for(t=0;t<amountOfOptionsOnScreen;t++){var n=t==titleSelection,r=lastInstruction>=0&&t>lastInstruction,o=titleImage[t+3];if(r){n&&titleSelected&&(titleSelected=!1,quittingTitleScreen=!1);var i=o.length;o="";for(var s=0;s<i;s++)o+="*"}else if(n&&titleSelected)return tryPlayStartGameSound(),void gotoManualPageScreen();var a=" ";hoverSelection-3+levelSelectScrollPos==t&&(a=">"),n&&titleSelected&&(a=" ");var l=a+" "+o;for(s=o.length;s<32;s++)l+=" ";titleImage[t+3]=l,redraw()}for(t=titleImage.length;t<13;t++)titleImage.push("                                  ");redraw()}var verifying=!1;function generateSettingsScreen(){titleImage=[" [ BACK ]                         ","             Settings             ","                                  ","              Volume              ","                                  "," SFX        [-]  ||||||||||  [+]  "," MUSIC      [-]  ||||||||||  [+]  ","                                  ","      [ Toggle Fullscreen ]       ","                                  ","       [ Skip Demo Levels ]       ","                                  ","        [ Reset Progress ]        "];var e=new String(" SFX        [-]  ||||||||||  [+]  "),t=new String(" MUSIC      [-]  ||||||||||  [+]  ");12==hoverSelection?titleImage[12]=verifying?"    [    Are You Certain?    ]    ":"       [  Reset Progress  ]       ":(verifying=!1,0==hoverSelection?titleImage[0]="[  BACK  ]                   ":5==hoverSelection?mouseCoordX>=11&&mouseCoordX<=15?e=" SFX       [ - ] ||||||||||  [+]  ":mouseCoordX>=28&&mouseCoordX<=32&&(e=" SFX        [-]  |||||||||| [ + ] "):6==hoverSelection?mouseCoordX>=11&&mouseCoordX<=15?t=" MUSIC     [ - ] ||||||||||  [+]  ":mouseCoordX>=28&&mouseCoordX<=32&&(t=" MUSIC      [-]  |||||||||| [ + ] "):8==hoverSelection?titleImage[8]="     [  Toggle Fullscreen  ]      ":10==hoverSelection&&(titleImage[10]="      [  Skip Demo Levels  ]      ")),isPasswordAvailable()||(titleImage[10]="                                 ");for(var n=0;n<sfxSetting;n++)e=e.replace("|","Ĥ");for(var r=0;r<musicSetting;r++)t=t.replace("|","Ĥ");titleImage[5]=e,titleImage[6]=t,redraw()}function increaseSFXVolume(){sfxSetting<10?(sfxSetting+=1,clearSFXCache(),tryPlaySimpleSound("sfx9"),generateSettingsScreen(),localStorage.setItem(document.URL+"_sfx",JSON.stringify(sfxSetting))):tryPlaySimpleSound("sfx1")}function decreaseSFXVolume(){sfxSetting>0?(sfxSetting-=1,clearSFXCache(),tryPlaySimpleSound("sfx9"),generateSettingsScreen(),localStorage.setItem(document.URL+"_sfx",JSON.stringify(sfxSetting))):tryPlaySimpleSound("sfx1")}function increaseMusicVolume(){musicSetting<10?(musicSetting+=1,currentMusic.volume=musicSetting/10*.5,currentMusic.play(),tryPlaySimpleSound("sfx9"),generateSettingsScreen(),localStorage.setItem(document.URL+"_music",JSON.stringify(musicSetting))):tryPlaySimpleSound("sfx1")}function decreaseMusicVolume(){musicSetting>0?(musicSetting-=1,currentMusic.volume=musicSetting/10*.5,currentMusic.play(),tryPlaySimpleSound("sfx9"),generateSettingsScreen(),localStorage.setItem(document.URL+"_music",JSON.stringify(musicSetting))):tryPlaySimpleSound("sfx1")}var amountOfAchievesOnScreen=0,achieveScrollPos=0;function generateAchievementsScreen(){titleImage=[" [ BACK ]                    ","           Achievements           "],0==hoverSelection&&(titleImage[0]="[  BACK  ]                   "),amountOfAchievesOnScreen=9,titleSelectOptions=achievementList.length,titleSelection<achieveScrollPos?achieveScrollPos=titleSelection:titleSelection>=achieveScrollPos+amountOfAchievesOnScreen&&(achieveScrollPos=titleSelection-amountOfAchievesOnScreen+1);var e=titleSelection-achieveScrollPos;0==e&&(achieveScrollPos=Math.max(0,achieveScrollPos-1)),e==amountOfAchievesOnScreen-1&&(achieveScrollPos=Math.min(achievementList.length-amountOfAchievesOnScreen,achieveScrollPos+1)),0!=achieveScrollPos?2==hoverSelection?titleImage.push("                        [  PREV  ]"):titleImage.push("                         [ PREV ] "):titleImage.push("                                  "),console.error("scroll pos: "+achieveScrollPos+", achievementlist length: "+achievementList.length);for(var t=achieveScrollPos;t<achieveScrollPos+amountOfAchievesOnScreen&&!(t<0||t>=achievementList.length);t++){console.error("achieve i is "+t);var n=achievementList[t],r=t==titleSelection,o=n[0].substring(0,31),i=1===earnedAchievements[o];r&&titleSelected&&tryPlayStartGameSound();var s=(i?"✓":" ")+" ",a=" ";hoverSelection-3+achieveScrollPos==t&&(a=">"),r&&titleSelected&&(a=" "),s+=a+" "+o;for(var l=o.length;l<32;l++)s+=" ";titleImage.push(s)}achieveScrollPos!=titleSelectOptions-amountOfAchievesOnScreen&&titleSelectOptions-amountOfAchievesOnScreen>0?12==hoverSelection?titleImage.push("                        [  NEXT  ]"):titleImage.push("                         [ NEXT ] "):titleImage.push("                                  ");for(t=titleImage.length;t<13;t++)titleImage.push("                                  ");redraw()}function generateLevelSelectScreen(){titleImage=[" [ BACK ]                    ","           Level Select           "],0==hoverSelection&&(titleImage[0]="[  BACK  ]                   "),amountOfLevelsOnScreen=9,titleSelectOptions=state.sections.length,titleSelection<levelSelectScrollPos?levelSelectScrollPos=titleSelection:titleSelection>=levelSelectScrollPos+amountOfLevelsOnScreen&&(levelSelectScrollPos=titleSelection-amountOfLevelsOnScreen+1);var e=titleSelection-levelSelectScrollPos;0==e&&(levelSelectScrollPos=Math.max(0,levelSelectScrollPos-1)),e==amountOfLevelsOnScreen-1&&(levelSelectScrollPos=Math.min(state.sections.length-amountOfLevelsOnScreen,levelSelectScrollPos+1)),0!=levelSelectScrollPos?2==hoverSelection?titleImage.push("                        [  PREV  ]"):titleImage.push("                         [ PREV ] "):titleImage.push("                                  ");var t=-1;if(void 0!==state.metadata.level_select_lock){for(var n=0;n<state.sections.length;n++)solvedSections.indexOf(state.sections[n].name)>=0?t=n:0;void 0===state.metadata.level_select_unlocked_ahead?t+=1:void 0!==state.metadata.level_select_unlocked_rollover?t=solvedSections.length+Number(state.metadata.level_select_unlocked_rollover)-1:t+=Number(state.metadata.level_select_unlocked_ahead)}for(n=levelSelectScrollPos;n<levelSelectScrollPos+amountOfLevelsOnScreen&&!(n<0||n>=state.sections.length);n++){var r=state.sections[n],o=solvedSections.indexOf(r.name)>=0,i=n==titleSelection,s=t>=0&&n>t,a=r.name.substring(0,31);if(s){i&&titleSelected&&(titleSelected=!1,quittingTitleScreen=!1);var l=a.length;a="";for(var c=0;c<l;c++)a+="*"}else i&&titleSelected&&tryPlayStartGameSound();var u="✓";void 0!==state.metadata.level_select_solve_symbol&&(u=state.metadata.level_select_solve_symbol);var d=(o?u:" ")+" ",h=" ";hoverSelection-3+levelSelectScrollPos==n&&(h=">"),i&&titleSelected&&(h=" "),d+=h+" "+a;for(c=a.length;c<32;c++)d+=" ";titleImage.push(d)}levelSelectScrollPos!=titleSelectOptions-amountOfLevelsOnScreen&&titleSelectOptions-amountOfLevelsOnScreen>0?12==hoverSelection?titleImage.push("                        [  NEXT  ]"):titleImage.push("                         [ NEXT ] "):titleImage.push("                                  ");for(n=titleImage.length;n<13;n++)titleImage.push("                                  ");redraw()}function gotoLevel(e){solving||e<0||(againing=!1,messagetext="",curlevel=state.sections[e].firstLevel,loadLevelFromStateOrTarget(),updateLocalStorage(),resetFlickDat(),canvasResize(),clearInputHistory())}var introstate={title:"EMPTY GAME",attribution:"increpare",objectCount:2,metadata:[],levels:[],bgcolor:"#000000",fgcolor:"#FFFFFF"},state=introstate;function deepClone(e){if(!e)return e;if([Number,String,Boolean].forEach((function(n){e instanceof n&&(t=n(e))})),void 0===t)if("[object Array]"===Object.prototype.toString.call(e))t=[],e.forEach((function(e,n,r){t[n]=deepClone(e)}));else if("object"==typeof e)if(e.nodeType&&"function"==typeof e.cloneNode)var t=e.cloneNode(!0);else if(e.prototype)t=e;else if(e instanceof Date)t=new Date(e);else for(var n in t={},e)t[n]=deepClone(e[n]);else t=e;return t}function wordwrap(e,t,n=!1){if(!e)return e;var r=".{1,"+(t=t||75)+"}(\\s|$)|.{"+t+"}|.+$";if(n){splitNewlines=e.split("\\n");var o=[];return splitNewlines.forEach((e=>{o=o.concat(e.match(RegExp(r,"g")))})),o}return e.match(RegExp(r,"g"))}var splitMessage=[];function drawMessageScreen(){if(tryLoadCustomFont(),titleMode=0,textMode=!0,"text_message_continue"in state.metadata){titleImage=deepClone(messagecontainer_template);for(var e=0;e<titleImage.length;e++)titleImage[e]=titleImage[e].replace(/\./g," ");titleImage[10]=state.metadata.text_message_continue}else{titleImage=IsMouseGameInputEnabled()?deepClone(messagecontainer_template_mouse):deepClone(messagecontainer_template);for(e=0;e<titleImage.length;e++)titleImage[e]=titleImage[e].replace(/\./g," ")}var t=titleImage[9],n=titleImage[10];titleImage[10]=t;var r,o=titleImage[0].length;""===messagetext?r=state.levels[curlevel].message.trim():r=messagetext;var i=5-((splitMessage=wordwrap(r,titleImage[0].length,!0)).length/2|0);i<0&&(i=0);var s=Math.min(splitMessage.length,12);for(e=0;e<s;e++)if(splitMessage[e]){var a=splitMessage[e].trimRight(),l=i+e,c=a.length,u=(o-c)/2|0;if(state.metadata.message_text_align){var d=state.metadata.message_text_align.toLowerCase();"left"==d?u=0:"right"==d&&(u=o-c)}var h=titleImage[l];titleImage[l]=h.slice(0,u)+a+h.slice(u+a.length)}var p=10;s>=10&&(p=s<12?s+1:12),titleImage[p]=quittingMessageScreen?t:n,canvasResize()}var loadedLevelSeed=0;function loadLevelFromLevelDat(e,t,n,r){if(null==n&&(n=(Math.random()+Date.now()).toString()),RandomGen=new RNG(loadedLevelSeed=n),forceRegenImages=!0,ignoreNotJustPressedAction=!0,titleScreen=!1,titleMode=showContinueOptionOnTitleScreen()?1:0,titleSelection=0,titleSelected=!1,dragging=!1,rightdragging=!1,e.metadata=deepClone(e.default_metadata),againing=!1,void 0===t)return consolePrint("Trying to access a level that doesn't exist.",!0),void goToTitleScreen();void 0!==t.message?(ignoreNotJustPressedAction=!0,tryPlayShowMessageSound(),twiddleMetadataExtras(),drawMessageScreen(),canvasResize(),clearInputHistory()):void 0!==t.target?(setSectionSolved(e.levels[Number(curlevel)].section),gotoLevel(t.target)):(consolePrint("level loading"),titleMode=0,textMode=!1,level=t.clone(),RebuildLevelArrays(),void 0!==e&&(void 0!==e.metadata.flickscreen?oldflickscreendat=[0,0,Math.min(e.metadata.flickscreen[0],level.width),Math.min(e.metadata.flickscreen[1],level.height)]:void 0!==e.metadata.zoomscreen?oldflickscreendat=[0,0,Math.min(e.metadata.zoomscreen[0],level.width),Math.min(e.metadata.zoomscreen[1],level.height)]:void 0!==e.metadata.smoothscreen&&(oldflickscreendat=[0,0,Math.min(e.metadata.smoothscreen.screenSize.width,level.width),Math.min(e.metadata.smoothscreen.screenSize.height,level.height)])),initSmoothCamera(),twiddleMetadataExtras(),backups=[],restartTarget=backupLevel(),keybuffer=[],"run_rules_on_level_start"in e.metadata&&(runrulesonlevelstart_phase=!0,processInput(-1,!0),runrulesonlevelstart_phase=!1)),!0===r&&clearInputHistory()}function loadLevelFromStateTarget(e,t,n,r){curlevel=t,curlevelTarget=n,void 0===n.message&&tryPlayStartLevelSound(),consolePrint("level index = "+t+", target = "+n),loadLevelFromLevelDat(e,e.levels[t],r),restoreLevel(n,!0),restartTarget=n}function loadLevelFromState(e,t,n){var r=e.levels[t];curlevel=t,curlevelTarget=null,void 0!==r&&void 0===r.message&&(document.dispatchEvent(new CustomEvent("psplusLevelLoaded",{detail:t})),tryPlayStartLevelSound()),loadLevelFromLevelDat(e,r,n)}var sprites=[{color:"#423563",dat:[[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]]},{color:"#252342",dat:[[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,1,1,1,0],[0,1,0,1,0]]}];function tryLoadCustomFont(){null==state||null==state.metadata||null==state.metadata.custom_font||loadedCustomFont||new FontFace("PuzzleCustomFont","url("+state.metadata.custom_font+")").load().then((function(e){document.fonts.add(e),loadedCustomFont=!0,canvasResize(),redraw()})).catch((function(e){alert("Unable to load font!")}))}function tryPlaySimpleSound(e){if(void 0!==state.sfx_Events[e]){var t=state.sfx_Events[e];"sfx10"==e||"sfx11"==e||"sfx12"==e||"sfx13"==e||"endlevel"==e||"startgame"==e||"sfx2"==e||"sfx4"==e||"sfx5"==e||"sfx1"==e||"sfx6"==e?playQuietSound(t):"closemessage"==e?playLoudSound(t):playSound(t)}}function tryPlayTitleSound(){tryPlaySimpleSound("titlescreen")}function tryPlayStartGameSound(){tryPlaySimpleSound("startgame")}function tryPlayEndGameSound(){tryPlaySimpleSound("endgame")}function tryPlayCancelSound(){tryPlaySimpleSound("cancel")}function tryPlayStartLevelSound(){tryPlaySimpleSound("startlevel")}function tryPlayEndLevelSound(){tryPlaySimpleSound("endlevel")}function tryPlayEnterLevelSelectSound(){tryPlaySimpleSound("enterlevelselect")}function tryPlayUndoSound(){tryPlaySimpleSound("undo")}function tryPlayRestartSound(){tryPlaySimpleSound("restart")}function tryPlayShowMessageSound(){tryPlaySimpleSound("showmessage")}function tryPlayCloseMessageSound(){tryPlaySimpleSound("closemessage")}loadedCustomFont=!1,tryLoadCustomFont(),generateTitleScreen(),titleSelection=0,canvasResize();var restartTarget,backups=[];function backupLevel(){var e={dat:new Int32Array(level.objects),width:level.width,height:level.height,oldflickscreendat:oldflickscreendat.concat([]),cameraPositionTarget:Object.assign({},cameraPositionTarget)};if(void 0!==state.metadata.runtime_metadata_twiddling){var t=deepClone(state.metadata);delete t.custom_font,e.metadata=t}return e}function level4Serialization(){return{dat:Array.from(level.objects),width:level.width,height:level.height,oldflickscreendat:oldflickscreendat.concat([]),cameraPositionTarget:Object.assign({},cameraPositionTarget)}}function tryDeactivateYoutube(){var e=document.getElementById("youtubeFrame");e&&document.body.removeChild(e)}function tryActivateYoutube(){if(!document.getElementById("youtubeFrame")&&canYoutube&&"youtube"in state.metadata){var e=state.metadata.youtube,t="https://www.youtube.com/embed/"+e+"?autoplay=1&loop=1&playlist="+e;(ifrm=document.createElement("IFRAME")).setAttribute("src",t),ifrm.setAttribute("id","youtubeFrame"),ifrm.style.visibility="hidden",ifrm.style.width="500px",ifrm.style.height="500px",ifrm.style.position="absolute",ifrm.style.top="-1000px",ifrm.style.left="-1000px",document.body.appendChild(ifrm)}}function setGameState(e,t,n){for(var r in oldflickscreendat=[],timer=0,autotick=0,winning=!1,againing=!1,messageselected=!1,STRIDE_MOV=e.STRIDE_MOV,STRIDE_OBJ=e.STRIDE_OBJ,sfxCreateMask=new BitVec(STRIDE_OBJ),sfxDestroyMask=new BitVec(STRIDE_OBJ),void 0===t&&(t=["restart"]),(0===state.levels.length||0===e.levels.length)&&t.length>0&&"rebuild"===t[0]&&(t=["restart"]),void 0===n&&(n=null),RandomGen=new RNG(n),state=e,"rebuild"!==t[0]&&(backups=[]),sprites=[],state.objects)if(state.objects.hasOwnProperty(r)){var o=state.objects[r],i={colors:o.colors,dat:o.spritematrix};sprites[o.id]=i}switch(void 0!==state.metadata.realtime_interval?(autotick=0,autotickinterval=1e3*state.metadata.realtime_interval):(autotick=0,autotickinterval=0),repeatinterval=void 0!==state.metadata.key_repeat_interval?1e3*state.metadata.key_repeat_interval:150,tweeninterval=void 0!==state.metadata.tween_length?1e3*state.metadata.tween_length:0,againinterval=void 0!==state.metadata.again_interval?1e3*state.metadata.again_interval:150,throttle_movement&&0===autotickinterval&&logWarning("throttle_movement is designed for use in conjunction with realtime_interval. Using it in other situations makes games gross and unresponsive, broadly speaking.  Please don't."),norepeat_action=void 0!==state.metadata.norepeat_action,storage_remove(document.URL+"_checkpoint"),storage_remove(document.URL),t[0]){case"restart":if(1==restarting){logWarning('A "restart" command is being triggered in the "run_rules_on_level_start" section of level creation, which would cause an infinite loop if it was actually triggered, but it\'s being ignored, so it\'s not.');break}winning=!1,timer=0,titleScreen=!0,tryPlayTitleSound(),textMode=!0,titleSelection=0,titleSelected=!1,quittingMessageScreen=!1,quittingTitleScreen=!1,messageselected=!1,titleMode=0,showContinueOptionOnTitleScreen()&&(titleMode=1),void 0!==state.metadata.skip_title_screen?(consolePrint("skip_title_screen enabled, proceeding to do exactly as it says on the tin."),void 0!==state.metadata.continue_is_level_select?gotoLevelSelectScreen():titleMode<=1?nextLevel():2==titleMode&&gotoLevel(titleSelection)):(titleMode=7,playPreIntro());break;case"rebuild":break;case"loadFirstNonMessageLevel":for(var s=0;s<state.levels.length;s++)if(!state.levels[s].hasOwnProperty("message")){curlevel=a=s,curlevelTarget=null,winning=!1,timer=0,titleScreen=!1,textMode=!1,titleSelected=!1,quittingMessageScreen=!1,quittingTitleScreen=!1,messageselected=!1,titleMode=0,loadLevelFromState(state,a,n);break}break;case"loadLevel":consolePrint("loading a level");var a=t[1];curlevel=a,curlevelTarget=null,winning=!1,timer=0,titleScreen=!1,textMode=!1,titleSelected=!1,quittingMessageScreen=!1,quittingTitleScreen=!1,messageselected=!1,titleMode=0,loadLevelFromState(state,a,n);break;case"levelline":var l=t[1];for(s=state.levels.length-1;s>=0;s--){if(state.levels[s].lineNumber<=l+1){curlevel=s,curlevelTarget=null,winning=!1,timer=0,titleScreen=!1,textMode=!1,titleSelected=!1,quittingMessageScreen=!1,quittingTitleScreen=!1,messageselected=!1,titleMode=0,loadLevelFromState(state,s);break}}}"rebuild"!==t[0]&&clearInputHistory(),canvasResize(),0==state.sounds.length&&null==state.metadata.youtube?killAudioButton():showAudioButton()}function RebuildLevelArrays(){level.movements=new Int32Array(level.n_tiles*STRIDE_MOV),level.rigidMovementAppliedMask=[],level.rigidGroupIndexMask=[],level.rowCellContents=[],level.rowCellContents_Movements=[],level.colCellContents=[],level.colCellContents_Movements=[],level.mapCellContents=new BitVec(STRIDE_OBJ),level.mapCellContents_Movements=new BitVec(STRIDE_MOV),_movementVecs=[new BitVec(STRIDE_MOV),new BitVec(STRIDE_MOV),new BitVec(STRIDE_MOV)],_o1=new BitVec(STRIDE_OBJ),_o2=new BitVec(STRIDE_OBJ),_o2_5=new BitVec(STRIDE_OBJ),_o3=new BitVec(STRIDE_OBJ),_o4=new BitVec(STRIDE_OBJ),_o5=new BitVec(STRIDE_OBJ),_o6=new BitVec(STRIDE_OBJ),_o7=new BitVec(STRIDE_OBJ),_o8=new BitVec(STRIDE_OBJ),_o9=new BitVec(STRIDE_OBJ),_o10=new BitVec(STRIDE_OBJ),_o11=new BitVec(STRIDE_OBJ),_o12=new BitVec(STRIDE_OBJ),_m1=new BitVec(STRIDE_MOV),_m2=new BitVec(STRIDE_MOV),_m3=new BitVec(STRIDE_MOV);for(var e=0;e<level.height;e++)level.rowCellContents[e]=new BitVec(STRIDE_OBJ);for(e=0;e<level.width;e++)level.colCellContents[e]=new BitVec(STRIDE_OBJ);for(e=0;e<level.height;e++)level.rowCellContents_Movements[e]=new BitVec(STRIDE_MOV);for(e=0;e<level.width;e++)level.colCellContents_Movements[e]=new BitVec(STRIDE_MOV);for(e=0;e<level.n_tiles;e++)level.rigidMovementAppliedMask[e]=new BitVec(STRIDE_MOV),level.rigidGroupIndexMask[e]=new BitVec(STRIDE_MOV)}var messagetext="",currentMovedEntities={},newMovedEntities={};function restoreLevel(e,t,n=!0,r=!0){var o=e.hasOwnProperty("diff");if(oldflickscreendat=e.oldflickscreendat.concat([]),n&&(currentMovedEntities={}),o)for(var i=0;i<e.dat.length;){var s=e.dat[i],a=e.dat[i+1];if(0===a)break;for(j=0;j<a;j++)level.objects[s+j]=e.dat[i+2+j];i+=2+a}else level.objects=new Int32Array(e.dat);if(level.width!==e.width||level.height!==e.height)level.width=e.width,level.height=e.height,level.n_tiles=e.width*e.height,RebuildLevelArrays();else{for(var l=0;l<level.n_tiles;l++)level.movements[l]=0,level.rigidMovementAppliedMask[l]=0,level.rigidGroupIndexMask[l]=0;for(l=0;l<level.height;l++){level.rowCellContents[l].setZero()}for(l=0;l<level.width;l++){level.colCellContents[l].setZero()}}e.cameraPositionTarget&&(cameraPositionTarget=Object.assign({},e.cameraPositionTarget),t&&(cameraPosition=Object.assign({},cameraPositionTarget))),void 0!==state.metadata.runtime_metadata_twiddling&&(void 0===e.metadata&&(e.metadata=deepClone(state.default_metadata),consolePrint("RUNTIME METADATA TWIDDLING: Reloaded level state that did not have saved metadata. Likely this state was recovered from a CHECKPOINT. Using the default metadata instead.",!0)),state.metadata=deepClone(e.metadata),twiddleMetadataExtras(r)),againing=!1,level.commandQueue=[],level.commandQueueSourceRules=[]}var zoomscreen=!1,flickscreen=!1,smoothscreen=!1,screenwidth=0,screenheight=0;function consolidateDiff(e,t){if(e.width!==t.width||e.height!==t.height||e.dat.length!==t.dat.length)return e;if(e.hasOwnProperty("diff")||t.hasOwnProperty("diff"))return e;if(e.dat.length<1024)return e;for(var n=new Int32Array(128),r=0,o=!1,i=-1,s=e.dat,a=t.dat,l=0;l<s.length;l++)if(!1===o){if(s[l]!==a[l]){if(o=!0,i=r,n.length<r+4)(c=new Int32Array(2*n.length)).set(n),n=c;n[r+0]=l,n[r+1]=1,n[r+2]=s[l],r+=3}}else if(s[l]!==a[l]){var c;if(r+1>=n.length)if(n.length<r+4)(c=new Int32Array(2*n.length)).set(n),n=c;n[i+1]++,n[r]=s[l],r++}else o=!1;return{diff:!0,dat:n,width:e.width,height:e.height,oldflickscreendat:e.oldflickscreendat}}function addUndoState(e){backups.push(e),backups.length>2&&!backups[backups.length-1].hasOwnProperty("diff")&&(backups[backups.length-3]=consolidateDiff(backups[backups.length-3],backups[backups.length-2]))}function DoRestart(e){!0!==restarting&&(!0!==e&&"norestart"in state.metadata||(restarting=!0,!0!==e&&addUndoState(backupLevel()),verbose_logging&&consolePrint("--- restarting ---",!0),restoreLevel(restartTarget,!0),tryPlayRestartSound(),document.dispatchEvent(new CustomEvent("psplusLevelRestarted",{detail:curlevel})),"run_rules_on_level_start"in state.metadata&&processInput(-1,!0),twiddleMetadataExtras(),level.commandQueue=[],level.commandQueueSourceRules=[],restarting=!1))}function backupDiffers(){if(0==backups.length)return!0;var e=backups[backups.length-1];if(e.hasOwnProperty("diff"))return 0!==e.dat.length&&0!==e.dat[1];for(var t=0;t<level.objects.length;t++)if(level.objects[t]!==e.dat[t])return!0;return!1}function DoUndo(e,t,n=!0,r=!0){if(levelEditorOpened||!("noundo"in state.metadata)||!0===e){if(verbose_logging&&consolePrint("--- undoing ---",!0),t)for(;0==backupDiffers();)backups.pop();if(backups.length>0)restoreLevel(backups[backups.length-1],null,n,r),backups=backups.splice(0,backups.length-1),e||tryPlayUndoSound()}}function getPlayerPositions(){var e=[],t=state.playerMask;for(i=0;i<level.n_tiles;i++)level.getCellInto(i,_o11),t.anyBitsInCommon(_o11)&&e.push(i);return e}function getLayersOfMask(e){for(var t=[],n=0;n<state.objectCount;n++)if(e.get(n)){var r=state.idDict[n],o=state.objects[r];t.push(o.layer)}return t}function moveEntitiesAtIndex(e,t,n){var r=level.getCell(e);r.iand(t);for(var o=getLayersOfMask(r),i=level.getMovements(e),s=0;s<o.length;s++)i.ishiftor(n,5*o[s]);level.setMovements(e,i);var a=e/level.height|0,l=e%level.height;level.colCellContents_Movements[a].ior(i),level.rowCellContents_Movements[l].ior(i),level.mapCellContents_Movements.ior(i)}function startMovement(e){for(var t=getPlayerPositions(),n=0;n<t.length;n++){moveEntitiesAtIndex(t[n],state.playerMask,e)}return t}var _movementVecs,dirMasksDelta={1:[0,-1],2:[0,1],4:[-1,0],8:[1,0],15:[0,0],16:[0,0],3:[0,0]},dirMaskName={1:"up",2:"down",4:"left",8:"right",15:"?",16:"action",3:"no"},seedsToPlay_CanMove=[],seedsToPlay_CantMove=[];function repositionEntitiesOnLayer(e,t,n){var r=dirMasksDelta[n],o=r[0],i=r[1],s=e/level.height|0,a=e%level.height,l=level.width-1,c=level.height-1;if(0===s&&o<0||s===l&&o>0||0===a&&i<0||a===c&&i>0)return!1;var u=e+r[1]+r[0]*level.height,d=state.layerMasks[t],h=level.getCellInto(u,_o7),p=level.getCellInto(e,_o8);if(d.anyBitsInCommon(h)&&16!=n)return!1;for(var f=0;f<state.sfx_MovementMasks.length;f++){var g=state.sfx_MovementMasks[f];if(g.objectMask.anyBitsInCommon(p)){var m=level.getMovements(e),v=g.directionMask;m.anyBitsInCommon(v)&&-1===seedsToPlay_CanMove.indexOf(g.seed)&&seedsToPlay_CanMove.push(g.seed)}}var y=p.clone();p.iclear(d),y.iand(d),h.ior(y),level.setCell(e,p),level.setCell(u,h);var _=u/level.height|0,b=u%level.height;return level.colCellContents[_].ior(y),level.rowCellContents[b].ior(y),level.mapCellContents.ior(y),!0}function repositionEntitiesAtCell(e){var t=level.getMovements(e);if(t.iszero())return!1;for(var n=!1,r=0;r<level.layerCount;r++){var o=t.getshiftor(31,5*r);if(0!==o)if(repositionEntitiesOnLayer(e,r,o)){if(state.metadata.tween_length){var i=dirMasksDelta[o],s=e+i[1]+i[0]*level.height;newMovedEntities["p"+s+"-l"+r]=o}t.ishiftclear(o,5*r),n=!0}}return level.setMovements(e,t),n}function Level(e,t,n,r,o,i){this.lineNumber=e,this.width=t,this.height=n,this.n_tiles=t*n,this.objects=o,this.section=i,this.layerCount=r,this.commandQueue=[],this.commandQueueSourceRules=[]}Level.prototype.delta_index=function(e){const[t,n]=dirMasksDelta[e];return t*this.height+n},Level.prototype.clone=function(){var e=new Level(this.lineNumber,this.width,this.height,this.layerCount,null,this.section);return e.objects=new Int32Array(this.objects),e},Level.prototype.getCell=function(e){return new BitVec(this.objects.subarray(e*STRIDE_OBJ,e*STRIDE_OBJ+STRIDE_OBJ))},Level.prototype.getCellInto=function(e,t){for(var n=0;n<STRIDE_OBJ;n++)t.data[n]=this.objects[e*STRIDE_OBJ+n];return t},Level.prototype.setCell=function(e,t){for(var n=0;n<t.data.length;++n)this.objects[e*STRIDE_OBJ+n]=t.data[n]};var _movementVecIndex=0;Level.prototype.getMovements=function(e){var t=_movementVecs[_movementVecIndex];_movementVecIndex=(_movementVecIndex+1)%_movementVecs.length;for(var n=0;n<STRIDE_MOV;n++)t.data[n]=this.movements[e*STRIDE_MOV+n];return t},Level.prototype.getMovementsInto=function(e,t){for(var n=t,r=0;r<STRIDE_MOV;r++)n.data[r]=this.movements[e*STRIDE_MOV+r];return n},Level.prototype.setMovements=function(e,t){for(var n=0;n<t.data.length;++n)this.movements[e*STRIDE_MOV+n]=t.data[n];var r=e/this.height|0,o=e%this.height;level.colCellContents_Movements[r].ior(t),level.rowCellContents_Movements[o].ior(t),level.mapCellContents_Movements.ior(t)};var ellipsisPattern=["ellipsis"];function BitVec(e){return this.data=new Int32Array(e),this}function Rule(e){this.direction=e[0],this.patterns=e[1],this.hasReplacements=e[2],this.lineNumber=e[3],this.isEllipsis=e[4],this.groupNumber=e[5],this.isRigid=e[6],this.commands=e[7],this.isRandom=e[8],this.cellRowMasks=e[9],this.cellRowMasks_Movements=e[10],this.isGlobal=e[11],this.ruleMask=this.cellRowMasks.reduce(((e,t)=>(e.ior(t),e)),new BitVec(STRIDE_OBJ)),this.cellRowMatches=[];for(var t=0;t<this.patterns.length;t++)this.cellRowMatches.push(this.generateCellRowMatchesFunction(this.patterns[t],this.isEllipsis[t]))}BitVec.prototype.cloneInto=function(e){for(var t=0;t<this.data.length;++t)e.data[t]=this.data[t];return e},BitVec.prototype.clone=function(){return new BitVec(this.data)},BitVec.prototype.iand=function(e){for(var t=0;t<this.data.length;++t)this.data[t]&=e.data[t]},BitVec.prototype.inot=function(){for(var e=0;e<this.data.length;++e)this.data[e]=~this.data[e]},BitVec.prototype.ior=function(e){for(var t=0;t<this.data.length;++t)this.data[t]|=e.data[t]},BitVec.prototype.iclear=function(e){for(var t=0;t<this.data.length;++t)this.data[t]&=~e.data[t]},BitVec.prototype.ibitset=function(e){this.data[e>>5]|=1<<(31&e)},BitVec.prototype.ibitclear=function(e){this.data[e>>5]&=~(1<<(31&e))},BitVec.prototype.get=function(e){return 0!=(this.data[e>>5]&1<<(31&e))},BitVec.prototype.getshiftor=function(e,t){var n=31&t,r=this.data[t>>5]>>>n;return n&&(r|=this.data[1+(t>>5)]<<32-n),r&e},BitVec.prototype.ishiftor=function(e,t){var n=31&t,r=e<<n;if(this.data[t>>5]|=r,n){var o=e>>32-n;this.data[1+(t>>5)]|=o}},BitVec.prototype.ishiftclear=function(e,t){var n=31&t,r=e<<n;if(this.data[t>>5]&=~r,n){var o=e>>32-(31&t);this.data[1+(t>>5)]&=~o}},BitVec.prototype.equals=function(e){if(this.data.length!==e.data.length)return!1;for(var t=0;t<this.data.length;++t)if(this.data[t]!==e.data[t])return!1;return!0},BitVec.prototype.setZero=function(){for(var e=0;e<this.data.length;++e)this.data[e]=0},BitVec.prototype.iszero=function(){for(var e=0;e<this.data.length;++e)if(this.data[e])return!1;return!0},BitVec.prototype.bitsSetInArray=function(e){for(var t=0;t<this.data.length;++t)if((this.data[t]&e[t])!==this.data[t])return!1;return!0},BitVec.prototype.bitsClearInArray=function(e){for(var t=0;t<this.data.length;++t)if(this.data[t]&e[t])return!1;return!0},BitVec.prototype.anyBitsInCommon=function(e){return!this.bitsClearInArray(e.data)},Rule.prototype.generateCellRowMatchesFunction=function(e,t){if(0==t){for(var n=e.length,r="",o=1===STRIDE_OBJ?"":"*"+STRIDE_OBJ,i=0;i<STRIDE_OBJ;++i)r+="var cellObjects"+i+" = objects[i"+o+(i?"+"+i:"")+"];\n";o=1===STRIDE_MOV?"":"*"+STRIDE_MOV;for(i=0;i<STRIDE_MOV;++i)r+="var cellMovements"+i+" = movements[i"+o+(i?"+"+i:"")+"];\n";r+="return "+e[0].generateMatchString("0_");for(var s=1;s<n;s++)r+="&&cellRow["+s+"].matches(i+"+s+"*d, objects, movements)";return(r+=";")in matchCache?matchCache[r]:matchCache[r]=new Function("cellRow","i","d","objects","movements",r)}n=e.length,r="var result = [];\n";r+="if(cellRow[0].matches(i, objects, movements)";for(s=1;e[s]!==ellipsisPattern;s++)r+="&&cellRow["+s+"].matches(i+"+s+"*d, objects, movements)";for(r+=") {\n",r+="\tfor (var k=kmin;k<kmax;k++) {\n",r+="\t\tif(cellRow["+ ++s+"].matches((i+d*(k+"+(s-1)+")), objects, movements)",s++;s<n;s++)r+="&&cellRow["+s+"].matches((i+d*(k+"+(s-1)+")), objects, movements)";return r+="){\n",r+="\t\t\tresult.push([i,k]);\n",r+="\t\t}\n",r+="\t}\n",r+="}\n",(r+="return result;")in matchCache?matchCache[r]:matchCache[r]=new Function("cellRow","i","kmax","kmin","d","objects","movements",r)},Rule.prototype.toJSON=function(){return[this.direction,this.patterns,this.hasReplacements,this.lineNumber,this.isEllipsis,this.groupNumber,this.isRigid,this.commands,this.isRandom,this.cellRowMasks,this.cellRowMasks_Movements]};var STRIDE_OBJ=1,STRIDE_MOV=1;function CellPattern(e){this.objectsPresent=e[0],this.objectsMissing=e[1],this.anyObjectsPresent=e[2],this.movementsPresent=e[3],this.movementsMissing=e[4],this.matches=this.generateMatchFunction(),this.replacement=e[5]}function CellReplacement(e){this.objectsClear=e[0],this.objectsSet=e[1],this.movementsClear=e[2],this.movementsSet=e[3],this.movementsLayerMask=e[4],this.randomEntityMask=e[5],this.randomDirMask=e[6]}var _o1,_o2,_o2_5,_o3,_o4,_o5,_o6,_o7,_o8,_o9,_o10,_o11,_o12,_m1,_m2,_m3,matchCache={};function matchCellRow(e,t,n,r,o,i,s){var a=[];if(!r.bitsSetInArray(level.mapCellContents.data)||!o.bitsSetInArray(level.mapCellContents_Movements.data))return a;if(s||void 0===state.metadata.local_radius)xmin=0,xmax=level.width,ymin=0,ymax=level.height;else{var l=parseInt(state.metadata.local_radius);xmin=Math.max(0,(playerPositions[0]/level.height|0)-l),xmax=Math.min(level.width,(playerPositions[0]/level.height|0)+l+1),ymin=Math.max(0,playerPositions[0]%level.height-l),ymax=Math.min(level.height,playerPositions[0]%level.height+l+1)}var c=n.length;switch(e){case 1:ymin+=c-1;break;case 2:ymax-=c-1;break;case 4:xmin+=c-1;break;case 8:xmax-=c-1;break;default:window.console.log("EEEP "+e)}if(e>2){for(var u=ymin;u<ymax;u++)if(r.bitsSetInArray(level.rowCellContents[u].data)&&o.bitsSetInArray(level.rowCellContents_Movements[u].data))for(var d=xmin;d<xmax;d++){t(n,h=d*level.height+u,i,level.objects,level.movements)&&a.push(h)}}else for(d=xmin;d<xmax;d++)if(r.bitsSetInArray(level.colCellContents[d].data)&&o.bitsSetInArray(level.colCellContents_Movements[d].data))for(u=ymin;u<ymax;u++){var h;t(n,h=d*level.height+u,i,level.objects,level.movements)&&a.push(h)}return a}function matchCellRowWildCard(e,t,n,r,o,i){var s=[];if(!r.bitsSetInArray(level.mapCellContents.data)||!o.bitsSetInArray(level.mapCellContents_Movements.data))return s;var a=0,l=level.width,c=0,u=level.height,d=n.length-1;switch(e){case 1:c+=d-1;break;case 2:u-=d-1;break;case 4:a+=d-1;break;case 8:l-=d-1;break;default:window.console.log("EEEP2 "+e)}if(e>2){for(var h=c;h<u;h++)if(r.bitsSetInArray(level.rowCellContents[h].data)&&o.bitsSetInArray(level.rowCellContents_Movements[h].data))for(var p=a;p<l;p++){var f=p*level.height+h;4===e?g=p-d+2:8===e?g=level.width-(p+d)+1:window.console.log("EEEP2 "+e),s.push.apply(s,t(n,f,g,0,i,level.objects,level.movements))}}else for(p=a;p<l;p++)if(r.bitsSetInArray(level.colCellContents[p].data)&&o.bitsSetInArray(level.colCellContents_Movements[p].data))for(h=c;h<u;h++){var g;f=p*level.height+h;2===e?g=level.height-(h+d)+1:1===e?g=h-d+2:window.console.log("EEEP2 "+e),s.push.apply(s,t(n,f,g,0,i,level.objects,level.movements))}return s}function generateTuples(e){for(var t=[[]],n=0;n<e.length;n++){for(var r=e[n],o=[],i=0;i<r.length;i++)for(var s=r[i],a=0;a<t.length;a++){var l=t[a].concat([s]);o.push(l)}t=o}return t}function twiddleMetadataExtras(e=!0){void 0!==state.metadata.realtime_interval?(e&&(autotick=0),autotickinterval=1e3*state.metadata.realtime_interval):(autotick=0,autotickinterval=0),againinterval=void 0!==state.metadata.again_interval?1e3*state.metadata.again_interval:150,tweeninterval=void 0!==state.metadata.tween_length?Math.max(1e3*state.metadata.tween_length,0):0,repeatinterval=void 0!==state.metadata.key_repeat_interval?1e3*state.metadata.key_repeat_interval:150,"background_color"in state.metadata?state.bgcolor=colorToHex(colorPalette,state.metadata.background_color):state.bgcolor="#000000","text_color"in state.metadata?state.fgcolor=colorToHex(colorPalette,state.metadata.text_color):state.fgcolor="#FFFFFF"}function showTempMessage(){solving||(keybuffer=[],textMode=!0,titleScreen=!1,quittingMessageScreen=!1,messageselected=!1,ignoreNotJustPressedAction=!0,tryPlayShowMessageSound(),drawMessageScreen(),canvasResize())}function processOutputCommands(e){for(var t=0;t<e.length;t++){var n=e[t];"f"===n.charAt(1)&&tryPlaySimpleSound(n),!1===unitTesting&&"message"===n&&showTempMessage()}}function applyRandomRuleGroup(e,t){for(var n=[],r=0;r<t.length;r++){var o=(c=t[r]).findMatches();if(o.length>0)for(var i=generateTuples(o),s=0;s<i.length;s++){var a=i[s];n.push([r,a])}}if(0===n.length)return!1;var l=n[Math.floor(RandomGen.uniform()*n.length)],c=t[r=l[0]];a=l[1];const u=e.delta_index(c.direction);var d=c.applyAt(e,a,!1,u);return c.queueCommands(),d}function applyRuleGroup(e){if(e[0].isRandom)return applyRandomRuleGroup(level,e);for(var t=!1,n=!0,r=0,o=-1;n;){if(++r>200){logErrorCacheable("Got caught looping lots in a rule group :O",e[0].lineNumber,!0);break}n=!1;for(var i=0;i<e.length;i++){if(e[i].tryApply(level)?(n=!0,o=0):o++,o===e.length)break}n&&(t=!0,verbose_logging&&(debugger_turnIndex++,addToDebugTimeline(level,-2)))}return t}function applyRules(e,t,n,r){playerPositions=getPlayerPositions();for(var o=n>0,i=0,s=n;s<e.length;){if(r&&r[s]);else o=applyRuleGroup(e[s])||o;if(o&&void 0!==t[s]){if(s=t[s],o=!1,++i>200){logErrorCacheable("got caught in an endless startloop...endloop vortex, escaping!",e[s][0].lineNumber,!0);break}verbose_logging&&(debugger_turnIndex++,addToDebugTimeline(level,-2))}else{if(++s===e.length&&o&&void 0!==t[s]&&(s=t[s],o=!1,++i>200)){logErrorCacheable("got caught in an endless startloop...endloop vortex, escaping!",e[s][0].lineNumber,!0);break}verbose_logging&&(debugger_turnIndex++,addToDebugTimeline(level,-2))}}}function resolveMovements(e,t){for(var n=!0;n;){n=!1;for(var r=0;r<e.n_tiles;r++)n=repositionEntitiesAtCell(r)||n}var o=!1;for(r=0;r<e.n_tiles;r++){var i=e.getCellInto(r,_o6),s=e.getMovements(r);if(!s.iszero()){var a=e.rigidMovementAppliedMask[r];if(0!==a&&(s.iand(a),!s.iszero()))for(var l=0;l<e.layerCount;l++){if(0!==s.getshiftor(31,5*l)){var c=e.rigidGroupIndexMask[r].getshiftor(31,5*l);c--,t[state.rigidGroupIndex_to_GroupIndex[c]]=!0,o=!0;break}}for(l=0;l<state.sfx_MovementFailureMasks.length;l++){var u=state.sfx_MovementFailureMasks[l];if(u.objectMask.anyBitsInCommon(i)){var d=u.directionMask;s.anyBitsInCommon(d)&&-1===seedsToPlay_CantMove.indexOf(u.seed)&&seedsToPlay_CantMove.push(u.seed)}}}for(l=0;l<STRIDE_MOV;l++)e.movements[l+r*STRIDE_MOV]=0;e.rigidGroupIndexMask[r]=0,e.rigidMovementAppliedMask[r]=0}return o}CellPattern.prototype.generateMatchString=function(){for(var e="(true",t=0;t<Math.max(STRIDE_OBJ,STRIDE_MOV);++t){var n="cellObjects"+t,r="cellMovements"+t,o=this.objectsPresent.data[t],i=this.objectsMissing.data[t],s=this.movementsPresent.data[t],a=this.movementsMissing.data[t];o&&(e+=o&o-1?"\t\t&& (("+n+"&"+o+")==="+o+")\n":"\t\t&& ("+n+"&"+o+")\n"),i&&(e+="\t\t&& !("+n+"&"+i+")\n"),s&&(e+=s&s-1?"\t\t&& (("+r+"&"+s+")==="+s+")\n":"\t\t&& ("+r+"&"+s+")\n"),a&&(e+="\t\t&& !("+r+"&"+a+")\n")}for(var l=0;l<this.anyObjectsPresent.length;l++){e+="\t\t&& (0";for(t=0;t<STRIDE_OBJ;++t){var c=this.anyObjectsPresent[l].data[t];c&&(e+="|(cellObjects"+t+"&"+c+")")}e+=")"}return e+="\t)"},CellPattern.prototype.generateMatchFunction=function(){for(var e="",t=1===STRIDE_OBJ?"":"*"+STRIDE_OBJ,n=0;n<STRIDE_OBJ;++n)e+="\tvar cellObjects"+n+" = objects[i"+t+(n?"+"+n:"")+"];\n";t=1===STRIDE_MOV?"":"*"+STRIDE_MOV;for(n=0;n<STRIDE_MOV;++n)e+="\tvar cellMovements"+n+" = movements[i"+t+(n?"+"+n:"")+"];\n";return(e+="return "+this.generateMatchString()+";")in matchCache?matchCache[e]:matchCache[e]=new Function("i","objects","movements",e)},CellPattern.prototype.toJSON=function(){return[this.movementMask,this.cellMask,this.nonExistenceMask,this.moveNonExistenceMask,this.moveStationaryMask,this.randomDirOrEntityMask,this.movementsToRemove]},CellPattern.prototype.replace=function(e,t){var n=this.replacement;if(null===n)return!1;var r=n.randomEntityMask,o=n.randomDirMask,i=n.objectsSet.cloneInto(_o1),s=n.objectsClear.cloneInto(_o2),a=n.movementsSet.cloneInto(_m1),l=n.movementsClear.cloneInto(_m2);if(l.ior(n.movementsLayerMask),!r.iszero()){for(var c=[],u=0;u<32*STRIDE_OBJ;u++)r.get(u)&&c.push(u);var d=c[Math.floor(RandomGen.uniform()*c.length)],h=state.idDict[d],p=state.objects[h];i.ibitset(d),s.ior(state.layerMasks[p.layer]),l.ishiftor(31,5*p.layer)}if(!o.iszero())for(var f=0;f<level.layerCount;f++)if(o.get(5*f)){var g=Math.floor(4*RandomGen.uniform());a.ibitset(g+5*f)}var m=level.getCellInto(t,_o2_5),v=level.getMovements(t),y=m.cloneInto(_o3),_=v.cloneInto(_m3);m.iclear(s),m.ior(i),v.iclear(l),v.ior(a);var b=!1,w=0,S=0;if(e.isRigid){var C=state.groupNumber_to_RigidGroupIndex[e.groupNumber];C++;for(var I=new BitVec(STRIDE_MOV),x=0;x<level.layerCount;x++)I.ishiftor(C,5*x);I.iand(n.movementsLayerMask),w=level.rigidGroupIndexMask[t]||new BitVec(STRIDE_MOV),S=level.rigidMovementAppliedMask[t]||new BitVec(STRIDE_MOV),I.bitsSetInArray(w.data)||n.movementsLayerMask.bitsSetInArray(S.data)||(w.ior(I),S.ior(n.movementsLayerMask),b=!0)}var O=!1;if(!y.equals(m)||!_.equals(v)||b){O=!0,b&&(level.rigidGroupIndexMask[t]=w,level.rigidMovementAppliedMask[t]=S);var M=m.cloneInto(_o4);M.iclear(y),sfxCreateMask.ior(M);var k=y.cloneInto(_o5);k.iclear(m),sfxDestroyMask.ior(k),level.setCell(t,m),level.setMovements(t,v);var E=t/level.height|0,N=t%level.height;level.colCellContents[E].ior(m),level.rowCellContents[N].ior(m),level.mapCellContents.ior(m),level.colCellContents_Movements[E].ior(v),level.rowCellContents_Movements[N].ior(v),level.mapCellContents_Movements.ior(v)}return O},Rule.prototype.findMatches=function(){if(!this.ruleMask.bitsSetInArray(level.mapCellContents.data))return[];const e=level.delta_index(this.direction);for(var t=[],n=this.cellRowMasks,r=this.cellRowMasks_Movements,o=0;o<this.patterns.length;o++){var i=this.patterns[o],s=this.cellRowMatches[o];if(this.isEllipsis[o])var a=matchCellRowWildCard(this.direction,s,i,n[o],r[o],e);else a=matchCellRow(this.direction,s,i,n[o],r[o],e,this.isGlobal);if(0===a.length)return[];t.push(a)}return t},Rule.prototype.directional=function(){for(var e=0;e<state.rules.length;e++)for(var t=state.rules[e],n=0,r=0;r<t.length;r++)if(this.lineNumber===t[r].lineNumber&&n++,n>1)return!0;return!1},Rule.prototype.applyAt=function(e,t,n,r){var o=this;if(n)for(var i=0;i<this.patterns.length;i++)if(this.isEllipsis[i]){if(0==this.cellRowMatches[i](this.patterns[i],t[i][0],t[i][1]+1,t[i][1],r,e.objects,e.movements).length)return!1}else if(!this.cellRowMatches[i](this.patterns[i],t[i],r,e.objects,e.movements))return!1;var s=!1;for(i=0;i<o.patterns.length;i++)for(var a=o.patterns[i],l=o.isEllipsis[i]?t[i][0]:t[i],c=0;c<a.length;c++){var u=a[c];if(u!==ellipsisPattern)s=u.replace(o,l)||s,l+=r;else l+=r*t[i][1]}if(verbose_logging&&s){var d=dirMaskName[o.direction];o.directional()||(d="");var h=addToDebugTimeline(e,o.lineNumber);consolePrint(`<font color="green">Rule <a onclick="jumpToLine(${o.lineNumber});"  href="javascript:void(0);">${o.lineNumber}</a> ${d} applied.</font>`,!1,o.lineNumber,h)}return s},Rule.prototype.tryApply=function(e){const t=e.delta_index(this.direction);var n=this.findMatches();if(0===n.length)return!1;var r=!1;if(this.hasReplacements)for(var o=generateTuples(n),i=0;i<o.length;i++){var s=o[i],a=i>0;r=this.applyAt(e,s,a,t)||r}return n.length>0&&this.queueCommands(),r},Rule.prototype.queueCommands=function(){var e=this.commands;if(0!=e.length){for(var t=level.commandQueue.indexOf("cancel")>=0,n=level.commandQueue.indexOf("restart")>=0,r=!1,o=!1,i=0;i<e.length;i++){var s=e[i][0];"cancel"===s?r=!0:"restart"===s&&(o=!0)}if(!t&&(!n||r)){(r||o)&&(level.commandQueue=[],level.commandQueueSourceRules=[],messagetext="");for(i=0;i<e.length;i++){var a=e[i];if(!(level.commandQueue.indexOf(a[0])>=0)){if(level.commandQueue.push(a[0]),level.commandQueueSourceRules.push(this),verbose_logging){var l=this.lineNumber;dirMaskName[this.direction];consolePrint('<font color="green">Rule <a onclick="jumpToLine('+l.toString()+');"  href="javascript:void(0);">'+l.toString()+"</a> triggers command "+a[0]+".</font>",!1,l,null)}if("message"===a[0]&&(messagetext=a[1]),"goto"===a[0]&&gotoLevel(a[1]),void 0!==state.metadata.runtime_metadata_twiddling&&twiddleable_params.includes(a[0])&&(value=a[1],"wipe"==value?(delete state.metadata[a[0]],value=null):"default"==value&&(value=deepClone(state.default_metadata[a[0]])),null!=value&&(state.metadata[a[0]]=value),"zoomscreen"!==a[0]&&"flickscreen"!==a[0]||(twiddleMetaData(state,!0),canvasResize()),"smoothscreen"===a[0]&&(void 0!==value?(twiddleMetaData(state,!0),initSmoothCamera()):smoothscreen=!1,canvasResize()),twiddleMetadataExtras(),void 0!==state.metadata.runtime_metadata_twiddling_debug)){var c="Metadata twiddled: Flag "+a[0]+" set to "+value;value!=a[1]&&(c+=" ("+a[1]+")"),consolePrintFromRule(c,this,!0)}}}}}};var playerPositions,playerPositionsAtTurnStart,sfxCreateMask=null,sfxDestroyMask=null,cancelDone=!1;function calculateRowColMasks(){for(var e=0;e<level.mapCellContents.length;e++)level.mapCellContents[e]=0,level.mapCellContents_Movements[e]=0;for(e=0;e<level.width;e++){level.colCellContents[e].setZero(),level.colCellContents_Movements[e].setZero()}for(e=0;e<level.height;e++){level.rowCellContents[e].setZero(),level.rowCellContents_Movements[e].setZero()}for(e=0;e<level.width;e++)for(var t=0;t<level.height;t++){var n=t+e*level.height,r=level.getCellInto(n,_o9);level.mapCellContents.ior(r),level.rowCellContents[t].ior(r),level.colCellContents[e].ior(r);var o=level.getMovementsInto(n,_m1);level.mapCellContents_Movements.ior(o),level.rowCellContents_Movements[t].ior(o),level.colCellContents_Movements[e].ior(o)}}function processInput(e,t,n,r){n||(newMovedEntities={});var o=e;if(againing=!1,null==r&&(r=backupLevel()),playerPositions=[],playerPositionsAtTurnStart=getPlayerPositions(),e<=5){if(verbose_logging&&(debugger_turnIndex++,addToDebugTimeline(level,-2)),e>=0&&e<=4){switch(e){case 0:e=parseInt("00001",2);break;case 1:e=parseInt("00100",2);break;case 2:e=parseInt("00010",2);break;case 3:e=parseInt("01000",2);break;case 4:e=parseInt("10000",2)}playerPositions=startMovement(e)}if(verbose_logging){consolePrint("Applying rules");var i=addToDebugTimeline(level,-1);consolePrint(-1===e?"Turn starts with no input.":`Turn starts with input of ${["up","left","down","right","action","mouse"][o]}.`,!1,null,i)}bannedGroup=[],level.commandQueue=[],level.commandQueueSourceRules=[];var s=0,a=!1;const b={objects:new Int32Array(level.objects),movements:new Int32Array(level.movements),rigidGroupIndexMask:level.rigidGroupIndexMask.concat([]),rigidMovementAppliedMask:level.rigidMovementAppliedMask.concat([]),commandQueue:[],commandQueueSourceRules:[]};sfxCreateMask.setZero(),sfxDestroyMask.setZero(),seedsToPlay_CanMove=[],seedsToPlay_CantMove=[],calculateRowColMasks();var l=0;do{if(a=!1,l++,applyRules(state.rules,state.loopPoint,s,bannedGroup),resolveMovements(level,bannedGroup))a=!0,consolePrint("Rigid movement application failed. Rolling back..."),level.objects=new Int32Array(b.objects),level.movements=new Int32Array(b.movements),level.rigidGroupIndexMask=b.rigidGroupIndexMask.concat([]),level.rigidMovementAppliedMask=b.rigidMovementAppliedMask.concat([]),level.commandQueue=b.commandQueue.concat([]),level.commandQueueSourceRules=b.commandQueueSourceRules.concat([]),sfxCreateMask.setZero(),sfxDestroyMask.setZero(),verbose_logging&&a&&l>0&&(consolePrint("Relooping through rules because of rigid."),debugger_turnIndex++,addToDebugTimeline(level,-2)),s=0;else{if(verbose_logging){var c=debug_visualisation_array[debugger_turnIndex].length+1;consolePrint("Processed movements.",!1,null,i=addToDebugTimeline(level,c)),state.lateRules.length>0&&(debugger_turnIndex++,addToDebugTimeline(level,-2),consolePrint("Applying late rules"))}applyRules(state.lateRules,state.lateLoopPoint,0),s=0}}while(l<250&&a);if(l>=250)return consolePrint("looped through 250 times, gave up. Too many loops!"),applyRules(state.lateRules,state.lateLoopPoint,0),s=0,backups.push(r),DoUndo(!0,!1),!1;if(level.commandQueue.indexOf("undo")>=0)return verbose_logging&&(consoleCacheDump(),consolePrint("UNDO command executed, undoing turn.",!0)),messagetext="",DoUndo(!0,!1),!0;if(playerPositionsAtTurnStart.length>0&&void 0!==state.metadata.require_player_movement&&e>=0){var u=!1;for(l=0;l<playerPositionsAtTurnStart.length;l++){var d=playerPositionsAtTurnStart[l],h=level.getCell(d);if(state.playerMask.bitsClearInArray(h.data)){u=!0;break}}if(!1===u)return verbose_logging&&(consolePrint("require_player_movement set, but no player movement detected, so cancelling turn."),consoleCacheDump()),addUndoState(r),DoUndo(!0,!1),!1}if(level.commandQueue.indexOf("cancel")>=0){if(verbose_logging)consoleCacheDump(),consolePrintFromRule("CANCEL command executed, cancelling turn.",v=level.commandQueueSourceRules[level.commandQueue.indexOf("cancel")],!0);return processOutputCommands(level.commandQueue),addUndoState(r),DoUndo(!0,!1,!1,!1),tryPlayCancelSound(),!1}if(level.commandQueue.indexOf("restart")>=0){if(verbose_logging)consolePrintFromRule("RESTART command executed, reverting to restart state.",v=level.commandQueueSourceRules[level.commandQueue.indexOf("restart")]),consoleCacheDump();return processOutputCommands(level.commandQueue),addUndoState(r),DoRestart(!0),!0}if(level.commandQueue.indexOf("quit")>=0&&!solving){if(verbose_logging)consolePrintFromRule("QUIT command executed, exiting level.",v=level.commandQueueSourceRules[level.commandQueue.indexOf("restart")]),consoleCacheDump();return tryPlayEndGameSound(),void 0!==state.metadata.level_select?gotoLevelSelectScreen():goToTitleScreen(),messagetext="",canvasResize(),!0}if(level.commandQueue.indexOf("achieve1")>=0&&earnAchievement("Efficient Emergency"),level.commandQueue.indexOf("achieve2")>=0&&(placedArrows+=1,localStorage.setItem(document.URL+"_arrows",JSON.stringify(placedArrows)),placedArrows>=250&&earnAchievement("Arrow Artist")),level.commandQueue.indexOf("achieve3")>=0&&(crashes+=1,localStorage.setItem(document.URL+"_crashes",JSON.stringify(crashes)),crashes>=30&&earnAchievement("Crash Craver")),level.commandQueue.indexOf("achieve4")>=0&&earnAchievement("Dedicated Driver"),n&&level.commandQueue.indexOf("win")>=0)return!0;var p=!0;if(!winning&&level.commandQueue.indexOf("nosave")>=0){if(verbose_logging)consolePrintFromRule("NOSAVE command executed, not storing current state to undo queue.",v=level.commandQueueSourceRules[level.commandQueue.indexOf("nosave")]);p=!1}var f=!1;for(l=0;l<level.objects.length;l++)if(level.objects[l]!==r.dat[l]){if(n)return verbose_logging&&consoleCacheDump(),addUndoState(r),DoUndo(!0,!1,!1),!0;-1!==e&&p&&addUndoState(r),f=!0,updateCameraPositionTarget();break}if(n&&level.commandQueue.indexOf("win")>=0)return!0;if(n)return verbose_logging&&consoleCacheDump(),!1;for(l=0;l<seedsToPlay_CantMove.length;l++)playSound(seedsToPlay_CantMove[l]);for(l=0;l<seedsToPlay_CanMove.length;l++)playSound(seedsToPlay_CanMove[l]);for(l=0;l<state.sfx_CreationMasks.length;l++){var g=state.sfx_CreationMasks[l];sfxCreateMask.anyBitsInCommon(g.objectMask)&&playSound(g.seed)}for(l=0;l<state.sfx_DestructionMasks.length;l++){g=state.sfx_DestructionMasks[l];sfxDestroyMask.anyBitsInCommon(g.objectMask)&&playSound(g.seed)}if(processOutputCommands(level.commandQueue),!1===textMode&&(verbose_logging&&consolePrint("Checking win conditions."),void 0===t&&(t=!1),checkWin(t)),!winning){if(level.commandQueue.indexOf("checkpoint")>=0){if(verbose_logging)consolePrintFromRule("CHECKPOINT command executed, saving current state to the restart state.",v=level.commandQueueSourceRules[level.commandQueue.indexOf("checkpoint")]);restartTarget=level4Serialization(),hasUsedCheckpoint=!0;var m=JSON.stringify(restartTarget);storage_set(document.URL+"_checkpoint",m),storage_set(document.URL,curlevel)}if(level.commandQueue.indexOf("again")>=0){var v=level.commandQueueSourceRules[level.commandQueue.indexOf("again")],y=verbose_logging,_=messagetext;verbose_logging=!1,processInput(-1,!0,!0),(verbose_logging=y)&&consolePrintFromRule("AGAIN command executed, with changes detected - will execute another turn.",v),againing=!0,timer=0,verbose_logging=y,messagetext=_}}verbose_logging&&consolePrint("Turn complete"),currentMovedEntities=newMovedEntities,tweentimer=0,level.commandQueue=[],level.commandQueueSourceRules=[]}return verbose_logging&&consoleCacheDump(),winning&&(againing=!1),f}function checkWin(e){if(levelEditorOpened&&(e=!0),level.commandQueue.indexOf("win")>=0)return runrulesonlevelstart_phase?consolePrint("Win Condition Satisfied (However this is in the run_rules_on_level_start rule pass, so I'm going to ignore it for you.  Why would you want to complete a level before it's already started?!)"):solving||consolePrint("Win Condition Satisfied"),void(e||DoWin());var t=!1;if(state.winconditions.length>0){for(var n=!0,r=0;r<state.winconditions.length;r++){var o=state.winconditions[r],i=o[1],s=o[2],a=!0;switch(o[0]){case-1:for(var l=0;l<level.n_tiles;l++){var c=level.getCellInto(l,_o10);if(!i.bitsClearInArray(c.data)&&!s.bitsClearInArray(c.data)){a=!1;break}}break;case 0:var u=!1;for(l=0;l<level.n_tiles;l++){c=level.getCellInto(l,_o10);if(!i.bitsClearInArray(c.data)&&!s.bitsClearInArray(c.data)){u=!0;break}}!1===u&&(a=!1);break;case 1:for(l=0;l<level.n_tiles;l++){c=level.getCellInto(l,_o10);if(!i.bitsClearInArray(c.data)&&s.bitsClearInArray(c.data)){a=!1;break}}}!1===a&&(n=!1)}t=n}t&&(runrulesonlevelstart_phase?consolePrint("Win Condition Satisfied (However this is in the run_rules_on_level_start rule pass, so I'm going to ignore it for you.  Why would you want to complete a level before it's already started?!)"):solving||consolePrint("Win Condition Satisfied"),e||DoWin())}function DoWin(){winning||(againing=!1,tryPlayEndLevelSound(),unitTesting?nextLevel():(winning=!0,timer=0))}function nextLevel(){if(againing=!1,messagetext="",state&&state.levels&&curlevel>state.levels.length&&(curlevel=state.levels.length-1),ignoreNotJustPressedAction=!0,titleScreen&&titleMode<=1)isContinueOptionSelected()?loadLevelFromStateOrTarget():isNewGameOptionSelected()?(curlevel=0,curlevelTarget=null,clearLocalStorage(),loadLevelFromStateOrTarget()):isLevelSelectOptionSelected()?(titleSelection=0,gotoLevelSelectScreen()):isCreditsOptionSelected()?gotoCreditsScreen():isManualOptionSelected()?gotoManualScreen():isAchievementsOptionSelected()?gotoAchievementsScreen():isSettingsOptionSelected&&gotoSettingsScreen();else if(hasUsedCheckpoint&&(curlevelTarget=null,hasUsedCheckpoint=!1),curlevel==state.levels.length-7)gotoOutro();else if(curlevel<state.levels.length-1){var e=!1,t=state.levels[Number(curlevel)].section,n=state.levels[Number(curlevel)+1].section;n!=t&&(setSectionSolved(state.levels[Number(curlevel)].section),solvedSections.length==state.sections.length&&null!=state.winSection?curlevel=state.winSection.firstLevel-1:"__WIN__"==n&&(gotoLevelSelectScreen(),e=!0)),e||(curlevel++,curlevelTarget=null,textMode=!1,titleScreen=!1,quittingMessageScreen=!1,messageselected=!1,loadLevelFromStateOrTarget())}else if(solvedSections.length==state.sections.length){if(void 0===state.metadata.level_select){try{storage_remove(document.URL),storage_remove(document.URL+"_checkpoint")}catch(e){}curlevel=0,curlevelTarget=null,goToTitleScreen()}else gotoLevelSelectScreen();tryPlayEndGameSound()}else null!=state.levels[Number(curlevel)].section&&setSectionSolved(state.levels[Number(curlevel)].section),gotoLevelSelectScreen();updateLocalStorage(),resetFlickDat(),canvasResize()}function loadLevelFromStateOrTarget(){null!==curlevelTarget?loadLevelFromStateTarget(state,curlevel,curlevelTarget):loadLevelFromState(state,curlevel),console.error("curlevel is "+curlevel);var e=Math.ceil((parseInt(curlevel)+1)/2);16==e?earnAchievement("Ambulance Amateur"):33==e?earnAchievement("Hospital Helper"):46==e?earnAchievement("Patient Pacifier"):58==e?earnAchievement("Vehicle Voyeur"):74==e?earnAchievement("Paramedic Professional"):86==e?earnAchievement("Siren Savant"):173===curlevel&&earnAchievement("Medical Master"),e<=15?startLevelMusic1():e<=32?startLevelMusic2():e<=45?startLevelMusic3():e<=57?startLevelMusic4():e<=73?startLevelMusic5():e<=84?startLevelMusic6():e<=85||170===curlevel?startEndingMusic():startLevelMusic6()}function goToTitleScreen(){againing=!1,messagetext="",titleScreen=!0,textMode=!0,hoverSelection=-1,doSetupTitleScreenLevelContinue(),state.metadata=deepClone(state.default_metadata),twiddleMetadataExtras(),null!==canvas&&regenSpriteImages(),generateTitleScreen()}function resetFlickDat(){void 0!==state&&void 0!==state.metadata.flickscreen&&(oldflickscreendat=[0,0,Math.min(state.metadata.flickscreen[0],level.width),Math.min(state.metadata.flickscreen[1],level.height)])}function updateLocalStorage(){try{if(storage_set(document.URL,curlevel),null!==curlevelTarget){restartTarget=level4Serialization();var e=JSON.stringify(restartTarget);storage_set(document.URL+"_checkpoint",e)}else storage_remove(document.URL+"_checkpoint")}catch(e){}}function setSectionSolved(e){if(null!=e&&null!=e&&"__WIN__"!=e.name&&!(solvedSections.indexOf(e)>=0))try{window.localStorage&&(solvedSections.push(e),localStorage.setItem(document.URL+"_sections",JSON.stringify(solvedSections)))}catch(e){}}function clearLocalStorage(){curlevel=0,curlevelTarget=null,solvedSections=[];try{window.localStorage&&(localStorage.removeItem(document.URL),localStorage.removeItem(document.URL+"_checkpoint"),localStorage.removeItem(document.URL+"_sections"),localStorage.removeItem(document.URL+"_achievements"),localStorage.removeItem(document.URL+"_crashes"),localStorage.removeItem(document.URL+"_arrows"))}catch(e){}}var cameraPositionTarget=null,cameraPosition={x:0,y:0};function initSmoothCamera(){if(void 0!==state&&void 0!==state.metadata.smoothscreen){screenwidth=state.metadata.smoothscreen.screenSize.width,screenheight=state.metadata.smoothscreen.screenSize.height;var e=state.metadata.smoothscreen.boundarySize,t=state.metadata.smoothscreen.flick,n=getPlayerPositions();if(n.length>0){var r={x:n[0]/level.height|0,y:n[0]%level.height|0};cameraPositionTarget={x:t?getFlickCameraPosition(r.x,level.width,screenwidth,e.width):getCameraPosition(r.x,level.width,screenwidth),y:t?getFlickCameraPosition(r.y,level.height,screenheight,e.height):getCameraPosition(r.y,level.height,screenheight)},cameraPosition.x=cameraPositionTarget.x,cameraPosition.y=cameraPositionTarget.y}}}function getCameraPosition(e,t,n){return Math.min(Math.max(e,Math.floor(n/2)),t-Math.ceil(n/2))}function getFlickCameraPosition(e,t,n,r){var o=Math.floor(n/2)-Math.floor(r/2),i=e-o,s=Math.floor(i/r),a=Math.floor((t-Math.ceil(n/2)-Math.floor(r/2)-o)/r);return Math.min(Math.max(s,0),a)*r+Math.floor(n/2)}function updateCameraPositionTarget(){var e=state.metadata.smoothscreen,t=getPlayerPositions();if(e&&0!==t.length){var n={x:t[0]/level.height|0,y:t[0]%level.height|0};["x","y"].forEach((function(t){var r="x"===t?screenwidth:screenheight,o="x"===t?"width":"height",i=level[o],s=e.boundarySize[o],a=n[t]-cameraPositionTarget[t],l=Math.sign(a),c=l>0?Math.ceil(s/2):-(Math.floor(s/2)+1);Math.abs(a)-Math.abs(c)>=0&&(cameraPositionTarget[t]=e.flick?getFlickCameraPosition(n[t],i,r,s):getCameraPosition(n[t]-c+l,i,r))}))}}function IsMouseGameInputEnabled(){return"mouse_left"in state.metadata||"mouse_drag"in state.metadata||"mouse_up"in state.metadata}var compiling=!1,errorStrings=[],errorCount=0,twiddleable_params=["background_color","text_color","key_repeat_interval","realtime_interval","again_interval","flickscreen","zoomscreen","smoothscreen","noundo","norestart","message_text_align"];function logErrorCacheable(e,t,n){if(compiling||n){if(void 0===t)return logErrorNoLine(e,n);var r='<a onclick="jumpToLine('+t.toString()+');"  href="javascript:void(0);"><span class="errorTextLineNumber"> line '+t.toString()+'</span></a> : <span class="errorText">'+e+"</span>";errorStrings.indexOf(r)>=0&&!n||(consolePrint(r),errorStrings.push(r),errorCount++)}}function logError(e,t,n){if(compiling||n){if(void 0===t)return logErrorNoLine(e,n);var r='<a onclick="jumpToLine('+t.toString()+');"  href="javascript:void(0);"><span class="errorTextLineNumber"> line '+t.toString()+'</span></a> : <span class="errorText">'+e+"</span>";errorStrings.indexOf(r)>=0&&!n||(consolePrint(r,!0),errorStrings.push(r),errorCount++)}}function logWarning(e,t,n){if(compiling||n){if(void 0===t)return logWarningNoLine(e,n);var r='<a onclick="jumpToLine('+t.toString()+');"  href="javascript:void(0);"><span class="errorTextLineNumber"> line '+t.toString()+'</span></a> : <span class="warningText">'+e+"</span>";errorStrings.indexOf(r)>=0&&!n||(consolePrint(r,!0),errorStrings.push(r))}}function logWarningNoLine(e,t){if(compiling||t){var n='<span class="warningText">'+e+"</span>";errorStrings.indexOf(n)>=0&&!t||(consolePrint(n,!0),errorStrings.push(n)),errorCount++}}function logErrorNoLine(e,t){if(compiling||t){var n='<span class="errorText">'+e+"</span>";errorStrings.indexOf(n)>=0&&!t||(consolePrint(n,!0),errorStrings.push(n)),errorCount++}}function logBetaMessage(e,t){if(compiling||t){var n='<span class="betaText">'+e+"</span>";errorStrings.indexOf(n)>=0&&!t||(consoleError(n),errorStrings.push(n))}}function blankLineHandle(e){"levels"===e.section?e.levels[e.levels.length-1].length>0&&e.levels.push([]):"objects"===e.section&&(e.objects_section=0)}"function"!=typeof Object.assign&&(Object.assign=function(e){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])}return t});var codeMirrorFn=function(){"use strict";var e=["objects","legend","sounds","collisionlayers","rules","winconditions","levels"],t=["sfx0","sfx1","sfx2","sfx3","sfx4","sfx5","sfx6","sfx7","sfx8","sfx9","sfx10","sfx11","sfx12","sfx13","cancel","checkpoint","restart","win","message","again","undo","nosave","quit","zoomscreen","flickscreen","smoothscreen","again_interval","realtime_interval","key_repeat_interval","noundo","norestart","background_color","text_color","goto","message_text_align","achieve1","achieve2","achieve3","achieve4","achieve5"],n=/[\p{L}\p{N}_]+[\p{Z}\s]*/u,r=/\d+\b/,o=/(objects|collisionlayers|legend|sounds|rules|winconditions|levels)(?![\p{L}\p{N}_])[\p{Z}\s]*/u,i=/[\=]+/,s=/[^\(]+/,a=/[ \,]*/,l=/(move|action|create|destroy|cantmove|undo|restart|titlescreen|startgame|cancel|endgame|startlevel|endlevel|enterlevelselect|showmessage|closemessage|sfx0|sfx1|sfx2|sfx3|sfx4|sfx5|sfx6|sfx7|sfx8|sfx9|sfx10|sfx11|sfx12|sfx13)\b[\p{Z}\s]*/u,c=/^(action|up|down|left|right|\^|v|\<|\>|moving|stationary|parallel|perpendicular|horizontal|orthogonal|vertical|no|randomdir|random)$/,u=/^(startloop|endloop)$/,d=/^(up|down|left|right|horizontal|vertical|orthogonal|late|rigid)$/,h=/[\p{Z}\s]*(up|down|left|right|horizontal|vertical|orthogonal)(?![\p{L}\p{N}_])[\p{Z}\s]*/u,p=/^(all|any|no|some)$/,f=["title","author","homepage","background_color","text_color","key_repeat_interval","realtime_interval","again_interval","flickscreen","zoomscreen","smoothscreen","color_palette","youtube","sprite_size","level_select_unlocked_ahead","level_select_solve_symbol","custom_font","mouse_left","mouse_drag","mouse_right","mouse_rdrag","mouse_up","mouse_rup","local_radius","font_size","tween_length","tween_easing","tween_snap","message_text_align","text_controls","text_message_continue","level_select_unlocked_rollover","sitelock_origin_whitelist","sitelock_hostname_whitelist"],g=["run_rules_on_level_start","norepeat_action","require_player_movement","debug","verbose_logging","throttle_movement","noundo","noaction","norestart","scanline","case_sensitive","level_select","credits","manual","continue_is_level_select","level_select_lock","settings","runtime_metadata_twiddling","runtime_metadata_twiddling_debug","smoothscreen_debug","skip_title_screen","nokeyboard"],m=["checkpoint","objects","collisionlayers","legend","sounds","rules","...","winconditions","levels","|","[","]","up","down","left","right","late","rigid","^","v",">","<","no","randomdir","random","horizontal","vertical","any","all","no","some","moving","stationary","parallel","perpendicular","action","nosave","message","global","zoomscreen","flickscreen","smoothscreen","noundo","norestart","background_color","text_color","goto","message_text_align"];return{copyState:function(e){var t={};for(var n in e.objects)if(e.objects.hasOwnProperty(n)){var r=e.objects[n];t[n]={colors:r.colors.concat([]),lineNumber:r.lineNumber,spritematrix:r.spritematrix.concat([])}}var o=[];for(n=0;n<e.collisionLayers.length;n++)o.push(e.collisionLayers[n].concat([]));var i=[],s=[],a=[],l=[],c=[],u=[];for(n=0;n<e.legend_synonyms.length;n++)i.push(e.legend_synonyms[n].concat([]));for(n=0;n<e.legend_aggregates.length;n++)s.push(e.legend_aggregates[n].concat([]));for(n=0;n<e.legend_properties.length;n++)a.push(e.legend_properties[n].concat([]));for(n=0;n<e.sounds.length;n++)l.push(e.sounds[n].concat([]));for(n=0;n<e.levels.length;n++)c.push(e.levels[n].concat([]));for(n=0;n<e.winconditions.length;n++)u.push(e.winconditions[n].concat([]));var d=Object.assign({},e.original_case_names);return{lineNumber:e.lineNumber,objects:t,collisionLayers:o,commentLevel:e.commentLevel,section:e.section,visitedSections:e.visitedSections.concat([]),objects_candname:e.objects_candname,objects_section:e.objects_section,objects_spritematrix:e.objects_spritematrix.concat([]),tokenIndex:e.tokenIndex,currentSection:e.currentSection,legend_synonyms:i,legend_aggregates:s,legend_properties:a,sounds:l,rules:e.rules.concat([]),names:e.names.concat([]),winconditions:u,original_case_names:d,abbrevNames:e.abbrevNames.concat([]),metadata:e.metadata.concat([]),sprite_size:e.sprite_size,case_sensitive:e.case_sensitive,levels:c,STRIDE_OBJ:e.STRIDE_OBJ,STRIDE_MOV:e.STRIDE_MOV}},blankLine:function(e){"levels"===e.section&&e.levels[e.levels.length-1].length>0&&e.levels.push([])},token:function(v,y){var _=v.string,b=v.sol();function w(e){function t(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var n;n=y.case_sensitive?new RegExp("\\b"+t(e)+"\\b"):new RegExp("\\b"+t(e)+"\\b","i");var r=_.match(n);null!=r&&(y.original_case_names[e]=r[0])}if(b&&(y.case_sensitive||(v.string=v.string.toLowerCase()),y.tokenIndex=0),v.eatWhile(/[ \t]/),"("===(E=v.peek())&&-4!==y.tokenIndex)v.next(),y.commentLevel++;else if(")"===E&&(v.next(),y.commentLevel>0&&(y.commentLevel--,0===y.commentLevel)))return"comment";if(y.commentLevel>0){for(;v.eatWhile(/[^\(\)]+/),!v.eol()&&("("===(E=v.peek())?y.commentLevel++:")"===E&&y.commentLevel--,v.next(),0!==y.commentLevel););return"comment"}if(v.eatWhile(/[ \t]/),b&&v.eol())return blankLineHandle(y);if(b&&v.match(i,!0))return"EQUALSBIT";if(b&&v.match(o,!0)){y.section=v.string.slice(0,v.pos).trim().toLowerCase(),y.visitedSections.indexOf(y.section)>=0&&logError('cannot duplicate sections (you tried to duplicate "'+y.section+'").',y.lineNumber),y.visitedSections.push(y.section);var S=e.indexOf(y.section);if(0==S?(y.objects_section=0,y.visitedSections.length>1&&logError('section "'+y.section+'" must be the first section',y.lineNumber)):-1==y.visitedSections.indexOf(e[S-1])&&logError(-1===S?'no such section as "'+y.section+'".':'section "'+y.section+'" is out of order, must follow  "'+e[S-1]+'".',y.lineNumber),"sounds"===y.section){for(var C in y.objects)y.objects.hasOwnProperty(C)&&y.names.push(C);for(var I=0;I<y.legend_synonyms.length;I++){C=y.legend_synonyms[I][0];y.names.push(C)}for(I=0;I<y.legend_aggregates.length;I++){C=y.legend_aggregates[I][0];y.names.push(C)}for(I=0;I<y.legend_properties.length;I++){C=y.legend_properties[I][0];y.names.push(C)}}else if("levels"===y.section){for(var C in y.objects)y.objects.hasOwnProperty(C)&&1==C.length&&y.abbrevNames.push(C);for(I=0;I<y.legend_synonyms.length;I++)1==y.legend_synonyms[I][0].length&&y.abbrevNames.push(y.legend_synonyms[I][0]);for(I=0;I<y.legend_aggregates.length;I++)1==y.legend_aggregates[I][0].length&&y.abbrevNames.push(y.legend_aggregates[I][0])}return"HEADER"}if(void 0===y.section&&logError('must start with section "OBJECTS"',y.lineNumber),v.eol())return null;switch(y.section){case"objects":var x=function(){var e=b?v.match(n,!0):v.match(/[^\p{Z}\s\()]+[\p{Z}\s]*/u,!0);if(null==e)return v.match(s,!0),v.pos>0&&logWarning('Unknown junk in object section (possibly: the main names for objects have to be words containing only the letters a-z0.9 - if you want to call them something like ",", do it in the legend section).',y.lineNumber),"ERROR";var t=e[0].trim();if(void 0!==y.objects[t])return logError('Object "'+t+'" defined multiple times.',y.lineNumber),"ERROR";for(var r=0;r<y.legend_synonyms.length;r++){y.legend_synonyms[r][0]==t&&logError('Name "'+t+'" already in use.',y.lineNumber)}if(m.indexOf(t)>=0&&logWarning('You named an object "'+t+"\", but this is a keyword. Don't do that!",y.lineNumber),b)y.objects_candname=t,w(t),y.objects[y.objects_candname]={lineNumber:y.lineNumber,colors:[],spritematrix:[],cloneSprite:""};else{if("copy:"==t.substring(0,5)&&t.length>5){var o=t.substring(5);return""!=y.objects[y.objects_candname].cloneSprite?(logError("You already assigned a sprite parent for "+o+", you can't have more than one!",y.lineNumber),"ERROR"):o==y.objects_candname?(logError("You attempted to set the sprite parent for "+o+" to "+o+"! Please don't, and keep the recursion in check.",y.lineNumber),"ERROR"):(y.objects[y.objects_candname].cloneSprite=o,"SPRITEPARENT")}var i;w(t),(i=[t,y.objects_candname]).lineNumber=y.lineNumber,y.legend_synonyms.push(i)}return y.case_sensitive&&("player"==t.toLowerCase()&&"player"!=t||"background"==t.toLowerCase()&&"background"!=t)&&((i=[t.toLowerCase(),y.objects_candname]).lineNumber=y.lineNumber,y.legend_synonyms.push(i)),y.objects_section=1,"NAME"};switch(b&&2==y.objects_section&&(y.objects_section=3),b&&1==y.objects_section&&(y.objects_section=2),y.objects_section){case 0:case 1:return y.objects_spritematrix=[],x();case 2:v.string=v.string.toLowerCase(),y.tokenIndex=0;var O=v.match(reg_color,!0);if(null==O){var M=v.match(n,!0)||v.match(s,!0);return logError("Was looking for color for object "+y.objects_candname+', got "'+M+'" instead.',y.lineNumber),null}void 0===y.objects[y.objects_candname].colors?y.objects[y.objects_candname].colors=[O[0].trim()]:y.objects[y.objects_candname].colors.push(O[0].trim());var k=O[0].trim().toLowerCase();return k in colorPalettes.arnecolors?"COLOR COLOR-"+k.toUpperCase():"transparent"===k?"COLOR FADECOLOR":"MULTICOLOR"+O[0];case 3:var E=v.eat(/[.\d]/),N=y.objects_spritematrix;if(void 0===E)return 0===N.length?x():(logError("Unknown junk in spritematrix for object "+y.objects_candname+".",y.lineNumber),v.match(s,!0),null);b&&N.push("");var T=y.objects[y.objects_candname];return N[N.length-1]+=E,N[N.length-1].length>y.sprite_size?(logError("Sprites must be "+y.sprite_size+" wide and "+y.sprite_size+" high.",y.lineNumber),v.match(s,!0),null):(T.spritematrix=y.objects_spritematrix,N.length===y.sprite_size&&N[N.length-1].length==y.sprite_size&&(y.objects_section=0),"."!==E?(C=parseInt(E))>=T.colors.length?(logError("Trying to access color number "+C+" from the color palette of sprite "+y.objects_candname+", but there are only "+T.colors.length+" defined in it.",y.lineNumber),"ERROR"):isNaN(C)?(logError('Invalid character "'+E+'" in sprite for '+y.objects_candname,y.lineNumber),"ERROR"):"COLOR BOLDCOLOR COLOR-"+T.colors[C].toUpperCase():"COLOR FADECOLOR");default:window.console.logError("EEK shouldn't get here.")}break;case"sounds":if(b){var L=!0;(U=s.exec(v.string)[0].split(/[\p{Z}\s]/u).filter((function(e){return""!==e}))).push(y.lineNumber),y.sounds.push(U)}if(null!==(D=v.match(l,!0)))return"SOUNDVERB";if(null!==(D=v.match(h,!0)))return"DIRECTION";if(null!==(D=v.match(r,!0)))return y.tokenIndex++,"SOUND";if(null!==(D=v.match(/[^\[\|\]\p{Z}\s]*/u,!0))){var A=D[0].trim();if(y.names.indexOf(A)>=0)return"NAME"}else D=v.match(s,!0);return logError('unexpected sound token "'+D+'".',y.lineNumber),v.match(s,!0),"ERROR";case"collisionlayers":if(b&&(y.collisionLayers.push([]),y.tokenIndex=0),null===(W=v.match(n,!0))){var R=v.pos;return v.match(a,!0),v.pos==R&&(logError("error detected - unexpected character "+v.peek(),y.lineNumber),v.next()),null}var D=W[0].trim(),P=function(e){if(y.case_sensitive||(e=e.toLowerCase()),e in y.objects)return[e];for(var t=0;t<y.legend_synonyms.length;t++){if((n=y.legend_synonyms[t])[0]===e)return P(n[1])}for(t=0;t<y.legend_aggregates.length;t++){if((n=y.legend_aggregates[t])[0]===e)return logError('"'+e+'" is an aggregate (defined using "and"), and cannot be added to a single layer because its constituent objects must be able to coexist.',y.lineNumber),[]}for(t=0;t<y.legend_properties.length;t++){var n;if((n=y.legend_properties[t])[0]===e)return[].concat.apply([],n.slice(1).map(P))}return logError('Cannot add "'+D+'" to a collision layer; it has not been declared.',y.lineNumber),[]};"background"===D.toLowerCase()?(y.collisionLayers.length>0&&y.collisionLayers[y.collisionLayers.length-1].length>0&&logError("Background must be in a layer by itself.",y.lineNumber),y.tokenIndex=1):0!==y.tokenIndex&&logError("Background must be in a layer by itself.",y.lineNumber);var F=P(D);if(0===y.collisionLayers.length)return logError("no layers found.",y.lineNumber),"ERROR";var B=[];for(I=0;I<F.length;I++){D=F[I];for(var j=0;j<=y.collisionLayers.length-1;j++){y.collisionLayers[j].indexOf(D)>=0&&j!=y.collisionLayers.length-1&&B.push(j)}}if(B.length>0){var z='Object "'+D+'" included in multiple collision layers ( layers ';for(I=0;I<B.length;I++)z+="#"+(B[I]+1)+", ";logWarning((z+="#"+y.collisionLayers.length)+" ). You should fix this!",y.lineNumber)}return y.collisionLayers[y.collisionLayers.length-1]=y.collisionLayers[y.collisionLayers.length-1].concat(F),F.length>0?"NAME":"ERROR";case"legend":if(b){var V=v.string.replace("="," = "),U=(V=s.exec(V)[0]).split(/[\p{Z}\s]/u).filter((function(e){return""!==e}));L=!0;if(U.length>0){D=U[0];y.case_sensitive||(D=D.toLowerCase()),m.indexOf(D)>=0&&logWarning('You named an object "'+D+"\", but this is a keyword. Don't do that!",y.lineNumber),U.indexOf(D,2)>=2&&logError("You can't define object "+D.toUpperCase()+" in terms of itself!",y.lineNumber),function(e,t){if(void 0!==e.objects[t])return logError('Object "'+t+'" defined multiple times.',e.lineNumber),"ERROR";for(var n=0;n<e.legend_synonyms.length;n++)e.legend_synonyms[n][0]==t&&logError('Name "'+t+'" already in use.',e.lineNumber);for(n=0;n<e.legend_aggregates.length;n++)e.legend_aggregates[n][0]==t&&logError('Name "'+t+'" already in use.',e.lineNumber);for(n=0;n<e.legend_properties.length;n++)e.legend_properties[n][0]==t&&logError('Name "'+t+'" already in use.',e.lineNumber)}(y,D)}if(L)if(U.length<3)L=!1;else if("="!==U[1])L=!1;else if(3===U.length){var H=[U[0],U[2]];y.case_sensitive||(H[1]=H[1].toLowerCase()),H.lineNumber=y.lineNumber,w(U[0]),y.legend_synonyms.push(H)}else if(U.length%2==0)L=!1;else{var G=U[3].toLowerCase();if("and"===G){for(P=function(e){if(y.case_sensitive||(e=e.toLowerCase()),e in y.objects)return[e];for(var t=0;t<y.legend_synonyms.length;t++){if((n=y.legend_synonyms[t])[0]===e)return P(n[1])}for(t=0;t<y.legend_aggregates.length;t++){if((n=y.legend_aggregates[t])[0]===e)return[].concat.apply([],n.slice(1).map(P))}for(t=0;t<y.legend_properties.length;t++){var n;if((n=y.legend_properties[t])[0]===e)return logError("Cannot define an aggregate (using 'and') in terms of properties (something that uses 'or').",y.lineNumber),L=!1,[e]}return[e]},I=5;I<U.length;I+=2)if("and"!==U[I].toLowerCase()){L=!1;break}if(L){var q=[U[0]].concat(P(U[2])).concat(P(U[4]));for(I=6;I<U.length;I+=2)q=q.concat(P(U[I]));q.lineNumber=y.lineNumber,w(q[0]),y.legend_aggregates.push(q)}}else if("or"===G){for(P=function(e){if(y.case_sensitive||(e=e.toLowerCase()),e in y.objects)return[e];for(var t=0;t<y.legend_synonyms.length;t++){if((n=y.legend_synonyms[t])[0]===e)return P(n[1])}for(t=0;t<y.legend_aggregates.length;t++){(n=y.legend_aggregates[t])[0]===e&&(logError("Cannot define a property (using 'or') in terms of aggregates (something that uses 'and').",y.lineNumber),L=!1)}for(t=0;t<y.legend_properties.length;t++){var n;if((n=y.legend_properties[t])[0]===e)return[].concat.apply([],n.slice(1).map(P))}return[e]},I=5;I<U.length;I+=2)if("or"!==U[I].toLowerCase()){L=!1;break}if(L){for(q=[U[0]].concat(P(U[2])).concat(P(U[4])),I=6;I<U.length;I+=2)y.case_sensitive?q.push(U[I]):q.push(U[I].toLowerCase());q.lineNumber=y.lineNumber,w(q[0]),y.legend_properties.push(q)}}else L=!1}else;if(!1===L)return logError("incorrect format of legend - should be one of A = B, A = B or C ( or D ...), A = B and C (and D ...)",y.lineNumber),v.match(s,!0),"ERROR";y.tokenIndex=0}if(0===y.tokenIndex)return v.match(/[^=]*/,!0),y.tokenIndex++,"NAME";if(1===y.tokenIndex)return v.next(),v.match(/[\p{Z}\s]*/u,!0),y.tokenIndex++,"ASSSIGNMENT";var W;if(null===(W=v.match(n,!0)))return logError("Something bad's happening in the LEGEND",y.lineNumber),v.match(s,!0),"ERROR";D=W[0].trim();if(y.tokenIndex%2==0){return!1===function(e){if(y.case_sensitive||(e=e.toLowerCase()),e in y.objects)return!0;for(var t=0;t<y.legend_aggregates.length;t++){if(y.legend_aggregates[t][0]===e)return!0}for(t=0;t<y.legend_properties.length;t++){if(y.legend_properties[t][0]===e)return!0}for(t=0;t<y.legend_synonyms.length;t++){if(y.legend_synonyms[t][0]===e)return!0}return!1}(D)?(logError('Cannot reference "'+D+'" in the LEGEND section; it has not been defined yet.',y.lineNumber),y.tokenIndex++,"ERROR"):(y.tokenIndex++,"NAME")}return y.tokenIndex++,"LOGICWORD";case"rules":if(b){var K=s.exec(v.string)[0];y.rules.push([K,y.lineNumber,_]),y.tokenIndex=0}if(-4===y.tokenIndex)return v.skipToEnd(),"MESSAGE";if(v.match(/[\p{Z}\s]*->[\p{Z}\s]*/u,!0))return"ARROW";if("["===E||"|"===E||"]"===E||"+"===E)return"+"!==E&&(y.tokenIndex=1),v.next(),v.match(/[\p{Z}\s]*/u,!0),"BRACKET";A=v.match(/[^\[\|\]\p{Z}\s]*/u,!0)[0].trim();return 0===y.tokenIndex&&u.exec(A)?"BRACKET":0===y.tokenIndex&&d.exec(A)||1===y.tokenIndex&&c.exec(A)?(v.match(/[\p{Z}\s]*/u,!0),"DIRECTION"):y.names.indexOf(A)>=0?b?(logError("Identifiers cannot appear outside of square brackets in rules, only directions can.",y.lineNumber),"ERROR"):(v.match(/[\p{Z}\s]*/u,!0),"NAME"):"..."===(A=A.toLowerCase())||"rigid"===A||"random"===A||"global"===A?"DIRECTION":t.indexOf(A)>=0?(("message"===A||"goto"===A||twiddleable_params.includes(A))&&(y.tokenIndex=-4),"COMMAND"):(logError('Name "'+A+'", referred to in a rule, does not exist.',y.lineNumber),"ERROR");case"winconditions":if(b){var X=s.exec(v.string)[0].split(/[\p{Z}\s]/u).filter((function(e){return""!==e}));X.push(y.lineNumber),y.winconditions.push(X),y.tokenIndex=-1}if(y.tokenIndex++,null===($=v.match(/[\p{Z}\s]*[\p{L}\p{N}_]+[\p{Z}\s]*/u)))return logError("incorrect format of win condition.",y.lineNumber),v.match(s,!0),"ERROR";var Y=$[0].trim();if(0===y.tokenIndex)return p.exec(Y)?"LOGICWORD":"ERROR";if(2===y.tokenIndex)return"on"!=Y?(logError('Expecting the word "ON" but got "'+Y.toUpperCase()+"'.",y.lineNumber),"ERROR"):"LOGICWORD";if(1===y.tokenIndex||3===y.tokenIndex)return-1===y.names.indexOf(Y)?(logError('Error in win condition: "'+Y+'" is not a valid object name.',y.lineNumber),"ERROR"):"NAME";break;case"levels":if(b){if(v.match(/[\p{Z}\s]*message\b[\p{Z}\s]*/u,!0)){y.tokenIndex=1;var J=["message",_.slice(v.pos).trim(),y.lineNumber,y.currentSection];return 0==y.levels[y.levels.length-1].length?y.levels.splice(y.levels.length-1,0,J):y.levels.push(J),"MESSAGE_VERB"}if(v.match(/[\p{Z}\s]*message[\p{Z}\s]*/u,!0)){logWarning("You probably meant to put a space after 'message' innit.  That's ok, I'll still interpret it as a message, but you probably want to put a space there.",y.lineNumber),y.tokenIndex=1;J=["message",_.slice(v.pos).trim(),y.lineNumber,y.currentSection];return 0==y.levels[y.levels.length-1].length?y.levels.splice(y.levels.length-1,0,J):y.levels.push(J),"MESSAGE_VERB"}if(v.match(/\s*section\s*/i,!0))return y.tokenIndex=3,y.currentSection=_.slice(v.pos).trim(),"SECTION_VERB";if(v.match(/\s*goto\s*/i,!0)){y.tokenIndex=4;J=["goto",_.slice(v.pos).trim(),y.lineNumber,y.currentSection];return 0==y.levels[y.levels.length-1].length?y.levels.splice(y.levels.length-1,0,J):y.levels.push(J),"GOTO_VERB"}var Q=v.match(s,!1)[0].trim();y.tokenIndex=2;var Z=y.levels[y.levels.length-1];"\n"==Z[0]?y.levels.push([y.lineNumber,y.currentSection,Q]):(0==Z.length&&(Z.push(y.lineNumber),Z.push(y.currentSection)),Z.push(Q),Z.length>2&&Q.length!=Z[2].length&&logWarning("Maps must be rectangular, yo (In a level, the length of each row must be the same).",y.lineNumber))}else{if(1==y.tokenIndex)return v.skipToEnd(),"MESSAGE";if(3==y.tokenIndex)return v.skipToEnd(),"SECTION";if(4==y.tokenIndex)return v.skipToEnd(),"GOTO"}if(2===y.tokenIndex&&!v.eol()){E=v.peek();return v.next(),y.abbrevNames.indexOf(E)>=0?"LEVEL":(logError('Key "'+E+'" not found. Do you need to add it to the legend, or define a new object?',y.lineNumber),"ERROR")}break;default:if(b&&(y.tokenIndex=0),0!=y.tokenIndex)return v.match(s,!0),"METADATATEXT";var $;if(null!==($=v.match(/[\p{Z}\s]*[\p{L}\p{N}_]+[\p{Z}\s]*/u))){var ee=$[0].trim();if(b){if(f.indexOf(ee)>=0){"youtube"!==ee&&"author"!==ee&&"homepage"!==ee&&"title"!==ee&&"custom_font"!==ee&&"text_controls"!==ee&&"text_message_continue"!==ee||(v.string=_);var te=v.match(s,!1);return null!=te?"sprite_size"==ee?y.sprite_size=parseInt(te[0].trim(),10):(y.metadata.push(ee),y.metadata.push(te[0].trim())):logError('MetaData "'+ee+'" needs a value.',y.lineNumber),y.tokenIndex=1,"METADATA"}return g.indexOf(ee)>=0?("case_sensitive"==ee&&(y.case_sensitive=!0),y.metadata.push(ee),y.metadata.push("true"),y.tokenIndex=-1,"METADATA"):(logError("Unrecognised stuff in the prelude.",y.lineNumber),"ERROR")}return-1==y.tokenIndex?(logError('MetaData "'+ee+'" has no parameters.',y.lineNumber),"ERROR"):"METADATA"}}return v.eol()?null:v.eol()?void 0:(v.next(),null)},startState:function(){return{objects:{},lineNumber:0,commentLevel:0,section:"",visitedSections:[],objects_candname:"",objects_section:0,objects_spritematrix:[],collisionLayers:[],tokenIndex:0,currentSection:null,legend_synonyms:[],legend_aggregates:[],legend_properties:[],sounds:[],rules:[],names:[],winconditions:[],metadata:[],sprite_size:5,case_sensitive:!1,original_case_names:{},abbrevNames:[],levels:[[]],subsection:""}}}};window.CodeMirror.defineMode("puzzle",codeMirrorFn);var code=document.getElementById("code"),_editorDirty=!1,_editorCleanState="",fileToOpen=getParameterByName("demo");if(null!==fileToOpen&&fileToOpen.length>0)tryLoadFile(fileToOpen),code.value="loading...";else{var gistToLoad=getParameterByName("hack");if(null!==gistToLoad&&gistToLoad.length>0){var id=gistToLoad.replace(/[\\\/]/,"");tryLoadGist(id),code.value="loading..."}else try{if(storage_has("saves")){var curSaveArray=JSON.parse(storage_get("saves")),sd=curSaveArray[curSaveArray.length-1];code.value=sd.text,(loadDropdown=document.getElementById("loadDropDown")).selectedIndex=0}}catch(e){}}CodeMirror.commands.swapLineUp=function(e){for(var t=e.listSelections(),n=[],r=e.firstLine()-1,o=[],i=0;i<t.length;i++){var s=t[i],a=s.from().line-1,l=s.to().line;o.push({anchor:CodeMirror.Pos(s.anchor.line-1,s.anchor.ch),head:CodeMirror.Pos(s.head.line-1,s.head.ch)}),a>r?n.push(a,l):n.length&&(n[n.length-1]=l),r=l}0!==n.length&&e.operation((function(){for(var t=0;t<n.length;t+=2){var r=n[t],i=n[t+1],s=e.getLine(r);e.replaceRange("",CodeMirror.Pos(r,0),CodeMirror.Pos(r+1,0),"+swapLine"),i>e.lastLine()?e.replaceRange("\n"+s,CodeMirror.Pos(e.lastLine()),null,"+swapLine"):e.replaceRange(s+"\n",CodeMirror.Pos(i,0),null,"+swapLine")}e.setSelections(o),e.scrollIntoView()}))},CodeMirror.commands.swapLineDown=function(e){for(var t=e.listSelections(),n=[],r=e.lastLine()+1,o=t.length-1;o>=0;o--){var i=t[o],s=i.to().line+1,a=i.from().line;s<r?n.push(s,a):n.length&&(n[n.length-1]=a),r=a}e.operation((function(){for(var t=n.length-2;t>=0;t-=2){var r=n[t],o=n[t+1],i=e.getLine(r);r==e.lastLine()?e.replaceRange("",CodeMirror.Pos(r-1),CodeMirror.Pos(r),"+swapLine"):e.replaceRange("",CodeMirror.Pos(r,0),CodeMirror.Pos(r+1,0),"+swapLine"),e.replaceRange(i+"\n",CodeMirror.Pos(o,0),null,"+swapLine")}e.scrollIntoView()}))};var editor=window.CodeMirror.fromTextArea(code,{lineWrapping:!0,lineNumbers:!0,styleActiveLine:!0,extraKeys:{"Ctrl-/":"toggleComment","Cmd-/":"toggleComment",Esc:CodeMirror.commands.clearSearch,"Shift-Ctrl-Up":"swapLineUp","Shift-Ctrl-Down":"swapLineDown"}});function checkEditorDirty(){var e=document.getElementById("saveClickLink");_editorCleanState!==editor.getValue()?(_editorDirty=!0,e&&(e.innerHTML="SAVE*")):(_editorDirty=!1,e&&(e.innerHTML="SAVE"))}function setEditorClean(){if(_editorCleanState=editor.getValue(),!0===_editorDirty){var e=document.getElementById("saveClickLink");e&&(e.innerHTML="SAVE"),_editorDirty=!1}}editor.on("mousedown",(function(e,t){"cm-SOUND"==t.target.className?playSound(parseInt(t.target.innerHTML)):"cm-LEVEL"==t.target.className&&(t.ctrlKey||t.metaKey)&&(document.activeElement.blur(),editor.display.input.blur(),prevent(t),compile(["levelline",e.posFromMouse(t).line]))})),_editorCleanState=editor.getValue(),editor.on("change",(function(e,t){checkEditorDirty()}));var debugMode,colorPalette,mapObj={parallel:"&#8741;",perpendicular:"&#8869;"};function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function tryLoadGist(e){var t="https://api.github.com/gists/"+e;consolePrint("Contacting GitHub",!0);var n=new XMLHttpRequest;n.open("GET",t),n.onreadystatechange=function(){if(4==n.readyState){""===n.responseText&&consoleError("GitHub request returned nothing.  A connection fault, maybe?");var e=JSON.parse(n.responseText);if(403===n.status)consoleError(e.message);else if(200!==n.status&&201!==n.status)consoleError("HTTP Error "+n.status+" - "+n.statusText);else{var t=e.files["script.txt"].content;editor.setValue(t),editor.clearHistory(),clearConsole(),setEditorClean(),unloadGame(),compile(["restart"],t)}}},n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send()}function tryLoadFile(e){var t=new XMLHttpRequest;t.open("GET","demo/"+e+".txt"),t.onreadystatechange=function(){4==t.readyState&&(editor.setValue(t.responseText),clearConsole(),setEditorClean(),unloadGame(),compile(["restart"]))},t.send()}function canExit(){return!_editorDirty||confirm("You haven't saved your game! Are you sure you want to lose your unsaved changes?")}function dropdownChange(){canExit()?(tryLoadFile(this.value),this.selectedIndex=0):this.selectedIndex=0}function debugPreview(e,t){diffToVisualize=debug_visualisation_array[e][t],redraw()}function debugUnpreview(){diffToVisualize=null,redraw()}function addToDebugTimeline(e,t){debug_visualisation_array.hasOwnProperty(debugger_turnIndex)||(debug_visualisation_array[debugger_turnIndex]=[]);var n={width:e.width,height:e.height,layerCount:e.layerCount,turnIndex:debugger_turnIndex,lineNumber:t,objects:new Int32Array(e.objects),movements:new Int32Array(e.movements),commandQueue:e.commandQueue.concat([]),commandQueueSourceRules:e.commandQueueSourceRules.concat([])};return debug_visualisation_array[debugger_turnIndex][t]=n,`${debugger_turnIndex},${t}`}code.editorreference=editor,editor.setOption("theme","midnight"),editor.on("keyup",(function(e,t){CodeMirror.ExcludedIntelliSenseTriggerKeys[(t.keyCode||t.which).toString()]||CodeMirror.commands.autocomplete(e,null,{completeSingle:!1})}));"use strict";function isColor(e){return(e=e.trim())in colorPalettes.arnecolors||(!!/^#([0-9A-F]{2}){3,4}$/i.test(e)||(!!/^#([0-9A-F]{3})$/i.test(e)||"transparent"===e))}function colorToHex(e,t){return(t=t.trim())in e?e[t]:t}function generateSpriteMatrix(e){for(var t=[],n=0;n<e.length;n++){for(var r=[],o=0;o<e.length;o++){var i=e[n].charAt(o);"."==i?r.push(-1):r.push(i)}t.push(r)}return t}function generateExtraMembers(e){0===e.collisionLayers.length&&logError("No collision layers defined.  All objects need to be in collision layers."),e.idDict=[];for(var t=0,n=0;n<e.collisionLayers.length;n++)for(var r=0;r<e.collisionLayers[n].length;r++){if((c=e.collisionLayers[n][r])in e.objects)(p=e.objects[c]).layer=n,p.id=t,e.idDict[t]=c,t++}e.objectCount=t;for(var o=e.collisionLayers.length,i=[],s=0;s<o;s++)i.push(-1);STRIDE_OBJ=0|Math.ceil(e.objectCount/32),STRIDE_MOV=0|Math.ceil(o/5),e.STRIDE_OBJ=STRIDE_OBJ,e.STRIDE_MOV=STRIDE_MOV,debugMode=!1,verbose_logging=!1,throttle_movement=!1,colorPalette=colorPalettes.arnecolors;for(s=0;s<e.metadata.length;s+=2){var a=e.metadata[s],l=e.metadata[s+1];"color_palette"===a?(l in colorPalettesAliases&&(l=colorPalettesAliases[l]),void 0===colorPalettes[l]?logError('Palette "'+l+'" not found, defaulting to arnecolors.',0):colorPalette=colorPalettes[l]):"debug"===a?IDE&&!1===unitTesting&&(debugMode=!0,cache_console_messages=!0):"verbose_logging"===a?IDE&&!1===unitTesting&&(verbose_logging=!0,cache_console_messages=!0):"throttle_movement"===a&&(throttle_movement=!0)}for(var c in e.objects)if(e.objects.hasOwnProperty(c)){(p=e.objects[c]).colors.length>10&&logError("a sprite cannot have more than 10 colors.  Why you would want more than 10 is beyond me.",p.lineNumber+1);for(s=0;s<p.colors.length;s++){var u=p.colors[s];isColor(u)?(u=colorToHex(colorPalette,u),p.colors[s]=u):(logError('Invalid color specified for object "'+c+'", namely "'+p.colors[s]+'".',p.lineNumber+1),p.colors[s]="#ff00ff")}}for(var c in e.objects){if(e.objects.hasOwnProperty(c))if(0==(p=e.objects[c]).colors.length&&(logError('color not specified for object "'+c+'".',p.lineNumber),p.colors=["#ff00ff"]),""!==p.cloneSprite)e.objects.hasOwnProperty(p.cloneSprite)?""===e.objects[p.cloneSprite].cloneSprite?p.spritematrix=deepClone(e.objects[p.cloneSprite].spritematrix):logError("The sprite that "+c+" attempted to clone ("+p.cloneSprite+") clones a sprite itself ("+e.objects[p.cloneSprite].cloneSprite+"), so it can't clone the sprite! You'll need to set up the cloning differently.",p.lineNumber):logError(c+" attempted to clone the sprite matrix of "+p.cloneSprite+", but that object doesn't exist?!",p.lineNumber);else if(0===p.spritematrix.length){p.spritematrix=new Array(e.sprite_size);var d=new Array(e.sprite_size);for(s=0;s<e.sprite_size;s++)d[s]=0;for(s=0;s<e.sprite_size;s++)p.spritematrix[s]=d}else{if(p.spritematrix.length!==e.sprite_size)logWarning("Sprite graphics must be "+e.sprite_size+" wide and "+e.sprite_size+" high exactly.",p.lineNumber);else for(s=0;s<e.sprite_size;s++)if(p.spritematrix[s].length!==e.sprite_size){logWarning("Sprite graphics must be "+e.sprite_size+" wide and "+e.sprite_size+" high exactly.",p.lineNumber);break}p.spritematrix=generateSpriteMatrix(p.spritematrix)}}var h={};for(var c in e.objects)if(e.objects.hasOwnProperty(c)){var p=e.objects[c];(y=i.concat([]))[p.layer]=p.id,h[c]=y}for(var f=!0;f;){f=!1;for(s=0;s<e.legend_synonyms.length;s++){a=(g=e.legend_synonyms[s])[0],l=g[1];a in h&&void 0!==h[a]||void 0===h[l]||(f=!0,h[a]=h[l])}for(s=0;s<e.legend_aggregates.length;s++){a=(g=e.legend_aggregates[s])[0];var g,m=g.slice(1),v=!0;for(r=0;r<m.length;r++){if(void 0===h[m[r]]){v=!1;break}}if((!(a in h)||void 0===h[a])&&v){var y=i.concat([]);for(r=1;r<g.length;r++){c=g[r];if(null==(p=e.objects[c])&&logError("Object not found with name "+c,e.lineNumber),-1==y[p.layer])y[p.layer]=p.id;else if(void 0===p.layer)logError('Object "'+c.toUpperCase()+'" has been defined, but not assigned to a layer.',g.lineNumber);else{var _=c.toUpperCase(),b=e.idDict[y[p.layer]].toUpperCase();_!==b&&logError('Trying to create an aggregate object (defined in the legend) with both "'+_+'" and "'+b+"\", which are on the same layer and therefore can't coexist.",g.lineNumber)}}f=!0,h[g[0]]=y}}}e.glyphDict=h;var w={};for(s=0;s<e.legend_aggregates.length;s++){w[(I=e.legend_aggregates[s])[0]]=I.slice(1)}e.aggregatesDict=w;var S={};for(s=0;s<e.legend_properties.length;s++){S[(I=e.legend_properties[s])[0]]=I.slice(1)}e.propertiesDict=S;var C={};for(s=0;s<e.legend_synonyms.length;s++){var I;a=(I=e.legend_synonyms[s])[0];(T=I[1])in w?w[a]=w[T]:T in S?S[a]=S[T]:a!==T&&(C[a]=T)}e.synonymsDict=C;for(var x,O,M=!0;M;){for(var c in M=!1,C){if(C.hasOwnProperty(c))(T=C[c])in S?(delete C[c],S[c]=S[T],M=!0):T in w?(delete w[c],w[c]=w[T],M=!0):T in C&&(C[c]=C[T])}for(var c in S)if(S.hasOwnProperty(c)){var k=S[c];for(s=0;s<k.length;s++){if((T=k[s])in C)k[s]=C[T],M=!0;else if(T in S){k.splice(s,1);var E=S[T];for(r=0;r<E.length;r++){var N=E[r];-1===k.indexOf(N)&&k.push(N)}M=!0}T in w&&logError('Trying to define property "'+c.toUpperCase()+'" in terms of aggregate "'+T.toUpperCase()+'".')}}for(var c in w)if(w.hasOwnProperty(c))for(k=w[c],s=0;s<k.length;s++){var T;if((T=k[s])in C)k[s]=C[T],M=!0;else if(T in w){k.splice(s,1);for(E=w[T],r=0;r<E.length;r++){N=E[r];-1===k.indexOf(N)&&k.push(N)}M=!0}T in S&&logError('Trying to define aggregate "'+c.toUpperCase()+'" in terms of property "'+T.toUpperCase()+'".')}}for(var a in e.propertiesSingleLayer={},S)if(S.hasOwnProperty(a)){k=S[a];var L=!0;for(s=1;s<k.length;s++)if(e.objects[k[s-1]].layer!==e.objects[k[s]].layer){L=!1;break}L&&(e.propertiesSingleLayer[a]=e.objects[k[0]].layer)}if(void 0===e.idDict[0]&&e.collisionLayers.length>0&&logError("You need to have some objects defined"),void 0===e.objects.background)if("background"in e.synonymsDict){c=e.synonymsDict.background;x=(p=e.objects[c]).id,O=p.layer}else if("background"in e.propertiesDict){c=e.propertiesDict.background[0];x=(p=e.objects[c]).id,O=p.layer}else if("background"in e.aggregatesDict){x=(p=e.objects[e.idDict[0]]).id,O=p.layer,logError("background cannot be an aggregate (declared with 'and'), it has to be a simple type, or property (declared in terms of others using 'or').")}else{null!=(p=e.objects[e.idDict[0]])&&(x=p.id,O=p.layer),logError("you have to define something to be the background")}else x=e.objects.background.id,O=e.objects.background.layer;e.backgroundid=x,e.backgroundlayer=O}function generateExtraMembersPart2(e){function t(t,n){if(t in e.metadata){var r=e.metadata[t]||n,o=null;if(e.objects[r])o=e.objects[r].id;else if(r in e.synonymsDict){var i=e.synonymsDict[r];o=e.objects[i].id}else{o=e.objects[e.idDict[1]].id,logError(r+" object/alias has to be defined")}return o}}if(e.lmbID=t("mouse_left","lmb"),e.rmbID=t("mouse_right","rmb"),e.dragID=t("mouse_drag","drag"),e.rdragID=t("mouse_rdrag","rdrag"),e.lmbupID=t("mouse_up","lmbup"),e.rmbupID=t("mouse_rup","rmbup"),"mouse_obstacle"in e.metadata){var n=e.metadata.mouse_obstacle;n&&(e.obstacleMask=e.objectMasks[n],e.obstacleMask||(logError(n+" object/alias has to be defined."),e.obstacleMask=e.objectMasks.background))}}function levelFromString(e,t){var n=e.backgroundlayer,r=(e.backgroundid,e.layerMasks[n]),o=new Level(t[0],t[2].length,t.length-2,e.collisionLayers.length,null,t[1]);o.objects=new Int32Array(o.width*o.height*STRIDE_OBJ);for(var i=0;i<o.width;i++)for(var s=0;s<o.height;s++){var a=t[s+2].charAt(i);0==a.length&&(a=t[s+2].charAt(t[s+2].length-1));var l=e.glyphDict[a];null==l&&(void 0===e.propertiesDict[a]?logError('Error, symbol "'+a+'", used in map, not found.',t[0]+s):logError('Error, symbol "'+a+"\" is defined using 'or', and therefore ambiguous - it cannot be used in a map. Did you mean to define it in terms of 'and'?",t[0]+s));var c=new BitVec(STRIDE_OBJ);l=l.concat([]);for(var u=0;u<o.layerCount;u++)l[u]>=0&&c.ibitset(l[u]);for(var d=0;d<STRIDE_OBJ;++d)o.objects[STRIDE_OBJ*(i*o.height+s)+d]=c.data[d]}var h=o.calcBackgroundMask(e);for(i=0;i<o.n_tiles;i++){var p=o.getCell(i);r.anyBitsInCommon(p)||(p.ior(h),o.setCell(i,p))}return o}function levelsToArray(e){for(var t=e.levels,n=[],r=!1,o=null,i=0;i<t.length;i++){var s,a=t[i];if(0!=a.length)"message"==a[0]?(s={message:a[1],section:a[3]},(splitMessage=wordwrap(s.message,intro_template[0].length)).length>12&&logWarning("Message too long to fit on screen.",a[2]),s.section!=o&&(r=!1,o=s.section),r&&logWarning("Message unreachable due to previous GOTO.",a[2])):"goto"==a[0]?((s={target:a[1],lineNumber:a[2],section:a[3]}).section!=o&&(r=!1,o=s.section),r&&logWarning("GOTO unreachable due to previous GOTO.",s.lineNumber),r=!0):((s=levelFromString(e,a)).section!=o&&(r=!1,o=s.section),r&&logWarning("Level unreachable due to previous GOTO.",s.lineNumber)),n.push(s)}e.levels=n}function extractSections(e){for(var t=[],n=null,r=0;r<e.levels.length;r++){var o=e.levels[r];if(o.section!=n){var i={name:o.section,firstLevel:r};"__WIN__"==i.name?e.winSection=i:t.push(i),n=o.section}}e.sections=t}function convertSectionNamesToIndices(e){for(var t={},n={},r=0;r<e.sections.length;r++){void 0===t[l=e.sections[r].name.toLowerCase()]?t[l]=r:n[l]=!0}for(var o=0;o<e.rules.length;o++)for(var i=e.rules[o],s=0;s<i.commands.length;s++){var a=i.commands[s];if("goto"==a[0]){var l,c=t[l=a[1].toLowerCase()];void 0===c?(logError('Invalid GOTO command - There is no section named "'+a[1]+'". Either it does not exist, or it has zero levels.',i.lineNumber),c=-1):void 0!==n[l]&&(logError('Invalid GOTO command - There are multiple sections named "'+a[1]+'". Section names must be unique for GOTO to work.',i.lineNumber),c=-1),a[1]=c}}for(var u=0;u<e.levels.length;u++){var d=e.levels[u];if(void 0!==d.target){var h=d.target.toLowerCase(),p=t[h];void 0===p?(logError('Invalid GOTO command - There is no section named "'+a[1]+'".',d.lineNumber),p=0):void 0!==n[h]&&(logError('Invalid GOTO command - There are multiple sections named "'+a[1]+'".',d.lineNumber),p=0),d.target=p}}}Level.prototype.calcBackgroundMask=function(e){void 0===e.backgroundlayer&&logError("you have to have a background layer");for(var t=e.layerMasks[e.backgroundlayer],n=0;n<this.n_tiles;n++){var r=this.getCell(n);if(r.iand(t),!r.iszero())return r}return(r=new BitVec(STRIDE_OBJ)).ibitset(e.backgroundid),r};var directionaggregates={horizontal:["left","right"],horizontal_par:["left","right"],horizontal_perp:["left","right"],vertical:["up","down"],vertical_par:["up","down"],vertical_perp:["up","down"],moving:["up","down","left","right","action"],orthogonal:["up","down","left","right"],perpendicular:["^","v"],parallel:["<",">"]},relativeDirections=["^","v","<",">","perpendicular","parallel"],simpleAbsoluteDirections=["up","down","left","right"],simpleRelativeDirections=["^","v","<",">"],reg_directions_only=/^(\>|\<|\^|v|up|down|left|right|moving|stationary|no|randomdir|random|horizontal|vertical|orthogonal|perpendicular|parallel|action)$/i,commandwords=["sfx0","sfx1","sfx2","sfx3","sfx4","sfx5","sfx6","sfx7","sfx8","sfx9","sfx10","sfx11","sfx12","sfx13","cancel","checkpoint","restart","win","message","again","undo","nosave","quit","zoomscreen","flickscreen","smoothscreen","again_interval","realtime_interval","key_repeat_interval","noundo","norestart","background_color","text_color","goto","message_text_align","achieve1","achieve2","achieve3","achieve4","achieve5"];function directionalRule(e){for(var t=0;t<e.lhs.length;t++){if((i=e.lhs[t]).length>1)return!0;for(var n=0;n<i.length;n++)for(var r=i[n],o=0;o<r.length;o+=2)if(relativeDirections.indexOf(r[o])>=0)return!0}for(t=0;t<e.rhs.length;t++){var i;if((i=e.rhs[t]).length>1)return!0;for(n=0;n<i.length;n++)for(r=i[n],o=0;o<r.length;o+=2)if(relativeDirections.indexOf(r[o])>=0)return!0}return!1}function findIndexAfterToken(e,t,n){e=e.toLowerCase();for(var r=0,o=0;o<=n;o++){var i=t[o];r=e.indexOf(i,r)+i.length}return r}function rightBracketToRightOf(e,t){for(;t<e.length;t++)if("]"===e[t])return!0;return!1}function processRuleString(e,t,n){var r=e[0],o=e[1],i=e[2];"+"===(r=(r=r.replace(/\[/g," [ ").replace(/\]/g," ] ").replace(/\|/g," | ").replace(/\-\>/g," -> ")).trim())[0]&&(r=r.substring(0,1)+" "+r.substring(1,r.length));var s=r.split(/\s/).filter((function(e){return""!==e}));0==s.length&&logError("Spooky error!  Empty line passed to rule function.",o);var a=0,l=[],c=null,u=[],d=!1,h=!1,p=[],f=[],g=!1,m=!1,v=o,y=[],_=!1,b=!1,w=!1;if(1===s.length){if("startloop"===s[0])return M={bracket:1};if("endloop"===s[0])return M={bracket:-1}}-1==s.indexOf("->")&&logError("A rule has to have an arrow in it.  There's no arrow here! Consider reading up about rules - you're clearly doing something weird",o);c=[];for(var S=0,C=0;C<s.length;C++){var I=s[C];switch(a){case 0:"+"===I?(b=!0,v===o?(0==n.length&&logError('The "+" symbol, for joining a rule with the group of the previous rule, needs a previous rule to be applied to.'),0!==C&&logError('The "+" symbol, for joining a rule with the group of the previous rule, must be the first symbol on the line '),v=n[n.length-1].groupNumber):logError('Two "+"s ("append to previous rule group" symbol) applied to the same rule.',o)):I in directionaggregates?l=l.concat(directionaggregates[I]):"late"===I?g=!0:"rigid"===I?m=!0:"random"===I?(_=!0,b&&logError("A rule-group can only be marked random by the opening rule in the group (aka, a '+' and 'random' can't appear as rule modifiers on the same line).  Why? Well, you see \"random\" isn't a property of individual rules, but of whole rule groups.  It indicates that a single possible application of some rule from the whole group should be applied at random.",o)):"global"===I?w=!0:simpleAbsoluteDirections.indexOf(I)>=0?l.push(I):simpleRelativeDirections.indexOf(I)>=0?logError('You cannot use relative directions ("^v<>") to indicate in which direction(s) a rule applies.  Use absolute directions indicators (Up, Down, Left, Right, Horizontal, or Vertical, for instance), or, if you want the rule to apply in all four directions, do not specify directions',o):"["==I?(0==l.length&&(l=l.concat(directionaggregates.orthogonal)),a=1,C--):logError("The start of a rule must consist of some number of directions (possibly 0), before the first bracket, specifying in what directions to look (with no direction specified, it applies in all four directions).  It seems you've just entered \""+I.toUpperCase()+'".',o);break;case 1:if("["==I)++S>1&&logWarning("Multiple opening brackets without closing brackets.  Something fishy here.  Every '[' has to be closed by a ']', and you can't nest them.",o),c.length>0&&logError('Error, malformed cell rule - encountered a "["" before previous bracket was closed',o),d=!0,c=[];else if(reg_directions_only.exec(I))c.length%2==1?logError("Error, an item can only have one direction/action at a time, but you're looking for several at once!",o):d?g&&"no"!==I&&"random"!==I&&"randomdir"!==I?logError("Movements cannot appear in late rules.",o):c.push(I):logWarning("Invalid syntax. Directions should be placed at the start of a rule.",o);else if("|"==I)d?c.length%2==1?logError("In a rule, if you specify a force, it has to act on an object.",o):(u.push(c),c=[]):logWarning('Janky syntax.  "|" should only be used inside cell rows (the square brackety bits).',o);else if("]"===I)--S<0&&logWarning("Multiple closing brackets without corresponding opening brackets.  Something fishy here.  Every '[' has to be closed by a ']', and you can't nest them.",o),c.length%2==1?"..."===c[0]?logError("Cannot end a rule with ellipses.",o):logError("In a rule, if you specify a force, it has to act on an object.",o):(u.push(c),c=[]),h?f.push(u):p.push(u),u=[],d=!1;else if("->"===I)d?logError('Encountered an unexpected "->" inside square brackets.  It\'s used to separate states, it has no place inside them >:| .',o):h?logError('Error, you can only use "->" once in a rule; it\'s used to separate before and after states.',o):h=!0;else if(t.names.indexOf(I)>=0)d?c.length%2==0?(c.push(""),c.push(I)):c.length%2==1&&c.push(I):logWarning("Invalid token "+I.toUpperCase()+". Object names should only be used within cells (square brackets).",o);else if("..."===I)d?(c.push(I),c.push(I)):logWarning("Invalid syntax, ellipses should only be used within cells (square brackets).",o);else if(commandwords.indexOf(I.toLowerCase())>=0)if(!1===h?logError("Commands should only appear at the end of rules, not in or before the pattern-detection/-replacement sections.",o):(d||rightBracketToRightOf(s,C))&&logWarning("Commands should only appear at the end of rules, not in or before the pattern-detection/-replacement sections.",o),"message"===I.toLowerCase()){var x=findIndexAfterToken(i,s,C);""===(O=i.substring(x).trim())&&(O=" "),y.push([I.toLowerCase(),O]),C=s.length}else if("goto"===I.toLowerCase()){x=findIndexAfterToken(i,s,C);""===(O=i.substring(x).trim())&&(O=" "),y.push([I.toLowerCase(),O]),C=s.length}else if(twiddleable_params.includes(I.toLowerCase())){if(t.metadata.includes("runtime_metadata_twiddling")){var O;x=findIndexAfterToken(i,s,C);""===(O=i.substring(x).trim())&&(O=" "),y.push([I.toLowerCase(),O])}else logError("You can only change a flag at runtime if you have the 'runtime_metadata_twiddling' prelude flag defined!",o);C=s.length}else y.push([I.toLowerCase()]);else logError('Error, malformed cell rule - was looking for cell contents, but found "'+I+'".  What am I supposed to do with this, eh, please tell me that.',o)}}if(p.length!=f.length)y.length>0&&0==f.length||logError("Error, when specifying a rule, the number of matches (square bracketed bits) on the left hand side of the arrow must equal the number on the right",o);else for(C=0;C<p.length;C++)p[C].length!=f[C].length&&(logError("In a rule, each pattern to match on the left must have a corresponding pattern on the right of equal length (number of cells).",o),t.invalid=!0),0==p[C].length&&logError("You have an totally empty pattern on the left-hand side.  This will match *everything*.  You certainly don't want this.");0==p.length&&logError("This rule refers to nothing.  What the heck? :O",o);var M={directions:l,lhs:p,rhs:f,lineNumber:o,late:g,rigid:m,groupNumber:v,commands:y,randomRule:_,globalRule:w};return!1===directionalRule(M)&&M.directions.length>1&&M.directions.splice(1),M}function deepCloneHS(e){return e.map((function(e){return e.map((function(e){return e.slice()}))}))}function deepCloneRule(e){return{direction:e.direction,lhs:deepCloneHS(e.lhs),rhs:deepCloneHS(e.rhs),lineNumber:e.lineNumber,late:e.late,rigid:e.rigid,groupNumber:e.groupNumber,commands:e.commands,randomRule:e.randomRule,globalRule:e.globalRule}}function rulesToArray(e){for(var t=e.rules,n=[],r=[],o=0;o<t.length;o++){var i=t[o][1],s=processRuleString(t[o],e,n);void 0===s.bracket?n.push(s):r.push([i,s.bracket])}e.loops=r;var a=[];for(o=0;o<n.length;o++)for(var l=(g=n[o]).directions,c=0;c<l.length;c++){var u=l[c];if(u in directionaggregates&&directionalRule(g))for(var d=directionaggregates[u],h=0;h<d.length;h++){var p;(p=deepCloneRule(g)).direction=d[h],a.push(p)}else(p=deepCloneRule(g)).direction=u,a.push(p)}for(o=0;o<a.length;o++){if(convertRelativeDirsToAbsolute(g=a[o]),rewriteUpLeftRules(g),atomizeAggregates(e,g),e.invalid)return;rephraseSynonyms(e,g)}var f=[];for(o=0;o<a.length;o++){var g=a[o];f=f.concat(concretizeMovingRule(e,g,g.lineNumber))}var m=[];for(o=0;o<f.length;o++){g=f[o];m=m.concat(concretizePropertyRule(e,g,g.lineNumber))}for(o=0;o<m.length;o++)makeSpawnedObjectsStationary(e,m[o],g.lineNumber);e.rules=m}function containsEllipsis(e){for(var t=0;t<e.lhs.length;t++)for(var n=0;n<e.lhs[t].length;n++)if("..."===e.lhs[t][n][1])return!0;return!1}function rewriteUpLeftRules(e){if(!containsEllipsis(e)){if("up"==e.direction)e.direction="down";else{if("left"!=e.direction)return;e.direction="right"}for(var t=0;t<e.lhs.length;t++)e.lhs[t].reverse(),e.rhs.length>0&&e.rhs[t].reverse()}}function getPossibleObjectsFromCell(e,t){for(var n=[],r=0;r<t.length;r+=2){t[r];var o=t[r+1];if(o in e.objects)n.push(o);else if(o in e.propertiesDict)for(var i=e.propertiesDict[o],s=0;s<i.length;s++){var a=i[s];n.push(a)}}return n}function getPropertiesFromCell(e,t){for(var n=[],r=0;r<t.length;r+=2){var o=t[r],i=t[r+1];"random"!=o&&(i in e.propertiesDict&&n.push(i))}return n}function getMovings(e,t){for(var n=[],r=0;r<t.length;r+=2){var o=t[r],i=t[r+1];o in directionaggregates&&n.push([i,o])}return n}function concretizePropertyInCell(e,t,n){for(var r=0;r<e.length;r+=2)e[r+1]===t&&"random"!==e[r]&&(e[r+1]=n)}function concretizeMovingInCell(e,t,n,r){for(var o=0;o<e.length;o+=2)e[o]===t&&e[o+1]===n&&(e[o]=r)}function concretizeMovingInCellByAmbiguousMovementName(e,t,n){for(var r=0;r<e.length;r+=2)e[r]===t&&(e[r]=n)}function expandNoPrefixedProperties(e,t){for(var n=[],r=0;r<t.length;r+=2){var o=t[r],i=t[r+1];if("no"===o&&i in e.propertiesDict)for(var s=e.propertiesDict[i],a=0;a<s.length;a++){var l=s[a];n.push(o),n.push(l)}else n.push(o),n.push(i)}return n}function concretizePropertyRule(e,t,n){for(var r=0;r<t.lhs.length;r++)for(var o=t.lhs[r],i=0;i<o.length;i++)o[i]=expandNoPrefixedProperties(e,o[i]),t.rhs.length>0&&(t.rhs[r][i]=expandNoPrefixedProperties(e,t.rhs[r][i]));var s,a={};for(i=0;i<t.rhs.length;i++)for(var l=t.lhs[i],c=t.rhs[i],u=0;u<c.length;u++)for(var d=getPropertiesFromCell(e,l[u]),h=getPropertiesFromCell(e,c[u]),p=0;p<h.length;p++){var f=h[p];-1==d.indexOf(f)&&(a[f]=!0)}for(var g=[t],m=!0;m;){m=!1;for(r=0;r<g.length;r++){var v=g[r];s=!1;for(i=0;i<v.lhs.length&&!s;i++){var y=v.lhs[i];for(u=0;u<y.length&&!s;u++){var _=getPropertiesFromCell(e,y[u]);for(p=0;p<_.length;++p){f=_[p];if(!e.propertiesSingleLayer.hasOwnProperty(f)||!0===a[f]){var b=e.propertiesDict[f];s=!0,m=!0;for(var w=0;w<b.length;w++){var S=b[w],C=deepCloneRule(v);for(var I in C.propertyReplacement={},v.propertyReplacement)if(v.propertyReplacement.hasOwnProperty(I)){var x=v.propertyReplacement[I];C.propertyReplacement[I]=[x[0],x[1]]}concretizePropertyInCell(C.lhs[i][u],f,S),C.rhs.length>0&&concretizePropertyInCell(C.rhs[i][u],f,S),void 0===C.propertyReplacement[f]?C.propertyReplacement[f]=[S,1]:C.propertyReplacement[f][1]=C.propertyReplacement[f][1]+1,g.push(C)}break}}}}s&&(g.splice(r,1),r--)}}for(r=0;r<g.length;r++){if(void 0!==(v=g[r]).propertyReplacement)for(var f in v.propertyReplacement)if(v.propertyReplacement.hasOwnProperty(f)){var O=v.propertyReplacement[f];S=O[0];if(1===O[1])for(i=0;i<v.rhs.length;i++){var M=v.rhs[i];for(u=0;u<M.length;u++){concretizePropertyInCell(M[u],f,S)}}}}var k="";for(r=0;r<g.length;r++){v=g[r];delete g.propertyReplacement;for(i=0;i<v.rhs.length;i++)for(y=v.rhs[i],u=0;u<y.length;u++)for(_=getPropertiesFromCell(e,y[u]),p=0;p<_.length;p++)a.hasOwnProperty(_[p])&&(k=_[p])}return k.length>0&&logError('This rule has a property on the right-hand side, "'+k.toUpperCase()+"\", that can't be inferred from the left-hand side.  (either for every property on the right there has to be a corresponding one on the left in the same cell, OR, if there's a single occurrence of a particular property name on the left, all properties of the same name on the right are assumed to be the same).",n),g}function makeSpawnedObjectsStationary(e,t,n){if(!t.late)for(var r=0;r<t.rhs.length;r++)for(var o=t.lhs[r],i=t.rhs[r],s=0;s<i.length;s++)for(var a=i[s],l=getPossibleObjectsFromCell(e,o[s]),c=l.map((t=>e.objects[t].layer)),u=0;u<a.length;u+=2){if(""===a[u]){var d=a[u+1];if(!(d in e.propertiesDict||l.indexOf(d)>=0)){var h=e.objects[d].layer;-1===c.indexOf(h)&&(a[u]="stationary")}}}}function concretizeMovingRule(e,t,n){for(var r,o=[t],i=!0;i;){i=!1;for(var s=0;s<o.length;s++){var a=o[s];r=!1;for(var l=0;l<a.lhs.length;l++)for(var c=a.lhs[l],u=0;u<c.length;u++){if((E=getMovings(e,c[u])).length>0){r=!0,i=!0;for(var d=E[0][0],h=E[0][1],p=directionaggregates[h],f=0;f<p.length;f++){var g=p[f],m=deepCloneRule(a);for(var v in m.movingReplacement={},a.movingReplacement)if(a.movingReplacement.hasOwnProperty(v)){var y=a.movingReplacement[v];m.movingReplacement[v]=[y[0],y[1],y[2],y[3],y[4],y[5]]}for(var v in m.aggregateDirReplacement={},a.aggregateDirReplacement)if(a.aggregateDirReplacement.hasOwnProperty(v)){y=a.aggregateDirReplacement[v];m.aggregateDirReplacement[v]=[y[0],y[1],y[2]]}if(concretizeMovingInCell(m.lhs[l][u],h,d,g),m.rhs.length>0&&concretizeMovingInCell(m.rhs[l][u],h,d,g),void 0===m.movingReplacement[d+h])m.movingReplacement[d+h]=[g,1,h,d,l,u];else{var _=m.movingReplacement[d+h];l===_[4]&&u===_[5]||(_[1]=_[1]+1)}void 0===m.aggregateDirReplacement[h]?m.aggregateDirReplacement[h]=[g,1,h]:m.aggregateDirReplacement[h][1]=m.aggregateDirReplacement[h][1]+1,o.push(m)}}}r&&(o.splice(s,1),s--)}}for(s=0;s<o.length;s++){if(void 0!==(a=o[s]).movingReplacement){var b={};for(var d in a.movingReplacement)if(a.movingReplacement.hasOwnProperty(d)){var w=(M=a.movingReplacement[d])[0],S=M[1],C=M[2],I=M[3];if(1===S)for(l=0;l<a.rhs.length;l++){var x=a.rhs[l];for(u=0;u<x.length;u++){concretizeMovingInCell(x[u],C,I,w)}}}var O={};for(var d in a.aggregateDirReplacement)if(a.aggregateDirReplacement.hasOwnProperty(d)){var M;w=(M=a.aggregateDirReplacement[d])[0],S=M[1];O[C=M[2]]=C in O||1!==S?"INVALID":w}for(var C in b)if(b.hasOwnProperty(C)&&"INVALID"!==C){if("INVALID"===(w=b[C]))continue;for(l=0;l<a.rhs.length;l++)for(x=a.rhs[l],u=0;u<x.length;u++){concretizeMovingInCellByAmbiguousMovementName(x[u],C,w)}}for(var C in O)if(O.hasOwnProperty(C)&&"INVALID"!==C){if("INVALID"===(w=O[C]))continue;for(l=0;l<a.rhs.length;l++)for(x=a.rhs[l],u=0;u<x.length;u++){concretizeMovingInCellByAmbiguousMovementName(x[u],C,w)}}}}var k="";for(s=0;s<o.length;s++){a=o[s];delete o.movingReplacement;for(l=0;l<a.rhs.length;l++)for(c=a.rhs[l],u=0;u<c.length;u++){var E;(E=getMovings(e,c[u])).length>0&&(k=E[0][1])}}return k.length>0&&(logError('This rule has an ambiguous movement on the right-hand side, "'+k+"\", that can't be inferred from the left-hand side.  (either for every ambiguous movement associated to an entity on the right there has to be a corresponding one on the left attached to the same entity, OR, if there's a single occurrence of a particular ambiguous movement on the left, all properties of the same movement attached to the same object on the right are assumed to be the same (or something like that)).",n),e.invalid=!0),o}function rephraseSynonyms(e,t){for(var n=0;n<t.lhs.length;n++)for(var r=t.lhs[n],o=t.rhs[n],i=0;i<r.length;i++){for(var s=r[i],a=1;a<s.length;a+=2){s[a]in e.synonymsDict&&(s[a]=e.synonymsDict[s[a]])}if(t.rhs.length>0){var l=o[i];for(a=1;a<l.length;a+=2){l[a]in e.synonymsDict&&(l[a]=e.synonymsDict[l[a]])}}}}function atomizeAggregates(e,t){for(var n=0;n<t.lhs.length;n++)for(var r=t.lhs[n],o=0;o<r.length;o++){atomizeCellAggregates(e,r[o],t.lineNumber)}for(n=0;n<t.rhs.length;n++)for(r=t.rhs[n],o=0;o<r.length;o++){atomizeCellAggregates(e,r[o],t.lineNumber)}}function atomizeCellAggregates(e,t,n){for(var r=0;r<t.length;r+=2){var o=t[r],i=t[r+1];if(i in e.aggregatesDict){"no"===o&&logError("You cannot use 'no' to exclude the aggregate object "+i.toUpperCase()+" (defined using 'AND'), only regular objects, or properties (objects defined using 'OR').  If you want to do this, you'll have to write it out yourself the long way.",n);var s=e.aggregatesDict[i];t[r+1]=s[0];for(var a=1;a<s.length;a++)t.push(t[r]),t.push(s[a])}}}function convertRelativeDirsToAbsolute(e){for(var t=e.direction,n=0;n<e.lhs.length;n++)for(var r=e.lhs[n],o=0;o<r.length;o++){absolutifyRuleCell(t,r[o])}for(n=0;n<e.rhs.length;n++)for(r=e.rhs[n],o=0;o<r.length;o++){absolutifyRuleCell(t,r[o])}}var relativeDirs=["^","v","<",">","parallel","perpendicular"],relativeDict={right:["up","down","left","right","horizontal_par","vertical_perp"],up:["left","right","down","up","vertical_par","horizontal_perp"],down:["right","left","up","down","vertical_par","horizontal_perp"],left:["down","up","right","left","horizontal_par","vertical_perp"]};function absolutifyRuleCell(e,t){for(var n=0;n<t.length;n+=2){var r=t[n],o=relativeDirs.indexOf(r);o>=0&&(t[n]=relativeDict[e][o])}}var dirMasks={up:parseInt("00001",2),down:parseInt("00010",2),left:parseInt("00100",2),right:parseInt("01000",2),moving:parseInt("01111",2),no:parseInt("00011",2),randomdir:parseInt("00101",2),random:parseInt("10010",2),action:parseInt("10000",2),"":parseInt("00000",2)};function rulesToMask(e){for(var t=e.collisionLayers.length,n=[],r=0;r<t;r++)n.push(null);for(r=0;r<e.rules.length;r++)for(var o=e.rules[r],i=0;i<o.lhs.length;i++)for(var s=o.lhs[i],a=o.rhs[i],l=0;l<s.length;l++){for(var c=s[l],u=n.concat([]),d=new BitVec(STRIDE_OBJ),h=new BitVec(STRIDE_OBJ),p=[],f=new BitVec(STRIDE_MOV),g=new BitVec(STRIDE_MOV),m=new BitVec(STRIDE_MOV),v=0;v<c.length;v+=2){if("..."===(P=c[v])){if(d=ellipsisPattern,2!==c.length)logError("You can't have anything in with an ellipsis. Sorry.",o.lineNumber);else if(0===l||l===s.length-1)logError("There's no point in putting an ellipsis at the very start or the end of a rule",o.lineNumber);else if(o.rhs.length>0){2===(S=a[l]).length&&"..."===S[0]||logError("An ellipsis on the left must be matched by one in the corresponding place on the right.",o.lineNumber)}break}if("random"!==P){var y=c[v+1],_=e.objects[y],b=e.objectMasks[y];if(_)var w=0|_.layer;else w=e.propertiesSingleLayer[y];if(void 0===w&&logError("Oops!  "+y.toUpperCase()+" not assigned to a layer.",o.lineNumber),"no"===P)h.ior(b);else null!==(V=u[w])&&(o.discard=[y.toUpperCase(),V.toUpperCase()]),u[w]=y,_?(d.ior(b),m.ishiftor(31,5*w)):p.push(b),"stationary"===P?g.ishiftor(31,5*w):f.ishiftor(dirMasks[P],5*w)}else logError("'random' cannot be matched on the left-hand side, it can only appear on the right",o.lineNumber)}if(o.rhs.length>0){var S=a[l],C=s[l];"..."===S[0]&&"..."!==C[0]&&logError("An ellipsis on the right must be matched by one in the corresponding place on the left.",o.lineNumber);for(v=0;v<S.length;v+=2){"..."===S[v]&&2!==S.length&&logError("You can't have anything in with an ellipsis. Sorry.",o.lineNumber)}}if(d!==ellipsisPattern){if(s[l]=new CellPattern([d,h,p,f,g,null]),d.anyBitsInCommon(h)){var I=o.lineNumber;r>0&&e.rules[r-1].lineNumber===I||r+1<e.rules.length&&e.rules[r+1].lineNumber===I||logError('This rule has some content of the form "X no X" which can never match and so the rule is getting removed during compilation.',o.lineNumber),e.rules.splice(r,1),r--}else if(0!==o.rhs.length){var x=a[l],O=n.concat([]),M=n.concat([]),k=new BitVec(STRIDE_OBJ),E=new BitVec(STRIDE_OBJ),N=new BitVec(STRIDE_MOV),T=new BitVec(STRIDE_MOV),L=new BitVec(STRIDE_MOV),A=new BitVec(STRIDE_OBJ),R=new BitVec(STRIDE_MOV),D=new BitVec(STRIDE_MOV);for(v=0;v<x.length;v+=2){var P=x[v];y=x[v+1];if("..."===P)break;if("random"!==P){_=e.objects[y],b=e.objectMasks[y];if(_)w=0|_.layer;else w=e.propertiesSingleLayer[y];if("no"==P)k.ior(b);else{null===(V=O[w])&&(V=M[w]),null!==V&&(o.hasOwnProperty("discard")||logError("Rule matches object types that can't overlap: \""+y.toUpperCase()+'" and "'+V.toUpperCase()+'".',o.lineNumber)),O[w]=y,P.length>0&&R.ishiftor(31,5*w);var F=e.layerMasks[w];_&&(E.ibitset(_.id),k.ior(F),L.ishiftor(31,5*w)),"stationary"===P&&N.ishiftor(31,5*w),"randomdir"===P?D.ishiftor(dirMasks[P],5*w):T.ishiftor(dirMasks[P],5*w)}}else if(y in e.objectMasks){var B,j=e.objectMasks[y];A.ior(j),B=e.propertiesDict.hasOwnProperty(y)?e.propertiesDict[y]:[y];for(var z=0;z<B.length;z++){var V,U=B[z];if(null!==(V=O[w=0|e.objects[U].layer])){var H=U.toUpperCase(),G=V.toUpperCase();H!==G&&logWarning("This rule may try to spawn a "+H+" with random, but also requires a "+G+" be here, which is on the same layer - they shouldn't be able to coexist!",o.lineNumber)}M[w]=U}}else logError('You want to spawn a random "'+y.toUpperCase()+"\", but I don't know how to do that",o.lineNumber)}d.bitsSetInArray(E.data)||k.ior(d),f.bitsSetInArray(T.data)||N.ior(f);for(v=0;v<t;v++)null!==u[v]&&null===O[v]&&(k.ior(e.layerMasks[v]),R.ishiftor(31,5*v));m.iclear(L),R.ior(m),k.iszero()&&E.iszero()&&N.iszero()&&T.iszero()&&R.iszero()&&A.iszero()&&D.iszero()||(s[l].replacement=new CellReplacement([k,E,N,T,R,A,D]))}}else s[l]=ellipsisPattern}}function cellRowMasks(e){for(var t=[],n=e[1],r=0;r<n.length;r++){for(var o=n[r],i=new BitVec(STRIDE_OBJ),s=0;s<o.length;s++)o[s]!==ellipsisPattern&&i.ior(o[s].objectsPresent);t.push(i)}return t}function cellRowMasks_Movements(e){for(var t=[],n=e[1],r=0;r<n.length;r++){for(var o=n[r],i=new BitVec(STRIDE_MOV),s=0;s<o.length;s++)o[s]!==ellipsisPattern&&i.ior(o[s].movementsPresent);t.push(i)}return t}function collapseRules(e){for(var t=0;t<e.length;t++)for(var n=e[t],r=0;r<n.length;r++){for(var o=n[r],i=[0,[],o.rhs.length>0,o.lineNumber],s=[],a=0;a<o.lhs.length;a++)s.push(!1);i[0]=dirMasks[o.direction];for(a=0;a<o.lhs.length;a++){for(var l=o.lhs[a],c=0;c<l.length;c++)l[c]===ellipsisPattern&&(s[a]&&logError("You can't use two ellipses in a single cell match pattern.  If you really want to, please implement it yourself and send me a patch :) ",o.lineNumber),s[a]=!0);i[1][a]=l}i.push(s),i.push(o.groupNumber),i.push(o.rigid),i.push(o.commands),i.push(o.randomRule),i.push(cellRowMasks(i)),i.push(cellRowMasks_Movements(i)),i.push(o.globalRule),n[r]=new Rule(i)}matchCache={}}function ruleGroupDiscardOverlappingTest(e){if(0!==e.length)for(var t=0;t<e.length;t++){var n=e[t];if(n.hasOwnProperty("discard")){if(e.splice(t,1),(0===t||e[t-1].lineNumber!==n.lineNumber)&&t<e.length-1&&e[t+1].lineNumber!==n.lineNumber||0===e.length){var r=n.discard;logError(r[0]+" and "+r[1]+" can never overlap, but this rule requires that to happen.",n.lineNumber)}t--}}}function arrangeRulesByGroupNumber(e){for(var t={},n={},r=0;r<e.rules.length;r++){var o=e.rules[r],i=t;o.late&&(i=n),null==i[o.groupNumber]&&(i[o.groupNumber]=[]),i[o.groupNumber].push(o)}var s=[];for(var a in t){if(t.hasOwnProperty(a))ruleGroupDiscardOverlappingTest(c=t[a]),c.length>0&&s.push(c)}var l=[];for(var a in n){var c;if(n.hasOwnProperty(a))ruleGroupDiscardOverlappingTest(c=n[a]),c.length>0&&l.push(c)}e.rules=s,e.lateRules=l}function generateRigidGroupList(e){for(var t=[],n=[],r=[],o=[],i=[],s=0;s<e.rules.length;s++){for(var a=e.rules[s],l=!1,c=0;c<a.length;c++){a[c].isRigid&&(l=!0)}if(i[s]=l,l){var u=a[0].groupNumber;r[u]=s;var d=t.length;n[s]=d,o[u]=d,t.push(s)}}t.length>60&&logError("There can't be more than 60 rigid groups (rule groups containing rigid members).",rules[0][0][3]),e.rigidGroups=i,e.rigidGroupIndex_to_GroupIndex=t,e.groupNumber_to_RigidGroupIndex=o,e.groupIndex_to_RigidGroupIndex=n}function getMaskFromName(e,t){var n=new BitVec(STRIDE_OBJ);if(t in e.objects){var r=e.objects[t];n.ibitset(r.id)}if(t in e.aggregatesDict)for(var o=e.aggregatesDict[t],i=0;i<o.length;i++){var s=o[i];r=e.objects[s];n.ibitset(r.id)}if(t in e.propertiesDict)for(o=e.propertiesDict[t],i=0;i<o.length;i++){s=o[i],r=e.objects[s];n.ibitset(r.id)}if(t in e.synonymsDict){s=e.synonymsDict[t],r=e.objects[s];n.ibitset(r.id)}return!e.metadata.includes("nokeyboard")&&n.iszero()&&logErrorNoLine("error, didn't find any object called player, either in the objects section, or the legends section. there must be a player!"),n}function generateMasks(e){e.playerMask=getMaskFromName(e,"player");for(var t=[],n=e.collisionLayers.length,r=0;r<n;r++){for(var o=new BitVec(STRIDE_OBJ),i=0;i<e.objectCount;i++){var s=e.idDict[i];(l=e.objects[s]).layer==r&&o.ibitset(l.id)}t.push(o)}e.layerMasks=t;var a={};for(var s in e.objects)if(e.objects.hasOwnProperty(s)){var l=e.objects[s];a[s]=new BitVec(STRIDE_OBJ),a[s].ibitset(l.id)}var c=e.legend_synonyms.concat(e.legend_properties);c.sort((function(e,t){return e.lineNumber-t.lineNumber}));for(var u=0;u<c.length;u++){var d=c[u];if(2==d.length)a[d[0]]=a[d[1]];else{var h=new BitVec(STRIDE_OBJ);for(i=1;i<d.length;i++){s=d[i];h.ior(a[s])}a[d[0]]=h}}var p=new BitVec(STRIDE_OBJ);p.inot(),a["\nall\n"]=p,e.objectMasks=a}function checkObjectsAreLayered(e){for(var t in e.objects)if(e.objects.hasOwnProperty(t)){for(var n=!1,r=0;r<e.collisionLayers.length;r++){for(var o=e.collisionLayers[r],i=0;i<o.length;i++)if(o[i]===t){n=!0;break}if(n)break}if(!1===n){var s=e.objects[t];logError('Object "'+t.toUpperCase()+'" has been defined, but not assigned to a layer.',s.lineNumber)}}}function twiddleMetaData(e,t=!1){var n;if(t)n=e.metadata;else{n={};for(var r=0;r<e.metadata.length;r+=2){var o=e.metadata[r],i=e.metadata[r+1];n[o]=i}}if(void 0!==n.flickscreen){var s=(i=n.flickscreen).split("x"),a=[parseInt(s[0]),parseInt(s[1])];n.flickscreen=a}if(void 0!==n.zoomscreen){s=(i=n.zoomscreen).split("x"),a=[parseInt(s[0]),parseInt(s[1])];n.zoomscreen=a}if(void 0!==n.smoothscreen){var l=(i=n.smoothscreen).split(/\s+/),c=!0;l.length<1?(logErrorNoLine("smoothscreen given no arguments but expects at least 1: smoothscreen [flick] WxH [IxJ] [S]"),c=!1):l.length>4&&(logErrorNoLine("smoothscreen given "+l.length+" arguments but expects at most 4: smoothscreen [flick] WxH [IxJ] [S]"),c=!1);const e={screenSize:{width:0,height:0},boundarySize:{width:1,height:1},cameraSpeed:.125,flick:!1,debug:!!n.smoothscreen_debug};"flick"===l[0]&&(e.flick=!0,l.shift());const t=l[0].match(/^(?<width>\d+)x(?<height>\d+)$/);if(t?(e.screenSize.width=parseInt(t.groups.width),e.screenSize.height=parseInt(t.groups.height),e.flick&&(e.boundarySize.width=e.screenSize.width,e.boundarySize.height=e.screenSize.height)):(logErrorNoLine("smoothscreen given first argument "+l[0]+" but must be formatted WxH where W and H are integers"),c=!1),l.length>1){const t=l[1].match(/^(?<width>\d+)x(?<height>\d+)$/);t?(e.boundarySize.width=parseInt(t.groups.width),e.boundarySize.height=parseInt(t.groups.height)):(logErrorNoLine("smoothscreen given second argument "+l[1]+" but must be formatted IxJ where I and J are integers"),c=!1)}if(l.length>2){const t=l[2].match(/^(?<speed>\d+(\.\d+)?)$/);t?e.cameraSpeed=clamp(parseFloat(t.groups.speed),0,1):(logErrorNoLine("smoothscreen given third argument "+l[2]+" but must be a number"),c=!1)}c?n.smoothscreen=e:delete n.smoothscreen}e.metadata=n,t||(e.default_metadata=deepClone(n))}function processWinConditions(e){for(var t=[],n=0;n<e.winconditions.length;n++){var r=e.winconditions[n];if(0==r.length)return;var o=0;switch(r[0]){case"no":o=-1;break;case"all":o=1}var i,s=r[r.length-1],a=r[1];i=5==r.length?r[3]:"\nall\n";var l=0,c=0;a in e.objectMasks?l=e.objectMasks[a]:logError('Unwelcome term "'+a+'" found in win condition. Win conditions objects have to be objects or properties (defined using "or", in terms of other properties)',s),i in e.objectMasks?c=e.objectMasks[i]:logError('Unwelcome term "'+i+'" found in win condition. Win conditions objects have to be objects or properties (defined using "or", in terms of other properties)',s);var u=[o,l,c,s];t.push(u)}e.winconditions=t}function printCellRow(e){for(var t="[ ",n=0;n<e.length;n++){n>0&&(t+="| ");for(var r=e[n],o=0;o<r.length;o+=2){var i=r[o],s=r[o+1];t+="..."===i?i+" ":i+" "+s+" "}}return t+="] "}function cacheRuleStringRep(e){var t="(<a onclick=\"jumpToLine('"+e.lineNumber.toString()+'\');"  href="javascript:void(0);">'+e.lineNumber+"</a>) "+e.direction.toString().toUpperCase()+" ";e.rigid&&(t="RIGID "+t+" "),e.randomRule&&(t="RANDOM "+t+" "),e.globalRule&&(t="GLOBAL "+t+" "),e.late&&(t="LATE "+t+" ");for(var n=0;n<e.lhs.length;n++){t+=printCellRow(e.lhs[n])}t+="-> ";for(n=0;n<e.rhs.length;n++){t+=printCellRow(e.rhs[n])}for(n=0;n<e.commands.length;n++){var r=e.commands[n];1===r.length?t+=r[0].toString():t=t+"("+r[0].toString()+", "+r[1].toString()+") "}e.stringRep=t}function cacheAllRuleNames(e){for(var t=0;t<e.rules.length;t++){cacheRuleStringRep(e.rules[t])}}function printRules(e){for(var t="",n=0,r=-1,o=0,i=0;i<e.rules.length;i++){var s=e.rules[i];n<e.loops.length&&e.loops[n][0]<s.lineNumber&&(t+="STARTLOOP<br>",++n<e.loops.length&&(r=e.loops[n][0],n++)),-1!==r&&r<s.lineNumber&&(t+="ENDLOOP<br>",r=-1),s.hasOwnProperty("discard")?o++:t+=s.stringRep+"<br>"}-1!==r&&(t+="ENDLOOP<br>"),t+="===========<br>",consolePrint(t="<br>Rule Assembly : ("+(e.rules.length-o)+" rules)<br>===========<br>"+t)}function removeDuplicateRules(e){for(var t={},n=-1,r=e.rules.length-1;r>=0;r--){var o=e.rules[r],i=o.groupNumber;i!==n&&(t={});var s=o.stringRep;t.hasOwnProperty(s)?e.rules.splice(r,1):t[s]=!0,n=i}}function generateLoopPoints(e){var t={},n=!0,r=0;e.loops.length%2==1&&logErrorNoLine("have to have matching number of  'startLoop' and 'endLoop' loop points.");for(var o=0;o<e.loops.length;o++)for(var i=e.loops[o],s=0;s<e.rules.length;s++){var a=(u=e.rules[s])[0],l=u[u.length-1],c=a.lineNumber;l.lineNumber;if(n){if(c>=i[0]){r=s,n=!1,-1===i[1]&&logErrorNoLine("Need have to have matching number of  'startLoop' and 'endLoop' loop points.");break}}else if(c>=i[0]){t[s-1]=r,n=!0,1===i[1]&&logErrorNoLine("Need have to have matching number of  'startLoop' and 'endLoop' loop points.");break}}!1===n&&(t[e.rules.length]=r);e.loopPoint=t,t={},n=!0;for(o=0;o<e.loops.length;o++)for(i=e.loops[o],s=0;s<e.lateRules.length;s++){var u;a=(u=e.lateRules[s])[0],l=u[u.length-1],c=a.lineNumber,l.lineNumber;if(n){if(c>=i[0]){r=s,n=!1,-1===i[1]&&logErrorNoLine("Need have to have matching number of  'startLoop' and 'endLoop' loop points.");break}}else if(c>=i[0]){t[s-1]=r,n=!0,1===i[1]&&logErrorNoLine("Need have to have matching number of  'startLoop' and 'endLoop' loop points.");break}}!1===n&&(t[e.lateRules.length]=r);e.lateLoopPoint=t}var soundEvents=["titlescreen","startgame","cancel","endgame","startlevel","undo","restart","endlevel","enterlevelselect","showmessage","closemessage","sfx0","sfx1","sfx2","sfx3","sfx4","sfx5","sfx6","sfx7","sfx8","sfx9","sfx10","sfx11","sfx12","sfx13"],soundMaskedEvents=["create","destroy","move","cantmove","action"],soundVerbs=soundEvents.concat(soundMaskedEvents);function validSeed(e){return null!==/^\s*\d+\s*$/.exec(e)}var soundDirectionIndicatorMasks={up:parseInt("00001",2),down:parseInt("00010",2),left:parseInt("00100",2),right:parseInt("01000",2),horizontal:parseInt("01100",2),vertical:parseInt("00011",2),orthogonal:parseInt("01111",2),___action____:parseInt("10000",2)},soundDirectionIndicators=["up","down","left","right","horizontal","vertical","orthogonal","___action____"];function generateSoundData(e){for(var t={},n=[],r=[],o=[],i=[],s=0;s<e.sounds.length;s++){var a=e.sounds[s];if(!(a.length<=1)){var l=a[a.length-1];if(2!==a.length)if(soundEvents.indexOf(a[0])>=0){a.length>4&&logError("too much stuff to define a sound event.",l),validSeed(h=a[1])?(void 0!==t[a[0]]&&logWarning(a[0].toUpperCase()+" already declared.",l),t[a[0]]=a[1]):logError('Expecting sfx data, instead found "'+a[1]+'".',l)}else{var c=a[0].trim(),u=a[1].trim(),d=a.slice(2,a.length-2);d.length>0&&"move"!==u&&"cantmove"!==u&&logError("incorrect sound declaration.",l),"action"===u&&(u="move",d=["___action____"]),0==d.length&&(d=["orthogonal"]);var h=a[a.length-2];c in e.aggregatesDict?logError('cannot assign sound events to aggregate objects (declared with "and"), only to regular objects, or properties, things defined in terms of "or" ("'+c+'").',l):c in e.objectMasks||logError('Object "'+c+'" not found.',l);for(var p=e.objectMasks[c],f=0,g=0;g<d.length;g++){d[g]=d[g].trim();var m=d[g];if(-1===soundDirectionIndicators.indexOf(m))logError('Was expecting a direction, instead found "'+m+'".',l);else f|=soundDirectionIndicatorMasks[m]}for(var v=[c],y=!0;y;){y=!1;for(var _=0;_<v.length;_++){var b=v[_];if(b in e.synonymsDict)v[_]=e.synonymsDict[b],y=!0;else if(b in e.propertiesDict){y=!0;var w=e.propertiesDict[b];v.splice(_,1),_--;for(var S=0;S<w.length;S++)v.push(w[S])}}}if("move"===u||"cantmove"===u)for(g=0;g<v.length;g++){var C=v[g],I=e.objects[C].layer,x=new BitVec(STRIDE_MOV);x.ishiftor(f,5*I);var O={objectMask:p,directionMask:x,seed:h};"move"===u?o.push(O):i.push(O)}switch(validSeed(h)||logError('Expecting sfx data, instead found "'+h+'".',l),u){case"create":O={objectMask:p,seed:h};n.push(O);break;case"destroy":O={objectMask:p,seed:h};r.push(O)}}else logError("incorrect sound declaration.",l)}}e.sfx_Events=t,e.sfx_CreationMasks=n,e.sfx_DestructionMasks=r,e.sfx_MovementMasks=o,e.sfx_MovementFailureMasks=i}function formatHomePage(e){if("background_color"in e.metadata?e.bgcolor=colorToHex(colorPalette,e.metadata.background_color):e.bgcolor="#000000","text_color"in e.metadata?e.fgcolor=colorToHex(colorPalette,e.metadata.text_color):e.fgcolor="#FFFFFF",!1===isColor(e.fgcolor)&&(logError("text_color in incorrect format - found "+e.fgcolor+", but I expect a color name (like 'pink') or hex-formatted color (like '#1412FA').  Defaulting to white."),e.fgcolor="#FFFFFF"),!1===isColor(e.bgcolor)&&(logError("background_color in incorrect format - found "+e.bgcolor+", but I expect a color name (like 'pink') or hex-formatted color (like '#1412FA').  Defaulting to black."),e.bgcolor="#000000"),canSetHTMLColors&&("background_color"in e.metadata&&(document.body.style.backgroundColor=e.bgcolor),"text_color"in e.metadata)){var t=document.getElementById("separator");null!=t&&(t.style.color=e.fgcolor);for(var n=document.getElementsByTagName("a"),r=0;r<n.length;r++)n[r].style.color=e.fgcolor;for(n=document.getElementsByTagName("h1"),r=0;r<n.length;r++)n[r].style.color=e.fgcolor}if("homepage"in e.metadata){var o=e.metadata.homepage;o=(o=o.replace("http://","")).replace("https://",""),e.metadata.homepage=o}}var ifrm,MAX_ERRORS=5;function loadFile(e){for(var t=new codeMirrorFn,n=t.startState(),r=e.split("\n"),o=0;o<r.length;o++){var i=r[o];n.lineNumber=o+1;var s=new CodeMirror.StringStream(i,4);do{if(t.token(s,n),errorCount>MAX_ERRORS)return void consolePrint("too many errors, aborting compilation")}while(!1===s.eol())}return generateExtraMembers(n),generateMasks(n),levelsToArray(n),extractSections(n),rulesToArray(n),n.invalid>0?null:(cacheAllRuleNames(n),removeDuplicateRules(n),n.invalid>0?null:(convertSectionNamesToIndices(n),rulesToMask(n),debugMode&&printRules(n),arrangeRulesByGroupNumber(n),collapseRules(n.rules),collapseRules(n.lateRules),generateRigidGroupList(n),processWinConditions(n),checkObjectsAreLayered(n),twiddleMetaData(n),generateExtraMembersPart2(n),generateLoopPoints(n),generateSoundData(n),formatHomePage(n),IDE&&(n.metadata.tween_length&&n.lateRules.length>=1&&logWarning("[PS+] Using tweens in a game that also has LATE rules is currently experimental! If you change objects that moved with LATE then tweens might not play!",void 0,!1),void 0!==n.metadata.level_select_unlocked_ahead&&void 0!==n.metadata.level_select_unlocked_rollover&&logWarning("[PS+] You can't use both level_select_unlocked_ahead and level_select_unlocked_rollover at the same time, so please choose only one!",void 0,!1)),delete n.commentLevel,delete n.names,delete n.abbrevNames,delete n.objects_candname,delete n.objects_section,delete n.objects_spritematrix,delete n.section,delete n.subsection,delete n.tokenIndex,delete n.visitedSections,delete n.loops,n))}function compile(e,t,n){(matchCache={},forceRegenImages=!0,void 0===e&&(e=["restart"]),void 0===n&&(n=null),lastDownTarget=canvas,void 0===t)&&(t=window.form1.code.editorreference.getValue()+"\n");!0===canDump&&(compiledText=t),errorCount=0,compiling=!0,errorStrings=[],consolePrint("=================================");try{var r=loadFile(t)}finally{compiling=!1}if(r&&r.levels&&0===r.levels.length&&logError("No levels found.  Add some levels!",void 0,!0),!(errorCount>MAX_ERRORS)){if(errorCount>0)consoleError(!1===IDE?'<span class="systemMessage">Errors detected during compilation; the game may not work correctly.  If this is an older game, and you think it just broke because of recent changes in the puzzlescript plus engine, consider letting me know via the issue tracker.</span>':'<span class="systemMessage">Errors detected during compilation; the game may not work correctly.</span>');else{for(var o=0,i=0;i<r.rules.length;i++)o+=r.rules[i].length;for(i=0;i<r.lateRules.length;i++)o+=r.lateRules[i].length;"restart"==e[0]?consolePrint('<span class="systemMessage">Successful Compilation, generated '+o+" instructions.</span>"):consolePrint('<span class="systemMessage">Successful live recompilation, generated '+o+" instructions.</span>"),IDE&&void 0!==r.metadata.title&&(document.title="PS Plus - "+r.metadata.title)}null!==r&&setGameState(r,e,n),clearInputHistory(),isSitelocked()&&IDE&&logError("The game is sitelocked. To continue testing, add the current domain '"+window.location.origin+"' to the list.",void 0,!0),consoleCacheDump()}}function qualifyURL(e){var t=document.createElement("a");return t.href=e,t.href}function isSitelocked(){if(void 0===state.metadata.sitelock_origin_whitelist&&void 0===state.metadata.sitelock_hostname_whitelist)return!1;if(1==IDE)return!1;if(void 0===state.metadata.sitelock_origin_whitelist)for(var e=state.metadata.sitelock_origin_whitelist.split(" "),t=window.location.origin,n=0;n<e.length;n+=1)if(t==e[n])return!1;if(null==state.metadata.sitelock_hostname_whitelist){var r=state.metadata.sitelock_hostname_whitelist.split(" "),o=window.location.hostname;for(n=0;n<r.length;n+=1)if(o==r[n])return!1}return!0}function jumpToLine(e){var t=parent.form1.code.editorreference,n=t.doc.lastLine(),r=e-1-10,o=e-1+10,i=e-1;r<0&&(r=0),o>n&&(o=n),i>n&&(i=n),t.scrollIntoView(r),t.scrollIntoView(o),t.scrollIntoView(i),t.setCursor(i,0)}var consolecache=[];function consolePrintFromRule(e,t,n){void 0===n&&(n=!1);var r=dirMaskName[t.direction],o='<font color="green">Rule <a onclick="jumpToLine('+t.lineNumber+');"  href="javascript:void(0);">'+t.lineNumber+"</a> "+r+" : "+e+"</font>";cache_console_messages&&0==n?consolecache.push([o,null,null,1]):addToConsole(o)}function consolePrint(e,t,n,r){void 0===t&&(t=!1),cache_console_messages&&!1===t?consolecache.push([e,n,r,1]):(consoleCacheDump(),addToConsole(e))}var cache_n=0;function addToConsole(e){cache=document.createElement("div"),cache.id="cache"+cache_n,cache.innerHTML=e,cache_n++,document.getElementById("consoletextarea").appendChild(cache),consolecache=[];var t=document.getElementById("lowerarea");t.scrollTop=t.scrollHeight}function consoleCacheDump(){if(!1!==cache_console_messages){for(var e=0;e<consolecache.length-1;e++){var t=consolecache[e],n=t[0],r=consolecache[e+1];n===r[0]&&(consolecache.splice(e,1),e--,r[3]=t[3]+1)}var o=[],i=[];for(e=0;e<consolecache.length;e++){var s=consolecache[e],a=(s[0],s[1]),l=s[2];s[3];if(0!==e&&null!=a){var c=i[0];i[1];null===l&&a==c?i[2].push(s):(i=[a,l,[s]],o.push(i))}else i=[a,l,[s]],o.push(i)}for(var u="<br>",d=0;d<o.length;d++){var h=o[d],p=(c=h[0],l=h[1],h[2]);u+="<br>",null!=l&&(u+=`<span class="hoverpreview" onmouseover="debugPreview(${l})" onmouseleave="debugUnpreview()">`);for(e=0;e<p.length;e++){e>0&&(u+='<br><span class="noeye_indent"></span>');var f=p[e],g=f[0],m=f[3];m>1&&(g+=` (x${m})`),u+=g}null!=l&&(u+="</span>")}addToConsole(u)}}function consoleError(e){consolePrint('<span class="errorText">'+e+"</span>",!0)}function clearConsole(){document.getElementById("consoletextarea").innerHTML="";var e=document.getElementById("lowerarea");e.scrollTop=e.scrollHeight,debugger_turnIndex=0,debug_visualisation_array=[],diffToVisualize=null}var clearConsoleClick=document.getElementById("clearConsoleClick");function verboseToggle(){if(titleScreen)consolePrint("Once your game is running, you can use this button to toggle Verbose Logging",!0);else{var e=!verbose_logging;cache_console_messages=e,consolePrint("Verbose logging is now "+((verbose_logging=e)?"ENABLED":"DISABLED"),!0)}}clearConsoleClick.addEventListener("click",clearConsole,!1),clearConsoleClick.addEventListener("click",clearConsole,!1);var audio,loadDropdown,verboseLoggingClick=document.getElementById("verboseLoggingClick");function newSound(e){var t=e+100*(1e6*Math.random()|1);parent.frames[4],document.getElementById("consoletextarea");consolePrint(generatorNames[e]+' : <span class="cm-SOUND" onclick="playSound('+t.toString()+')">'+t.toString()+"</span>",!0);var n=generateFromSeed(t);n.sound_vol=SOUND_VOL,n.sample_rate=SAMPLE_RATE,n.bit_depth=BIT_DEPTH,SoundEffect.generate(n).play()}function buttonPress(){var e=document.getElementById("sounddat").value,t=generateFromSeed(e);t.sound_vol=SOUND_VOL,t.sample_rate=SAMPLE_RATE,t.bit_depth=BIT_DEPTH,SoundEffect.generate(t).play()}function solveClick(){confirm("Use the solver? It can be slow & crash on big levels, so please save beforehand. Doesn't work for mouse controlled games.")&&solve()}function runClick(){clearConsole(),compile(["restart"])}function levelEditorClick_Fn(){textMode||0===state.levels.length?(compile(["loadLevel",0]),levelEditorOpened=!0,canvasResize()):(levelEditorOpened=!levelEditorOpened,canvasResize()),lastDownTarget=canvas}function printUnauthorized(){consolePrint('<br>PuzzleScript needs permission to share games through GitHub:<br><ul><li><a target="_blank" href="'+getAuthURL()+'">Give PuzzleScript permission</a></li></ul>',!0)}function cancelClick(){stopSolving()}function runClick(){clearConsole(),compile(["restart"])}function dateToReadable(e,t){var n=t.getFullYear(),r=t.getMonth()+1,o=t.getDate(),i=t.getHours(),s=t.getMinutes(),a=t.getSeconds();return r<10&&(r="0"+r),o<10&&(o="0"+o),i<10&&(i="0"+i),s<10&&(s="0"+s),a<10&&(a="0"+a),i+":"+s+" "+n+"-"+r+"-"+o+" "+e}function saveClick(){var e="Untitled";void 0!==state.metadata.title&&(e=state.metadata.title);var t={title:e,text:editor.getValue(),date:new Date},n=[];if(storage_has("saves"))n=JSON.parse(storage_get("saves"));n.length>maximumsavedprojects&&n.splice(0,1),n.push(t);var r=JSON.stringify(n);try{storage_set("saves",r)}catch(e){return console.log(e),void consoleError("Was not able to save the project. This likely has something to do with your cookie settings or, if you've already saved some projects, with local storage size limits.")}if(repopulateSaveDropdown(n),document.getElementById("loadDropDown").selectedIndex=0,setEditorClean(),consolePrint("saved file '"+e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"' to local storage",!0),window.location.href.indexOf("?hack")>=0){var o=window.location.href,i=o.substring(o.lastIndexOf("/")+1).split("?")[0];window.history.pushState({},document.title,"./"+i)}n.length===maximumsavedprojects&&consolePrint("WARNING: your <i>locally saved file list</i> has reached its maximum capacity of "+maximumsavedprojects+" files - older saved files will be deleted when you save in future.",!0)}function loadDropDownChange(){if(canExit()){var e=storage_get("saves");null===e&&consolePrint("Eek, trying to load a file, but there's no local storage found. Eek!",!0),saves=JSON.parse(e);for(var t=0;t<saves.length;t++){var n=saves[t];if(dateToReadable(n.title,new Date(n.date))==this.value){var r=n.text;return editor.setValue(r),clearConsole(),setEditorClean(),document.getElementById("loadDropDown").selectedIndex=0,unloadGame(),void compile(["restart"])}}consolePrint("Eek, trying to load a save, but couldn't find it. :(",!0)}else this.selectedIndex=0}function repopulateSaveDropdown(e){var t=document.getElementById("loadDropDown");if(t.options.length=0,void 0===e)try{if(!storage_has("saves"))return;e=JSON.parse(storage_get("saves"))}catch(e){return}(o=document.createElement("OPTION")).text="Load",o.value="Load",t.options.add(o);for(var n=e.length-1;n>=0;n--){var r=e[n],o=document.createElement("OPTION"),i=dateToReadable(r.title,new Date(r.date));o.text=i,o.value=i,t.options.add(o)}t.selectedIndex=0}function levelEditorClick_Fn(){textMode||0===state.levels.length?(compile(["loadLevel",0]),levelEditorOpened=!0,canvasResize()):(levelEditorOpened=!levelEditorOpened,canvasResize()),lastDownTarget=canvas}verboseLoggingClick.addEventListener("click",verboseToggle,!1),verboseLoggingClick.addEventListener("click",verboseToggle,!1),maximumsavedprojects=50,repopulateSaveDropdown(),(loadDropdown=document.getElementById("loadDropDown")).selectedIndex=0,window.addEventListener("pageshow",(function(e){(e.persisted||void 0!==window.performance&&2===window.performance.navigation.type)&&window.location.reload()})),window.addEventListener("popstate",(function(e){console.log("hey"),location.reload()})),repopulateSaveDropdown(),(loadDropdown=document.getElementById("loadDropDown")).selectedIndex=0;const HOSTPAGEURL="https://auroriax.github.io/PuzzleScript",PSFORKNAME="Puzzlescript Plus";function getAuthURL(){return HOSTPAGEURL+"/auth_pat.html"}function printUnauthorized(){const e=getAuthURL();consolePrint("<br>"+PSFORKNAME+' needs permission to share/save games through GitHub:<br><ul><li><a target="_blank" href="'+e+'">Give '+PSFORKNAME+" permission</a></li></ul>",!0)}function shareClick(){return shareOnGitHub(!0)}function cloudSaveClick(){return shareOnGitHub(!1)}function shareClick(){var e=storage_get("oauth_access_token");if("string"!=typeof e)return void printUnauthorized();consolePrint("<br>Sending code to github...",!0);const t=void 0!==state.metadata.title?state.metadata.title+" ("+PSFORKNAME+" Script)":"Untitled "+PSFORKNAME+" Script";compile(["rebuild"]);const n=editor.getValue();var r={description:t,public:!0,files:{"readme.txt":{content:"Play this game by pasting the script in "+HOSTPAGEURL+"/editor.html"},"script.txt":{content:n}}};var o=new XMLHttpRequest;o.open("POST","https://api.github.com/gists"),o.onreadystatechange=function(){if(4==o.readyState){var e=JSON.parse(o.responseText);if(403===o.status)consoleError(e.message);else if(200!==o.status&&201!==o.status)"Unauthorized"===o.statusText?(consoleError("Authorization check failed.  You have to log back into GitHub (or give it permission again or something)."),storage_remove("oauth_access_token")):(consoleError("HTTP Error "+o.status+" - "+o.statusText),consoleError("Try giving "+PSFORKNAME+" permission again, that might fix things...")),printUnauthorized();else{const t=e.id,n=qualifyURL("play.html?p="+t),r=qualifyURL("editor.html?hack="+t),o='Link to source code:<br><a target="_blank"  href="'+r+'">'+r+"</a>";consolePrint('GitHub (<a onclick="githubLogOut();"  href="javascript:void(0);">log out</a>) submission successful.<br>',!0),consolePrint("<br>"+o,!0),consolePrint('<br>The game can now be played at this url:<br><a target="_blank" href="'+n+'">'+n+"</a>",!0)}}},o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("Authorization","token "+e);const i=JSON.stringify(r);o.send(i),lastDownTarget=canvas}function githubLogOut(){storage_remove("oauth_access_token");consolePrint('<br>Logged out of Github.<br><ul><li><a target="_blank" href="'+getAuthURL()+'">Give '+PSFORKNAME+" permission</a></li></ul>",!0)}function rebuildClick(){compile(["rebuild"])}function post_to_url(e,t,n){n=n||"post";var r=document.createElement("form");for(var o in r.setAttribute("method",n),r.setAttribute("action",e),t)if(t.hasOwnProperty(o)){var i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name",o),i.setAttribute("value",t[o]),r.appendChild(i)}document.body.appendChild(r),r.submit()}function exportClick(){var e=editor.getValue();compile("restart"),buildStandalone(JSON.stringify(e))}var soundbarwidth=100,lowerbarheight=document.getElementById("soundbar").clientHeight,upperbarheight=document.getElementById("uppertoolbar").clientHeight,winwidth=window.innerWidth,winheight=window.innerHeight,verticaldragbarWidth=document.getElementById("verticaldragbar").clientWidth,horizontaldragbarHeight=document.getElementById("horizontaldragbar").clientHeight,minimumDimension=100;function resize_widths(e){document.getElementById("leftpanel").style.width=e+"px",document.getElementById("righttophalf").style.left=e+verticaldragbarWidth+"px",document.getElementById("rightbottomhalf").style.left=e+verticaldragbarWidth+"px",document.getElementById("horizontaldragbar").style.left=e+verticaldragbarWidth+"px",document.getElementById("verticaldragbar").style.left=e+"px",canvasResize()}function resize_heights(e){document.getElementById("leftpanel").style.height=window.innerHeight-upperbarheight+"px",document.getElementById("verticaldragbar").style.height=window.innerHeight-upperbarheight+"px",document.getElementById("righttophalf").style.height=e-upperbarheight+"px",document.getElementById("rightbottomhalf").style.top=e+horizontaldragbarHeight+"px",document.getElementById("horizontaldragbar").style.top=e+"px",canvasResize()}function resize_all(e){smallmovelimit=100,hdiff=window.innerWidth-winwidth,verticaldragbarX=parseInt(document.getElementById("verticaldragbar").style.left.replace("px","")),hdiff>-smallmovelimit&&hdiff<smallmovelimit?verticaldragbarX+=hdiff:verticaldragbarX*=window.innerWidth/winwidth,verticaldragbarX<=minimumDimension?verticaldragbarX=minimumDimension:window.innerWidth-verticaldragbarX<soundbarwidth&&(verticaldragbarX=window.innerWidth-soundbarwidth),resize_widths(verticaldragbarX),horizontaldragbarY=parseInt(document.getElementById("horizontaldragbar").style.top.replace("px","")),vdiff=window.innerHeight-winheight,vdiff>-smallmovelimit&&vdiff<smallmovelimit?horizontaldragbarY+=vdiff:horizontaldragbarY*=window.innerHeight/winheight,horizontaldragbarY<=upperbarheight+minimumDimension?horizontaldragbarY=upperbarheight+minimumDimension:window.innerHeight-horizontaldragbarY<lowerbarheight+minimumDimension&&(horizontaldragbarY=window.innerHeight-(lowerbarheight+minimumDimension+5)),resize_heights(horizontaldragbarY),winwidth=window.innerWidth,winheight=window.innerHeight}function verticalDragbarMouseDown(e){e.preventDefault(),document.body.style.cursor="col-resize",window.addEventListener("mousemove",verticalDragbarMouseMove,!1),window.addEventListener("mouseup",verticalDragbarMouseUp,!1)}function verticalDragbarMouseMove(e){e.pageX<=minimumDimension?resize_widths(minimumDimension):window.innerWidth-e.pageX>soundbarwidth?resize_widths(e.pageX-1):resize_widths(window.innerWidth-soundbarwidth)}function verticalDragbarMouseUp(e){document.body.style.cursor="",window.removeEventListener("mousemove",verticalDragbarMouseMove,!1)}function horizontalDragbarMouseDown(e){e.preventDefault(),document.body.style.cursor="row-resize",window.addEventListener("mousemove",horizontalDragbarMouseMove,!1),window.addEventListener("mouseup",horizontalDragbarMouseUp,!1)}function horizontalDragbarMouseMove(e){e.pageY<=upperbarheight+minimumDimension?resize_heights(upperbarheight+minimumDimension):window.innerHeight-e.pageY>lowerbarheight+minimumDimension?resize_heights(e.pageY-1):resize_heights(window.innerHeight-lowerbarheight-minimumDimension)}function horizontalDragbarMouseUp(e){document.body.style.cursor="",window.removeEventListener("mousemove",horizontalDragbarMouseMove,!1)}function reset_panels(){resize_widths(Math.floor(window.innerWidth/2)),resize_heights(Math.floor(window.innerHeight/2)),winwidth=window.innerWidth,winheight=window.innerHeight}for(i=0;i<10;i++){var idname="newsound"+i,el=document.getElementById(idname);el.addEventListener("click",function(e){return function(){return newSound(e)}}(i),!1)}var solveClickLink=document.getElementById("solveClickLink");solveClickLink.addEventListener("click",solveClick,!1);var cancelClickLink=document.getElementById("cancelClickLink");cancelClickLink.addEventListener("click",cancelClick,!1);var runClickLink=document.getElementById("runClickLink");runClickLink.addEventListener("click",runClick,!1);var saveClickLink=document.getElementById("saveClickLink");saveClickLink.addEventListener("click",saveClick,!1);var rebuildClickLink=document.getElementById("rebuildClickLink");rebuildClickLink.addEventListener("click",rebuildClick,!1);var shareClickLink=document.getElementById("shareClickLink");shareClickLink.addEventListener("click",shareClick,!1);var levelEditorClickLink=document.getElementById("levelEditorClickLink");levelEditorClickLink.addEventListener("click",levelEditorClick_Fn,!1);var exportClickLink=document.getElementById("exportClickLink");exportClickLink.addEventListener("click",exportClick,!1);var exampleDropdown=document.getElementById("exampleDropdown");exampleDropdown.addEventListener("change",dropdownChange,!1);var loadDropDown=document.getElementById("loadDropDown");loadDropDown.addEventListener("change",loadDropDownChange,!1);var horizontalDragbar=document.getElementById("horizontaldragbar");horizontalDragbar.addEventListener("mousedown",horizontalDragbarMouseDown,!1);var verticalDragbar=document.getElementById("verticaldragbar");verticalDragbar.addEventListener("mousedown",verticalDragbarMouseDown,!1),window.addEventListener("resize",resize_all,!1),window.addEventListener("load",reset_panels,!1),window.onbeforeunload=function(e){e=e||window.event;var t="You have unsaved changes!";if(_editorDirty)return e&&(e.returnValue=t),t};var gestureHandler=Mobile.enable();gestureHandler&&gestureHandler.setFocusElement(document.getElementById("gameCanvas"));var abortSolver=!1,solving=!1;const timeout=e=>new Promise((t=>setTimeout(t,e)));function byScoreAndLength(e,t){return e[0]!=t[0]?e[0]<t[0]:e[2].length<t[2].length}var distanceTable;async function solve(){if(!levelEditorOpened&&!solving&&!textMode&&0!==state.levels.length){var e=!1;verbose_logging&&(verbose_logging=!1,cache_console_messages=!1,e=!0,consolePrint("Disabling verbose logging to speed up solver")),precalcDistances(),abortSolver=!1,muted=!0,solving=!0,restartTarget=backupLevel(),hasUsedCheckpoint=!1,backups=[];var t=deltatime;deltatime=0;var n=[0,1,2,3,4];"noaction"in state.metadata&&(n=[0,1,2,3]);var r="uldrx",o={};o[level.objects]=!0;var i=new FastPriorityQueue(byScoreAndLength);i.add([0,level.objects.slice(0),""]),consolePrint("searching...");var s=document.getElementById("solvingProgress"),a=document.getElementById("cancelClickLink");a.hidden=!1;for(var l=0,c=1;!i.isEmpty();){if(abortSolver){consolePrint("solver aborted"),a.hidden=!0,verbose_logging=e,cache_console_messages=e;break}++l>250&&(l=0,s.innerHTML="searched: "+c,redraw(),await timeout(1));var u=i.poll(),d=u[1],h=u[2];shuffleALittle(n);for(var p=0,f=n.length;p<f;p++){for(var g=0,m=d.length;g<m;g++)level.objects[g]=d[g];for(var v=processInput(n[p]);againing;)v=processInput(-1)||v;if(v){if(level.objects in o)continue;var y=h+r[n[p]];if(winning||hasUsedCheckpoint){hasUsedCheckpoint=!1;var _="("+chunkString(y,5).join(" ")+")";verbose_logging=!0,cache_console_messages=!0,consolePrint("solution found: ("+y.length+" steps, "+c+" positions explored)"),consolePrint(_),console.log("solution found:\n"+_);if(y.length>=200)consolePrint("More than 200 steps needed to solve puzzle, not printing individual states");else{winning=!1,verbose_logging=!1,DoRestart(),addToDebugTimeline(level,0);for(p=0;p!=y.length;p++){var b=y[p],w=-1;for(j=0;j!=r.length;j++)if(b==r[j]){w=j;break}verbose_logging=!1;var S=0;for(processInput(w);againing;)processInput(-1),S++;verbose_logging=!0;var C="Turn "+(p+1)+", input "+b;S>=1&&(C+=" (again turns: "+S+")"),consolePrint(C,!1,null,addToDebugTimeline(level,p+2))}}return s.innerHTML="",deltatime=t,DoRestart(),cache_console_messages=e,verbose_logging=e,solving=!1,muted=!1,winning=!1,playSound(13219900),redraw(),void(a.hidden=!0)}o[level.objects]=!0,c++,i.add([getScore(),level.objects.slice(0),y])}}}muted=!1,solving=!1,DoRestart(),consolePrint("no solution found ("+c+" positions explored)"),console.log("no solution found"),verbose_logging=e,cache_console_messages=e,s.innerHTML="",deltatime=t,playSound(52291704),redraw(),a.hidden=!0}}function stopSolving(){abortSolver=!0}function chunkString(e,t){return e.match(new RegExp(".{1,"+t+"}","g"))}function shuffleALittle(e){randomIndex=1+Math.floor(Math.random()*(e.length-1)),temporaryValue=e[0],e[0]=e[randomIndex],e[randomIndex]=temporaryValue}function distance(e,t){return Math.abs(Math.floor(e/level.height)-Math.floor(t/level.height))+Math.abs(e%level.height-t%level.height)}function precalcDistances(){distanceTable=[];for(var e=0;e<level.n_tiles;e++){ds=[];for(var t=0;t<level.n_tiles;t++)ds.push(distance(e,t));distanceTable.push(ds)}}function getScore(){var e=0,t=level.width+level.height;if(state.winconditions.length>0)for(var n=0;n<state.winconditions.length;n++){var r=state.winconditions[n],o=r[1],i=r[2];if(-1==r[0])for(var s=0;s<level.n_tiles;s++){var a=level.getCellInto(s,_o10);o.bitsClearInArray(a.data)||i.bitsClearInArray(a.data)||(e+=1)}else for(s=0;s<level.n_tiles;s++)if(!o.bitsClearInArray(level.getCellInto(s,_o10).data)){for(var l=t,c=0;c<level.n_tiles;c++)if(!i.bitsClearInArray(level.getCellInto(c,_o10).data)){var u=distanceTable[s][c];u<l&&(l=u)}e+=l}}return e}var defaultcomparator=function(e,t){return e<t};function FastPriorityQueue(e){if(!(this instanceof FastPriorityQueue))return new FastPriorityQueue(e);this.array=[],this.size=0,this.compare=e||defaultcomparator}FastPriorityQueue.prototype.clone=function(){var e=new FastPriorityQueue(this.compare);e.size=this.size;for(var t=0;t<this.size;t++)e.array.push(this.array[t]);return e},FastPriorityQueue.prototype.add=function(e){var t,n,r=this.size;for(this.array[this.size]=e,this.size+=1;r>0&&(t=r-1>>1,n=this.array[t],this.compare(e,n));)this.array[r]=n,r=t;this.array[r]=e},FastPriorityQueue.prototype.heapify=function(e){var t;for(this.array=e,this.size=e.length,t=this.size>>1;t>=0;t--)this._percolateDown(t)},FastPriorityQueue.prototype._percolateUp=function(e,t){for(var n,r,o=this.array[e];e>0&&(n=e-1>>1,r=this.array[n],t||this.compare(o,r));)this.array[e]=r,e=n;this.array[e]=o},FastPriorityQueue.prototype._percolateDown=function(e){for(var t,n,r,o=this.size,i=this.size>>>1,s=this.array[e];e<i&&(n=(t=1+(e<<1))+1,r=this.array[t],n<o&&this.compare(this.array[n],r)&&(t=n,r=this.array[n]),this.compare(r,s));)this.array[e]=r,e=t;this.array[e]=s},FastPriorityQueue.prototype._removeAt=function(e){return!(this.isEmpty()||e>this.size-1||e<0)&&(this._percolateUp(e,!0),this.poll(),!0)},FastPriorityQueue.prototype.remove=function(e,t){if(t||(t=this.compare),this.isEmpty())return!1;for(var n=0;n<this.size;n++)if(!t(this.array[n],e)&&!t(e,this.array[n]))return this._removeAt(n);return!1},FastPriorityQueue.prototype.peek=function(){if(0!=this.size)return this.array[0]},FastPriorityQueue.prototype.poll=function(){if(0!=this.size){var e=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,e}},FastPriorityQueue.prototype.replaceTop=function(e){if(0!=this.size){var t=this.array[0];return this.array[0]=e,this._percolateDown(0),t}},FastPriorityQueue.prototype.trim=function(){this.array=this.array.slice(0,this.size)},FastPriorityQueue.prototype.isEmpty=function(){return 0===this.size},FastPriorityQueue.prototype.forEach=function(e){if(!this.isEmpty()&&"function"==typeof e)for(var t=0,n=this.clone();!n.isEmpty();)e(n.poll(),t++)},FastPriorityQueue.prototype.kSmallest=function(e){if(0==this.size)return[];var t=this.compare,n=this.array,r=new FastPriorityQueue((function(e,r){return t(n[e],n[r])}));e=Math.min(this.size,e);var o=new Array(e),i=0;for(r.add(0);i<e;){var s=r.poll();o[i++]=this.array[s];var a=1+(s<<1),l=a+1;a<this.size&&r.add(a),l<this.size&&r.add(l)}return o};
//# sourceMappingURL=scripts_compiled.js.map